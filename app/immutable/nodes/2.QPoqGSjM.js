const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/BaLj8HaF.js","../chunks/BJrbMhgq.js","../chunks/zngUhAbX.js","../chunks/bH9uCY5d.js","../chunks/DSDy7V6L.js","../chunks/D6bpRoeh.js","../chunks/AwXmWqiV.js","../chunks/-suHlTGB.js"])))=>i.map(i=>d[i]);
import{b as Rf,d as o0,f as Z,a as _,e as ye,t as Ih,c as pe}from"../chunks/cbbg3mAR.js";import{a as jt,o as tr,w as nt,g as de,d as ci}from"../chunks/DKo6twJq.js";import{aJ as Tu,aK as Nh,aL as a0,h as Zt,M as tc,aM as r0,b as Iu,O as Ha,H as Oa,a as ql,n as r,aA as l0,au as c0,a2 as d0,ab as Of,an as Bs,f as Ls,a1 as Nu,as as u0,a9 as zf,c as Aa,e as Or,s as f0,aN as Ph,aq as Pu,Z as Lf,U as p0,aO as h0,aP as g0,aQ as m0,aR as Xi,r as Mh,p as Ah,aS as vd,a0 as Mu,al as nc,aT as v0,ap as y0,d as ic,x as G,K as Dh,aU as b0,at as w0,am as _0,E as x0,aV as k0,L as S0,av as nr,aW as C0,ai as Rh,aG as E0,C as Zn,j as Qn,aX as T0,aY as I0,aZ as N0,_ as Oh,o as P0,D as M0,a_ as zh,a$ as A0,b0 as D0,ah as R0,b1 as O0,b2 as z0,b3 as L0,b4 as H0,b5 as F0,b6 as B0,b7 as q0,b8 as V0,b9 as W0,W as Lh,ba as K0,bb as Hh,bc as j0,bd as Au,v as Oe,u as Fh,y as ze,z as M,A as C,X as D,be as Zs,w as ae,B as q,aa as Kt,bf as Bh,i as ut,V as $,P as E,bg as Nn,bh as Ot,bi as X0,aB as Et,bj as G0,bk as U0}from"../chunks/WhGNZ2BR.js";import{a as Y0,i as Z0,c as J0,d as Mt,n as Q0,b as $0,s as Fe,e as e1,o as Yd,f as ht,r as t1}from"../chunks/BaO-Nwd6.js";import{p as _e,r as Js,i as j,b as Jt,c as Du,s as sc,_ as oi,a as n1,d as Hf}from"../chunks/DavcfYcS.js";import{b as Ir}from"../chunks/BaeGkBtx.js";import{B as i1}from"../chunks/jHqPq_a7.js";import{s as Dn}from"../chunks/CW9PBbOt.js";import{i as s1}from"../chunks/DOnNWnzK.js";const o1=[];function qh(e,t=!1,n=!1){return Vl(e,new Map,"",o1,null,n)}function Vl(e,t,n,i,s=null,o=!1){if(typeof e=="object"&&e!==null){var a=t.get(e);if(a!==void 0)return a;if(e instanceof Map)return new Map(e);if(e instanceof Set)return new Set(e);if(Tu(e)){var l=Array(e.length);t.set(e,l),s!==null&&t.set(s,l);for(var d=0;d<e.length;d+=1){var c=e[d];d in e&&(l[d]=Vl(c,t,n,i,null,o))}return l}if(Nh(e)===a0){l={},t.set(e,l),s!==null&&t.set(s,l);for(var u in e)l[u]=Vl(e[u],t,n,i,null,o);return l}if(e instanceof Date)return structuredClone(e);if(typeof e.toJSON=="function"&&!o)return Vl(e.toJSON(),t,n,i,e)}if(e instanceof EventTarget)return e;try{return structuredClone(e)}catch{return e}}function Ff(e,t,n){Zt&&tc();var i=new i1(e),s=!r0();Iu(()=>{var o=t();s&&o!==null&&typeof o=="object"&&(o={}),i.ensure(o,n)})}function _t(e,t){return t}function a1(e,t,n){for(var i=[],s=t.length,o,a=t.length,l=0;l<s;l++){let p=t[l];Ah(p,()=>{if(o){if(o.pending.delete(p),o.done.add(p),o.pending.size===0){var f=e.outrogroups;Zd(Pu(o.done)),f.delete(o),f.size===0&&(e.outrogroups=null)}}else a-=1},!1)}if(a===0){var d=i.length===0&&n!==null;if(d){var c=n,u=c.parentNode;y0(u),u.append(c),e.items.clear()}Zd(t,!d)}else o={pending:new Set(t),done:new Set},(e.outrogroups??=new Set).add(o)}function Zd(e,t=!0){for(var n=0;n<e.length;n++)ic(e[n],t)}var Bf;function it(e,t,n,i,s,o=null){var a=e,l=new Map,d=(t&Ph)!==0;if(d){var c=e;a=Zt?Ha(Oa(c)):c.appendChild(ql())}Zt&&tc();var u=null,p=l0(()=>{var m=n();return Tu(m)?m:m==null?[]:Pu(m)}),f,h=!0;function g(){b.fallback=u,r1(b,f,a,t,i),u!==null&&(f.length===0?(u.f&Xi)===0?Mh(u):(u.f^=Xi,br(u,null,a)):Ah(u,()=>{u=null}))}var y=Iu(()=>{f=r(p);var m=f.length;let x=!1;if(Zt){var S=c0(a)===d0;S!==(m===0)&&(a=Of(),Ha(a),Bs(!1),x=!0)}for(var v=new Set,A=Aa,w=f0(),k=0;k<m;k+=1){Zt&&Ls.nodeType===Nu&&Ls.data===u0&&(a=Ls,x=!0,Bs(!1));var N=f[k],L=i(N,k),X=h?null:l.get(L);X?(X.v&&zf(X.v,N),X.i&&zf(X.i,k),w&&A.skipped_effects.delete(X.e)):(X=l1(l,h?a:Bf??=ql(),N,L,k,s,t,n),h||(X.e.f|=Xi),l.set(L,X)),v.add(L)}if(m===0&&o&&!u&&(h?u=Or(()=>o(a)):(u=Or(()=>o(Bf??=ql())),u.f|=Xi)),Zt&&m>0&&Ha(Of()),!h)if(w){for(const[O,I]of l)v.has(O)||A.skipped_effects.add(I.e);A.oncommit(g),A.ondiscard(()=>{})}else g();x&&Bs(!0),r(p)}),b={effect:y,items:l,outrogroups:null,fallback:u};h=!1,Zt&&(a=Ls)}function r1(e,t,n,i,s){var o=(i&v0)!==0,a=t.length,l=e.items,d=e.effect.first,c,u=null,p,f=[],h=[],g,y,b,m;if(o)for(m=0;m<a;m+=1)g=t[m],y=s(g,m),b=l.get(y).e,(b.f&Xi)===0&&(b.nodes?.a?.measure(),(p??=new Set).add(b));for(m=0;m<a;m+=1){if(g=t[m],y=s(g,m),b=l.get(y).e,e.outrogroups!==null)for(const X of e.outrogroups)X.pending.delete(b),X.done.delete(b);if((b.f&Xi)!==0)if(b.f^=Xi,b===d)br(b,null,n);else{var x=u?u.next:d;b===e.effect.last&&(e.effect.last=b.prev),b.prev&&(b.prev.next=b.next),b.next&&(b.next.prev=b.prev),vs(e,u,b),vs(e,b,x),br(b,x,n),u=b,f=[],h=[],d=u.next;continue}if((b.f&vd)!==0&&(Mh(b),o&&(b.nodes?.a?.unfix(),(p??=new Set).delete(b))),b!==d){if(c!==void 0&&c.has(b)){if(f.length<h.length){var S=h[0],v;u=S.prev;var A=f[0],w=f[f.length-1];for(v=0;v<f.length;v+=1)br(f[v],S,n);for(v=0;v<h.length;v+=1)c.delete(h[v]);vs(e,A.prev,w.next),vs(e,u,A),vs(e,w,S),d=S,u=w,m-=1,f=[],h=[]}else c.delete(b),br(b,d,n),vs(e,b.prev,b.next),vs(e,b,u===null?e.effect.first:u.next),vs(e,u,b),u=b;continue}for(f=[],h=[];d!==null&&d!==b;)(c??=new Set).add(d),h.push(d),d=d.next;if(d===null)continue}(b.f&Xi)===0&&f.push(b),u=b,d=b.next}if(e.outrogroups!==null){for(const X of e.outrogroups)X.pending.size===0&&(Zd(Pu(X.done)),e.outrogroups?.delete(X));e.outrogroups.size===0&&(e.outrogroups=null)}if(d!==null||c!==void 0){var k=[];if(c!==void 0)for(b of c)(b.f&vd)===0&&k.push(b);for(;d!==null;)(d.f&vd)===0&&d!==e.fallback&&k.push(d),d=d.next;var N=k.length;if(N>0){var L=(i&Ph)!==0&&a===0?n:null;if(o){for(m=0;m<N;m+=1)k[m].nodes?.a?.measure();for(m=0;m<N;m+=1)k[m].nodes?.a?.fix()}a1(e,k,L)}}o&&Mu(()=>{if(p!==void 0)for(b of p)b.nodes?.a?.apply()})}function l1(e,t,n,i,s,o,a,l){var d=(a&g0)!==0?(a&m0)===0?p0(n,!1,!1):Lf(n):null,c=(a&h0)!==0?Lf(s):null;return{v:d,i:c,e:Or(()=>(o(t,d??n,c??s,l),()=>{e.delete(i)}))}}function br(e,t,n){if(e.nodes)for(var i=e.nodes.start,s=e.nodes.end,o=t&&(t.f&Xi)===0?t.nodes.start:n;i!==null;){var a=nc(i);if(o.before(i),i===s)return;i=a}}function vs(e,t,n){t===null?e.effect.first=n:t.next=n,n===null?e.effect.last=t:n.prev=t}function Ru(e,t,n=!1,i=!1,s=!1){var o=e,a="";G(()=>{var l=Dh;if(a===(a=t()??"")){Zt&&tc();return}if(l.nodes!==null&&(b0(l.nodes.start,l.nodes.end),l.nodes=null),a!==""){if(Zt){Ls.data;for(var d=tc(),c=d;d!==null&&(d.nodeType!==Nu||d.data!=="");)c=d,d=nc(d);if(d===null)throw w0(),_0;Rf(Ls,c),o=Ha(d);return}var u=a+"";n?u=`<svg>${u}</svg>`:i&&(u=`<math>${u}</math>`);var p=o0(u);if((n||i)&&(p=Oa(p)),Rf(Oa(p),p.lastChild),n||i)for(;Oa(p);)o.before(Oa(p));else o.before(p)}})}const c1=()=>performance.now(),Ki={tick:e=>requestAnimationFrame(e),now:()=>c1(),tasks:new Set};function Vh(){const e=Ki.now();Ki.tasks.forEach(t=>{t.c(e)||(Ki.tasks.delete(t),t.f())}),Ki.tasks.size!==0&&Ki.tick(Vh)}function d1(e){let t;return Ki.tasks.size===0&&Ki.tick(Vh),{promise:new Promise(n=>{Ki.tasks.add(t={c:e,f:n})}),abort(){Ki.tasks.delete(t)}}}function _l(e,t){Rh(()=>{e.dispatchEvent(new CustomEvent(t))})}function u1(e){if(e==="float")return"cssFloat";if(e==="offset")return"cssOffset";if(e.startsWith("--"))return e;const t=e.split("-");return t.length===1?t[0]:t[0]+t.slice(1).map(n=>n[0].toUpperCase()+n.slice(1)).join("")}function qf(e){const t={},n=e.split(";");for(const i of n){const[s,o]=i.split(":");if(!s||o===void 0)break;const a=u1(s.trim());t[a]=o.trim()}return t}const f1=e=>e;function St(e,t,n,i){var s=(e&T0)!==0,o=(e&I0)!==0,a=s&&o,l=(e&C0)!==0,d=a?"both":s?"in":"out",c,u=t.inert,p=t.style.overflow,f,h;function g(){return Rh(()=>c??=n()(t,i?.()??{},{direction:d}))}var y={is_global:l,in(){if(t.inert=u,!s){h?.abort(),h?.reset?.();return}o||f?.abort(),_l(t,"introstart"),f=Jd(t,g(),h,1,()=>{_l(t,"introend"),f?.abort(),f=c=void 0,t.style.overflow=p})},out(S){if(!o){S?.(),c=void 0;return}t.inert=!0,_l(t,"outrostart"),h=Jd(t,g(),f,0,()=>{_l(t,"outroend"),S?.()})},stop:()=>{f?.abort(),h?.abort()}},b=Dh;if((b.nodes.t??=[]).push(y),s&&Y0){var m=l;if(!m){for(var x=b.parent;x&&(x.f&x0)!==0;)for(;(x=x.parent)&&(x.f&k0)===0;);m=!x||(x.f&S0)!==0}m&&nr(()=>{Qn(()=>y.in())})}}function Jd(e,t,n,i,s){var o=i===1;if(E0(t)){var a,l=!1;return Mu(()=>{if(!l){var b=t({direction:o?"in":"out"});a=Jd(e,b,n,i,s)}}),{abort:()=>{l=!0,a?.abort()},deactivate:()=>a.deactivate(),reset:()=>a.reset(),t:()=>a.t()}}if(n?.deactivate(),!t?.duration)return s(),{abort:Zn,deactivate:Zn,reset:Zn,t:()=>i};const{delay:d=0,css:c,tick:u,easing:p=f1}=t;var f=[];if(o&&n===void 0&&(u&&u(0,1),c)){var h=qf(c(0,1));f.push(h,h)}var g=()=>1-i,y=e.animate(f,{duration:d,fill:"forwards"});return y.onfinish=()=>{y.cancel();var b=n?.t()??1-i;n?.abort();var m=i-b,x=t.duration*Math.abs(m),S=[];if(x>0){var v=!1;if(c)for(var A=Math.ceil(x/16.666666666666668),w=0;w<=A;w+=1){var k=b+m*p(w/A),N=qf(c(k,1-k));S.push(N),v||=N.overflow==="hidden"}v&&(e.style.overflow="hidden"),g=()=>{var L=y.currentTime;return b+m*p(L/x)},u&&d1(()=>{if(y.playState!=="running")return!1;var L=g();return u(L,1-L),!0})}y=e.animate(S,{duration:x,fill:"forwards"}),y.onfinish=()=>{g=()=>i,u?.(i,1-i),s()}},{abort:()=>{y&&(y.cancel(),y.effect=null,y.onfinish=Zn)},deactivate:()=>{s=Zn},reset:()=>{i===0&&u?.(1,0)},t:()=>g()}}function Ac(e,t){let n=null,i=Zt;var s;if(Zt){n=Ls;for(var o=Oa(document.head);o!==null&&(o.nodeType!==Nu||o.data!==e);)o=nc(o);if(o===null)Bs(!1);else{var a=nc(o);o.remove(),Ha(a)}}Zt||(s=document.head.appendChild(ql()));try{Iu(()=>t(s),N0)}finally{i&&(Bs(!0),Ha(n))}}function Ee(e,t,n){nr(()=>{var i=Qn(()=>t(e,n?.())||{});if(n&&i?.update){var s=!1,o={};Oh(()=>{var a=n();P0(a),s&&M0(o,a)&&(o=a,i.update(a))}),s=!0}if(i?.destroy)return()=>i.destroy()})}function p1(e,t){var n=void 0,i;zh(()=>{n!==(n=t())&&(i&&(ic(i),i=null),n&&(i=Or(()=>{nr(()=>n(e))})))})}function Wh(e){var t,n,i="";if(typeof e=="string"||typeof e=="number")i+=e;else if(typeof e=="object")if(Array.isArray(e)){var s=e.length;for(t=0;t<s;t++)e[t]&&(n=Wh(e[t]))&&(i&&(i+=" "),i+=n)}else for(n in e)e[n]&&(i&&(i+=" "),i+=n);return i}function h1(){for(var e,t,n=0,i="",s=arguments.length;n<s;n++)(e=arguments[n])&&(t=Wh(e))&&(i&&(i+=" "),i+=t);return i}function Qs(e){return typeof e=="object"?h1(e):e??""}const Vf=[...` 	
\r\fÂ \v\uFEFF`];function g1(e,t,n){var i=e==null?"":""+e;if(t&&(i=i?i+" "+t:t),n){for(var s in n)if(n[s])i=i?i+" "+s:s;else if(i.length)for(var o=s.length,a=0;(a=i.indexOf(s,a))>=0;){var l=a+o;(a===0||Vf.includes(i[a-1]))&&(l===i.length||Vf.includes(i[l]))?i=(a===0?"":i.substring(0,a))+i.substring(l+1):a=l}}return i===""?null:i}function Wf(e,t=!1){var n=t?" !important;":";",i="";for(var s in e){var o=e[s];o!=null&&o!==""&&(i+=" "+s+": "+o+n)}return i}function yd(e){return e[0]!=="-"||e[1]!=="-"?e.toLowerCase():e}function m1(e,t){if(t){var n="",i,s;if(Array.isArray(t)?(i=t[0],s=t[1]):i=t,e){e=String(e).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var o=!1,a=0,l=!1,d=[];i&&d.push(...Object.keys(i).map(yd)),s&&d.push(...Object.keys(s).map(yd));var c=0,u=-1;const y=e.length;for(var p=0;p<y;p++){var f=e[p];if(l?f==="/"&&e[p-1]==="*"&&(l=!1):o?o===f&&(o=!1):f==="/"&&e[p+1]==="*"?l=!0:f==='"'||f==="'"?o=f:f==="("?a++:f===")"&&a--,!l&&o===!1&&a===0){if(f===":"&&u===-1)u=p;else if(f===";"||p===y-1){if(u!==-1){var h=yd(e.substring(c,u).trim());if(!d.includes(h)){f!==";"&&p++;var g=e.substring(c,p).trim();n+=" "+g+";"}}c=p+1,u=-1}}}}return i&&(n+=Wf(i)),s&&(n+=Wf(s,!0)),n=n.trim(),n===""?null:n}return e==null?null:String(e)}function qe(e,t,n,i,s,o){var a=e.__className;if(Zt||a!==n||a===void 0){var l=g1(n,i,o);(!Zt||l!==e.getAttribute("class"))&&(l==null?e.removeAttribute("class"):t?e.className=l:e.setAttribute("class",l)),e.__className=n}else if(o&&s!==o)for(var d in o){var c=!!o[d];(s==null||c!==!!s[d])&&e.classList.toggle(d,c)}return o}function bd(e,t={},n,i){for(var s in n){var o=n[s];t[s]!==o&&(n[s]==null?e.style.removeProperty(s):e.style.setProperty(s,o,i))}}function wt(e,t,n,i){var s=e.__style;if(Zt||s!==t){var o=m1(t,i);(!Zt||o!==e.getAttribute("style"))&&(o==null?e.removeAttribute("style"):e.style.cssText=o),e.__style=t}else i&&(Array.isArray(i)?(bd(e,n?.[0],i[0]),bd(e,n?.[1],i[1],"important")):bd(e,n,i));return i}function oc(e,t,n=!1){if(e.multiple){if(t==null)return;if(!Tu(t))return A0();for(var i of e.options)i.selected=t.includes(Kf(i));return}for(i of e.options){var s=Kf(i);if(D0(s,t)){i.selected=!0;return}}(!n||t!==void 0)&&(e.selectedIndex=-1)}function Kh(e){var t=new MutationObserver(()=>{oc(e,e.__value)});t.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),R0(()=>{t.disconnect()})}function Kf(e){return"__value"in e?e.__value:e.value}const Ss=Symbol("class"),ji=Symbol("style"),jh=Symbol("is custom element"),Xh=Symbol("is html");function xn(e){if(Zt){var t=!1,n=()=>{if(!t){if(t=!0,e.hasAttribute("value")){var i=e.value;z(e,"value",null),e.value=i}if(e.hasAttribute("checked")){var s=e.checked;z(e,"checked",null),e.checked=s}}};e.__on_r=n,Mu(n),F0()}}function An(e,t){var n=Ou(e);n.value===(n.value=t??void 0)||e.value===t&&(t!==0||e.nodeName!=="PROGRESS")||(e.value=t??"")}function v1(e,t){t?e.hasAttribute("selected")||e.setAttribute("selected",""):e.removeAttribute("selected")}function z(e,t,n,i){var s=Ou(e);Zt&&(s[t]=e.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&e.nodeName==="LINK")||s[t]!==(s[t]=n)&&(t==="loading"&&(e[q0]=n),n==null?e.removeAttribute(t):typeof n!="string"&&Gh(e).includes(t)?e[t]=n:e.setAttribute(t,n))}function y1(e,t,n,i,s=!1,o=!1){if(Zt&&s&&e.tagName==="INPUT"){var a=e,l=a.type==="checkbox"?"defaultChecked":"defaultValue";l in n||xn(a)}var d=Ou(e),c=d[jh],u=!d[Xh];let p=Zt&&c;p&&Bs(!1);var f=t||{},h=e.tagName==="OPTION";for(var g in t)g in n||(n[g]=null);n.class?n.class=Qs(n.class):(i||n[Ss])&&(n.class=null),n[ji]&&(n.style??=null);var y=Gh(e);for(const w in n){let k=n[w];if(h&&w==="value"&&k==null){e.value=e.__value="",f[w]=k;continue}if(w==="class"){var b=e.namespaceURI==="http://www.w3.org/1999/xhtml";qe(e,b,k,i,t?.[Ss],n[Ss]),f[w]=k,f[Ss]=n[Ss];continue}if(w==="style"){wt(e,k,t?.[ji],n[ji]),f[w]=k,f[ji]=n[ji];continue}var m=f[w];if(!(k===m&&!(k===void 0&&e.hasAttribute(w)))){f[w]=k;var x=w[0]+w[1];if(x!=="$$")if(x==="on"){const N={},L="$$"+w;let X=w.slice(2);var S=$0(X);if(Z0(X)&&(X=X.slice(0,-7),N.capture=!0),!S&&m){if(k!=null)continue;e.removeEventListener(X,f[L],N),f[L]=null}if(k!=null)if(S)e[`__${X}`]=k,Mt([X]);else{let O=function(I){f[w].call(this,I)};f[L]=J0(X,e,O,N)}else S&&(e[`__${X}`]=void 0)}else if(w==="style")z(e,w,k);else if(w==="autofocus")L0(e,!!k);else if(!c&&(w==="__value"||w==="value"&&k!=null))e.value=e.__value=k;else if(w==="selected"&&h)v1(e,k);else{var v=w;u||(v=Q0(v));var A=v==="defaultValue"||v==="defaultChecked";if(k==null&&!c&&!A)if(d[w]=null,v==="value"||v==="checked"){let N=e;const L=t===void 0;if(v==="value"){let X=N.defaultValue;N.removeAttribute(v),N.defaultValue=X,N.value=N.__value=L?X:null}else{let X=N.defaultChecked;N.removeAttribute(v),N.defaultChecked=X,N.checked=L?X:!1}}else e.removeAttribute(w);else A||y.includes(v)&&(c||typeof k!="string")?(e[v]=k,v in d&&(d[v]=H0)):typeof k!="function"&&z(e,v,k)}}}return p&&Bs(!0),f}function Ns(e,t,n=[],i=[],s=[],o,a=!1,l=!1){O0(s,n,i,d=>{var c=void 0,u={},p=e.nodeName==="SELECT",f=!1;if(zh(()=>{var g=t(...d.map(r)),y=y1(e,c,g,o,a,l);f&&p&&"value"in g&&oc(e,g.value);for(let m of Object.getOwnPropertySymbols(u))g[m]||ic(u[m]);for(let m of Object.getOwnPropertySymbols(g)){var b=g[m];m.description===z0&&(!c||b!==c[m])&&(u[m]&&ic(u[m]),u[m]=Or(()=>p1(e,()=>b))),y[m]=b}c=y}),p){var h=e;nr(()=>{oc(h,c.value,!0),Kh(h)})}f=!0})}function Ou(e){return e.__attributes??={[jh]:e.nodeName.includes("-"),[Xh]:e.namespaceURI===B0}}var jf=new Map;function Gh(e){var t=e.getAttribute("is")||e.nodeName,n=jf.get(t);if(n)return n;jf.set(t,n=[]);for(var i,s=e,o=Element.prototype;o!==s;){i=V0(s);for(var a in i)i[a].set&&n.push(a);s=Nh(s)}return n}function Uh(e,t,n=t){var i=new WeakSet;W0(e,"input",async s=>{var o=s?e.defaultValue:e.value;if(o=wd(e)?_d(o):o,n(o),Aa!==null&&i.add(Aa),await Lh(),o!==(o=t())){var a=e.selectionStart,l=e.selectionEnd,d=e.value.length;if(e.value=o??"",l!==null){var c=e.value.length;a===l&&l===d&&c>d?(e.selectionStart=c,e.selectionEnd=c):(e.selectionStart=a,e.selectionEnd=Math.min(l,c))}}}),(Zt&&e.defaultValue!==e.value||Qn(t)==null&&e.value)&&(n(wd(e)?_d(e.value):e.value),Aa!==null&&i.add(Aa)),Oh(()=>{var s=t();if(e===document.activeElement){var o=K0??Aa;if(i.has(o))return}wd(e)&&s===_d(e.value)||e.type==="date"&&!s&&!e.value||s!==e.value&&(e.value=s??"")})}function wd(e){var t=e.type;return t==="number"||t==="range"}function _d(e){return e===""?null:+e}class zu{#e=new WeakMap;#t;#n;static entries=new WeakMap;constructor(t){this.#n=t}observe(t,n){var i=this.#e.get(t)||new Set;return i.add(n),this.#e.set(t,i),this.#i().observe(t,this.#n),()=>{var s=this.#e.get(t);s.delete(n),s.size===0&&(this.#e.delete(t),this.#t.unobserve(t))}}#i(){return this.#t??(this.#t=new ResizeObserver(t=>{for(var n of t){zu.entries.set(n.target,n);for(var i of this.#e.get(n.target)||[])i(n)}}))}}var b1=new zu({box:"border-box"});function Xf(e,t,n){var i=b1.observe(e,()=>n(e[t]));nr(()=>(Qn(()=>n(e[t])),i))}const w1=e=>e;function Lu(e){const t=e-1;return t*t*t+1}function Gf(e){const t=typeof e=="string"&&e.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return t?[parseFloat(t[1]),t[2]||"px"]:[e,"px"]}function mn(e,{delay:t=0,duration:n=400,easing:i=w1}={}){const s=+getComputedStyle(e).opacity;return{delay:t,duration:n,easing:i,css:o=>`opacity: ${o*s}`}}function Hu(e,{delay:t=0,duration:n=400,easing:i=Lu,x:s=0,y:o=0,opacity:a=0}={}){const l=getComputedStyle(e),d=+l.opacity,c=l.transform==="none"?"":l.transform,u=d*(1-a),[p,f]=Gf(s),[h,g]=Gf(o);return{delay:t,duration:n,easing:i,css:(y,b)=>`
			transform: ${c} translate(${(1-y)*p}${f}, ${(1-y)*h}${g});
			opacity: ${d-u*b}`}}function _1(e,{delay:t=0,duration:n=400,easing:i=Lu,axis:s="y"}={}){const o=getComputedStyle(e),a=+o.opacity,l=s==="y"?"height":"width",d=parseFloat(o[l]),c=s==="y"?["top","bottom"]:["left","right"],u=c.map(m=>`${m[0].toUpperCase()}${m.slice(1)}`),p=parseFloat(o[`padding${u[0]}`]),f=parseFloat(o[`padding${u[1]}`]),h=parseFloat(o[`margin${u[0]}`]),g=parseFloat(o[`margin${u[1]}`]),y=parseFloat(o[`border${u[0]}Width`]),b=parseFloat(o[`border${u[1]}Width`]);return{delay:t,duration:n,easing:i,css:m=>`overflow: hidden;opacity: ${Math.min(m*20,1)*a};${l}: ${m*d}px;padding-${c[0]}: ${m*p}px;padding-${c[1]}: ${m*f}px;margin-${c[0]}: ${m*h}px;margin-${c[1]}: ${m*g}px;border-${c[0]}-width: ${m*y}px;border-${c[1]}-width: ${m*b}px;min-${l}: 0`}}function Ei(e,{delay:t=0,duration:n=400,easing:i=Lu,start:s=0,opacity:o=0}={}){const a=getComputedStyle(e),l=+a.opacity,d=a.transform==="none"?"":a.transform,c=1-s,u=l*(1-o);return{delay:t,duration:n,easing:i,css:(p,f)=>`
			transform: ${d} scale(${1-c*f});
			opacity: ${l-u*f}
		`}}function di(e){const t=e-1;return t*t*t+1}var x1={value:()=>{}};function Dc(){for(var e=0,t=arguments.length,n={},i;e<t;++e){if(!(i=arguments[e]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new Wl(n)}function Wl(e){this._=e}function k1(e,t){return e.trim().split(/^|\s+/).map(function(n){var i="",s=n.indexOf(".");if(s>=0&&(i=n.slice(s+1),n=n.slice(0,s)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}Wl.prototype=Dc.prototype={constructor:Wl,on:function(e,t){var n=this._,i=k1(e+"",n),s,o=-1,a=i.length;if(arguments.length<2){for(;++o<a;)if((s=(e=i[o]).type)&&(s=S1(n[s],e.name)))return s;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++o<a;)if(s=(e=i[o]).type)n[s]=Uf(n[s],e.name,t);else if(t==null)for(s in n)n[s]=Uf(n[s],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new Wl(e)},call:function(e,t){if((s=arguments.length-2)>0)for(var n=new Array(s),i=0,s,o;i<s;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(o=this._[e],i=0,s=o.length;i<s;++i)o[i].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var i=this._[e],s=0,o=i.length;s<o;++s)i[s].value.apply(t,n)}};function S1(e,t){for(var n=0,i=e.length,s;n<i;++n)if((s=e[n]).name===t)return s.value}function Uf(e,t,n){for(var i=0,s=e.length;i<s;++i)if(e[i].name===t){e[i]=x1,e=e.slice(0,i).concat(e.slice(i+1));break}return n!=null&&e.push({name:t,value:n}),e}var Qd="http://www.w3.org/1999/xhtml";const Yf={svg:"http://www.w3.org/2000/svg",xhtml:Qd,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Rc(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),Yf.hasOwnProperty(t)?{space:Yf[t],local:e}:e}function C1(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===Qd&&t.documentElement.namespaceURI===Qd?t.createElement(e):t.createElementNS(n,e)}}function E1(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function Yh(e){var t=Rc(e);return(t.local?E1:C1)(t)}function T1(){}function Fu(e){return e==null?T1:function(){return this.querySelector(e)}}function I1(e){typeof e!="function"&&(e=Fu(e));for(var t=this._groups,n=t.length,i=new Array(n),s=0;s<n;++s)for(var o=t[s],a=o.length,l=i[s]=new Array(a),d,c,u=0;u<a;++u)(d=o[u])&&(c=e.call(d,d.__data__,u,o))&&("__data__"in d&&(c.__data__=d.__data__),l[u]=c);return new Bn(i,this._parents)}function N1(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function P1(){return[]}function Zh(e){return e==null?P1:function(){return this.querySelectorAll(e)}}function M1(e){return function(){return N1(e.apply(this,arguments))}}function A1(e){typeof e=="function"?e=M1(e):e=Zh(e);for(var t=this._groups,n=t.length,i=[],s=[],o=0;o<n;++o)for(var a=t[o],l=a.length,d,c=0;c<l;++c)(d=a[c])&&(i.push(e.call(d,d.__data__,c,a)),s.push(d));return new Bn(i,s)}function Jh(e){return function(){return this.matches(e)}}function Qh(e){return function(t){return t.matches(e)}}var D1=Array.prototype.find;function R1(e){return function(){return D1.call(this.children,e)}}function O1(){return this.firstElementChild}function z1(e){return this.select(e==null?O1:R1(typeof e=="function"?e:Qh(e)))}var L1=Array.prototype.filter;function H1(){return Array.from(this.children)}function F1(e){return function(){return L1.call(this.children,e)}}function B1(e){return this.selectAll(e==null?H1:F1(typeof e=="function"?e:Qh(e)))}function q1(e){typeof e!="function"&&(e=Jh(e));for(var t=this._groups,n=t.length,i=new Array(n),s=0;s<n;++s)for(var o=t[s],a=o.length,l=i[s]=[],d,c=0;c<a;++c)(d=o[c])&&e.call(d,d.__data__,c,o)&&l.push(d);return new Bn(i,this._parents)}function $h(e){return new Array(e.length)}function V1(){return new Bn(this._enter||this._groups.map($h),this._parents)}function ac(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}ac.prototype={constructor:ac,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function W1(e){return function(){return e}}function K1(e,t,n,i,s,o){for(var a=0,l,d=t.length,c=o.length;a<c;++a)(l=t[a])?(l.__data__=o[a],i[a]=l):n[a]=new ac(e,o[a]);for(;a<d;++a)(l=t[a])&&(s[a]=l)}function j1(e,t,n,i,s,o,a){var l,d,c=new Map,u=t.length,p=o.length,f=new Array(u),h;for(l=0;l<u;++l)(d=t[l])&&(f[l]=h=a.call(d,d.__data__,l,t)+"",c.has(h)?s[l]=d:c.set(h,d));for(l=0;l<p;++l)h=a.call(e,o[l],l,o)+"",(d=c.get(h))?(i[l]=d,d.__data__=o[l],c.delete(h)):n[l]=new ac(e,o[l]);for(l=0;l<u;++l)(d=t[l])&&c.get(f[l])===d&&(s[l]=d)}function X1(e){return e.__data__}function G1(e,t){if(!arguments.length)return Array.from(this,X1);var n=t?j1:K1,i=this._parents,s=this._groups;typeof e!="function"&&(e=W1(e));for(var o=s.length,a=new Array(o),l=new Array(o),d=new Array(o),c=0;c<o;++c){var u=i[c],p=s[c],f=p.length,h=U1(e.call(u,u&&u.__data__,c,i)),g=h.length,y=l[c]=new Array(g),b=a[c]=new Array(g),m=d[c]=new Array(f);n(u,p,y,b,m,h,t);for(var x=0,S=0,v,A;x<g;++x)if(v=y[x]){for(x>=S&&(S=x+1);!(A=b[S])&&++S<g;);v._next=A||null}}return a=new Bn(a,i),a._enter=l,a._exit=d,a}function U1(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function Y1(){return new Bn(this._exit||this._groups.map($h),this._parents)}function Z1(e,t,n){var i=this.enter(),s=this,o=this.exit();return typeof e=="function"?(i=e(i),i&&(i=i.selection())):i=i.append(e+""),t!=null&&(s=t(s),s&&(s=s.selection())),n==null?o.remove():n(o),i&&s?i.merge(s).order():s}function J1(e){for(var t=e.selection?e.selection():e,n=this._groups,i=t._groups,s=n.length,o=i.length,a=Math.min(s,o),l=new Array(s),d=0;d<a;++d)for(var c=n[d],u=i[d],p=c.length,f=l[d]=new Array(p),h,g=0;g<p;++g)(h=c[g]||u[g])&&(f[g]=h);for(;d<s;++d)l[d]=n[d];return new Bn(l,this._parents)}function Q1(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var i=e[t],s=i.length-1,o=i[s],a;--s>=0;)(a=i[s])&&(o&&a.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(a,o),o=a);return this}function $1(e){e||(e=ew);function t(p,f){return p&&f?e(p.__data__,f.__data__):!p-!f}for(var n=this._groups,i=n.length,s=new Array(i),o=0;o<i;++o){for(var a=n[o],l=a.length,d=s[o]=new Array(l),c,u=0;u<l;++u)(c=a[u])&&(d[u]=c);d.sort(t)}return new Bn(s,this._parents).order()}function ew(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function tw(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function nw(){return Array.from(this)}function iw(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i=e[t],s=0,o=i.length;s<o;++s){var a=i[s];if(a)return a}return null}function sw(){let e=0;for(const t of this)++e;return e}function ow(){return!this.node()}function aw(e){for(var t=this._groups,n=0,i=t.length;n<i;++n)for(var s=t[n],o=0,a=s.length,l;o<a;++o)(l=s[o])&&e.call(l,l.__data__,o,s);return this}function rw(e){return function(){this.removeAttribute(e)}}function lw(e){return function(){this.removeAttributeNS(e.space,e.local)}}function cw(e,t){return function(){this.setAttribute(e,t)}}function dw(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function uw(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function fw(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function pw(e,t){var n=Rc(e);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((t==null?n.local?lw:rw:typeof t=="function"?n.local?fw:uw:n.local?dw:cw)(n,t))}function eg(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function hw(e){return function(){this.style.removeProperty(e)}}function gw(e,t,n){return function(){this.style.setProperty(e,t,n)}}function mw(e,t,n){return function(){var i=t.apply(this,arguments);i==null?this.style.removeProperty(e):this.style.setProperty(e,i,n)}}function vw(e,t,n){return arguments.length>1?this.each((t==null?hw:typeof t=="function"?mw:gw)(e,t,n??"")):ja(this.node(),e)}function ja(e,t){return e.style.getPropertyValue(t)||eg(e).getComputedStyle(e,null).getPropertyValue(t)}function yw(e){return function(){delete this[e]}}function bw(e,t){return function(){this[e]=t}}function ww(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function _w(e,t){return arguments.length>1?this.each((t==null?yw:typeof t=="function"?ww:bw)(e,t)):this.node()[e]}function tg(e){return e.trim().split(/^|\s+/)}function Bu(e){return e.classList||new ng(e)}function ng(e){this._node=e,this._names=tg(e.getAttribute("class")||"")}ng.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function ig(e,t){for(var n=Bu(e),i=-1,s=t.length;++i<s;)n.add(t[i])}function sg(e,t){for(var n=Bu(e),i=-1,s=t.length;++i<s;)n.remove(t[i])}function xw(e){return function(){ig(this,e)}}function kw(e){return function(){sg(this,e)}}function Sw(e,t){return function(){(t.apply(this,arguments)?ig:sg)(this,e)}}function Cw(e,t){var n=tg(e+"");if(arguments.length<2){for(var i=Bu(this.node()),s=-1,o=n.length;++s<o;)if(!i.contains(n[s]))return!1;return!0}return this.each((typeof t=="function"?Sw:t?xw:kw)(n,t))}function Ew(){this.textContent=""}function Tw(e){return function(){this.textContent=e}}function Iw(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function Nw(e){return arguments.length?this.each(e==null?Ew:(typeof e=="function"?Iw:Tw)(e)):this.node().textContent}function Pw(){this.innerHTML=""}function Mw(e){return function(){this.innerHTML=e}}function Aw(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function Dw(e){return arguments.length?this.each(e==null?Pw:(typeof e=="function"?Aw:Mw)(e)):this.node().innerHTML}function Rw(){this.nextSibling&&this.parentNode.appendChild(this)}function Ow(){return this.each(Rw)}function zw(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Lw(){return this.each(zw)}function Hw(e){var t=typeof e=="function"?e:Yh(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function Fw(){return null}function Bw(e,t){var n=typeof e=="function"?e:Yh(e),i=t==null?Fw:typeof t=="function"?t:Fu(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})}function qw(){var e=this.parentNode;e&&e.removeChild(this)}function Vw(){return this.each(qw)}function Ww(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Kw(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function jw(e){return this.select(e?Kw:Ww)}function Xw(e){return arguments.length?this.property("__data__",e):this.node().__data__}function Gw(e){return function(t){e.call(this,t,this.__data__)}}function Uw(e){return e.trim().split(/^|\s+/).map(function(t){var n="",i=t.indexOf(".");return i>=0&&(n=t.slice(i+1),t=t.slice(0,i)),{type:t,name:n}})}function Yw(e){return function(){var t=this.__on;if(t){for(var n=0,i=-1,s=t.length,o;n<s;++n)o=t[n],(!e.type||o.type===e.type)&&o.name===e.name?this.removeEventListener(o.type,o.listener,o.options):t[++i]=o;++i?t.length=i:delete this.__on}}}function Zw(e,t,n){return function(){var i=this.__on,s,o=Gw(t);if(i){for(var a=0,l=i.length;a<l;++a)if((s=i[a]).type===e.type&&s.name===e.name){this.removeEventListener(s.type,s.listener,s.options),this.addEventListener(s.type,s.listener=o,s.options=n),s.value=t;return}}this.addEventListener(e.type,o,n),s={type:e.type,name:e.name,value:t,listener:o,options:n},i?i.push(s):this.__on=[s]}}function Jw(e,t,n){var i=Uw(e+""),s,o=i.length,a;if(arguments.length<2){var l=this.node().__on;if(l){for(var d=0,c=l.length,u;d<c;++d)for(s=0,u=l[d];s<o;++s)if((a=i[s]).type===u.type&&a.name===u.name)return u.value}return}for(l=t?Zw:Yw,s=0;s<o;++s)this.each(l(i[s],t,n));return this}function og(e,t,n){var i=eg(e),s=i.CustomEvent;typeof s=="function"?s=new s(t,n):(s=i.document.createEvent("Event"),n?(s.initEvent(t,n.bubbles,n.cancelable),s.detail=n.detail):s.initEvent(t,!1,!1)),e.dispatchEvent(s)}function Qw(e,t){return function(){return og(this,e,t)}}function $w(e,t){return function(){return og(this,e,t.apply(this,arguments))}}function e_(e,t){return this.each((typeof t=="function"?$w:Qw)(e,t))}function*t_(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i=e[t],s=0,o=i.length,a;s<o;++s)(a=i[s])&&(yield a)}var ag=[null];function Bn(e,t){this._groups=e,this._parents=t}function Ur(){return new Bn([[document.documentElement]],ag)}function n_(){return this}Bn.prototype=Ur.prototype={constructor:Bn,select:I1,selectAll:A1,selectChild:z1,selectChildren:B1,filter:q1,data:G1,enter:V1,exit:Y1,join:Z1,merge:J1,selection:n_,order:Q1,sort:$1,call:tw,nodes:nw,node:iw,size:sw,empty:ow,each:aw,attr:pw,style:vw,property:_w,classed:Cw,text:Nw,html:Dw,raise:Ow,lower:Lw,append:Hw,insert:Bw,remove:Vw,clone:jw,datum:Xw,on:Jw,dispatch:e_,[Symbol.iterator]:t_};function Jn(e){return typeof e=="string"?new Bn([[document.querySelector(e)]],[document.documentElement]):new Bn([[e]],ag)}function i_(e){let t;for(;t=e.sourceEvent;)e=t;return e}function mi(e,t){if(e=i_(e),t===void 0&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=e.clientX,i.y=e.clientY,i=i.matrixTransform(t.getScreenCTM().inverse()),[i.x,i.y]}if(t.getBoundingClientRect){var s=t.getBoundingClientRect();return[e.clientX-s.left-t.clientLeft,e.clientY-s.top-t.clientTop]}}return[e.pageX,e.pageY]}const s_={passive:!1},zr={capture:!0,passive:!1};function xd(e){e.stopImmediatePropagation()}function Fa(e){e.preventDefault(),e.stopImmediatePropagation()}function rg(e){var t=e.document.documentElement,n=Jn(e).on("dragstart.drag",Fa,zr);"onselectstart"in t?n.on("selectstart.drag",Fa,zr):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function lg(e,t){var n=e.document.documentElement,i=Jn(e).on("dragstart.drag",null);t&&(i.on("click.drag",Fa,zr),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const xl=e=>()=>e;function $d(e,{sourceEvent:t,subject:n,target:i,identifier:s,active:o,x:a,y:l,dx:d,dy:c,dispatch:u}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},identifier:{value:s,enumerable:!0,configurable:!0},active:{value:o,enumerable:!0,configurable:!0},x:{value:a,enumerable:!0,configurable:!0},y:{value:l,enumerable:!0,configurable:!0},dx:{value:d,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:u}})}$d.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function o_(e){return!e.ctrlKey&&!e.button}function a_(){return this.parentNode}function r_(e,t){return t??{x:e.x,y:e.y}}function l_(){return navigator.maxTouchPoints||"ontouchstart"in this}function cg(){var e=o_,t=a_,n=r_,i=l_,s={},o=Dc("start","drag","end"),a=0,l,d,c,u,p=0;function f(v){v.on("mousedown.drag",h).filter(i).on("touchstart.drag",b).on("touchmove.drag",m,s_).on("touchend.drag touchcancel.drag",x).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function h(v,A){if(!(u||!e.call(this,v,A))){var w=S(this,t.call(this,v,A),v,A,"mouse");w&&(Jn(v.view).on("mousemove.drag",g,zr).on("mouseup.drag",y,zr),rg(v.view),xd(v),c=!1,l=v.clientX,d=v.clientY,w("start",v))}}function g(v){if(Fa(v),!c){var A=v.clientX-l,w=v.clientY-d;c=A*A+w*w>p}s.mouse("drag",v)}function y(v){Jn(v.view).on("mousemove.drag mouseup.drag",null),lg(v.view,c),Fa(v),s.mouse("end",v)}function b(v,A){if(e.call(this,v,A)){var w=v.changedTouches,k=t.call(this,v,A),N=w.length,L,X;for(L=0;L<N;++L)(X=S(this,k,v,A,w[L].identifier,w[L]))&&(xd(v),X("start",v,w[L]))}}function m(v){var A=v.changedTouches,w=A.length,k,N;for(k=0;k<w;++k)(N=s[A[k].identifier])&&(Fa(v),N("drag",v,A[k]))}function x(v){var A=v.changedTouches,w=A.length,k,N;for(u&&clearTimeout(u),u=setTimeout(function(){u=null},500),k=0;k<w;++k)(N=s[A[k].identifier])&&(xd(v),N("end",v,A[k]))}function S(v,A,w,k,N,L){var X=o.copy(),O=mi(L||w,A),I,H,P;if((P=n.call(v,new $d("beforestart",{sourceEvent:w,target:f,identifier:N,active:a,x:O[0],y:O[1],dx:0,dy:0,dispatch:X}),k))!=null)return I=P.x-O[0]||0,H=P.y-O[1]||0,function T(R,B,V){var F=O,Y;switch(R){case"start":s[N]=T,Y=a++;break;case"end":delete s[N],--a;case"drag":O=mi(V||B,A),Y=a;break}X.call(R,v,new $d(R,{sourceEvent:B,subject:P,target:f,identifier:N,active:Y,x:O[0]+I,y:O[1]+H,dx:O[0]-F[0],dy:O[1]-F[1],dispatch:X}),k)}}return f.filter=function(v){return arguments.length?(e=typeof v=="function"?v:xl(!!v),f):e},f.container=function(v){return arguments.length?(t=typeof v=="function"?v:xl(v),f):t},f.subject=function(v){return arguments.length?(n=typeof v=="function"?v:xl(v),f):n},f.touchable=function(v){return arguments.length?(i=typeof v=="function"?v:xl(!!v),f):i},f.on=function(){var v=o.on.apply(o,arguments);return v===o?f:v},f.clickDistance=function(v){return arguments.length?(p=(v=+v)*v,f):Math.sqrt(p)},f}function qu(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function dg(e,t){var n=Object.create(e.prototype);for(var i in t)n[i]=t[i];return n}function Yr(){}var Lr=.7,rc=1/Lr,Ba="\\s*([+-]?\\d+)\\s*",Hr="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",wi="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",c_=/^#([0-9a-f]{3,8})$/,d_=new RegExp(`^rgb\\(${Ba},${Ba},${Ba}\\)$`),u_=new RegExp(`^rgb\\(${wi},${wi},${wi}\\)$`),f_=new RegExp(`^rgba\\(${Ba},${Ba},${Ba},${Hr}\\)$`),p_=new RegExp(`^rgba\\(${wi},${wi},${wi},${Hr}\\)$`),h_=new RegExp(`^hsl\\(${Hr},${wi},${wi}\\)$`),g_=new RegExp(`^hsla\\(${Hr},${wi},${wi},${Hr}\\)$`),Zf={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};qu(Yr,Vs,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:Jf,formatHex:Jf,formatHex8:m_,formatHsl:v_,formatRgb:Qf,toString:Qf});function Jf(){return this.rgb().formatHex()}function m_(){return this.rgb().formatHex8()}function v_(){return ug(this).formatHsl()}function Qf(){return this.rgb().formatRgb()}function Vs(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=c_.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?$f(t):n===3?new Rn(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?kl(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?kl(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=d_.exec(e))?new Rn(t[1],t[2],t[3],1):(t=u_.exec(e))?new Rn(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=f_.exec(e))?kl(t[1],t[2],t[3],t[4]):(t=p_.exec(e))?kl(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=h_.exec(e))?np(t[1],t[2]/100,t[3]/100,1):(t=g_.exec(e))?np(t[1],t[2]/100,t[3]/100,t[4]):Zf.hasOwnProperty(e)?$f(Zf[e]):e==="transparent"?new Rn(NaN,NaN,NaN,0):null}function $f(e){return new Rn(e>>16&255,e>>8&255,e&255,1)}function kl(e,t,n,i){return i<=0&&(e=t=n=NaN),new Rn(e,t,n,i)}function y_(e){return e instanceof Yr||(e=Vs(e)),e?(e=e.rgb(),new Rn(e.r,e.g,e.b,e.opacity)):new Rn}function eu(e,t,n,i){return arguments.length===1?y_(e):new Rn(e,t,n,i??1)}function Rn(e,t,n,i){this.r=+e,this.g=+t,this.b=+n,this.opacity=+i}qu(Rn,eu,dg(Yr,{brighter(e){return e=e==null?rc:Math.pow(rc,e),new Rn(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?Lr:Math.pow(Lr,e),new Rn(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Rn(qs(this.r),qs(this.g),qs(this.b),lc(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:ep,formatHex:ep,formatHex8:b_,formatRgb:tp,toString:tp}));function ep(){return`#${Hs(this.r)}${Hs(this.g)}${Hs(this.b)}`}function b_(){return`#${Hs(this.r)}${Hs(this.g)}${Hs(this.b)}${Hs((isNaN(this.opacity)?1:this.opacity)*255)}`}function tp(){const e=lc(this.opacity);return`${e===1?"rgb(":"rgba("}${qs(this.r)}, ${qs(this.g)}, ${qs(this.b)}${e===1?")":`, ${e})`}`}function lc(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function qs(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Hs(e){return e=qs(e),(e<16?"0":"")+e.toString(16)}function np(e,t,n,i){return i<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new ri(e,t,n,i)}function ug(e){if(e instanceof ri)return new ri(e.h,e.s,e.l,e.opacity);if(e instanceof Yr||(e=Vs(e)),!e)return new ri;if(e instanceof ri)return e;e=e.rgb();var t=e.r/255,n=e.g/255,i=e.b/255,s=Math.min(t,n,i),o=Math.max(t,n,i),a=NaN,l=o-s,d=(o+s)/2;return l?(t===o?a=(n-i)/l+(n<i)*6:n===o?a=(i-t)/l+2:a=(t-n)/l+4,l/=d<.5?o+s:2-o-s,a*=60):l=d>0&&d<1?0:a,new ri(a,l,d,e.opacity)}function w_(e,t,n,i){return arguments.length===1?ug(e):new ri(e,t,n,i??1)}function ri(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}qu(ri,w_,dg(Yr,{brighter(e){return e=e==null?rc:Math.pow(rc,e),new ri(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Lr:Math.pow(Lr,e),new ri(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*t,s=2*n-i;return new Rn(kd(e>=240?e-240:e+120,s,i),kd(e,s,i),kd(e<120?e+240:e-120,s,i),this.opacity)},clamp(){return new ri(ip(this.h),Sl(this.s),Sl(this.l),lc(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=lc(this.opacity);return`${e===1?"hsl(":"hsla("}${ip(this.h)}, ${Sl(this.s)*100}%, ${Sl(this.l)*100}%${e===1?")":`, ${e})`}`}}));function ip(e){return e=(e||0)%360,e<0?e+360:e}function Sl(e){return Math.max(0,Math.min(1,e||0))}function kd(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const Vu=e=>()=>e;function __(e,t){return function(n){return e+n*t}}function x_(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(i){return Math.pow(e+i*t,n)}}function k_(e){return(e=+e)==1?fg:function(t,n){return n-t?x_(t,n,e):Vu(isNaN(t)?n:t)}}function fg(e,t){var n=t-e;return n?__(e,n):Vu(isNaN(e)?t:e)}const cc=(function e(t){var n=k_(t);function i(s,o){var a=n((s=eu(s)).r,(o=eu(o)).r),l=n(s.g,o.g),d=n(s.b,o.b),c=fg(s.opacity,o.opacity);return function(u){return s.r=a(u),s.g=l(u),s.b=d(u),s.opacity=c(u),s+""}}return i.gamma=e,i})(1);function S_(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,i=t.slice(),s;return function(o){for(s=0;s<n;++s)i[s]=e[s]*(1-o)+t[s]*o;return i}}function C_(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function E_(e,t){var n=t?t.length:0,i=e?Math.min(n,e.length):0,s=new Array(i),o=new Array(n),a;for(a=0;a<i;++a)s[a]=Nr(e[a],t[a]);for(;a<n;++a)o[a]=t[a];return function(l){for(a=0;a<i;++a)o[a]=s[a](l);return o}}function T_(e,t){var n=new Date;return e=+e,t=+t,function(i){return n.setTime(e*(1-i)+t*i),n}}function vi(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function I_(e,t){var n={},i={},s;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(s in t)s in e?n[s]=Nr(e[s],t[s]):i[s]=t[s];return function(o){for(s in n)i[s]=n[s](o);return i}}var tu=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Sd=new RegExp(tu.source,"g");function N_(e){return function(){return e}}function P_(e){return function(t){return e(t)+""}}function pg(e,t){var n=tu.lastIndex=Sd.lastIndex=0,i,s,o,a=-1,l=[],d=[];for(e=e+"",t=t+"";(i=tu.exec(e))&&(s=Sd.exec(t));)(o=s.index)>n&&(o=t.slice(n,o),l[a]?l[a]+=o:l[++a]=o),(i=i[0])===(s=s[0])?l[a]?l[a]+=s:l[++a]=s:(l[++a]=null,d.push({i:a,x:vi(i,s)})),n=Sd.lastIndex;return n<t.length&&(o=t.slice(n),l[a]?l[a]+=o:l[++a]=o),l.length<2?d[0]?P_(d[0].x):N_(t):(t=d.length,function(c){for(var u=0,p;u<t;++u)l[(p=d[u]).i]=p.x(c);return l.join("")})}function Nr(e,t){var n=typeof t,i;return t==null||n==="boolean"?Vu(t):(n==="number"?vi:n==="string"?(i=Vs(t))?(t=i,cc):pg:t instanceof Vs?cc:t instanceof Date?T_:C_(t)?S_:Array.isArray(t)?E_:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?I_:vi)(e,t)}var sp=180/Math.PI,nu={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function hg(e,t,n,i,s,o){var a,l,d;return(a=Math.sqrt(e*e+t*t))&&(e/=a,t/=a),(d=e*n+t*i)&&(n-=e*d,i-=t*d),(l=Math.sqrt(n*n+i*i))&&(n/=l,i/=l,d/=l),e*i<t*n&&(e=-e,t=-t,d=-d,a=-a),{translateX:s,translateY:o,rotate:Math.atan2(t,e)*sp,skewX:Math.atan(d)*sp,scaleX:a,scaleY:l}}var Cl;function M_(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?nu:hg(t.a,t.b,t.c,t.d,t.e,t.f)}function A_(e){return e==null||(Cl||(Cl=document.createElementNS("http://www.w3.org/2000/svg","g")),Cl.setAttribute("transform",e),!(e=Cl.transform.baseVal.consolidate()))?nu:(e=e.matrix,hg(e.a,e.b,e.c,e.d,e.e,e.f))}function gg(e,t,n,i){function s(c){return c.length?c.pop()+" ":""}function o(c,u,p,f,h,g){if(c!==p||u!==f){var y=h.push("translate(",null,t,null,n);g.push({i:y-4,x:vi(c,p)},{i:y-2,x:vi(u,f)})}else(p||f)&&h.push("translate("+p+t+f+n)}function a(c,u,p,f){c!==u?(c-u>180?u+=360:u-c>180&&(c+=360),f.push({i:p.push(s(p)+"rotate(",null,i)-2,x:vi(c,u)})):u&&p.push(s(p)+"rotate("+u+i)}function l(c,u,p,f){c!==u?f.push({i:p.push(s(p)+"skewX(",null,i)-2,x:vi(c,u)}):u&&p.push(s(p)+"skewX("+u+i)}function d(c,u,p,f,h,g){if(c!==p||u!==f){var y=h.push(s(h)+"scale(",null,",",null,")");g.push({i:y-4,x:vi(c,p)},{i:y-2,x:vi(u,f)})}else(p!==1||f!==1)&&h.push(s(h)+"scale("+p+","+f+")")}return function(c,u){var p=[],f=[];return c=e(c),u=e(u),o(c.translateX,c.translateY,u.translateX,u.translateY,p,f),a(c.rotate,u.rotate,p,f),l(c.skewX,u.skewX,p,f),d(c.scaleX,c.scaleY,u.scaleX,u.scaleY,p,f),c=u=null,function(h){for(var g=-1,y=f.length,b;++g<y;)p[(b=f[g]).i]=b.x(h);return p.join("")}}}var D_=gg(M_,"px, ","px)","deg)"),R_=gg(A_,", ",")",")"),O_=1e-12;function op(e){return((e=Math.exp(e))+1/e)/2}function z_(e){return((e=Math.exp(e))-1/e)/2}function L_(e){return((e=Math.exp(2*e))-1)/(e+1)}const Kl=(function e(t,n,i){function s(o,a){var l=o[0],d=o[1],c=o[2],u=a[0],p=a[1],f=a[2],h=u-l,g=p-d,y=h*h+g*g,b,m;if(y<O_)m=Math.log(f/c)/t,b=function(k){return[l+k*h,d+k*g,c*Math.exp(t*k*m)]};else{var x=Math.sqrt(y),S=(f*f-c*c+i*y)/(2*c*n*x),v=(f*f-c*c-i*y)/(2*f*n*x),A=Math.log(Math.sqrt(S*S+1)-S),w=Math.log(Math.sqrt(v*v+1)-v);m=(w-A)/t,b=function(k){var N=k*m,L=op(A),X=c/(n*x)*(L*L_(t*N+A)-z_(A));return[l+X*h,d+X*g,c*L/op(t*N+A)]}}return b.duration=m*1e3*t/Math.SQRT2,b}return s.rho=function(o){var a=Math.max(.001,+o),l=a*a,d=l*l;return e(a,l,d)},s})(Math.SQRT2,2,4);var Xa=0,wr=0,pr=0,mg=1e3,dc,_r,uc=0,Ws=0,Oc=0,Fr=typeof performance=="object"&&performance.now?performance:Date,vg=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Wu(){return Ws||(vg(H_),Ws=Fr.now()+Oc)}function H_(){Ws=0}function fc(){this._call=this._time=this._next=null}fc.prototype=yg.prototype={constructor:fc,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?Wu():+n)+(t==null?0:+t),!this._next&&_r!==this&&(_r?_r._next=this:dc=this,_r=this),this._call=e,this._time=n,iu()},stop:function(){this._call&&(this._call=null,this._time=1/0,iu())}};function yg(e,t,n){var i=new fc;return i.restart(e,t,n),i}function F_(){Wu(),++Xa;for(var e=dc,t;e;)(t=Ws-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Xa}function ap(){Ws=(uc=Fr.now())+Oc,Xa=wr=0;try{F_()}finally{Xa=0,q_(),Ws=0}}function B_(){var e=Fr.now(),t=e-uc;t>mg&&(Oc-=t,uc=e)}function q_(){for(var e,t=dc,n,i=1/0;t;)t._call?(i>t._time&&(i=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:dc=n);_r=e,iu(i)}function iu(e){if(!Xa){wr&&(wr=clearTimeout(wr));var t=e-Ws;t>24?(e<1/0&&(wr=setTimeout(ap,e-Fr.now()-Oc)),pr&&(pr=clearInterval(pr))):(pr||(uc=Fr.now(),pr=setInterval(B_,mg)),Xa=1,vg(ap))}}function rp(e,t,n){var i=new fc;return t=t==null?0:+t,i.restart(s=>{i.stop(),e(s+t)},t,n),i}var V_=Dc("start","end","cancel","interrupt"),W_=[],bg=0,lp=1,su=2,jl=3,cp=4,ou=5,Xl=6;function zc(e,t,n,i,s,o){var a=e.__transition;if(!a)e.__transition={};else if(n in a)return;K_(e,n,{name:t,index:i,group:s,on:V_,tween:W_,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:bg})}function Ku(e,t){var n=ui(e,t);if(n.state>bg)throw new Error("too late; already scheduled");return n}function Ti(e,t){var n=ui(e,t);if(n.state>jl)throw new Error("too late; already running");return n}function ui(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function K_(e,t,n){var i=e.__transition,s;i[t]=n,n.timer=yg(o,0,n.time);function o(c){n.state=lp,n.timer.restart(a,n.delay,n.time),n.delay<=c&&a(c-n.delay)}function a(c){var u,p,f,h;if(n.state!==lp)return d();for(u in i)if(h=i[u],h.name===n.name){if(h.state===jl)return rp(a);h.state===cp?(h.state=Xl,h.timer.stop(),h.on.call("interrupt",e,e.__data__,h.index,h.group),delete i[u]):+u<t&&(h.state=Xl,h.timer.stop(),h.on.call("cancel",e,e.__data__,h.index,h.group),delete i[u])}if(rp(function(){n.state===jl&&(n.state=cp,n.timer.restart(l,n.delay,n.time),l(c))}),n.state=su,n.on.call("start",e,e.__data__,n.index,n.group),n.state===su){for(n.state=jl,s=new Array(f=n.tween.length),u=0,p=-1;u<f;++u)(h=n.tween[u].value.call(e,e.__data__,n.index,n.group))&&(s[++p]=h);s.length=p+1}}function l(c){for(var u=c<n.duration?n.ease.call(null,c/n.duration):(n.timer.restart(d),n.state=ou,1),p=-1,f=s.length;++p<f;)s[p].call(e,u);n.state===ou&&(n.on.call("end",e,e.__data__,n.index,n.group),d())}function d(){n.state=Xl,n.timer.stop(),delete i[t];for(var c in i)return;delete e.__transition}}function Gl(e,t){var n=e.__transition,i,s,o=!0,a;if(n){t=t==null?null:t+"";for(a in n){if((i=n[a]).name!==t){o=!1;continue}s=i.state>su&&i.state<ou,i.state=Xl,i.timer.stop(),i.on.call(s?"interrupt":"cancel",e,e.__data__,i.index,i.group),delete n[a]}o&&delete e.__transition}}function j_(e){return this.each(function(){Gl(this,e)})}function X_(e,t){var n,i;return function(){var s=Ti(this,e),o=s.tween;if(o!==n){i=n=o;for(var a=0,l=i.length;a<l;++a)if(i[a].name===t){i=i.slice(),i.splice(a,1);break}}s.tween=i}}function G_(e,t,n){var i,s;if(typeof n!="function")throw new Error;return function(){var o=Ti(this,e),a=o.tween;if(a!==i){s=(i=a).slice();for(var l={name:t,value:n},d=0,c=s.length;d<c;++d)if(s[d].name===t){s[d]=l;break}d===c&&s.push(l)}o.tween=s}}function U_(e,t){var n=this._id;if(e+="",arguments.length<2){for(var i=ui(this.node(),n).tween,s=0,o=i.length,a;s<o;++s)if((a=i[s]).name===e)return a.value;return null}return this.each((t==null?X_:G_)(n,e,t))}function ju(e,t,n){var i=e._id;return e.each(function(){var s=Ti(this,i);(s.value||(s.value={}))[t]=n.apply(this,arguments)}),function(s){return ui(s,i).value[t]}}function wg(e,t){var n;return(typeof t=="number"?vi:t instanceof Vs?cc:(n=Vs(t))?(t=n,cc):pg)(e,t)}function Y_(e){return function(){this.removeAttribute(e)}}function Z_(e){return function(){this.removeAttributeNS(e.space,e.local)}}function J_(e,t,n){var i,s=n+"",o;return function(){var a=this.getAttribute(e);return a===s?null:a===i?o:o=t(i=a,n)}}function Q_(e,t,n){var i,s=n+"",o;return function(){var a=this.getAttributeNS(e.space,e.local);return a===s?null:a===i?o:o=t(i=a,n)}}function $_(e,t,n){var i,s,o;return function(){var a,l=n(this),d;return l==null?void this.removeAttribute(e):(a=this.getAttribute(e),d=l+"",a===d?null:a===i&&d===s?o:(s=d,o=t(i=a,l)))}}function ex(e,t,n){var i,s,o;return function(){var a,l=n(this),d;return l==null?void this.removeAttributeNS(e.space,e.local):(a=this.getAttributeNS(e.space,e.local),d=l+"",a===d?null:a===i&&d===s?o:(s=d,o=t(i=a,l)))}}function tx(e,t){var n=Rc(e),i=n==="transform"?R_:wg;return this.attrTween(e,typeof t=="function"?(n.local?ex:$_)(n,i,ju(this,"attr."+e,t)):t==null?(n.local?Z_:Y_)(n):(n.local?Q_:J_)(n,i,t))}function nx(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function ix(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function sx(e,t){var n,i;function s(){var o=t.apply(this,arguments);return o!==i&&(n=(i=o)&&ix(e,o)),n}return s._value=t,s}function ox(e,t){var n,i;function s(){var o=t.apply(this,arguments);return o!==i&&(n=(i=o)&&nx(e,o)),n}return s._value=t,s}function ax(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var i=Rc(e);return this.tween(n,(i.local?sx:ox)(i,t))}function rx(e,t){return function(){Ku(this,e).delay=+t.apply(this,arguments)}}function lx(e,t){return t=+t,function(){Ku(this,e).delay=t}}function cx(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?rx:lx)(t,e)):ui(this.node(),t).delay}function dx(e,t){return function(){Ti(this,e).duration=+t.apply(this,arguments)}}function ux(e,t){return t=+t,function(){Ti(this,e).duration=t}}function fx(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?dx:ux)(t,e)):ui(this.node(),t).duration}function px(e,t){if(typeof t!="function")throw new Error;return function(){Ti(this,e).ease=t}}function hx(e){var t=this._id;return arguments.length?this.each(px(t,e)):ui(this.node(),t).ease}function gx(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;Ti(this,e).ease=n}}function mx(e){if(typeof e!="function")throw new Error;return this.each(gx(this._id,e))}function vx(e){typeof e!="function"&&(e=Jh(e));for(var t=this._groups,n=t.length,i=new Array(n),s=0;s<n;++s)for(var o=t[s],a=o.length,l=i[s]=[],d,c=0;c<a;++c)(d=o[c])&&e.call(d,d.__data__,c,o)&&l.push(d);return new ts(i,this._parents,this._name,this._id)}function yx(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,i=t.length,s=n.length,o=Math.min(i,s),a=new Array(i),l=0;l<o;++l)for(var d=t[l],c=n[l],u=d.length,p=a[l]=new Array(u),f,h=0;h<u;++h)(f=d[h]||c[h])&&(p[h]=f);for(;l<i;++l)a[l]=t[l];return new ts(a,this._parents,this._name,this._id)}function bx(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function wx(e,t,n){var i,s,o=bx(t)?Ku:Ti;return function(){var a=o(this,e),l=a.on;l!==i&&(s=(i=l).copy()).on(t,n),a.on=s}}function _x(e,t){var n=this._id;return arguments.length<2?ui(this.node(),n).on.on(e):this.each(wx(n,e,t))}function xx(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function kx(){return this.on("end.remove",xx(this._id))}function Sx(e){var t=this._name,n=this._id;typeof e!="function"&&(e=Fu(e));for(var i=this._groups,s=i.length,o=new Array(s),a=0;a<s;++a)for(var l=i[a],d=l.length,c=o[a]=new Array(d),u,p,f=0;f<d;++f)(u=l[f])&&(p=e.call(u,u.__data__,f,l))&&("__data__"in u&&(p.__data__=u.__data__),c[f]=p,zc(c[f],t,n,f,c,ui(u,n)));return new ts(o,this._parents,t,n)}function Cx(e){var t=this._name,n=this._id;typeof e!="function"&&(e=Zh(e));for(var i=this._groups,s=i.length,o=[],a=[],l=0;l<s;++l)for(var d=i[l],c=d.length,u,p=0;p<c;++p)if(u=d[p]){for(var f=e.call(u,u.__data__,p,d),h,g=ui(u,n),y=0,b=f.length;y<b;++y)(h=f[y])&&zc(h,t,n,y,f,g);o.push(f),a.push(u)}return new ts(o,a,t,n)}var Ex=Ur.prototype.constructor;function Tx(){return new Ex(this._groups,this._parents)}function Ix(e,t){var n,i,s;return function(){var o=ja(this,e),a=(this.style.removeProperty(e),ja(this,e));return o===a?null:o===n&&a===i?s:s=t(n=o,i=a)}}function _g(e){return function(){this.style.removeProperty(e)}}function Nx(e,t,n){var i,s=n+"",o;return function(){var a=ja(this,e);return a===s?null:a===i?o:o=t(i=a,n)}}function Px(e,t,n){var i,s,o;return function(){var a=ja(this,e),l=n(this),d=l+"";return l==null&&(d=l=(this.style.removeProperty(e),ja(this,e))),a===d?null:a===i&&d===s?o:(s=d,o=t(i=a,l))}}function Mx(e,t){var n,i,s,o="style."+t,a="end."+o,l;return function(){var d=Ti(this,e),c=d.on,u=d.value[o]==null?l||(l=_g(t)):void 0;(c!==n||s!==u)&&(i=(n=c).copy()).on(a,s=u),d.on=i}}function Ax(e,t,n){var i=(e+="")=="transform"?D_:wg;return t==null?this.styleTween(e,Ix(e,i)).on("end.style."+e,_g(e)):typeof t=="function"?this.styleTween(e,Px(e,i,ju(this,"style."+e,t))).each(Mx(this._id,e)):this.styleTween(e,Nx(e,i,t),n).on("end.style."+e,null)}function Dx(e,t,n){return function(i){this.style.setProperty(e,t.call(this,i),n)}}function Rx(e,t,n){var i,s;function o(){var a=t.apply(this,arguments);return a!==s&&(i=(s=a)&&Dx(e,a,n)),i}return o._value=t,o}function Ox(e,t,n){var i="style."+(e+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(t==null)return this.tween(i,null);if(typeof t!="function")throw new Error;return this.tween(i,Rx(e,t,n??""))}function zx(e){return function(){this.textContent=e}}function Lx(e){return function(){var t=e(this);this.textContent=t??""}}function Hx(e){return this.tween("text",typeof e=="function"?Lx(ju(this,"text",e)):zx(e==null?"":e+""))}function Fx(e){return function(t){this.textContent=e.call(this,t)}}function Bx(e){var t,n;function i(){var s=e.apply(this,arguments);return s!==n&&(t=(n=s)&&Fx(s)),t}return i._value=e,i}function qx(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,Bx(e))}function Vx(){for(var e=this._name,t=this._id,n=xg(),i=this._groups,s=i.length,o=0;o<s;++o)for(var a=i[o],l=a.length,d,c=0;c<l;++c)if(d=a[c]){var u=ui(d,t);zc(d,e,n,c,a,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new ts(i,this._parents,e,n)}function Wx(){var e,t,n=this,i=n._id,s=n.size();return new Promise(function(o,a){var l={value:a},d={value:function(){--s===0&&o()}};n.each(function(){var c=Ti(this,i),u=c.on;u!==e&&(t=(e=u).copy(),t._.cancel.push(l),t._.interrupt.push(l),t._.end.push(d)),c.on=t}),s===0&&o()})}var Kx=0;function ts(e,t,n,i){this._groups=e,this._parents=t,this._name=n,this._id=i}function xg(){return++Kx}var Fi=Ur.prototype;ts.prototype={constructor:ts,select:Sx,selectAll:Cx,selectChild:Fi.selectChild,selectChildren:Fi.selectChildren,filter:vx,merge:yx,selection:Tx,transition:Vx,call:Fi.call,nodes:Fi.nodes,node:Fi.node,size:Fi.size,empty:Fi.empty,each:Fi.each,on:_x,attr:tx,attrTween:ax,style:Ax,styleTween:Ox,text:Hx,textTween:qx,remove:kx,tween:U_,delay:cx,duration:fx,ease:hx,easeVarying:mx,end:Wx,[Symbol.iterator]:Fi[Symbol.iterator]};function jx(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var Xx={time:null,delay:0,duration:250,ease:jx};function Gx(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function Ux(e){var t,n;e instanceof ts?(t=e._id,e=e._name):(t=xg(),(n=Xx).time=Wu(),e=e==null?null:e+"");for(var i=this._groups,s=i.length,o=0;o<s;++o)for(var a=i[o],l=a.length,d,c=0;c<l;++c)(d=a[c])&&zc(d,e,t,c,a,n||Gx(d,t));return new ts(i,this._parents,e,t)}Ur.prototype.interrupt=j_;Ur.prototype.transition=Ux;const El=e=>()=>e;function Yx(e,{sourceEvent:t,target:n,transform:i,dispatch:s}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:s}})}function Gi(e,t,n){this.k=e,this.x=t,this.y=n}Gi.prototype={constructor:Gi,scale:function(e){return e===1?this:new Gi(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new Gi(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Lc=new Gi(1,0,0);kg.prototype=Gi.prototype;function kg(e){for(;!e.__zoom;)if(!(e=e.parentNode))return Lc;return e.__zoom}function Cd(e){e.stopImmediatePropagation()}function hr(e){e.preventDefault(),e.stopImmediatePropagation()}function Zx(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function Jx(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function dp(){return this.__zoom||Lc}function Qx(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function $x(){return navigator.maxTouchPoints||"ontouchstart"in this}function e2(e,t,n){var i=e.invertX(t[0][0])-n[0][0],s=e.invertX(t[1][0])-n[1][0],o=e.invertY(t[0][1])-n[0][1],a=e.invertY(t[1][1])-n[1][1];return e.translate(s>i?(i+s)/2:Math.min(0,i)||Math.max(0,s),a>o?(o+a)/2:Math.min(0,o)||Math.max(0,a))}function t2(){var e=Zx,t=Jx,n=e2,i=Qx,s=$x,o=[0,1/0],a=[[-1/0,-1/0],[1/0,1/0]],l=250,d=Kl,c=Dc("start","zoom","end"),u,p,f,h=500,g=150,y=0,b=10;function m(P){P.property("__zoom",dp).on("wheel.zoom",N,{passive:!1}).on("mousedown.zoom",L).on("dblclick.zoom",X).filter(s).on("touchstart.zoom",O).on("touchmove.zoom",I).on("touchend.zoom touchcancel.zoom",H).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}m.transform=function(P,T,R,B){var V=P.selection?P.selection():P;V.property("__zoom",dp),P!==V?A(P,T,R,B):V.interrupt().each(function(){w(this,arguments).event(B).start().zoom(null,typeof T=="function"?T.apply(this,arguments):T).end()})},m.scaleBy=function(P,T,R,B){m.scaleTo(P,function(){var V=this.__zoom.k,F=typeof T=="function"?T.apply(this,arguments):T;return V*F},R,B)},m.scaleTo=function(P,T,R,B){m.transform(P,function(){var V=t.apply(this,arguments),F=this.__zoom,Y=R==null?v(V):typeof R=="function"?R.apply(this,arguments):R,J=F.invert(Y),ie=typeof T=="function"?T.apply(this,arguments):T;return n(S(x(F,ie),Y,J),V,a)},R,B)},m.translateBy=function(P,T,R,B){m.transform(P,function(){return n(this.__zoom.translate(typeof T=="function"?T.apply(this,arguments):T,typeof R=="function"?R.apply(this,arguments):R),t.apply(this,arguments),a)},null,B)},m.translateTo=function(P,T,R,B,V){m.transform(P,function(){var F=t.apply(this,arguments),Y=this.__zoom,J=B==null?v(F):typeof B=="function"?B.apply(this,arguments):B;return n(Lc.translate(J[0],J[1]).scale(Y.k).translate(typeof T=="function"?-T.apply(this,arguments):-T,typeof R=="function"?-R.apply(this,arguments):-R),F,a)},B,V)};function x(P,T){return T=Math.max(o[0],Math.min(o[1],T)),T===P.k?P:new Gi(T,P.x,P.y)}function S(P,T,R){var B=T[0]-R[0]*P.k,V=T[1]-R[1]*P.k;return B===P.x&&V===P.y?P:new Gi(P.k,B,V)}function v(P){return[(+P[0][0]+ +P[1][0])/2,(+P[0][1]+ +P[1][1])/2]}function A(P,T,R,B){P.on("start.zoom",function(){w(this,arguments).event(B).start()}).on("interrupt.zoom end.zoom",function(){w(this,arguments).event(B).end()}).tween("zoom",function(){var V=this,F=arguments,Y=w(V,F).event(B),J=t.apply(V,F),ie=R==null?v(J):typeof R=="function"?R.apply(V,F):R,ve=Math.max(J[1][0]-J[0][0],J[1][1]-J[0][1]),re=V.__zoom,me=typeof T=="function"?T.apply(V,F):T,ge=d(re.invert(ie).concat(ve/re.k),me.invert(ie).concat(ve/me.k));return function(Q){if(Q===1)Q=me;else{var oe=ge(Q),ue=ve/oe[2];Q=new Gi(ue,ie[0]-oe[0]*ue,ie[1]-oe[1]*ue)}Y.zoom(null,Q)}})}function w(P,T,R){return!R&&P.__zooming||new k(P,T)}function k(P,T){this.that=P,this.args=T,this.active=0,this.sourceEvent=null,this.extent=t.apply(P,T),this.taps=0}k.prototype={event:function(P){return P&&(this.sourceEvent=P),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(P,T){return this.mouse&&P!=="mouse"&&(this.mouse[1]=T.invert(this.mouse[0])),this.touch0&&P!=="touch"&&(this.touch0[1]=T.invert(this.touch0[0])),this.touch1&&P!=="touch"&&(this.touch1[1]=T.invert(this.touch1[0])),this.that.__zoom=T,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(P){var T=Jn(this.that).datum();c.call(P,this.that,new Yx(P,{sourceEvent:this.sourceEvent,target:m,transform:this.that.__zoom,dispatch:c}),T)}};function N(P,...T){if(!e.apply(this,arguments))return;var R=w(this,T).event(P),B=this.__zoom,V=Math.max(o[0],Math.min(o[1],B.k*Math.pow(2,i.apply(this,arguments)))),F=mi(P);if(R.wheel)(R.mouse[0][0]!==F[0]||R.mouse[0][1]!==F[1])&&(R.mouse[1]=B.invert(R.mouse[0]=F)),clearTimeout(R.wheel);else{if(B.k===V)return;R.mouse=[F,B.invert(F)],Gl(this),R.start()}hr(P),R.wheel=setTimeout(Y,g),R.zoom("mouse",n(S(x(B,V),R.mouse[0],R.mouse[1]),R.extent,a));function Y(){R.wheel=null,R.end()}}function L(P,...T){if(f||!e.apply(this,arguments))return;var R=P.currentTarget,B=w(this,T,!0).event(P),V=Jn(P.view).on("mousemove.zoom",ie,!0).on("mouseup.zoom",ve,!0),F=mi(P,R),Y=P.clientX,J=P.clientY;rg(P.view),Cd(P),B.mouse=[F,this.__zoom.invert(F)],Gl(this),B.start();function ie(re){if(hr(re),!B.moved){var me=re.clientX-Y,ge=re.clientY-J;B.moved=me*me+ge*ge>y}B.event(re).zoom("mouse",n(S(B.that.__zoom,B.mouse[0]=mi(re,R),B.mouse[1]),B.extent,a))}function ve(re){V.on("mousemove.zoom mouseup.zoom",null),lg(re.view,B.moved),hr(re),B.event(re).end()}}function X(P,...T){if(e.apply(this,arguments)){var R=this.__zoom,B=mi(P.changedTouches?P.changedTouches[0]:P,this),V=R.invert(B),F=R.k*(P.shiftKey?.5:2),Y=n(S(x(R,F),B,V),t.apply(this,T),a);hr(P),l>0?Jn(this).transition().duration(l).call(A,Y,B,P):Jn(this).call(m.transform,Y,B,P)}}function O(P,...T){if(e.apply(this,arguments)){var R=P.touches,B=R.length,V=w(this,T,P.changedTouches.length===B).event(P),F,Y,J,ie;for(Cd(P),Y=0;Y<B;++Y)J=R[Y],ie=mi(J,this),ie=[ie,this.__zoom.invert(ie),J.identifier],V.touch0?!V.touch1&&V.touch0[2]!==ie[2]&&(V.touch1=ie,V.taps=0):(V.touch0=ie,F=!0,V.taps=1+!!u);u&&(u=clearTimeout(u)),F&&(V.taps<2&&(p=ie[0],u=setTimeout(function(){u=null},h)),Gl(this),V.start())}}function I(P,...T){if(this.__zooming){var R=w(this,T).event(P),B=P.changedTouches,V=B.length,F,Y,J,ie;for(hr(P),F=0;F<V;++F)Y=B[F],J=mi(Y,this),R.touch0&&R.touch0[2]===Y.identifier?R.touch0[0]=J:R.touch1&&R.touch1[2]===Y.identifier&&(R.touch1[0]=J);if(Y=R.that.__zoom,R.touch1){var ve=R.touch0[0],re=R.touch0[1],me=R.touch1[0],ge=R.touch1[1],Q=(Q=me[0]-ve[0])*Q+(Q=me[1]-ve[1])*Q,oe=(oe=ge[0]-re[0])*oe+(oe=ge[1]-re[1])*oe;Y=x(Y,Math.sqrt(Q/oe)),J=[(ve[0]+me[0])/2,(ve[1]+me[1])/2],ie=[(re[0]+ge[0])/2,(re[1]+ge[1])/2]}else if(R.touch0)J=R.touch0[0],ie=R.touch0[1];else return;R.zoom("touch",n(S(Y,J,ie),R.extent,a))}}function H(P,...T){if(this.__zooming){var R=w(this,T).event(P),B=P.changedTouches,V=B.length,F,Y;for(Cd(P),f&&clearTimeout(f),f=setTimeout(function(){f=null},h),F=0;F<V;++F)Y=B[F],R.touch0&&R.touch0[2]===Y.identifier?delete R.touch0:R.touch1&&R.touch1[2]===Y.identifier&&delete R.touch1;if(R.touch1&&!R.touch0&&(R.touch0=R.touch1,delete R.touch1),R.touch0)R.touch0[1]=this.__zoom.invert(R.touch0[0]);else if(R.end(),R.taps===2&&(Y=mi(Y,this),Math.hypot(p[0]-Y[0],p[1]-Y[1])<b)){var J=Jn(this).on("dblclick.zoom");J&&J.apply(this,arguments)}}}return m.wheelDelta=function(P){return arguments.length?(i=typeof P=="function"?P:El(+P),m):i},m.filter=function(P){return arguments.length?(e=typeof P=="function"?P:El(!!P),m):e},m.touchable=function(P){return arguments.length?(s=typeof P=="function"?P:El(!!P),m):s},m.extent=function(P){return arguments.length?(t=typeof P=="function"?P:El([[+P[0][0],+P[0][1]],[+P[1][0],+P[1][1]]]),m):t},m.scaleExtent=function(P){return arguments.length?(o[0]=+P[0],o[1]=+P[1],m):[o[0],o[1]]},m.translateExtent=function(P){return arguments.length?(a[0][0]=+P[0][0],a[1][0]=+P[1][0],a[0][1]=+P[0][1],a[1][1]=+P[1][1],m):[[a[0][0],a[0][1]],[a[1][0],a[1][1]]]},m.constrain=function(P){return arguments.length?(n=P,m):n},m.duration=function(P){return arguments.length?(l=+P,m):l},m.interpolate=function(P){return arguments.length?(d=P,m):d},m.on=function(){var P=c.on.apply(c,arguments);return P===c?m:P},m.clickDistance=function(P){return arguments.length?(y=(P=+P)*P,m):Math.sqrt(y)},m.tapDistance=function(P){return arguments.length?(b=+P,m):b},m}const Br={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:e=>`Node type "${e}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:e=>`The old edge with id=${e} does not exist.`,error009:e=>`Marker type "${e}" doesn't exist.`,error008:(e,{id:t,sourceHandle:n,targetHandle:i})=>`Couldn't create edge for ${e} handle id: "${e==="source"?n:i}", edge id: ${t}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:e=>`Edge type "${e}" not found. Using fallback type "default".`,error012:e=>`Node with id "${e}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,error013:(e="react")=>`It seems that you haven't loaded the styles. Please import '@xyflow/${e}/dist/style.css' or base.css to make sure everything is working properly.`,error014:()=>"useNodeConnections: No node ID found. Call useNodeConnections inside a custom Node or provide a node ID.",error015:()=>"It seems that you are trying to drag a node that is not initialized. Please use onNodesChange as explained in the docs."},au=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],Sg=["Enter"," ","Escape"],n2={"node.a11yDescription.default":"Press enter or space to select a node. Press delete to remove it and escape to cancel.","node.a11yDescription.keyboardDisabled":"Press enter or space to select a node. You can then use the arrow keys to move the node around. Press delete to remove it and escape to cancel.","node.a11yDescription.ariaLiveMessage":({direction:e,x:t,y:n})=>`Moved selected node ${e}. New position, x: ${t}, y: ${n}`,"edge.a11yDescription.default":"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel.","controls.ariaLabel":"Control Panel","controls.zoomIn.ariaLabel":"Zoom In","controls.zoomOut.ariaLabel":"Zoom Out","controls.fitView.ariaLabel":"Fit View","controls.interactive.ariaLabel":"Toggle Interactivity","minimap.ariaLabel":"Mini Map","handle.ariaLabel":"Handle"};var Ga;(function(e){e.Strict="strict",e.Loose="loose"})(Ga||(Ga={}));var qa;(function(e){e.Free="free",e.Vertical="vertical",e.Horizontal="horizontal"})(qa||(qa={}));var pc;(function(e){e.Partial="partial",e.Full="full"})(pc||(pc={}));const ru={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null,pointer:null};var Cs;(function(e){e.Bezier="default",e.Straight="straight",e.Step="step",e.SmoothStep="smoothstep",e.SimpleBezier="simplebezier"})(Cs||(Cs={}));var hc;(function(e){e.Arrow="arrow",e.ArrowClosed="arrowclosed"})(hc||(hc={}));var We;(function(e){e.Left="left",e.Top="top",e.Right="right",e.Bottom="bottom"})(We||(We={}));const up={[We.Left]:We.Right,[We.Right]:We.Left,[We.Top]:We.Bottom,[We.Bottom]:We.Top};function i2(e,t){if(!e&&!t)return!0;if(!e||!t||e.size!==t.size)return!1;if(!e.size&&!t.size)return!0;for(const n of e.keys())if(!t.has(n))return!1;return!0}function fp(e,t,n){if(!n)return;const i=[];e.forEach((s,o)=>{t?.has(o)||i.push(s)}),i.length&&n(i)}function s2(e){return e===null?null:e?"valid":"invalid"}const Cg=e=>"id"in e&&"source"in e&&"target"in e,o2=e=>"id"in e&&"position"in e&&!("source"in e)&&!("target"in e),Xu=e=>"id"in e&&"internals"in e&&!("source"in e)&&!("target"in e),Zr=(e,t=[0,0])=>{const{width:n,height:i}=$s(e),s=e.origin??t,o=n*s[0],a=i*s[1];return{x:e.position.x-o,y:e.position.y-a}},a2=(e,t={nodeOrigin:[0,0]})=>{if(e.length===0)return{x:0,y:0,width:0,height:0};const n=e.reduce((i,s)=>{const o=typeof s=="string";let a=!t.nodeLookup&&!o?s:void 0;t.nodeLookup&&(a=o?t.nodeLookup.get(s):Xu(s)?s:t.nodeLookup.get(s.id));const l=a?gc(a,t.nodeOrigin):{x:0,y:0,x2:0,y2:0};return Fc(i,l)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return Bc(n)},Hc=(e,t={})=>{let n={x:1/0,y:1/0,x2:-1/0,y2:-1/0},i=!1;return e.forEach(s=>{(t.filter===void 0||t.filter(s))&&(n=Fc(n,gc(s)),i=!0)}),i?Bc(n):{x:0,y:0,width:0,height:0}},Gu=(e,t,[n,i,s]=[0,0,1],o=!1,a=!1)=>{const l={...Qr(t,[n,i,s]),width:t.width/s,height:t.height/s},d=[];for(const c of e.values()){const{measured:u,selectable:p=!0,hidden:f=!1}=c;if(a&&!p||f)continue;const h=u.width??c.width??c.initialWidth??null,g=u.height??c.height??c.initialHeight??null,y=qr(l,Ya(c)),b=(h??0)*(g??0),m=o&&y>0;(!c.internals.handleBounds||m||y>=b||c.dragging)&&d.push(c)}return d},r2=(e,t)=>{const n=new Set;return e.forEach(i=>{n.add(i.id)}),t.filter(i=>n.has(i.source)||n.has(i.target))};function l2(e,t){const n=new Map,i=t?.nodes?new Set(t.nodes.map(s=>s.id)):null;return e.forEach(s=>{s.measured.width&&s.measured.height&&(t?.includeHiddenNodes||!s.hidden)&&(!i||i.has(s.id))&&n.set(s.id,s)}),n}async function c2({nodes:e,width:t,height:n,panZoom:i,minZoom:s,maxZoom:o},a){if(e.size===0)return Promise.resolve(!0);const l=l2(e,a),d=Hc(l),c=Uu(d,t,n,a?.minZoom??s,a?.maxZoom??o,a?.padding??.1);return await i.setViewport(c,{duration:a?.duration,ease:a?.ease,interpolate:a?.interpolate}),Promise.resolve(!0)}function Eg({nodeId:e,nextPosition:t,nodeLookup:n,nodeOrigin:i=[0,0],nodeExtent:s,onError:o}){const a=n.get(e),l=a.parentId?n.get(a.parentId):void 0,{x:d,y:c}=l?l.internals.positionAbsolute:{x:0,y:0},u=a.origin??i;let p=a.extent||s;if(a.extent==="parent"&&!a.expandParent)if(!l)o?.("005",Br.error005());else{const h=l.measured.width,g=l.measured.height;h&&g&&(p=[[d,c],[d+h,c+g]])}else l&&Za(a.extent)&&(p=[[a.extent[0][0]+d,a.extent[0][1]+c],[a.extent[1][0]+d,a.extent[1][1]+c]]);const f=Za(p)?Ks(t,p,a.measured):t;return(a.measured.width===void 0||a.measured.height===void 0)&&o?.("015",Br.error015()),{position:{x:f.x-d+(a.measured.width??0)*u[0],y:f.y-c+(a.measured.height??0)*u[1]},positionAbsolute:f}}async function d2({nodesToRemove:e=[],edgesToRemove:t=[],nodes:n,edges:i,onBeforeDelete:s}){const o=new Set(e.map(f=>f.id)),a=[];for(const f of n){if(f.deletable===!1)continue;const h=o.has(f.id),g=!h&&f.parentId&&a.find(y=>y.id===f.parentId);(h||g)&&a.push(f)}const l=new Set(t.map(f=>f.id)),d=i.filter(f=>f.deletable!==!1),u=r2(a,d);for(const f of d)l.has(f.id)&&!u.find(g=>g.id===f.id)&&u.push(f);if(!s)return{edges:u,nodes:a};const p=await s({nodes:a,edges:u});return typeof p=="boolean"?p?{edges:u,nodes:a}:{edges:[],nodes:[]}:p}const Ua=(e,t=0,n=1)=>Math.min(Math.max(e,t),n),Ks=(e={x:0,y:0},t,n)=>({x:Ua(e.x,t[0][0],t[1][0]-(n?.width??0)),y:Ua(e.y,t[0][1],t[1][1]-(n?.height??0))});function Tg(e,t,n){const{width:i,height:s}=$s(n),{x:o,y:a}=n.internals.positionAbsolute;return Ks(e,[[o,a],[o+i,a+s]],t)}const pp=(e,t,n)=>e<t?Ua(Math.abs(e-t),1,t)/t:e>n?-Ua(Math.abs(e-n),1,t)/t:0,Ig=(e,t,n=15,i=40)=>{const s=pp(e.x,i,t.width-i)*n,o=pp(e.y,i,t.height-i)*n;return[s,o]},Fc=(e,t)=>({x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}),lu=({x:e,y:t,width:n,height:i})=>({x:e,y:t,x2:e+n,y2:t+i}),Bc=({x:e,y:t,x2:n,y2:i})=>({x:e,y:t,width:n-e,height:i-t}),Ya=(e,t=[0,0])=>{const{x:n,y:i}=Xu(e)?e.internals.positionAbsolute:Zr(e,t);return{x:n,y:i,width:e.measured?.width??e.width??e.initialWidth??0,height:e.measured?.height??e.height??e.initialHeight??0}},gc=(e,t=[0,0])=>{const{x:n,y:i}=Xu(e)?e.internals.positionAbsolute:Zr(e,t);return{x:n,y:i,x2:n+(e.measured?.width??e.width??e.initialWidth??0),y2:i+(e.measured?.height??e.height??e.initialHeight??0)}},u2=(e,t)=>Bc(Fc(lu(e),lu(t))),qr=(e,t)=>{const n=Math.max(0,Math.min(e.x+e.width,t.x+t.width)-Math.max(e.x,t.x)),i=Math.max(0,Math.min(e.y+e.height,t.y+t.height)-Math.max(e.y,t.y));return Math.ceil(n*i)},hp=e=>Ui(e.width)&&Ui(e.height)&&Ui(e.x)&&Ui(e.y),Ui=e=>!isNaN(e)&&isFinite(e),f2=(e,t)=>{},Jr=(e,t=[1,1])=>({x:t[0]*Math.round(e.x/t[0]),y:t[1]*Math.round(e.y/t[1])}),Qr=({x:e,y:t},[n,i,s],o=!1,a=[1,1])=>{const l={x:(e-n)/s,y:(t-i)/s};return o?Jr(l,a):l},mc=({x:e,y:t},[n,i,s])=>({x:e*s+n,y:t*s+i});function Na(e,t){if(typeof e=="number")return Math.floor((t-t/(1+e))*.5);if(typeof e=="string"&&e.endsWith("px")){const n=parseFloat(e);if(!Number.isNaN(n))return Math.floor(n)}if(typeof e=="string"&&e.endsWith("%")){const n=parseFloat(e);if(!Number.isNaN(n))return Math.floor(t*n*.01)}return console.error(`[React Flow] The padding value "${e}" is invalid. Please provide a number or a string with a valid unit (px or %).`),0}function p2(e,t,n){if(typeof e=="string"||typeof e=="number"){const i=Na(e,n),s=Na(e,t);return{top:i,right:s,bottom:i,left:s,x:s*2,y:i*2}}if(typeof e=="object"){const i=Na(e.top??e.y??0,n),s=Na(e.bottom??e.y??0,n),o=Na(e.left??e.x??0,t),a=Na(e.right??e.x??0,t);return{top:i,right:a,bottom:s,left:o,x:o+a,y:i+s}}return{top:0,right:0,bottom:0,left:0,x:0,y:0}}function h2(e,t,n,i,s,o){const{x:a,y:l}=mc(e,[t,n,i]),{x:d,y:c}=mc({x:e.x+e.width,y:e.y+e.height},[t,n,i]),u=s-d,p=o-c;return{left:Math.floor(a),top:Math.floor(l),right:Math.floor(u),bottom:Math.floor(p)}}const Uu=(e,t,n,i,s,o)=>{const a=p2(o,t,n),l=(t-a.x)/e.width,d=(n-a.y)/e.height,c=Math.min(l,d),u=Ua(c,i,s),p=e.x+e.width/2,f=e.y+e.height/2,h=t/2-p*u,g=n/2-f*u,y=h2(e,h,g,u,t,n),b={left:Math.min(y.left-a.left,0),top:Math.min(y.top-a.top,0),right:Math.min(y.right-a.right,0),bottom:Math.min(y.bottom-a.bottom,0)};return{x:h-b.left+b.right,y:g-b.top+b.bottom,zoom:u}},vc=()=>typeof navigator<"u"&&navigator?.userAgent?.indexOf("Mac")>=0;function Za(e){return e!=null&&e!=="parent"}function $s(e){return{width:e.measured?.width??e.width??e.initialWidth??0,height:e.measured?.height??e.height??e.initialHeight??0}}function g2(e){return(e.measured?.width??e.width??e.initialWidth)!==void 0&&(e.measured?.height??e.height??e.initialHeight)!==void 0}function m2(e,t={width:0,height:0},n,i,s){const o={...e},a=i.get(n);if(a){const l=a.origin||s;o.x+=a.internals.positionAbsolute.x-(t.width??0)*l[0],o.y+=a.internals.positionAbsolute.y-(t.height??0)*l[1]}return o}function v2(e){return{...n2,...e||{}}}function Pr(e,{snapGrid:t=[0,0],snapToGrid:n=!1,transform:i,containerBounds:s}){const{x:o,y:a}=li(e),l=Qr({x:o-(s?.left??0),y:a-(s?.top??0)},i),{x:d,y:c}=n?Jr(l,t):l;return{xSnapped:d,ySnapped:c,...l}}const Ng=e=>({width:e.offsetWidth,height:e.offsetHeight}),Pg=e=>e?.getRootNode?.()||window?.document,y2=["INPUT","SELECT","TEXTAREA"];function Mg(e){const t=e.composedPath?.()?.[0]||e.target;return t?.nodeType!==1?!1:y2.includes(t.nodeName)||t.hasAttribute("contenteditable")||!!t.closest(".nokey")}const Ag=e=>"clientX"in e,li=(e,t)=>{const n=Ag(e),i=n?e.clientX:e.touches?.[0].clientX,s=n?e.clientY:e.touches?.[0].clientY;return{x:i-(t?.left??0),y:s-(t?.top??0)}},gp=(e,t,n,i,s)=>{const o=t.querySelectorAll(`.${e}`);return!o||!o.length?null:Array.from(o).map(a=>{const l=a.getBoundingClientRect();return{id:a.getAttribute("data-handleid"),type:e,nodeId:s,position:a.getAttribute("data-handlepos"),x:(l.left-n.left)/i,y:(l.top-n.top)/i,...Ng(a)}})};function b2({sourceX:e,sourceY:t,targetX:n,targetY:i,sourceControlX:s,sourceControlY:o,targetControlX:a,targetControlY:l}){const d=e*.125+s*.375+a*.375+n*.125,c=t*.125+o*.375+l*.375+i*.125,u=Math.abs(d-e),p=Math.abs(c-t);return[d,c,u,p]}function Tl(e,t){return e>=0?.5*e:t*25*Math.sqrt(-e)}function mp({pos:e,x1:t,y1:n,x2:i,y2:s,c:o}){switch(e){case We.Left:return[t-Tl(t-i,o),n];case We.Right:return[t+Tl(i-t,o),n];case We.Top:return[t,n-Tl(n-s,o)];case We.Bottom:return[t,n+Tl(s-n,o)]}}function Dg({sourceX:e,sourceY:t,sourcePosition:n=We.Bottom,targetX:i,targetY:s,targetPosition:o=We.Top,curvature:a=.25}){const[l,d]=mp({pos:n,x1:e,y1:t,x2:i,y2:s,c:a}),[c,u]=mp({pos:o,x1:i,y1:s,x2:e,y2:t,c:a}),[p,f,h,g]=b2({sourceX:e,sourceY:t,targetX:i,targetY:s,sourceControlX:l,sourceControlY:d,targetControlX:c,targetControlY:u});return[`M${e},${t} C${l},${d} ${c},${u} ${i},${s}`,p,f,h,g]}function Rg({sourceX:e,sourceY:t,targetX:n,targetY:i}){const s=Math.abs(n-e)/2,o=n<e?n+s:n-s,a=Math.abs(i-t)/2,l=i<t?i+a:i-a;return[o,l,s,a]}function w2({sourceNode:e,targetNode:t,selected:n=!1,zIndex:i=0,elevateOnSelect:s=!1,zIndexMode:o="basic"}){if(o==="manual")return i;const a=s&&n?i+1e3:i,l=Math.max(e.parentId||s&&e.selected?e.internals.z:0,t.parentId||s&&t.selected?t.internals.z:0);return a+l}function _2({sourceNode:e,targetNode:t,width:n,height:i,transform:s}){const o=Fc(gc(e),gc(t));o.x===o.x2&&(o.x2+=1),o.y===o.y2&&(o.y2+=1);const a={x:-s[0]/s[2],y:-s[1]/s[2],width:n/s[2],height:i/s[2]};return qr(a,Bc(o))>0}const x2=({source:e,sourceHandle:t,target:n,targetHandle:i})=>`xy-edge__${e}${t||""}-${n}${i||""}`,k2=(e,t)=>t.some(n=>n.source===e.source&&n.target===e.target&&(n.sourceHandle===e.sourceHandle||!n.sourceHandle&&!e.sourceHandle)&&(n.targetHandle===e.targetHandle||!n.targetHandle&&!e.targetHandle)),S2=(e,t,n={})=>{if(!e.source||!e.target)return t;const i=n.getEdgeId||x2;let s;return Cg(e)?s={...e}:s={...e,id:i(e)},k2(s,t)?t:(s.sourceHandle===null&&delete s.sourceHandle,s.targetHandle===null&&delete s.targetHandle,t.concat(s))};function Og({sourceX:e,sourceY:t,targetX:n,targetY:i}){const[s,o,a,l]=Rg({sourceX:e,sourceY:t,targetX:n,targetY:i});return[`M ${e},${t}L ${n},${i}`,s,o,a,l]}const vp={[We.Left]:{x:-1,y:0},[We.Right]:{x:1,y:0},[We.Top]:{x:0,y:-1},[We.Bottom]:{x:0,y:1}},C2=({source:e,sourcePosition:t=We.Bottom,target:n})=>t===We.Left||t===We.Right?e.x<n.x?{x:1,y:0}:{x:-1,y:0}:e.y<n.y?{x:0,y:1}:{x:0,y:-1},yp=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));function E2({source:e,sourcePosition:t=We.Bottom,target:n,targetPosition:i=We.Top,center:s,offset:o,stepPosition:a}){const l=vp[t],d=vp[i],c={x:e.x+l.x*o,y:e.y+l.y*o},u={x:n.x+d.x*o,y:n.y+d.y*o},p=C2({source:c,sourcePosition:t,target:u}),f=p.x!==0?"x":"y",h=p[f];let g=[],y,b;const m={x:0,y:0},x={x:0,y:0},[,,S,v]=Rg({sourceX:e.x,sourceY:e.y,targetX:n.x,targetY:n.y});if(l[f]*d[f]===-1){f==="x"?(y=s.x??c.x+(u.x-c.x)*a,b=s.y??(c.y+u.y)/2):(y=s.x??(c.x+u.x)/2,b=s.y??c.y+(u.y-c.y)*a);const w=[{x:y,y:c.y},{x:y,y:u.y}],k=[{x:c.x,y:b},{x:u.x,y:b}];l[f]===h?g=f==="x"?w:k:g=f==="x"?k:w}else{const w=[{x:c.x,y:u.y}],k=[{x:u.x,y:c.y}];if(f==="x"?g=l.x===h?k:w:g=l.y===h?w:k,t===i){const I=Math.abs(e[f]-n[f]);if(I<=o){const H=Math.min(o-1,o-I);l[f]===h?m[f]=(c[f]>e[f]?-1:1)*H:x[f]=(u[f]>n[f]?-1:1)*H}}if(t!==i){const I=f==="x"?"y":"x",H=l[f]===d[I],P=c[I]>u[I],T=c[I]<u[I];(l[f]===1&&(!H&&P||H&&T)||l[f]!==1&&(!H&&T||H&&P))&&(g=f==="x"?w:k)}const N={x:c.x+m.x,y:c.y+m.y},L={x:u.x+x.x,y:u.y+x.y},X=Math.max(Math.abs(N.x-g[0].x),Math.abs(L.x-g[0].x)),O=Math.max(Math.abs(N.y-g[0].y),Math.abs(L.y-g[0].y));X>=O?(y=(N.x+L.x)/2,b=g[0].y):(y=g[0].x,b=(N.y+L.y)/2)}return[[e,{x:c.x+m.x,y:c.y+m.y},...g,{x:u.x+x.x,y:u.y+x.y},n],y,b,S,v]}function T2(e,t,n,i){const s=Math.min(yp(e,t)/2,yp(t,n)/2,i),{x:o,y:a}=t;if(e.x===o&&o===n.x||e.y===a&&a===n.y)return`L${o} ${a}`;if(e.y===a){const c=e.x<n.x?-1:1,u=e.y<n.y?1:-1;return`L ${o+s*c},${a}Q ${o},${a} ${o},${a+s*u}`}const l=e.x<n.x?1:-1,d=e.y<n.y?-1:1;return`L ${o},${a+s*d}Q ${o},${a} ${o+s*l},${a}`}function qc({sourceX:e,sourceY:t,sourcePosition:n=We.Bottom,targetX:i,targetY:s,targetPosition:o=We.Top,borderRadius:a=5,centerX:l,centerY:d,offset:c=20,stepPosition:u=.5}){const[p,f,h,g,y]=E2({source:{x:e,y:t},sourcePosition:n,target:{x:i,y:s},targetPosition:o,center:{x:l,y:d},offset:c,stepPosition:u});return[p.reduce((m,x,S)=>{let v="";return S>0&&S<p.length-1?v=T2(p[S-1],x,p[S+1],a):v=`${S===0?"M":"L"}${x.x} ${x.y}`,m+=v,m},""),f,h,g,y]}function bp(e){return e&&!!(e.internals.handleBounds||e.handles?.length)&&!!(e.measured.width||e.width||e.initialWidth)}function I2(e){const{sourceNode:t,targetNode:n}=e;if(!bp(t)||!bp(n))return null;const i=t.internals.handleBounds||wp(t.handles),s=n.internals.handleBounds||wp(n.handles),o=_p(i?.source??[],e.sourceHandle),a=_p(e.connectionMode===Ga.Strict?s?.target??[]:(s?.target??[]).concat(s?.source??[]),e.targetHandle);if(!o||!a)return e.onError?.("008",Br.error008(o?"target":"source",{id:e.id,sourceHandle:e.sourceHandle,targetHandle:e.targetHandle})),null;const l=o?.position||We.Bottom,d=a?.position||We.Top,c=js(t,o,l),u=js(n,a,d);return{sourceX:c.x,sourceY:c.y,targetX:u.x,targetY:u.y,sourcePosition:l,targetPosition:d}}function wp(e){if(!e)return null;const t=[],n=[];for(const i of e)i.width=i.width??1,i.height=i.height??1,i.type==="source"?t.push(i):i.type==="target"&&n.push(i);return{source:t,target:n}}function js(e,t,n=We.Left,i=!1){const s=(t?.x??0)+e.internals.positionAbsolute.x,o=(t?.y??0)+e.internals.positionAbsolute.y,{width:a,height:l}=t??$s(e);if(i)return{x:s+a/2,y:o+l/2};switch(t?.position??n){case We.Top:return{x:s+a/2,y:o};case We.Right:return{x:s+a,y:o+l/2};case We.Bottom:return{x:s+a/2,y:o+l};case We.Left:return{x:s,y:o+l/2}}}function _p(e,t){return e&&(t?e.find(n=>n.id===t):e[0])||null}function cu(e,t){return e?typeof e=="string"?e:`${t?`${t}__`:""}${Object.keys(e).sort().map(i=>`${i}=${e[i]}`).join("&")}`:""}function N2(e,{id:t,defaultColor:n,defaultMarkerStart:i,defaultMarkerEnd:s}){const o=new Set;return e.reduce((a,l)=>([l.markerStart||i,l.markerEnd||s].forEach(d=>{if(d&&typeof d=="object"){const c=cu(d,t);o.has(c)||(a.push({id:c,color:d.color||n,...d}),o.add(c))}}),a),[]).sort((a,l)=>a.id.localeCompare(l.id))}const zg=1e3,P2=10,Yu={nodeOrigin:[0,0],nodeExtent:au,elevateNodesOnSelect:!0,zIndexMode:"basic",defaults:{}},M2={...Yu,checkEquality:!0};function Zu(e,t){const n={...e};for(const i in t)t[i]!==void 0&&(n[i]=t[i]);return n}function A2(e,t,n){const i=Zu(Yu,n);for(const s of e.values())if(s.parentId)Qu(s,e,t,i);else{const o=Zr(s,i.nodeOrigin),a=Za(s.extent)?s.extent:i.nodeExtent,l=Ks(o,a,$s(s));s.internals.positionAbsolute=l}}function D2(e,t){if(!e.handles)return e.measured?t?.internals.handleBounds:void 0;const n=[],i=[];for(const s of e.handles){const o={id:s.id,width:s.width??1,height:s.height??1,nodeId:e.id,x:s.x,y:s.y,position:s.position,type:s.type};s.type==="source"?n.push(o):s.type==="target"&&i.push(o)}return{source:n,target:i}}function Ju(e){return e==="manual"}function R2(e,t,n,i={}){const s=Zu(M2,i),o={i:0},a=new Map(t),l=s?.elevateNodesOnSelect&&!Ju(s.zIndexMode)?zg:0;let d=e.length>0;t.clear(),n.clear();for(const c of e){let u=a.get(c.id);if(s.checkEquality&&c===u?.internals.userNode)t.set(c.id,u);else{const p=Zr(c,s.nodeOrigin),f=Za(c.extent)?c.extent:s.nodeExtent,h=Ks(p,f,$s(c));u={...s.defaults,...c,measured:{width:c.measured?.width,height:c.measured?.height},internals:{positionAbsolute:h,handleBounds:D2(c,u),z:Lg(c,l,s.zIndexMode),userNode:c}},t.set(c.id,u)}(u.measured===void 0||u.measured.width===void 0||u.measured.height===void 0)&&!u.hidden&&(d=!1),c.parentId&&Qu(u,t,n,i,o)}return d}function O2(e,t){if(!e.parentId)return;const n=t.get(e.parentId);n?n.set(e.id,e):t.set(e.parentId,new Map([[e.id,e]]))}function Qu(e,t,n,i,s){const{elevateNodesOnSelect:o,nodeOrigin:a,nodeExtent:l,zIndexMode:d}=Zu(Yu,i),c=e.parentId,u=t.get(c);if(!u){console.warn(`Parent node ${c} not found. Please make sure that parent nodes are in front of their child nodes in the nodes array.`);return}O2(e,n),s&&!u.parentId&&u.internals.rootParentIndex===void 0&&d==="auto"&&(u.internals.rootParentIndex=++s.i,u.internals.z=u.internals.z+s.i*P2),s&&u.internals.rootParentIndex!==void 0&&(s.i=u.internals.rootParentIndex);const p=o&&!Ju(d)?zg:0,{x:f,y:h,z:g}=z2(e,u,a,l,p,d),{positionAbsolute:y}=e.internals,b=f!==y.x||h!==y.y;(b||g!==e.internals.z)&&t.set(e.id,{...e,internals:{...e.internals,positionAbsolute:b?{x:f,y:h}:y,z:g}})}function Lg(e,t,n){const i=Ui(e.zIndex)?e.zIndex:0;return Ju(n)?i:i+(e.selected?t:0)}function z2(e,t,n,i,s,o){const{x:a,y:l}=t.internals.positionAbsolute,d=$s(e),c=Zr(e,n),u=Za(e.extent)?Ks(c,e.extent,d):c;let p=Ks({x:a+u.x,y:l+u.y},i,d);e.extent==="parent"&&(p=Tg(p,d,t));const f=Lg(e,s,o),h=t.internals.z??0;return{x:p.x,y:p.y,z:h>=f?h+1:f}}function L2(e,t,n,i=[0,0]){const s=[],o=new Map;for(const a of e){const l=t.get(a.parentId);if(!l)continue;const d=o.get(a.parentId)?.expandedRect??Ya(l),c=u2(d,a.rect);o.set(a.parentId,{expandedRect:c,parent:l})}return o.size>0&&o.forEach(({expandedRect:a,parent:l},d)=>{const c=l.internals.positionAbsolute,u=$s(l),p=l.origin??i,f=a.x<c.x?Math.round(Math.abs(c.x-a.x)):0,h=a.y<c.y?Math.round(Math.abs(c.y-a.y)):0,g=Math.max(u.width,Math.round(a.width)),y=Math.max(u.height,Math.round(a.height)),b=(g-u.width)*p[0],m=(y-u.height)*p[1];(f>0||h>0||b||m)&&(s.push({id:d,type:"position",position:{x:l.position.x-f+b,y:l.position.y-h+m}}),n.get(d)?.forEach(x=>{e.some(S=>S.id===x.id)||s.push({id:x.id,type:"position",position:{x:x.position.x+f,y:x.position.y+h}})})),(u.width<a.width||u.height<a.height||f||h)&&s.push({id:d,type:"dimensions",setAttributes:!0,dimensions:{width:g+(f?p[0]*f-b:0),height:y+(h?p[1]*h-m:0)}})}),s}function H2(e,t,n,i,s,o,a){const l=i?.querySelector(".xyflow__viewport");let d=!1;if(!l)return{changes:[],updatedInternals:d};const c=[],u=window.getComputedStyle(l),{m22:p}=new window.DOMMatrixReadOnly(u.transform),f=[];for(const h of e.values()){const g=t.get(h.id);if(!g)continue;if(g.hidden){t.set(g.id,{...g,internals:{...g.internals,handleBounds:void 0}}),d=!0;continue}const y=Ng(h.nodeElement),b=g.measured.width!==y.width||g.measured.height!==y.height;if(!!(y.width&&y.height&&(b||!g.internals.handleBounds||h.force))){const x=h.nodeElement.getBoundingClientRect(),S=Za(g.extent)?g.extent:o;let{positionAbsolute:v}=g.internals;g.parentId&&g.extent==="parent"?v=Tg(v,y,t.get(g.parentId)):S&&(v=Ks(v,S,y));const A={...g,measured:y,internals:{...g.internals,positionAbsolute:v,handleBounds:{source:gp("source",h.nodeElement,x,p,g.id),target:gp("target",h.nodeElement,x,p,g.id)}}};t.set(g.id,A),g.parentId&&Qu(A,t,n,{nodeOrigin:s,zIndexMode:a}),d=!0,b&&(c.push({id:g.id,type:"dimensions",dimensions:y}),g.expandParent&&g.parentId&&f.push({id:g.id,parentId:g.parentId,rect:Ya(A,s)}))}}if(f.length>0){const h=L2(f,t,n,s);c.push(...h)}return{changes:c,updatedInternals:d}}async function F2({delta:e,panZoom:t,transform:n,translateExtent:i,width:s,height:o}){if(!t||!e.x&&!e.y)return Promise.resolve(!1);const a=await t.setViewportConstrained({x:n[0]+e.x,y:n[1]+e.y,zoom:n[2]},[[0,0],[s,o]],i),l=!!a&&(a.x!==n[0]||a.y!==n[1]||a.k!==n[2]);return Promise.resolve(l)}function xp(e,t,n,i,s,o){let a=s;const l=i.get(a)||new Map;i.set(a,l.set(n,t)),a=`${s}-${e}`;const d=i.get(a)||new Map;if(i.set(a,d.set(n,t)),o){a=`${s}-${e}-${o}`;const c=i.get(a)||new Map;i.set(a,c.set(n,t))}}function B2(e,t,n){e.clear(),t.clear();for(const i of n){const{source:s,target:o,sourceHandle:a=null,targetHandle:l=null}=i,d={edgeId:i.id,source:s,target:o,sourceHandle:a,targetHandle:l},c=`${s}-${a}--${o}-${l}`,u=`${o}-${l}--${s}-${a}`;xp("source",d,u,e,s,a),xp("target",d,c,e,o,l),t.set(i.id,i)}}function Hg(e,t){if(!e.parentId)return!1;const n=t.get(e.parentId);return n?n.selected?!0:Hg(n,t):!1}function kp(e,t,n){let i=e;do{if(i?.matches?.(t))return!0;if(i===n)return!1;i=i?.parentElement}while(i);return!1}function q2(e,t,n,i){const s=new Map;for(const[o,a]of e)if((a.selected||a.id===i)&&(!a.parentId||!Hg(a,e))&&(a.draggable||t&&typeof a.draggable>"u")){const l=e.get(o);l&&s.set(o,{id:o,position:l.position||{x:0,y:0},distance:{x:n.x-l.internals.positionAbsolute.x,y:n.y-l.internals.positionAbsolute.y},extent:l.extent,parentId:l.parentId,origin:l.origin,expandParent:l.expandParent,internals:{positionAbsolute:l.internals.positionAbsolute||{x:0,y:0}},measured:{width:l.measured.width??0,height:l.measured.height??0}})}return s}function Ed({nodeId:e,dragItems:t,nodeLookup:n,dragging:i=!0}){const s=[];for(const[a,l]of t){const d=n.get(a)?.internals.userNode;d&&s.push({...d,position:l.position,dragging:i})}if(!e)return[s[0],s];const o=n.get(e)?.internals.userNode;return[o?{...o,position:t.get(e)?.position||o.position,dragging:i}:s[0],s]}function V2({dragItems:e,snapGrid:t,x:n,y:i}){const s=e.values().next().value;if(!s)return null;const o={x:n-s.distance.x,y:i-s.distance.y},a=Jr(o,t);return{x:a.x-o.x,y:a.y-o.y}}function W2({onNodeMouseDown:e,getStoreItems:t,onDragStart:n,onDrag:i,onDragStop:s}){let o={x:null,y:null},a=0,l=new Map,d=!1,c={x:0,y:0},u=null,p=!1,f=null,h=!1,g=!1,y=null;function b({noDragClassName:x,handleSelector:S,domNode:v,isSelectable:A,nodeId:w,nodeClickDistance:k=0}){f=Jn(v);function N({x:I,y:H}){const{nodeLookup:P,nodeExtent:T,snapGrid:R,snapToGrid:B,nodeOrigin:V,onNodeDrag:F,onSelectionDrag:Y,onError:J,updateNodePositions:ie}=t();o={x:I,y:H};let ve=!1;const re=l.size>1,me=re&&T?lu(Hc(l)):null,ge=re&&B?V2({dragItems:l,snapGrid:R,x:I,y:H}):null;for(const[Q,oe]of l){if(!P.has(Q))continue;let ue={x:I-oe.distance.x,y:H-oe.distance.y};B&&(ue=ge?{x:Math.round(ue.x+ge.x),y:Math.round(ue.y+ge.y)}:Jr(ue,R));let le=null;if(re&&T&&!oe.extent&&me){const{positionAbsolute:fe}=oe.internals,Pe=fe.x-me.x+T[0][0],Re=fe.x+oe.measured.width-me.x2+T[1][0],Se=fe.y-me.y+T[0][1],Ce=fe.y+oe.measured.height-me.y2+T[1][1];le=[[Pe,Se],[Re,Ce]]}const{position:te,positionAbsolute:be}=Eg({nodeId:Q,nextPosition:ue,nodeLookup:P,nodeExtent:le||T,nodeOrigin:V,onError:J});ve=ve||oe.position.x!==te.x||oe.position.y!==te.y,oe.position=te,oe.internals.positionAbsolute=be}if(g=g||ve,!!ve&&(ie(l,!0),y&&(i||F||!w&&Y))){const[Q,oe]=Ed({nodeId:w,dragItems:l,nodeLookup:P});i?.(y,l,Q,oe),F?.(y,Q,oe),w||Y?.(y,oe)}}async function L(){if(!u)return;const{transform:I,panBy:H,autoPanSpeed:P,autoPanOnNodeDrag:T}=t();if(!T){d=!1,cancelAnimationFrame(a);return}const[R,B]=Ig(c,u,P);(R!==0||B!==0)&&(o.x=(o.x??0)-R/I[2],o.y=(o.y??0)-B/I[2],await H({x:R,y:B})&&N(o)),a=requestAnimationFrame(L)}function X(I){const{nodeLookup:H,multiSelectionActive:P,nodesDraggable:T,transform:R,snapGrid:B,snapToGrid:V,selectNodesOnDrag:F,onNodeDragStart:Y,onSelectionDragStart:J,unselectNodesAndEdges:ie}=t();p=!0,(!F||!A)&&!P&&w&&(H.get(w)?.selected||ie()),A&&F&&w&&e?.(w);const ve=Pr(I.sourceEvent,{transform:R,snapGrid:B,snapToGrid:V,containerBounds:u});if(o=ve,l=q2(H,T,ve,w),l.size>0&&(n||Y||!w&&J)){const[re,me]=Ed({nodeId:w,dragItems:l,nodeLookup:H});n?.(I.sourceEvent,l,re,me),Y?.(I.sourceEvent,re,me),w||J?.(I.sourceEvent,me)}}const O=cg().clickDistance(k).on("start",I=>{const{domNode:H,nodeDragThreshold:P,transform:T,snapGrid:R,snapToGrid:B}=t();u=H?.getBoundingClientRect()||null,h=!1,g=!1,y=I.sourceEvent,P===0&&X(I),o=Pr(I.sourceEvent,{transform:T,snapGrid:R,snapToGrid:B,containerBounds:u}),c=li(I.sourceEvent,u)}).on("drag",I=>{const{autoPanOnNodeDrag:H,transform:P,snapGrid:T,snapToGrid:R,nodeDragThreshold:B,nodeLookup:V}=t(),F=Pr(I.sourceEvent,{transform:P,snapGrid:T,snapToGrid:R,containerBounds:u});if(y=I.sourceEvent,(I.sourceEvent.type==="touchmove"&&I.sourceEvent.touches.length>1||w&&!V.has(w))&&(h=!0),!h){if(!d&&H&&p&&(d=!0,L()),!p){const Y=li(I.sourceEvent,u),J=Y.x-c.x,ie=Y.y-c.y;Math.sqrt(J*J+ie*ie)>B&&X(I)}(o.x!==F.xSnapped||o.y!==F.ySnapped)&&l&&p&&(c=li(I.sourceEvent,u),N(F))}}).on("end",I=>{if(!(!p||h)&&(d=!1,p=!1,cancelAnimationFrame(a),l.size>0)){const{nodeLookup:H,updateNodePositions:P,onNodeDragStop:T,onSelectionDragStop:R}=t();if(g&&(P(l,!1),g=!1),s||T||!w&&R){const[B,V]=Ed({nodeId:w,dragItems:l,nodeLookup:H,dragging:!1});s?.(I.sourceEvent,l,B,V),T?.(I.sourceEvent,B,V),w||R?.(I.sourceEvent,V)}}}).filter(I=>{const H=I.target;return!I.button&&(!x||!kp(H,`.${x}`,v))&&(!S||kp(H,S,v))});f.call(O)}function m(){f?.on(".drag",null)}return{update:b,destroy:m}}function K2(e,t,n){const i=[],s={x:e.x-n,y:e.y-n,width:n*2,height:n*2};for(const o of t.values())qr(s,Ya(o))>0&&i.push(o);return i}const j2=250;function X2(e,t,n,i){let s=[],o=1/0;const a=K2(e,n,t+j2);for(const l of a){const d=[...l.internals.handleBounds?.source??[],...l.internals.handleBounds?.target??[]];for(const c of d){if(i.nodeId===c.nodeId&&i.type===c.type&&i.id===c.id)continue;const{x:u,y:p}=js(l,c,c.position,!0),f=Math.sqrt(Math.pow(u-e.x,2)+Math.pow(p-e.y,2));f>t||(f<o?(s=[{...c,x:u,y:p}],o=f):f===o&&s.push({...c,x:u,y:p}))}}if(!s.length)return null;if(s.length>1){const l=i.type==="source"?"target":"source";return s.find(d=>d.type===l)??s[0]}return s[0]}function Fg(e,t,n,i,s,o=!1){const a=i.get(e);if(!a)return null;const l=s==="strict"?a.internals.handleBounds?.[t]:[...a.internals.handleBounds?.source??[],...a.internals.handleBounds?.target??[]],d=(n?l?.find(c=>c.id===n):l?.[0])??null;return d&&o?{...d,...js(a,d,d.position,!0)}:d}function Bg(e,t){return e||(t?.classList.contains("target")?"target":t?.classList.contains("source")?"source":null)}function G2(e,t){let n=null;return t?n=!0:e&&!t&&(n=!1),n}const qg=()=>!0;function U2(e,{connectionMode:t,connectionRadius:n,handleId:i,nodeId:s,edgeUpdaterType:o,isTarget:a,domNode:l,nodeLookup:d,lib:c,autoPanOnConnect:u,flowId:p,panBy:f,cancelConnection:h,onConnectStart:g,onConnect:y,onConnectEnd:b,isValidConnection:m=qg,onReconnectEnd:x,updateConnection:S,getTransform:v,getFromHandle:A,autoPanSpeed:w,dragThreshold:k=1,handleDomNode:N}){const L=Pg(e.target);let X=0,O;const{x:I,y:H}=li(e),P=Bg(o,N),T=l?.getBoundingClientRect();let R=!1;if(!T||!P)return;const B=Fg(s,P,i,d,t);if(!B)return;let V=li(e,T),F=!1,Y=null,J=!1,ie=null;function ve(){if(!u||!T)return;const[te,be]=Ig(V,T,w);f({x:te,y:be}),X=requestAnimationFrame(ve)}const re={...B,nodeId:s,type:P,position:B.position},me=d.get(s);let Q={inProgress:!0,isValid:null,from:js(me,re,We.Left,!0),fromHandle:re,fromPosition:re.position,fromNode:me,to:V,toHandle:null,toPosition:up[re.position],toNode:null,pointer:V};function oe(){R=!0,S(Q),g?.(e,{nodeId:s,handleId:i,handleType:P})}k===0&&oe();function ue(te){if(!R){const{x:Ce,y:ke}=li(te),Ne=Ce-I,$e=ke-H;if(!(Ne*Ne+$e*$e>k*k))return;oe()}if(!A()||!re){le(te);return}const be=v();V=li(te,T),O=X2(Qr(V,be,!1,[1,1]),n,d,re),F||(ve(),F=!0);const fe=Vg(te,{handle:O,connectionMode:t,fromNodeId:s,fromHandleId:i,fromType:a?"target":"source",isValidConnection:m,doc:L,lib:c,flowId:p,nodeLookup:d});ie=fe.handleDomNode,Y=fe.connection,J=G2(!!O,fe.isValid);const Pe=d.get(s),Re=Pe?js(Pe,re,We.Left,!0):Q.from,Se={...Q,from:Re,isValid:J,to:fe.toHandle&&J?mc({x:fe.toHandle.x,y:fe.toHandle.y},be):V,toHandle:fe.toHandle,toPosition:J&&fe.toHandle?fe.toHandle.position:up[re.position],toNode:fe.toHandle?d.get(fe.toHandle.nodeId):null,pointer:V};S(Se),Q=Se}function le(te){if(!("touches"in te&&te.touches.length>0)){if(R){(O||ie)&&Y&&J&&y?.(Y);const{inProgress:be,...fe}=Q,Pe={...fe,toPosition:Q.toHandle?Q.toPosition:null};b?.(te,Pe),o&&x?.(te,Pe)}h(),cancelAnimationFrame(X),F=!1,J=!1,Y=null,ie=null,L.removeEventListener("mousemove",ue),L.removeEventListener("mouseup",le),L.removeEventListener("touchmove",ue),L.removeEventListener("touchend",le)}}L.addEventListener("mousemove",ue),L.addEventListener("mouseup",le),L.addEventListener("touchmove",ue),L.addEventListener("touchend",le)}function Vg(e,{handle:t,connectionMode:n,fromNodeId:i,fromHandleId:s,fromType:o,doc:a,lib:l,flowId:d,isValidConnection:c=qg,nodeLookup:u}){const p=o==="target",f=t?a.querySelector(`.${l}-flow__handle[data-id="${d}-${t?.nodeId}-${t?.id}-${t?.type}"]`):null,{x:h,y:g}=li(e),y=a.elementFromPoint(h,g),b=y?.classList.contains(`${l}-flow__handle`)?y:f,m={handleDomNode:b,isValid:!1,connection:null,toHandle:null};if(b){const x=Bg(void 0,b),S=b.getAttribute("data-nodeid"),v=b.getAttribute("data-handleid"),A=b.classList.contains("connectable"),w=b.classList.contains("connectableend");if(!S||!x)return m;const k={source:p?S:i,sourceHandle:p?v:s,target:p?i:S,targetHandle:p?s:v};m.connection=k;const L=A&&w&&(n===Ga.Strict?p&&x==="source"||!p&&x==="target":S!==i||v!==s);m.isValid=L&&c(k),m.toHandle=Fg(S,x,v,u,n,!0)}return m}const Sp={onPointerDown:U2,isValid:Vg},Vc=e=>({x:e.x,y:e.y,zoom:e.k}),Td=({x:e,y:t,zoom:n})=>Lc.translate(e,t).scale(n),za=(e,t)=>e.target.closest(`.${t}`),Wg=(e,t)=>t===2&&Array.isArray(e)&&e.includes(2),Y2=e=>((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2,Id=(e,t=0,n=Y2,i=()=>{})=>{const s=typeof t=="number"&&t>0;return s||i(),s?e.transition().duration(t).ease(n).on("end",i):e},Kg=e=>{const t=e.ctrlKey&&vc()?10:1;return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*t};function Z2({zoomPanValues:e,noWheelClassName:t,d3Selection:n,d3Zoom:i,panOnScrollMode:s,panOnScrollSpeed:o,zoomOnPinch:a,onPanZoomStart:l,onPanZoom:d,onPanZoomEnd:c}){return u=>{if(za(u,t))return u.ctrlKey&&u.preventDefault(),!1;u.preventDefault(),u.stopImmediatePropagation();const p=n.property("__zoom").k||1;if(u.ctrlKey&&a){const b=mi(u),m=Kg(u),x=p*Math.pow(2,m);i.scaleTo(n,x,b,u);return}const f=u.deltaMode===1?20:1;let h=s===qa.Vertical?0:u.deltaX*f,g=s===qa.Horizontal?0:u.deltaY*f;!vc()&&u.shiftKey&&s!==qa.Vertical&&(h=u.deltaY*f,g=0),i.translateBy(n,-(h/p)*o,-(g/p)*o,{internal:!0});const y=Vc(n.property("__zoom"));clearTimeout(e.panScrollTimeout),e.isPanScrolling?(d?.(u,y),e.panScrollTimeout=setTimeout(()=>{c?.(u,y),e.isPanScrolling=!1},150)):(e.isPanScrolling=!0,l?.(u,y))}}function J2({noWheelClassName:e,preventScrolling:t,d3ZoomHandler:n}){return function(i,s){const o=i.type==="wheel",a=!t&&o&&!i.ctrlKey,l=za(i,e);if(i.ctrlKey&&o&&l&&i.preventDefault(),a||l)return null;i.preventDefault(),n.call(this,i,s)}}function Q2({zoomPanValues:e,onDraggingChange:t,onPanZoomStart:n}){return i=>{if(i.sourceEvent?.internal)return;const s=Vc(i.transform);e.mouseButton=i.sourceEvent?.button||0,e.isZoomingOrPanning=!0,e.prevViewport=s,i.sourceEvent?.type==="mousedown"&&t(!0),n&&n?.(i.sourceEvent,s)}}function $2({zoomPanValues:e,panOnDrag:t,onPaneContextMenu:n,onTransformChange:i,onPanZoom:s}){return o=>{e.usedRightMouseButton=!!(n&&Wg(t,e.mouseButton??0)),o.sourceEvent?.sync||i([o.transform.x,o.transform.y,o.transform.k]),s&&!o.sourceEvent?.internal&&s?.(o.sourceEvent,Vc(o.transform))}}function ek({zoomPanValues:e,panOnDrag:t,panOnScroll:n,onDraggingChange:i,onPanZoomEnd:s,onPaneContextMenu:o}){return a=>{if(!a.sourceEvent?.internal&&(e.isZoomingOrPanning=!1,o&&Wg(t,e.mouseButton??0)&&!e.usedRightMouseButton&&a.sourceEvent&&o(a.sourceEvent),e.usedRightMouseButton=!1,i(!1),s)){const l=Vc(a.transform);e.prevViewport=l,clearTimeout(e.timerId),e.timerId=setTimeout(()=>{s?.(a.sourceEvent,l)},n?150:0)}}}function tk({zoomActivationKeyPressed:e,zoomOnScroll:t,zoomOnPinch:n,panOnDrag:i,panOnScroll:s,zoomOnDoubleClick:o,userSelectionActive:a,noWheelClassName:l,noPanClassName:d,lib:c,connectionInProgress:u}){return p=>{const f=e||t,h=n&&p.ctrlKey,g=p.type==="wheel";if(p.button===1&&p.type==="mousedown"&&(za(p,`${c}-flow__node`)||za(p,`${c}-flow__edge`)))return!0;if(!i&&!f&&!s&&!o&&!n||a||u&&!g||za(p,l)&&g||za(p,d)&&(!g||s&&g&&!e)||!n&&p.ctrlKey&&g)return!1;if(!n&&p.type==="touchstart"&&p.touches?.length>1)return p.preventDefault(),!1;if(!f&&!s&&!h&&g||!i&&(p.type==="mousedown"||p.type==="touchstart")||Array.isArray(i)&&!i.includes(p.button)&&p.type==="mousedown")return!1;const y=Array.isArray(i)&&i.includes(p.button)||!p.button||p.button<=1;return(!p.ctrlKey||g)&&y}}function nk({domNode:e,minZoom:t,maxZoom:n,translateExtent:i,viewport:s,onPanZoom:o,onPanZoomStart:a,onPanZoomEnd:l,onDraggingChange:d}){const c={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},u=e.getBoundingClientRect(),p=t2().scaleExtent([t,n]).translateExtent(i),f=Jn(e).call(p);x({x:s.x,y:s.y,zoom:Ua(s.zoom,t,n)},[[0,0],[u.width,u.height]],i);const h=f.on("wheel.zoom"),g=f.on("dblclick.zoom");p.wheelDelta(Kg);function y(O,I){return f?new Promise(H=>{p?.interpolate(I?.interpolate==="linear"?Nr:Kl).transform(Id(f,I?.duration,I?.ease,()=>H(!0)),O)}):Promise.resolve(!1)}function b({noWheelClassName:O,noPanClassName:I,onPaneContextMenu:H,userSelectionActive:P,panOnScroll:T,panOnDrag:R,panOnScrollMode:B,panOnScrollSpeed:V,preventScrolling:F,zoomOnPinch:Y,zoomOnScroll:J,zoomOnDoubleClick:ie,zoomActivationKeyPressed:ve,lib:re,onTransformChange:me,connectionInProgress:ge,paneClickDistance:Q,selectionOnDrag:oe}){P&&!c.isZoomingOrPanning&&m();const ue=T&&!ve&&!P;p.clickDistance(oe?1/0:!Ui(Q)||Q<0?0:Q);const le=ue?Z2({zoomPanValues:c,noWheelClassName:O,d3Selection:f,d3Zoom:p,panOnScrollMode:B,panOnScrollSpeed:V,zoomOnPinch:Y,onPanZoomStart:a,onPanZoom:o,onPanZoomEnd:l}):J2({noWheelClassName:O,preventScrolling:F,d3ZoomHandler:h});if(f.on("wheel.zoom",le,{passive:!1}),!P){const be=Q2({zoomPanValues:c,onDraggingChange:d,onPanZoomStart:a});p.on("start",be);const fe=$2({zoomPanValues:c,panOnDrag:R,onPaneContextMenu:!!H,onPanZoom:o,onTransformChange:me});p.on("zoom",fe);const Pe=ek({zoomPanValues:c,panOnDrag:R,panOnScroll:T,onPaneContextMenu:H,onPanZoomEnd:l,onDraggingChange:d});p.on("end",Pe)}const te=tk({zoomActivationKeyPressed:ve,panOnDrag:R,zoomOnScroll:J,panOnScroll:T,zoomOnDoubleClick:ie,zoomOnPinch:Y,userSelectionActive:P,noPanClassName:I,noWheelClassName:O,lib:re,connectionInProgress:ge});p.filter(te),ie?f.on("dblclick.zoom",g):f.on("dblclick.zoom",null)}function m(){p.on("zoom",null)}async function x(O,I,H){const P=Td(O),T=p?.constrain()(P,I,H);return T&&await y(T),new Promise(R=>R(T))}async function S(O,I){const H=Td(O);return await y(H,I),new Promise(P=>P(H))}function v(O){if(f){const I=Td(O),H=f.property("__zoom");(H.k!==O.zoom||H.x!==O.x||H.y!==O.y)&&p?.transform(f,I,null,{sync:!0})}}function A(){const O=f?kg(f.node()):{x:0,y:0,k:1};return{x:O.x,y:O.y,zoom:O.k}}function w(O,I){return f?new Promise(H=>{p?.interpolate(I?.interpolate==="linear"?Nr:Kl).scaleTo(Id(f,I?.duration,I?.ease,()=>H(!0)),O)}):Promise.resolve(!1)}function k(O,I){return f?new Promise(H=>{p?.interpolate(I?.interpolate==="linear"?Nr:Kl).scaleBy(Id(f,I?.duration,I?.ease,()=>H(!0)),O)}):Promise.resolve(!1)}function N(O){p?.scaleExtent(O)}function L(O){p?.translateExtent(O)}function X(O){const I=!Ui(O)||O<0?0:O;p?.clickDistance(I)}return{update:b,destroy:m,setViewport:S,setViewportConstrained:x,getViewport:A,scaleTo:w,scaleBy:k,setScaleExtent:N,setTranslateExtent:L,syncViewport:v,setClickDistance:X}}var Vr;(function(e){e.Line="line",e.Handle="handle"})(Vr||(Vr={}));const ik=["top-left","top-right","bottom-left","bottom-right"],sk=["top","right","bottom","left"];function ok({width:e,prevWidth:t,height:n,prevHeight:i,affectsX:s,affectsY:o}){const a=e-t,l=n-i,d=[a>0?1:a<0?-1:0,l>0?1:l<0?-1:0];return a&&s&&(d[0]=d[0]*-1),l&&o&&(d[1]=d[1]*-1),d}function Cp(e){const t=e.includes("right")||e.includes("left"),n=e.includes("bottom")||e.includes("top"),i=e.includes("left"),s=e.includes("top");return{isHorizontal:t,isVertical:n,affectsX:i,affectsY:s}}function ys(e,t){return Math.max(0,t-e)}function bs(e,t){return Math.max(0,e-t)}function Il(e,t,n){return Math.max(0,t-e,e-n)}function Ep(e,t){return e?!t:t}function ak(e,t,n,i,s,o,a,l){let{affectsX:d,affectsY:c}=t;const{isHorizontal:u,isVertical:p}=t,f=u&&p,{xSnapped:h,ySnapped:g}=n,{minWidth:y,maxWidth:b,minHeight:m,maxHeight:x}=i,{x:S,y:v,width:A,height:w,aspectRatio:k}=e;let N=Math.floor(u?h-e.pointerX:0),L=Math.floor(p?g-e.pointerY:0);const X=A+(d?-N:N),O=w+(c?-L:L),I=-o[0]*A,H=-o[1]*w;let P=Il(X,y,b),T=Il(O,m,x);if(a){let V=0,F=0;d&&N<0?V=ys(S+N+I,a[0][0]):!d&&N>0&&(V=bs(S+X+I,a[1][0])),c&&L<0?F=ys(v+L+H,a[0][1]):!c&&L>0&&(F=bs(v+O+H,a[1][1])),P=Math.max(P,V),T=Math.max(T,F)}if(l){let V=0,F=0;d&&N>0?V=bs(S+N,l[0][0]):!d&&N<0&&(V=ys(S+X,l[1][0])),c&&L>0?F=bs(v+L,l[0][1]):!c&&L<0&&(F=ys(v+O,l[1][1])),P=Math.max(P,V),T=Math.max(T,F)}if(s){if(u){const V=Il(X/k,m,x)*k;if(P=Math.max(P,V),a){let F=0;!d&&!c||d&&!c&&f?F=bs(v+H+X/k,a[1][1])*k:F=ys(v+H+(d?N:-N)/k,a[0][1])*k,P=Math.max(P,F)}if(l){let F=0;!d&&!c||d&&!c&&f?F=ys(v+X/k,l[1][1])*k:F=bs(v+(d?N:-N)/k,l[0][1])*k,P=Math.max(P,F)}}if(p){const V=Il(O*k,y,b)/k;if(T=Math.max(T,V),a){let F=0;!d&&!c||c&&!d&&f?F=bs(S+O*k+I,a[1][0])/k:F=ys(S+(c?L:-L)*k+I,a[0][0])/k,T=Math.max(T,F)}if(l){let F=0;!d&&!c||c&&!d&&f?F=ys(S+O*k,l[1][0])/k:F=bs(S+(c?L:-L)*k,l[0][0])/k,T=Math.max(T,F)}}}L=L+(L<0?T:-T),N=N+(N<0?P:-P),s&&(f?X>O*k?L=(Ep(d,c)?-N:N)/k:N=(Ep(d,c)?-L:L)*k:u?(L=N/k,c=d):(N=L*k,d=c));const R=d?S+N:S,B=c?v+L:v;return{width:A+(d?-N:N),height:w+(c?-L:L),x:o[0]*N*(d?-1:1)+R,y:o[1]*L*(c?-1:1)+B}}const jg={width:0,height:0,x:0,y:0},rk={...jg,pointerX:0,pointerY:0,aspectRatio:1};function lk(e){return[[0,0],[e.measured.width,e.measured.height]]}function ck(e,t,n){const i=t.position.x+e.position.x,s=t.position.y+e.position.y,o=e.measured.width??0,a=e.measured.height??0,l=n[0]*o,d=n[1]*a;return[[i-l,s-d],[i+o-l,s+a-d]]}function dk({domNode:e,nodeId:t,getStoreItems:n,onChange:i,onEnd:s}){const o=Jn(e);let a={controlDirection:Cp("bottom-right"),boundaries:{minWidth:0,minHeight:0,maxWidth:Number.MAX_VALUE,maxHeight:Number.MAX_VALUE},resizeDirection:void 0,keepAspectRatio:!1};function l({controlPosition:c,boundaries:u,keepAspectRatio:p,resizeDirection:f,onResizeStart:h,onResize:g,onResizeEnd:y,shouldResize:b}){let m={...jg},x={...rk};a={boundaries:u,resizeDirection:f,keepAspectRatio:p,controlDirection:Cp(c)};let S,v=null,A=[],w,k,N,L=!1;const X=cg().on("start",O=>{const{nodeLookup:I,transform:H,snapGrid:P,snapToGrid:T,nodeOrigin:R,paneDomNode:B}=n();if(S=I.get(t),!S)return;v=B?.getBoundingClientRect()??null;const{xSnapped:V,ySnapped:F}=Pr(O.sourceEvent,{transform:H,snapGrid:P,snapToGrid:T,containerBounds:v});m={width:S.measured.width??0,height:S.measured.height??0,x:S.position.x??0,y:S.position.y??0},x={...m,pointerX:V,pointerY:F,aspectRatio:m.width/m.height},w=void 0,S.parentId&&(S.extent==="parent"||S.expandParent)&&(w=I.get(S.parentId),k=w&&S.extent==="parent"?lk(w):void 0),A=[],N=void 0;for(const[Y,J]of I)if(J.parentId===t&&(A.push({id:Y,position:{...J.position},extent:J.extent}),J.extent==="parent"||J.expandParent)){const ie=ck(J,S,J.origin??R);N?N=[[Math.min(ie[0][0],N[0][0]),Math.min(ie[0][1],N[0][1])],[Math.max(ie[1][0],N[1][0]),Math.max(ie[1][1],N[1][1])]]:N=ie}h?.(O,{...m})}).on("drag",O=>{const{transform:I,snapGrid:H,snapToGrid:P,nodeOrigin:T}=n(),R=Pr(O.sourceEvent,{transform:I,snapGrid:H,snapToGrid:P,containerBounds:v}),B=[];if(!S)return;const{x:V,y:F,width:Y,height:J}=m,ie={},ve=S.origin??T,{width:re,height:me,x:ge,y:Q}=ak(x,a.controlDirection,R,a.boundaries,a.keepAspectRatio,ve,k,N),oe=re!==Y,ue=me!==J,le=ge!==V&&oe,te=Q!==F&&ue;if(!le&&!te&&!oe&&!ue)return;if((le||te||ve[0]===1||ve[1]===1)&&(ie.x=le?ge:m.x,ie.y=te?Q:m.y,m.x=ie.x,m.y=ie.y,A.length>0)){const Re=ge-V,Se=Q-F;for(const Ce of A)Ce.position={x:Ce.position.x-Re+ve[0]*(re-Y),y:Ce.position.y-Se+ve[1]*(me-J)},B.push(Ce)}if((oe||ue)&&(ie.width=oe&&(!a.resizeDirection||a.resizeDirection==="horizontal")?re:m.width,ie.height=ue&&(!a.resizeDirection||a.resizeDirection==="vertical")?me:m.height,m.width=ie.width,m.height=ie.height),w&&S.expandParent){const Re=ve[0]*(ie.width??0);ie.x&&ie.x<Re&&(m.x=Re,x.x=x.x-(ie.x-Re));const Se=ve[1]*(ie.height??0);ie.y&&ie.y<Se&&(m.y=Se,x.y=x.y-(ie.y-Se))}const be=ok({width:m.width,prevWidth:Y,height:m.height,prevHeight:J,affectsX:a.controlDirection.affectsX,affectsY:a.controlDirection.affectsY}),fe={...m,direction:be};b?.(O,fe)!==!1&&(L=!0,g?.(O,fe),i(ie,B))}).on("end",O=>{L&&(y?.(O,{...m}),s?.({...m}),L=!1)});o.call(X)}function d(){o.on(".drag",null)}return{update:l,destroy:d}}function $u(){const e={};return[t=>{if(t&&!j0(e))throw new Error(t);return Au(e)},t=>Hh(e,t)]}const[ef,uk]=$u(),[fk,pk]=$u(),[hk,gk]=$u();var mk=Z("<div><!></div>");function Ja(e,t){Oe(t,!0);let n=_e(t,"id",3,null),i=_e(t,"type",3,"source"),s=_e(t,"position",19,()=>We.Top),o=_e(t,"isConnectableStart",3,!0),a=_e(t,"isConnectableEnd",3,!0),l=Js(t,["$$slots","$$events","$$legacy","id","type","position","style","class","isConnectable","isConnectableStart","isConnectableEnd","isValidConnection","onconnect","ondisconnect","children"]);const d=ef("Handle must be used within a Custom Node component"),c=fk("Handle must be used within a Custom Node component");let u=D(()=>i()==="target"),p=D(()=>t.isConnectable!==void 0?t.isConnectable:c.value),f=Ps(),h=D(()=>f.ariaLabelConfig),g=null;Fh(()=>{if(t.onconnect||t.ondisconnect){f.edges;let I=f.connectionLookup.get(`${d}-${i()}${n()?`-${n()}`:""}`);if(g&&!i2(I,g)){const H=I??new Map;fp(g,H,t.ondisconnect),fp(H,g,t.onconnect)}g=new Map(I)}});let y=D(()=>{if(!f.connection.inProgress)return[!1,!1,!1,!1,null];const{fromHandle:I,toHandle:H,isValid:P}=f.connection,T=I&&I.nodeId===d&&I.type===i()&&I.id===n(),R=H&&H.nodeId===d&&H.type===i()&&H.id===n(),B=f.connectionMode===Ga.Strict?I?.type!==i():d!==I?.nodeId||n()!==I?.id;return[!0,T,R,B,R&&P]}),b=D(()=>Zs(r(y),5)),m=D(()=>r(b)[0]),x=D(()=>r(b)[1]),S=D(()=>r(b)[2]),v=D(()=>r(b)[3]),A=D(()=>r(b)[4]);function w(I){const H=f.onbeforeconnect?f.onbeforeconnect(I):I;H&&(f.addEdge(H),f.onconnect?.(I))}function k(I){const H=Ag(I);I.currentTarget&&(H&&I.button===0||!H)&&Sp.onPointerDown(I,{handleId:n(),nodeId:d,isTarget:r(u),connectionRadius:f.connectionRadius,domNode:f.domNode,nodeLookup:f.nodeLookup,connectionMode:f.connectionMode,lib:"svelte",autoPanOnConnect:f.autoPanOnConnect,autoPanSpeed:f.autoPanSpeed,flowId:f.flowId,isValidConnection:t.isValidConnection??f.isValidConnection,updateConnection:f.updateConnection,cancelConnection:f.cancelConnection,panBy:f.panBy,onConnect:w,onConnectStart:(P,T)=>{f.onconnectstart?.(P,{nodeId:T.nodeId,handleId:T.handleId,handleType:T.handleType})},onConnectEnd:(P,T)=>{f.onconnectend?.(P,T)},getTransform:()=>[f.viewport.x,f.viewport.y,f.viewport.zoom],getFromHandle:()=>f.connection.fromHandle,dragThreshold:f.connectionDragThreshold,handleDomNode:I.currentTarget})}function N(I){if(!d||!f.clickConnectStartHandle&&!o())return;if(!f.clickConnectStartHandle){f.onclickconnectstart?.(I,{nodeId:d,handleId:n(),handleType:i()}),f.clickConnectStartHandle={nodeId:d,type:i(),id:n()};return}const H=Pg(I.target),P=t.isValidConnection??f.isValidConnection,{connectionMode:T,clickConnectStartHandle:R,flowId:B,nodeLookup:V}=f,{connection:F,isValid:Y}=Sp.isValid(I,{handle:{nodeId:d,id:n(),type:i()},connectionMode:T,fromNodeId:R.nodeId,fromHandleId:R.id??null,fromType:R.type,isValidConnection:P,flowId:B,doc:H,lib:"svelte",nodeLookup:V});Y&&F&&w(F);const J=structuredClone(qh(f.connection));delete J.inProgress,J.toPosition=J.toHandle?J.toHandle.position:null,f.onclickconnectend?.(I,J),f.clickConnectStartHandle=null}var L=mk(),X=()=>{};Ns(L,()=>({"data-handleid":n(),"data-nodeid":d,"data-handlepos":s(),"data-id":`${f.flowId??""}-${d??""}-${n()??"null"??""}-${i()??""}`,class:["svelte-flow__handle",`svelte-flow__handle-${s()}`,f.noDragClass,f.noPanClass,s(),t.class],onmousedown:k,ontouchstart:k,onclick:f.clickConnect?N:void 0,onkeypress:X,style:t.style,role:"button","aria-label":r(h)["handle.ariaLabel"],tabindex:"-1",...l,[Ss]:{valid:r(A),connectingto:r(S),connectingfrom:r(x),source:!r(u),target:r(u),connectablestart:o(),connectableend:a(),connectable:r(p),connectionindicator:r(p)&&(!r(m)||r(v))&&(r(m)||f.clickConnectStartHandle?a():o())}}));var O=M(L);Dn(O,()=>t.children??Zn),C(L),_(e,L),ze()}var vk=Z("<!> <!>",1);function Xg(e,t){Oe(t,!0);let n=_e(t,"targetPosition",19,()=>We.Top),i=_e(t,"sourcePosition",19,()=>We.Bottom);var s=vk(),o=ae(s);Ja(o,{type:"target",get position(){return n()}});var a=q(o),l=q(a);Ja(l,{type:"source",get position(){return i()}}),G(()=>Fe(a,` ${t.data?.label??""} `)),_(e,s),ze()}var yk=Z(" <!>",1);function bk(e,t){Oe(t,!0);let n=_e(t,"data",19,()=>({label:"Node"})),i=_e(t,"sourcePosition",19,()=>We.Bottom);Kt();var s=yk(),o=ae(s),a=q(o);Ja(a,{type:"source",get position(){return i()}}),G(()=>Fe(o,`${n()?.label??""} `)),_(e,s),ze()}var wk=Z(" <!>",1);function _k(e,t){Oe(t,!0);let n=_e(t,"data",19,()=>({label:"Node"})),i=_e(t,"targetPosition",19,()=>We.Top);Kt();var s=wk(),o=ae(s),a=q(o);Ja(a,{type:"target",get position(){return i()}}),G(()=>Fe(o,`${n()?.label??""} `)),_(e,s),ze()}function xk(e,t){}function Nd(e,t,n){if(!n||!t)return;const i=n==="root"?t:t.querySelector(`.svelte-flow__${n}`);i&&i.appendChild(e)}function kk(e,t){const n=D(Ps),i=D(()=>r(n).domNode);let s;return r(i)?Nd(e,r(i),t):s=Bh(()=>{ut(()=>{Nd(e,r(i),t),s?.()})}),{async update(o){Nd(e,r(i),o)},destroy(){e.parentNode&&e.parentNode.removeChild(e),s?.()}}}function Sk(){let e=$(typeof window>"u");if(r(e)){const t=Bh(()=>{ut(()=>{E(e,!1),t?.()})})}return{get value(){return r(e)}}}const Tp=e=>o2(e),Ck=e=>Cg(e);function Ci(e){return e===void 0?void 0:`${e}px`}const yc={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}};var Ek=Z("<div><!></div>");function Tk(e,t){Oe(t,!0);let n=_e(t,"x",3,0),i=_e(t,"y",3,0),s=_e(t,"selectEdgeOnClick",3,!1),o=_e(t,"transparent",3,!1),a=Js(t,["$$slots","$$events","$$legacy","x","y","width","height","selectEdgeOnClick","transparent","class","children"]);const l=Ps(),d=hk("EdgeLabel must be used within a Custom Edge component");let c=D(()=>l.visible.edges.get(d)?.zIndex);var u=Ek(),p=()=>{s()&&d&&l.handleEdgeSelection(d)};Ns(u,h=>({class:["svelte-flow__edge-label",{transparent:o()},t.class],tabindex:"-1",onclick:p,...a,[ji]:h}),[()=>({display:Sk().value?"none":void 0,cursor:s()?"pointer":void 0,transform:`translate(-50%, -50%) translate(${n()??""}px,${i()??""}px)`,"pointer-events":"all",width:Ci(t.width),height:Ci(t.height),"z-index":r(c)})],void 0,void 0,"svelte-1wg91mu");var f=M(u);Dn(f,()=>t.children??Zn),C(u),Ee(u,(h,g)=>kk?.(h,g),()=>"edge-labels"),_(e,u),ze()}var Ik=ye("<path></path>"),Nk=ye('<path fill="none"></path><!><!>',1);function $r(e,t){let n=_e(t,"interactionWidth",3,20),i=Js(t,["$$slots","$$events","$$legacy","id","path","label","labelX","labelY","labelStyle","markerStart","markerEnd","style","interactionWidth","class"]);var s=Nk(),o=ae(s),a=q(o);{var l=u=>{var p=Ik();Ns(p,()=>({d:t.path,"stroke-opacity":0,"stroke-width":n(),fill:"none",class:"svelte-flow__edge-interaction",...i})),_(u,p)};j(a,u=>{n()>0&&u(l)})}var d=q(a);{var c=u=>{Tk(u,{get x(){return t.labelX},get y(){return t.labelY},get style(){return t.labelStyle},selectEdgeOnClick:!0,children:(p,f)=>{Kt();var h=Ih();G(()=>Fe(h,t.label)),_(p,h)},$$slots:{default:!0}})};j(d,u=>{t.label&&u(c)})}G(()=>{z(o,"id",t.id),z(o,"d",t.path),qe(o,0,Qs(["svelte-flow__edge-path",t.class])),z(o,"marker-start",t.markerStart),z(o,"marker-end",t.markerEnd),wt(o,t.style)}),_(e,s)}function Gg(e,t){Oe(t,!0);let n=D(()=>Dg({sourceX:t.sourceX,sourceY:t.sourceY,targetX:t.targetX,targetY:t.targetY,sourcePosition:t.sourcePosition,targetPosition:t.targetPosition,curvature:t.pathOptions?.curvature})),i=D(()=>Zs(r(n),3)),s=D(()=>r(i)[0]),o=D(()=>r(i)[1]),a=D(()=>r(i)[2]);$r(e,{get id(){return t.id},get path(){return r(s)},get labelX(){return r(o)},get labelY(){return r(a)},get label(){return t.label},get labelStyle(){return t.labelStyle},get markerStart(){return t.markerStart},get markerEnd(){return t.markerEnd},get interactionWidth(){return t.interactionWidth},get style(){return t.style}}),ze()}function Pk(e,t){Oe(t,!0);let n=D(()=>qc({sourceX:t.sourceX,sourceY:t.sourceY,targetX:t.targetX,targetY:t.targetY,sourcePosition:t.sourcePosition,targetPosition:t.targetPosition})),i=D(()=>Zs(r(n),3)),s=D(()=>r(i)[0]),o=D(()=>r(i)[1]),a=D(()=>r(i)[2]);$r(e,{get path(){return r(s)},get labelX(){return r(o)},get labelY(){return r(a)},get label(){return t.label},get labelStyle(){return t.labelStyle},get markerStart(){return t.markerStart},get markerEnd(){return t.markerEnd},get interactionWidth(){return t.interactionWidth},get style(){return t.style}}),ze()}function Mk(e,t){Oe(t,!0);let n=D(()=>Og({sourceX:t.sourceX,sourceY:t.sourceY,targetX:t.targetX,targetY:t.targetY})),i=D(()=>Zs(r(n),3)),s=D(()=>r(i)[0]),o=D(()=>r(i)[1]),a=D(()=>r(i)[2]);$r(e,{get path(){return r(s)},get labelX(){return r(o)},get labelY(){return r(a)},get label(){return t.label},get labelStyle(){return t.labelStyle},get markerStart(){return t.markerStart},get markerEnd(){return t.markerEnd},get interactionWidth(){return t.interactionWidth},get style(){return t.style}}),ze()}function Ak(e,t){Oe(t,!0);let n=D(()=>qc({sourceX:t.sourceX,sourceY:t.sourceY,targetX:t.targetX,targetY:t.targetY,sourcePosition:t.sourcePosition,targetPosition:t.targetPosition,borderRadius:0})),i=D(()=>Zs(r(n),3)),s=D(()=>r(i)[0]),o=D(()=>r(i)[1]),a=D(()=>r(i)[2]);$r(e,{get path(){return r(s)},get labelX(){return r(o)},get labelY(){return r(a)},get label(){return t.label},get labelStyle(){return t.labelStyle},get markerStart(){return t.markerStart},get markerEnd(){return t.markerEnd},get interactionWidth(){return t.interactionWidth},get style(){return t.style}}),ze()}class Dk{#e;#t;constructor(t,n){this.#e=t,this.#t=e1(n)}get current(){return this.#t(),this.#e()}}const Rk=/\(.+\)/,Ok=new Set(["all","print","screen","and","or","not","only"]);class zk extends Dk{constructor(t,n){let i=Rk.test(t)||t.split(/[\s,]+/).some(o=>Ok.has(o.trim()))?t:`(${t})`;const s=window.matchMedia(i);super(()=>s.matches,o=>Yd(s,"change",o))}}function Lk(e,t,n,i){const s=new Map;return Gu(e,{x:0,y:0,width:n,height:i},t,!0).forEach(o=>{s.set(o.id,o)}),s}function Ip(e){const{edges:t,defaultEdgeOptions:n,nodeLookup:i,previousEdges:s,connectionMode:o,onerror:a,onlyRenderVisible:l,elevateEdgesOnSelect:d,zIndexMode:c}=e,u=new Map;for(const p of t){const f=i.get(p.source),h=i.get(p.target);if(!f||!h)continue;if(l){const{visibleNodes:b,transform:m,width:x,height:S}=e;if(_2({sourceNode:f,targetNode:h,width:x,height:S,transform:m}))b.set(f.id,f),b.set(h.id,h);else continue}const g=s.get(p.id);if(g&&p===g.edge&&f==g.sourceNode&&h==g.targetNode){u.set(p.id,g);continue}const y=I2({id:p.id,sourceNode:f,targetNode:h,sourceHandle:p.sourceHandle||null,targetHandle:p.targetHandle||null,connectionMode:o,onError:a});y&&u.set(p.id,{...n,...p,...y,zIndex:w2({selected:p.selected,zIndex:p.zIndex??n.zIndex,sourceNode:f,targetNode:h,elevateOnSelect:d,zIndexMode:c}),sourceNode:f,targetNode:h,edge:p})}return u}const Ug={input:bk,output:_k,default:Xg,group:xk},Yg={straight:Mk,smoothstep:Pk,default:Gg,step:Ak};function Hk(e,t,n,i,s,o){if(t&&!n&&i&&s){const a=Hc(o,{filter:l=>!!((l.width||l.initialWidth)&&(l.height||l.initialHeight))});return Uu(a,i,s,.5,2,.1)}else return n??{x:0,y:0,zoom:1}}function Fk(e){class t{#e=D(()=>e.props.id??"1");get flowId(){return r(this.#e)}set flowId(i){E(this.#e,i)}#t=$(null);get domNode(){return r(this.#t)}set domNode(i){E(this.#t,i)}#n=$(null);get panZoom(){return r(this.#n)}set panZoom(i){E(this.#n,i)}#i=$(e.width??0);get width(){return r(this.#i)}set width(i){E(this.#i,i)}#s=$(e.height??0);get height(){return r(this.#s)}set height(i){E(this.#s,i)}#o=$(e.props.zIndexMode??"basic");get zIndexMode(){return r(this.#o)}set zIndexMode(i){E(this.#o,i)}#a=D(()=>{const i=R2(e.nodes,this.nodeLookup,this.parentLookup,{nodeExtent:this.nodeExtent,nodeOrigin:this.nodeOrigin,elevateNodesOnSelect:e.props.elevateNodesOnSelect??!0,checkEquality:!0,zIndexMode:this.zIndexMode});return this.fitViewQueued&&i&&(this.fitViewOptions?.duration?this.resolveFitView():queueMicrotask(()=>{this.resolveFitView()})),i});get nodesInitialized(){return r(this.#a)}set nodesInitialized(i){E(this.#a,i)}#r=D(()=>this.panZoom!==null);get viewportInitialized(){return r(this.#r)}set viewportInitialized(i){E(this.#r,i)}#l=D(()=>(B2(this.connectionLookup,this.edgeLookup,e.edges),e.edges));get _edges(){return r(this.#l)}set _edges(i){E(this.#l,i)}get nodes(){return this.nodesInitialized,e.nodes}set nodes(i){e.nodes=i}get edges(){return this._edges}set edges(i){e.edges=i}_prevSelectedNodes=[];_prevSelectedNodeIds=new Set;#c=D(()=>{const i=this._prevSelectedNodeIds.size,s=new Set,o=this.nodes.filter(a=>(a.selected&&(s.add(a.id),this._prevSelectedNodeIds.delete(a.id)),a.selected));return(i!==s.size||this._prevSelectedNodeIds.size>0)&&(this._prevSelectedNodes=o),this._prevSelectedNodeIds=s,this._prevSelectedNodes});get selectedNodes(){return r(this.#c)}set selectedNodes(i){E(this.#c,i)}_prevSelectedEdges=[];_prevSelectedEdgeIds=new Set;#d=D(()=>{const i=this._prevSelectedEdgeIds.size,s=new Set,o=this.edges.filter(a=>(a.selected&&(s.add(a.id),this._prevSelectedEdgeIds.delete(a.id)),a.selected));return(i!==s.size||this._prevSelectedEdgeIds.size>0)&&(this._prevSelectedEdges=o),this._prevSelectedEdgeIds=s,this._prevSelectedEdges});get selectedEdges(){return r(this.#d)}set selectedEdges(i){E(this.#d,i)}selectionChangeHandlers=new Map;nodeLookup=new Map;parentLookup=new Map;connectionLookup=new Map;edgeLookup=new Map;_prevVisibleEdges=new Map;#u=D(()=>{const{nodes:i,_edges:s,_prevVisibleEdges:o,nodeLookup:a,connectionMode:l,onerror:d,onlyRenderVisibleElements:c,defaultEdgeOptions:u,zIndexMode:p}=this;let f,h;const g={edges:s,defaultEdgeOptions:u,previousEdges:o,nodeLookup:a,connectionMode:l,elevateEdgesOnSelect:e.props.elevateEdgesOnSelect??!0,zIndexMode:p,onerror:d};if(c){const{viewport:y,width:b,height:m}=this,x=[y.x,y.y,y.zoom];f=Lk(a,x,b,m),h=Ip({...g,onlyRenderVisible:!0,visibleNodes:f,transform:x,width:b,height:m})}else f=this.nodeLookup,h=Ip(g);return{nodes:f,edges:h}});get visible(){return r(this.#u)}set visible(i){E(this.#u,i)}#f=D(()=>e.props.nodesDraggable??!0);get nodesDraggable(){return r(this.#f)}set nodesDraggable(i){E(this.#f,i)}#p=D(()=>e.props.nodesConnectable??!0);get nodesConnectable(){return r(this.#p)}set nodesConnectable(i){E(this.#p,i)}#h=D(()=>e.props.elementsSelectable??!0);get elementsSelectable(){return r(this.#h)}set elementsSelectable(i){E(this.#h,i)}#g=D(()=>e.props.nodesFocusable??!0);get nodesFocusable(){return r(this.#g)}set nodesFocusable(i){E(this.#g,i)}#m=D(()=>e.props.edgesFocusable??!0);get edgesFocusable(){return r(this.#m)}set edgesFocusable(i){E(this.#m,i)}#v=D(()=>e.props.disableKeyboardA11y??!1);get disableKeyboardA11y(){return r(this.#v)}set disableKeyboardA11y(i){E(this.#v,i)}#y=D(()=>e.props.minZoom??.5);get minZoom(){return r(this.#y)}set minZoom(i){E(this.#y,i)}#b=D(()=>e.props.maxZoom??2);get maxZoom(){return r(this.#b)}set maxZoom(i){E(this.#b,i)}#w=D(()=>e.props.nodeOrigin??[0,0]);get nodeOrigin(){return r(this.#w)}set nodeOrigin(i){E(this.#w,i)}#_=D(()=>e.props.nodeExtent??au);get nodeExtent(){return r(this.#_)}set nodeExtent(i){E(this.#_,i)}#x=D(()=>e.props.translateExtent??au);get translateExtent(){return r(this.#x)}set translateExtent(i){E(this.#x,i)}#k=D(()=>e.props.defaultEdgeOptions??{});get defaultEdgeOptions(){return r(this.#k)}set defaultEdgeOptions(i){E(this.#k,i)}#S=D(()=>e.props.nodeDragThreshold??1);get nodeDragThreshold(){return r(this.#S)}set nodeDragThreshold(i){E(this.#S,i)}#C=D(()=>e.props.autoPanOnNodeDrag??!0);get autoPanOnNodeDrag(){return r(this.#C)}set autoPanOnNodeDrag(i){E(this.#C,i)}#E=D(()=>e.props.autoPanOnConnect??!0);get autoPanOnConnect(){return r(this.#E)}set autoPanOnConnect(i){E(this.#E,i)}#T=D(()=>e.props.autoPanOnNodeFocus??!0);get autoPanOnNodeFocus(){return r(this.#T)}set autoPanOnNodeFocus(i){E(this.#T,i)}#I=D(()=>e.props.autoPanSpeed??15);get autoPanSpeed(){return r(this.#I)}set autoPanSpeed(i){E(this.#I,i)}#N=D(()=>e.props.connectionDragThreshold??1);get connectionDragThreshold(){return r(this.#N)}set connectionDragThreshold(i){E(this.#N,i)}fitViewQueued=e.props.fitView??!1;fitViewOptions=e.props.fitViewOptions;fitViewResolver=null;#P=D(()=>e.props.snapGrid??null);get snapGrid(){return r(this.#P)}set snapGrid(i){E(this.#P,i)}#M=$(!1);get dragging(){return r(this.#M)}set dragging(i){E(this.#M,i)}#A=$(null);get selectionRect(){return r(this.#A)}set selectionRect(i){E(this.#A,i)}#D=$(!1);get selectionKeyPressed(){return r(this.#D)}set selectionKeyPressed(i){E(this.#D,i)}#R=$(!1);get multiselectionKeyPressed(){return r(this.#R)}set multiselectionKeyPressed(i){E(this.#R,i)}#O=$(!1);get deleteKeyPressed(){return r(this.#O)}set deleteKeyPressed(i){E(this.#O,i)}#z=$(!1);get panActivationKeyPressed(){return r(this.#z)}set panActivationKeyPressed(i){E(this.#z,i)}#L=$(!1);get zoomActivationKeyPressed(){return r(this.#L)}set zoomActivationKeyPressed(i){E(this.#L,i)}#H=$(null);get selectionRectMode(){return r(this.#H)}set selectionRectMode(i){E(this.#H,i)}#F=$("");get ariaLiveMessage(){return r(this.#F)}set ariaLiveMessage(i){E(this.#F,i)}#B=D(()=>e.props.selectionMode??pc.Partial);get selectionMode(){return r(this.#B)}set selectionMode(i){E(this.#B,i)}#q=D(()=>({...Ug,...e.props.nodeTypes}));get nodeTypes(){return r(this.#q)}set nodeTypes(i){E(this.#q,i)}#V=D(()=>({...Yg,...e.props.edgeTypes}));get edgeTypes(){return r(this.#V)}set edgeTypes(i){E(this.#V,i)}#W=D(()=>e.props.noPanClass??"nopan");get noPanClass(){return r(this.#W)}set noPanClass(i){E(this.#W,i)}#K=D(()=>e.props.noDragClass??"nodrag");get noDragClass(){return r(this.#K)}set noDragClass(i){E(this.#K,i)}#j=D(()=>e.props.noWheelClass??"nowheel");get noWheelClass(){return r(this.#j)}set noWheelClass(i){E(this.#j,i)}#X=D(()=>v2(e.props.ariaLabelConfig));get ariaLabelConfig(){return r(this.#X)}set ariaLabelConfig(i){E(this.#X,i)}#G=$(Hk(this.nodesInitialized,e.props.fitView,e.props.initialViewport,this.width,this.height,this.nodeLookup));get _viewport(){return r(this.#G)}set _viewport(i){E(this.#G,i)}get viewport(){return e.viewport??this._viewport}set viewport(i){e.viewport&&(e.viewport=i),this._viewport=i}#U=$(ru);get _connection(){return r(this.#U)}set _connection(i){E(this.#U,i)}#Y=D(()=>this._connection.inProgress?{...this._connection,to:Qr(this._connection.to,[this.viewport.x,this.viewport.y,this.viewport.zoom])}:this._connection);get connection(){return r(this.#Y)}set connection(i){E(this.#Y,i)}#Z=D(()=>e.props.connectionMode??Ga.Strict);get connectionMode(){return r(this.#Z)}set connectionMode(i){E(this.#Z,i)}#J=D(()=>e.props.connectionRadius??20);get connectionRadius(){return r(this.#J)}set connectionRadius(i){E(this.#J,i)}#Q=D(()=>e.props.isValidConnection??(()=>!0));get isValidConnection(){return r(this.#Q)}set isValidConnection(i){E(this.#Q,i)}#$=D(()=>e.props.selectNodesOnDrag??!0);get selectNodesOnDrag(){return r(this.#$)}set selectNodesOnDrag(i){E(this.#$,i)}#ee=D(()=>e.props.defaultMarkerColor===void 0?"#b1b1b7":e.props.defaultMarkerColor);get defaultMarkerColor(){return r(this.#ee)}set defaultMarkerColor(i){E(this.#ee,i)}#te=D(()=>N2(e.edges,{defaultColor:this.defaultMarkerColor,id:this.flowId,defaultMarkerStart:this.defaultEdgeOptions.markerStart,defaultMarkerEnd:this.defaultEdgeOptions.markerEnd}));get markers(){return r(this.#te)}set markers(i){E(this.#te,i)}#ne=D(()=>e.props.onlyRenderVisibleElements??!1);get onlyRenderVisibleElements(){return r(this.#ne)}set onlyRenderVisibleElements(i){E(this.#ne,i)}#ie=D(()=>e.props.onflowerror??f2);get onerror(){return r(this.#ie)}set onerror(i){E(this.#ie,i)}#se=D(()=>e.props.ondelete);get ondelete(){return r(this.#se)}set ondelete(i){E(this.#se,i)}#oe=D(()=>e.props.onbeforedelete);get onbeforedelete(){return r(this.#oe)}set onbeforedelete(i){E(this.#oe,i)}#ae=D(()=>e.props.onbeforeconnect);get onbeforeconnect(){return r(this.#ae)}set onbeforeconnect(i){E(this.#ae,i)}#re=D(()=>e.props.onconnect);get onconnect(){return r(this.#re)}set onconnect(i){E(this.#re,i)}#le=D(()=>e.props.onconnectstart);get onconnectstart(){return r(this.#le)}set onconnectstart(i){E(this.#le,i)}#ce=D(()=>e.props.onconnectend);get onconnectend(){return r(this.#ce)}set onconnectend(i){E(this.#ce,i)}#de=D(()=>e.props.onbeforereconnect);get onbeforereconnect(){return r(this.#de)}set onbeforereconnect(i){E(this.#de,i)}#ue=D(()=>e.props.onreconnect);get onreconnect(){return r(this.#ue)}set onreconnect(i){E(this.#ue,i)}#fe=D(()=>e.props.onreconnectstart);get onreconnectstart(){return r(this.#fe)}set onreconnectstart(i){E(this.#fe,i)}#pe=D(()=>e.props.onreconnectend);get onreconnectend(){return r(this.#pe)}set onreconnectend(i){E(this.#pe,i)}#he=D(()=>e.props.clickConnect??!0);get clickConnect(){return r(this.#he)}set clickConnect(i){E(this.#he,i)}#ge=D(()=>e.props.onclickconnectstart);get onclickconnectstart(){return r(this.#ge)}set onclickconnectstart(i){E(this.#ge,i)}#me=D(()=>e.props.onclickconnectend);get onclickconnectend(){return r(this.#me)}set onclickconnectend(i){E(this.#me,i)}#ve=$(null);get clickConnectStartHandle(){return r(this.#ve)}set clickConnectStartHandle(i){E(this.#ve,i)}#ye=D(()=>e.props.onselectiondrag);get onselectiondrag(){return r(this.#ye)}set onselectiondrag(i){E(this.#ye,i)}#be=D(()=>e.props.onselectiondragstart);get onselectiondragstart(){return r(this.#be)}set onselectiondragstart(i){E(this.#be,i)}#we=D(()=>e.props.onselectiondragstop);get onselectiondragstop(){return r(this.#we)}set onselectiondragstop(i){E(this.#we,i)}resolveFitView=async()=>{this.panZoom&&(await c2({nodes:this.nodeLookup,width:this.width,height:this.height,panZoom:this.panZoom,minZoom:this.minZoom,maxZoom:this.maxZoom},this.fitViewOptions),this.fitViewResolver?.resolve(!0),this.fitViewQueued=!1,this.fitViewOptions=void 0,this.fitViewResolver=null)};_prefersDark=new zk("(prefers-color-scheme: dark)",e.props.colorModeSSR==="dark");#_e=D(()=>e.props.colorMode==="system"?this._prefersDark.current?"dark":"light":e.props.colorMode??"light");get colorMode(){return r(this.#_e)}set colorMode(i){E(this.#_e,i)}constructor(){}resetStoreValues(){this.dragging=!1,this.selectionRect=null,this.selectionRectMode=null,this.selectionKeyPressed=!1,this.multiselectionKeyPressed=!1,this.deleteKeyPressed=!1,this.panActivationKeyPressed=!1,this.zoomActivationKeyPressed=!1,this._connection=ru,this.clickConnectStartHandle=null,this.viewport=e.props.initialViewport??{x:0,y:0,zoom:1},this.ariaLiveMessage=""}}return new t}function Ps(){const e=Au(du);if(!e)throw new Error("To call useStore outside of <SvelteFlow /> you need to wrap your component in a <SvelteFlowProvider />");return e.getStore()}const du=Symbol();function Bk(e){const t=Fk(e);function n(O){t.nodeTypes={...Ug,...O}}function i(O){t.edgeTypes={...Yg,...O}}function s(O){t.edges=S2(O,t.edges)}const o=(O,I=!1)=>{t.nodes=t.nodes.map(H=>{if(t.connection.inProgress&&t.connection.fromNode.id===H.id){const T=t.nodeLookup.get(H.id);T&&(t.connection={...t.connection,from:js(T,t.connection.fromHandle,We.Left,!0)})}const P=O.get(H.id);return P?{...H,position:P.position,dragging:I}:H})};function a(O){const{changes:I,updatedInternals:H}=H2(O,t.nodeLookup,t.parentLookup,t.domNode,t.nodeOrigin,t.nodeExtent,t.zIndexMode);if(!H)return;A2(t.nodeLookup,t.parentLookup,{nodeOrigin:t.nodeOrigin,nodeExtent:t.nodeExtent,zIndexMode:t.zIndexMode}),t.fitViewQueued&&t.resolveFitView();const P=new Map;for(const T of I){const R=t.nodeLookup.get(T.id)?.internals.userNode;if(!R)continue;const B={...R};switch(T.type){case"dimensions":{const V={...B.measured,...T.dimensions};T.setAttributes&&(B.width=T.dimensions?.width??B.width,B.height=T.dimensions?.height??B.height),B.measured=V;break}case"position":B.position=T.position??B.position;break}P.set(T.id,B)}t.nodes=t.nodes.map(T=>P.get(T.id)??T)}function l(O){const I=t.fitViewResolver??Promise.withResolvers();return t.fitViewQueued=!0,t.fitViewOptions=O,t.fitViewResolver=I,t.nodes=[...t.nodes],I.promise}async function d(O,I,H){const P=typeof H?.zoom<"u"?H.zoom:t.maxZoom,T=t.panZoom;return T?(await T.setViewport({x:t.width/2-O*P,y:t.height/2-I*P,zoom:P},{duration:H?.duration,ease:H?.ease,interpolate:H?.interpolate}),Promise.resolve(!0)):Promise.resolve(!1)}function c(O,I){const H=t.panZoom;return H?H.scaleBy(O,I):Promise.resolve(!1)}function u(O){return c(1.2,O)}function p(O){return c(1/1.2,O)}function f(O){const I=t.panZoom;I&&(I.setScaleExtent([O,t.maxZoom]),t.minZoom=O)}function h(O){const I=t.panZoom;I&&(I.setScaleExtent([t.minZoom,O]),t.maxZoom=O)}function g(O){const I=t.panZoom;I&&(I.setTranslateExtent(O),t.translateExtent=O)}function y(O,I=null){let H=!1;const P=O.map(T=>(I?I.has(T.id):!0)&&T.selected?(H=!0,{...T,selected:!1}):T);return[H,P]}function b(O){const I=O?.nodes?new Set(O.nodes.map(V=>V.id)):null,[H,P]=y(t.nodes,I);H&&(t.nodes=P);const T=O?.edges?new Set(O.edges.map(V=>V.id)):null,[R,B]=y(t.edges,T);R&&(t.edges=B)}function m(O){const I=t.multiselectionKeyPressed;t.nodes=t.nodes.map(H=>{const P=O.includes(H.id),T=I&&H.selected||P;return!!H.selected!==T?{...H,selected:T}:H}),I||b({nodes:[]})}function x(O){const I=t.multiselectionKeyPressed;t.edges=t.edges.map(H=>{const P=O.includes(H.id),T=I&&H.selected||P;return!!H.selected!==T?{...H,selected:T}:H}),I||b({edges:[]})}function S(O,I,H){const P=t.nodeLookup.get(O);if(!P){console.warn("012",Br.error012(O));return}t.selectionRect=null,t.selectionRectMode=null,P.selected?(I||P.selected&&t.multiselectionKeyPressed)&&(b({nodes:[P],edges:[]}),requestAnimationFrame(()=>H?.blur())):m([O])}function v(O){const I=t.edgeLookup.get(O);if(!I){console.warn("012",Br.error012(O));return}(I.selectable||t.elementsSelectable&&typeof I.selectable>"u")&&(t.selectionRect=null,t.selectionRectMode=null,I.selected?I.selected&&t.multiselectionKeyPressed&&b({nodes:[],edges:[I]}):x([O]))}function A(O,I){const{nodeExtent:H,snapGrid:P,nodeOrigin:T,nodeLookup:R,nodesDraggable:B,onerror:V}=t,F=new Map,Y=P?.[0]??5,J=P?.[1]??5,ie=O.x*Y*I,ve=O.y*J*I;for(const re of R.values()){if(!(re.selected&&(re.draggable||B&&typeof re.draggable>"u")))continue;let ge={x:re.internals.positionAbsolute.x+ie,y:re.internals.positionAbsolute.y+ve};P&&(ge=Jr(ge,P));const{position:Q,positionAbsolute:oe}=Eg({nodeId:re.id,nextPosition:ge,nodeLookup:R,nodeExtent:H,nodeOrigin:T,onError:V});re.position=Q,re.internals.positionAbsolute=oe,F.set(re.id,re)}o(F)}function w(O){return F2({delta:O,panZoom:t.panZoom,transform:[t.viewport.x,t.viewport.y,t.viewport.zoom],translateExtent:t.translateExtent,width:t.width,height:t.height})}const k=O=>{t._connection={...O}};function N(){t._connection=ru}function L(){t.resetStoreValues(),b()}return Object.assign(t,{setNodeTypes:n,setEdgeTypes:i,addEdge:s,updateNodePositions:o,updateNodeInternals:a,zoomIn:u,zoomOut:p,fitView:l,setCenter:d,setMinZoom:f,setMaxZoom:h,setTranslateExtent:g,unselectNodesAndEdges:b,addSelectedNodes:m,addSelectedEdges:x,handleNodeSelection:S,handleEdgeSelection:v,moveSelectedNodes:A,panBy:w,updateConnection:k,cancelConnection:N,reset:L})}function qk(e,t){const{minZoom:n,maxZoom:i,initialViewport:s,onPanZoomStart:o,onPanZoom:a,onPanZoomEnd:l,translateExtent:d,setPanZoomInstance:c,onDraggingChange:u,onTransformChange:p}=t,f=nk({domNode:e,minZoom:n,maxZoom:i,translateExtent:d,viewport:s,onPanZoom:a,onPanZoomStart:o,onPanZoomEnd:l,onDraggingChange:u}),h=f.getViewport();return(s.x!==h.x||s.y!==h.y||s.zoom!==h.zoom)&&p([h.x,h.y,h.zoom]),c(f),f.update(t),{update(g){f.update(g)}}}var Vk=Z('<div class="svelte-flow__zoom svelte-flow__container"><!></div>');function Wk(e,t){Oe(t,!0);let n=_e(t,"store",15),i=D(()=>n().panActivationKeyPressed||t.panOnDrag),s=D(()=>n().panActivationKeyPressed||t.panOnScroll);const{viewport:o}=n();let a=!1;ut(()=>{!a&&n().viewportInitialized&&(t.oninit?.(),a=!0)});var l=Vk(),d=M(l);Dn(d,()=>t.children),C(l),Ee(l,(c,u)=>qk?.(c,u),()=>({viewport:n().viewport,minZoom:n().minZoom,maxZoom:n().maxZoom,initialViewport:o,onDraggingChange:c=>{n(n().dragging=c,!0)},setPanZoomInstance:c=>{n(n().panZoom=c,!0)},onPanZoomStart:t.onmovestart,onPanZoom:t.onmove,onPanZoomEnd:t.onmoveend,zoomOnScroll:t.zoomOnScroll,zoomOnDoubleClick:t.zoomOnDoubleClick,zoomOnPinch:t.zoomOnPinch,panOnScroll:r(s),panOnDrag:r(i),panOnScrollSpeed:t.panOnScrollSpeed,panOnScrollMode:t.panOnScrollMode,zoomActivationKeyPressed:n().zoomActivationKeyPressed,preventScrolling:typeof t.preventScrolling=="boolean"?t.preventScrolling:!0,noPanClassName:n().noPanClass,noWheelClassName:n().noWheelClass,userSelectionActive:!!n().selectionRect,translateExtent:n().translateExtent,lib:"svelte",paneClickDistance:t.paneClickDistance,selectionOnDrag:t.selectionOnDrag,onTransformChange:c=>{n(n().viewport={x:c[0],y:c[1],zoom:c[2]},!0)},connectionInProgress:n().connection.inProgress})),_(e,l),ze()}function Np(e,t){return n=>{n.target===t&&e?.(n)}}function Pp(e){return t=>{const n=e.has(t.id);return!!t.selected!==n?{...t,selected:n}:t}}function Mp(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}var Kk=Z("<div><!></div>");function jk(e,t){Oe(t,!0);let n=_e(t,"store",15),i=_e(t,"panOnDrag",3,!0),s=_e(t,"paneClickDistance",3,1),o,a=null,l=new Set,d=new Set,c=D(()=>n().panActivationKeyPressed||i()),u=D(()=>n().selectionKeyPressed||!!n().selectionRect||t.selectionOnDrag&&r(c)!==!0),p=D(()=>n().elementsSelectable&&(r(u)||n().selectionRectMode==="user")),f=!1;function h(N){if(a=o?.getBoundingClientRect(),!a)return;const L=N.target===o,X=!L&&!!N.target.closest(".nokey"),O=t.selectionOnDrag&&L||n().selectionKeyPressed;if(X||!r(u)||!O||N.button!==0||!N.isPrimary)return;N.target?.setPointerCapture?.(N.pointerId),f=!1;const{x:I,y:H}=li(N,a);n(n().selectionRect={width:0,height:0,startX:I,startY:H,x:I,y:H},!0),L||(N.stopPropagation(),N.preventDefault())}function g(N){if(!r(u)||!a||!n().selectionRect)return;const L=li(N,a),{startX:X=0,startY:O=0}=n().selectionRect;if(!f){const R=n().selectionKeyPressed?0:s();if(Math.hypot(L.x-X,L.y-O)<=R)return;n().unselectNodesAndEdges(),t.onselectionstart?.(N)}f=!0;const I={...n().selectionRect,x:L.x<X?L.x:X,y:L.y<O?L.y:O,width:Math.abs(L.x-X),height:Math.abs(L.y-O)},H=l,P=d;l=new Set(Gu(n().nodeLookup,I,[n().viewport.x,n().viewport.y,n().viewport.zoom],n().selectionMode===pc.Partial,!0).map(R=>R.id));const T=n().defaultEdgeOptions.selectable??!0;d=new Set;for(const R of l){const B=n().connectionLookup.get(R);if(B)for(const{edgeId:V}of B.values()){const F=n().edgeLookup.get(V);F&&(F.selectable??T)&&d.add(V)}}Mp(H,l)||n(n().nodes=n().nodes.map(Pp(l)),!0),Mp(P,d)||n(n().edges=n().edges.map(Pp(d)),!0),n(n().selectionRectMode="user",!0),n(n().selectionRect=I,!0)}function y(N){N.button===0&&(N.target?.releasePointerCapture?.(N.pointerId),!f&&N.target===o&&x?.(N),n(n().selectionRect=null,!0),f&&n(n().selectionRectMode=l.size>0?"nodes":null,!0),f&&t.onselectionend?.(N))}const b=N=>{if(Array.isArray(r(c))&&r(c).includes(2)){N.preventDefault();return}t.onpanecontextmenu?.({event:N})},m=N=>{f&&(N.stopPropagation(),f=!1)};function x(N){if(f||n().connection.inProgress){f=!1;return}t.onpaneclick?.({event:N}),n().unselectNodesAndEdges(),n(n().selectionRectMode=null,!0),n(n().selectionRect=null,!0)}var S=Kk();let v;var A=D(()=>r(p)?void 0:Np(x,o));S.__click=function(...N){r(A)?.apply(this,N)},S.__pointermove=function(...N){(r(p)?g:void 0)?.apply(this,N)},S.__pointerup=function(...N){(r(p)?y:void 0)?.apply(this,N)};var w=D(()=>Np(b,o));S.__contextmenu=function(...N){r(w)?.apply(this,N)};var k=M(S);Dn(k,()=>t.children),C(S),Jt(S,N=>o=N,()=>o),G(N=>v=qe(S,1,"svelte-flow__pane svelte-flow__container",null,v,N),[()=>({draggable:i()===!0||Array.isArray(i())&&i().includes(0),dragging:n().dragging,selection:r(u)})]),ht("pointerdown",S,function(...N){(r(p)?h:void 0)?.apply(this,N)},!0),ht("click",S,function(...N){(r(p)?m:void 0)?.apply(this,N)},!0),_(e,S),ze()}Mt(["click","pointermove","pointerup","contextmenu"]);var Xk=Z('<div class="svelte-flow__viewport xyflow__viewport svelte-flow__container"><!></div>');function Gk(e,t){Oe(t,!0);var n=Xk();let i;var s=M(n);Dn(s,()=>t.children),C(n),G(()=>i=wt(n,"",i,{transform:`translate(${t.store.viewport.x??""}px, ${t.store.viewport.y??""}px) scale(${t.store.viewport.zoom??""})`})),_(e,n),ze()}function Zg(e,t){const{store:n,onDrag:i,onDragStart:s,onDragStop:o,onNodeMouseDown:a}=t,l=W2({onDrag:i,onDragStart:s,onDragStop:o,onNodeMouseDown:a,getStoreItems:()=>{const{snapGrid:c,viewport:u}=n;return{nodes:n.nodes,nodeLookup:n.nodeLookup,edges:n.edges,nodeExtent:n.nodeExtent,snapGrid:c||[0,0],snapToGrid:!!c,nodeOrigin:n.nodeOrigin,multiSelectionActive:n.multiselectionKeyPressed,domNode:n.domNode,transform:[u.x,u.y,u.zoom],autoPanOnNodeDrag:n.autoPanOnNodeDrag,nodesDraggable:n.nodesDraggable,selectNodesOnDrag:n.selectNodesOnDrag,nodeDragThreshold:n.nodeDragThreshold,unselectNodesAndEdges:n.unselectNodesAndEdges,updateNodePositions:n.updateNodePositions,onSelectionDrag:n.onselectiondrag,onSelectionDragStart:n.onselectiondragstart,onSelectionDragStop:n.onselectiondragstop,panBy:n.panBy}}});function d(c,u){if(u.disabled){l.destroy();return}l.update({domNode:c,noDragClassName:u.noDragClass,handleSelector:u.handleSelector,nodeId:u.nodeId,isSelectable:u.isSelectable,nodeClickDistance:u.nodeClickDistance})}return d(e,t),{update(c){d(e,c)},destroy(){l.destroy()}}}var Uk=Z('<div aria-live="assertive" aria-atomic="true" class="a11y-live-msg svelte-13pq11u"> </div>'),Yk=Z('<div class="a11y-hidden svelte-13pq11u"> </div> <div class="a11y-hidden svelte-13pq11u"> </div> <!>',1);function Zk(e,t){Oe(t,!0);var n=Yk(),i=ae(n),s=M(i,!0);C(i);var o=q(i,2),a=M(o,!0);C(o);var l=q(o,2);{var d=c=>{var u=Uk(),p=M(u,!0);C(u),G(()=>{z(u,"id",`${Jk}-${t.store.flowId}`),Fe(p,t.store.ariaLiveMessage)}),_(c,u)};j(l,c=>{t.store.disableKeyboardA11y||c(d)})}G(()=>{z(i,"id",`${Jg}-${t.store.flowId}`),Fe(s,t.store.disableKeyboardA11y?t.store.ariaLabelConfig["node.a11yDescription.default"]:t.store.ariaLabelConfig["node.a11yDescription.keyboardDisabled"]),z(o,"id",`${Qg}-${t.store.flowId}`),Fe(a,t.store.ariaLabelConfig["edge.a11yDescription.default"])}),_(e,n),ze()}const Jg="svelte-flow__node-desc",Qg="svelte-flow__edge-desc",Jk="svelte-flow__aria-live";var Qk=Z("<div><!></div>");function $k(e,t){Oe(t,!0);let n=_e(t,"store",15),i=D(()=>Nn(t.node.data,()=>({}),!0)),s=D(()=>Nn(t.node.selected,!1)),o=D(()=>t.node.draggable),a=D(()=>t.node.selectable),l=D(()=>Nn(t.node.deletable,!0)),d=D(()=>t.node.connectable),c=D(()=>t.node.focusable),u=D(()=>Nn(t.node.hidden,!1)),p=D(()=>Nn(t.node.dragging,!1)),f=D(()=>Nn(t.node.style,"")),h=D(()=>t.node.class),g=D(()=>Nn(t.node.type,"default")),y=D(()=>t.node.parentId),b=D(()=>t.node.sourcePosition),m=D(()=>t.node.targetPosition),x=D(()=>Nn(t.node.measured,()=>({width:0,height:0}),!0).width),S=D(()=>Nn(t.node.measured,()=>({width:0,height:0}),!0).height),v=D(()=>t.node.initialWidth),A=D(()=>t.node.initialHeight),w=D(()=>t.node.width),k=D(()=>t.node.height),N=D(()=>t.node.dragHandle),L=D(()=>Nn(t.node.internals.z,0)),X=D(()=>t.node.internals.positionAbsolute.x),O=D(()=>t.node.internals.positionAbsolute.y),I=D(()=>t.node.internals.userNode),{id:H}=t.node,P=D(()=>r(o)??n().nodesDraggable),T=D(()=>r(a)??n().elementsSelectable),R=D(()=>r(d)??n().nodesConnectable),B=D(()=>g2(t.node)),V=D(()=>!!t.node.internals.handleBounds),F=D(()=>r(B)&&r(V)),Y=D(()=>r(c)??n().nodesFocusable);function J(ke){return n().parentLookup.has(ke)}let ie=D(()=>J(H)),ve=$(null),re=null,me=r(g),ge=r(b),Q=r(m),oe=D(()=>n().nodeTypes[r(g)]??Xg),ue=D(()=>n().ariaLabelConfig),le={get value(){return r(R)}};uk(H),pk(le);let te=D(()=>{const ke=r(x)===void 0?r(w)??r(v):r(w),Ne=r(S)===void 0?r(k)??r(A):r(k);if(!(ke===void 0&&Ne===void 0&&r(f)===void 0))return`${r(f)};${ke?`width:${Ci(ke)};`:""}${Ne?`height:${Ci(Ne)};`:""}`});ut(()=>{(r(g)!==me||r(b)!==ge||r(m)!==Q)&&r(ve)!==null&&requestAnimationFrame(()=>{r(ve)!==null&&n().updateNodeInternals(new Map([[H,{id:H,nodeElement:r(ve),force:!0}]]))}),me=r(g),ge=r(b),Q=r(m)}),ut(()=>{t.resizeObserver&&(!r(F)||r(ve)!==re)&&(re&&t.resizeObserver.unobserve(re),r(ve)&&t.resizeObserver.observe(r(ve)),re=r(ve))}),jt(()=>{re&&t.resizeObserver?.unobserve(re)});function be(ke){r(T)&&(!n().selectNodesOnDrag||!r(P)||n().nodeDragThreshold>0)&&n().handleNodeSelection(H),t.onnodeclick?.({node:r(I),event:ke})}function fe(ke){if(!(Mg(ke)||n().disableKeyboardA11y))if(Sg.includes(ke.key)&&r(T)){const Ne=ke.key==="Escape";n().handleNodeSelection(H,Ne,r(ve))}else r(P)&&t.node.selected&&Object.prototype.hasOwnProperty.call(yc,ke.key)&&(ke.preventDefault(),n(n().ariaLiveMessage=r(ue)["node.a11yDescription.ariaLiveMessage"]({direction:ke.key.replace("Arrow","").toLowerCase(),x:~~t.node.internals.positionAbsolute.x,y:~~t.node.internals.positionAbsolute.y}),!0),n().moveSelectedNodes(yc[ke.key],ke.shiftKey?4:1))}const Pe=()=>{if(n().disableKeyboardA11y||!n().autoPanOnNodeFocus||!r(ve)?.matches(":focus-visible"))return;const{width:ke,height:Ne,viewport:$e}=n();Gu(new Map([[H,t.node]]),{x:0,y:0,width:ke,height:Ne},[$e.x,$e.y,$e.zoom],!0).length>0||n().setCenter(t.node.position.x+(t.node.measured.width??0)/2,t.node.position.y+(t.node.measured.height??0)/2,{zoom:$e.zoom})};var Re=pe(),Se=ae(Re);{var Ce=ke=>{var Ne=Qk();Ns(Ne,()=>({"data-id":H,class:["svelte-flow__node",`svelte-flow__node-${r(g)}`,r(h)],style:r(te),onclick:be,onpointerenter:t.onnodepointerenter?Me=>t.onnodepointerenter({node:r(I),event:Me}):void 0,onpointerleave:t.onnodepointerleave?Me=>t.onnodepointerleave({node:r(I),event:Me}):void 0,onpointermove:t.onnodepointermove?Me=>t.onnodepointermove({node:r(I),event:Me}):void 0,oncontextmenu:t.onnodecontextmenu?Me=>t.onnodecontextmenu({node:r(I),event:Me}):void 0,onkeydown:r(Y)?fe:void 0,onfocus:r(Y)?Pe:void 0,tabIndex:r(Y)?0:void 0,role:t.node.ariaRole??(r(Y)?"group":void 0),"aria-roledescription":"node","aria-describedby":n().disableKeyboardA11y?void 0:`${Jg}-${n().flowId}`,...t.node.domAttributes,[Ss]:{dragging:r(p),selected:r(s),draggable:r(P),connectable:r(R),selectable:r(T),nopan:r(P),parent:r(ie)},[ji]:{"z-index":r(L),transform:`translate(${r(X)??""}px, ${r(O)??""}px)`,visibility:r(B)?"visible":"hidden"}}));var $e=M(Ne);Du($e,()=>r(oe),(Me,Ae)=>{Ae(Me,{get data(){return r(i)},get id(){return H},get selected(){return r(s)},get selectable(){return r(T)},get deletable(){return r(l)},get sourcePosition(){return r(b)},get targetPosition(){return r(m)},get zIndex(){return r(L)},get dragging(){return r(p)},get draggable(){return r(P)},get dragHandle(){return r(N)},get parentId(){return r(y)},get type(){return r(g)},get isConnectable(){return r(R)},get positionAbsoluteX(){return r(X)},get positionAbsoluteY(){return r(O)},get width(){return r(w)},get height(){return r(k)}})}),C(Ne),Ee(Ne,(Me,Ae)=>Zg?.(Me,Ae),()=>({nodeId:H,isSelectable:r(T),disabled:!r(P),handleSelector:r(N),noDragClass:n().noDragClass,nodeClickDistance:t.nodeClickDistance,onNodeMouseDown:n().handleNodeSelection,onDrag:(Me,Ae,xt,It)=>{t.onnodedrag?.({event:Me,targetNode:xt,nodes:It})},onDragStart:(Me,Ae,xt,It)=>{t.onnodedragstart?.({event:Me,targetNode:xt,nodes:It})},onDragStop:(Me,Ae,xt,It)=>{t.onnodedragstop?.({event:Me,targetNode:xt,nodes:It})},store:n()})),Jt(Ne,Me=>E(ve,Me),()=>r(ve)),_(ke,Ne)};j(Se,ke=>{r(u)||ke(Ce)})}_(e,Re),ze()}var eS=Z('<div class="svelte-flow__nodes"></div>');function tS(e,t){Oe(t,!0);let n=_e(t,"store",15);const i=typeof ResizeObserver>"u"?null:new ResizeObserver(o=>{const a=new Map;o.forEach(l=>{const d=l.target.getAttribute("data-id");a.set(d,{id:d,nodeElement:l.target,force:!0})}),n().updateNodeInternals(a)});jt(()=>{i?.disconnect()});var s=eS();it(s,21,()=>n().visible.nodes.values(),o=>o.id,(o,a)=>{$k(o,{get node(){return r(a)},get resizeObserver(){return i},get nodeClickDistance(){return t.nodeClickDistance},get onnodeclick(){return t.onnodeclick},get onnodepointerenter(){return t.onnodepointerenter},get onnodepointermove(){return t.onnodepointermove},get onnodepointerleave(){return t.onnodepointerleave},get onnodedrag(){return t.onnodedrag},get onnodedragstart(){return t.onnodedragstart},get onnodedragstop(){return t.onnodedragstop},get onnodecontextmenu(){return t.onnodecontextmenu},get store(){return n()},set store(l){n(l)}})}),C(s),_(e,s),ze()}var nS=ye('<svg class="svelte-flow__edge-wrapper"><g><!></g></svg>');function iS(e,t){Oe(t,!0);let n=D(()=>t.edge.id),i=D(()=>t.edge.source),s=D(()=>t.edge.target),o=D(()=>t.edge.sourceX),a=D(()=>t.edge.sourceY),l=D(()=>t.edge.targetX),d=D(()=>t.edge.targetY),c=D(()=>t.edge.sourcePosition),u=D(()=>t.edge.targetPosition),p=D(()=>Nn(t.edge.animated,!1)),f=D(()=>Nn(t.edge.selected,!1)),h=D(()=>t.edge.label),g=D(()=>t.edge.labelStyle),y=D(()=>Nn(t.edge.data,()=>({}),!0)),b=D(()=>t.edge.style),m=D(()=>t.edge.interactionWidth),x=D(()=>Nn(t.edge.type,"default")),S=D(()=>t.edge.sourceHandle),v=D(()=>t.edge.targetHandle),A=D(()=>t.edge.markerStart),w=D(()=>t.edge.markerEnd),k=D(()=>t.edge.selectable),N=D(()=>t.edge.focusable),L=D(()=>Nn(t.edge.deletable,!0)),X=D(()=>t.edge.hidden),O=D(()=>t.edge.zIndex),I=D(()=>t.edge.class),H=D(()=>t.edge.ariaLabel);gk(r(n));let P=null,T=D(()=>r(k)??t.store.elementsSelectable),R=D(()=>r(N)??t.store.edgesFocusable),B=D(()=>t.store.edgeTypes[r(x)]??Gg),V=D(()=>r(A)?`url('#${cu(r(A),t.store.flowId)}')`:void 0),F=D(()=>r(w)?`url('#${cu(r(w),t.store.flowId)}')`:void 0);function Y(ge){const Q=t.store.edgeLookup.get(r(n));Q&&(r(T)&&t.store.handleEdgeSelection(r(n)),t.onedgeclick?.({event:ge,edge:Q}))}function J(ge,Q){const oe=t.store.edgeLookup.get(r(n));oe&&Q({event:ge,edge:oe})}function ie(ge){if(!t.store.disableKeyboardA11y&&Sg.includes(ge.key)&&r(T)){const{unselectNodesAndEdges:Q,addSelectedEdges:oe}=t.store;ge.key==="Escape"?(P?.blur(),Q({edges:[t.edge]})):oe([r(n)])}}var ve=pe(),re=ae(ve);{var me=ge=>{var Q=nS();let oe;var ue=M(Q);Ns(ue,()=>({class:["svelte-flow__edge",r(I)],"data-id":r(n),onclick:Y,oncontextmenu:t.onedgecontextmenu?te=>{J(te,t.onedgecontextmenu)}:void 0,onpointerenter:t.onedgepointerenter?te=>{J(te,t.onedgepointerenter)}:void 0,onpointerleave:t.onedgepointerleave?te=>{J(te,t.onedgepointerleave)}:void 0,"aria-label":r(H)===null?void 0:r(H)?r(H):`Edge from ${r(i)} to ${r(s)}`,"aria-describedby":r(R)?`${Qg}-${t.store.flowId}`:void 0,role:t.edge.ariaRole??(r(R)?"group":"img"),"aria-roledescription":"edge",onkeydown:r(R)?ie:void 0,tabindex:r(R)?0:void 0,...t.edge.domAttributes,[Ss]:{animated:r(p),selected:r(f),selectable:r(T)}}));var le=M(ue);Du(le,()=>r(B),(te,be)=>{be(te,{get id(){return r(n)},get source(){return r(i)},get target(){return r(s)},get sourceX(){return r(o)},get sourceY(){return r(a)},get targetX(){return r(l)},get targetY(){return r(d)},get sourcePosition(){return r(c)},get targetPosition(){return r(u)},get animated(){return r(p)},get selected(){return r(f)},get label(){return r(h)},get labelStyle(){return r(g)},get data(){return r(y)},get style(){return r(b)},get interactionWidth(){return r(m)},get selectable(){return r(T)},get deletable(){return r(L)},get type(){return r(x)},get sourceHandleId(){return r(S)},get targetHandleId(){return r(v)},get markerStart(){return r(V)},get markerEnd(){return r(F)}})}),C(ue),Jt(ue,te=>P=te,()=>P),C(Q),G(()=>oe=wt(Q,"",oe,{"z-index":r(O)})),_(ge,Q)};j(re,ge=>{r(X)||ge(me)})}_(e,ve),ze()}var sS=ye("<defs></defs>");function oS(e,t){Oe(t,!1);const n=Ps();s1();var i=sS();it(i,5,()=>n.markers,s=>s.id,(s,o)=>{cS(s,sc(()=>r(o)))}),C(i),_(e,i),ze()}var aS=ye('<polyline class="arrow" fill="none" stroke-linecap="round" stroke-linejoin="round" points="-5,-4 0,0 -5,4"></polyline>'),rS=ye('<polyline class="arrowclosed" stroke-linecap="round" stroke-linejoin="round" points="-5,-4 0,0 -5,4 -5,-4"></polyline>'),lS=ye('<marker class="svelte-flow__arrowhead" viewBox="-10 -10 20 20" refX="0" refY="0"><!></marker>');function cS(e,t){Oe(t,!0);let n=_e(t,"width",3,12.5),i=_e(t,"height",3,12.5),s=_e(t,"markerUnits",3,"strokeWidth"),o=_e(t,"orient",3,"auto-start-reverse"),a=_e(t,"color",3,"none");var l=lS(),d=M(l);{var c=p=>{var f=aS();let h;G(()=>{z(f,"stroke-width",t.strokeWidth),h=wt(f,"",h,{stroke:a()})}),_(p,f)},u=p=>{var f=pe(),h=ae(f);{var g=y=>{var b=rS();let m;G(()=>{z(b,"stroke-width",t.strokeWidth),m=wt(b,"",m,{stroke:a(),fill:a()})}),_(y,b)};j(h,y=>{t.type===hc.ArrowClosed&&y(g)},!0)}_(p,f)};j(d,p=>{t.type===hc.Arrow?p(c):p(u,!1)})}C(l),G(()=>{z(l,"id",t.id),z(l,"markerWidth",`${n()}`),z(l,"markerHeight",`${i()}`),z(l,"markerUnits",s()),z(l,"orient",o())}),_(e,l),ze()}var dS=Z('<div class="svelte-flow__edges"><svg class="svelte-flow__marker"><!></svg> <!></div>');function uS(e,t){Oe(t,!0);let n=_e(t,"store",15);var i=dS(),s=M(i),o=M(s);oS(o,{}),C(s);var a=q(s,2);it(a,17,()=>n().visible.edges.values(),l=>l.id,(l,d)=>{iS(l,{get edge(){return r(d)},get onedgeclick(){return t.onedgeclick},get onedgecontextmenu(){return t.onedgecontextmenu},get onedgepointerenter(){return t.onedgepointerenter},get onedgepointerleave(){return t.onedgepointerleave},get store(){return n()},set store(c){n(c)}})}),C(i),_(e,i),ze()}var fS=Z('<div class="svelte-flow__selection svelte-1vr3gfi"></div>');function $g(e,t){Oe(t,!0);let n=_e(t,"x",3,0),i=_e(t,"y",3,0),s=_e(t,"width",3,0),o=_e(t,"height",3,0),a=_e(t,"isVisible",3,!0);var l=pe(),d=ae(l);{var c=u=>{var p=fS();let f;G(h=>f=wt(p,"",f,h),[()=>({width:typeof s()=="string"?s():Ci(s()),height:typeof o()=="string"?o():Ci(o()),transform:`translate(${n()}px, ${i()}px)`})]),_(u,p)};j(d,u=>{a()&&u(c)})}_(e,l),ze()}var pS=Z("<div><!></div>");function hS(e,t){Oe(t,!0);let n=$(void 0);ut(()=>{t.store.disableKeyboardA11y||r(n)?.focus({preventScroll:!0})});let i=D(()=>{if(t.store.selectionRectMode==="nodes"){t.store.nodes;const u=Hc(t.store.nodeLookup,{filter:p=>!!p.selected});if(u.width>0&&u.height>0)return u}return null});function s(u){const p=t.store.nodes.filter(f=>f.selected);t.onselectioncontextmenu?.({nodes:p,event:u})}function o(u){const p=t.store.nodes.filter(f=>f.selected);t.onselectionclick?.({nodes:p,event:u})}function a(u){Object.prototype.hasOwnProperty.call(yc,u.key)&&(u.preventDefault(),t.store.moveSelectedNodes(yc[u.key],u.shiftKey?4:1))}var l=pe(),d=ae(l);{var c=u=>{var p=pS();p.__contextmenu=s,p.__click=o,p.__keydown=function(...g){(t.store.disableKeyboardA11y?void 0:a)?.apply(this,g)};let f;var h=M(p);$g(h,{width:"100%",height:"100%",x:0,y:0}),C(p),Ee(p,(g,y)=>Zg?.(g,y),()=>({disabled:!1,store:t.store,onDrag:(g,y,b,m)=>{t.onnodedrag?.({event:g,targetNode:null,nodes:m})},onDragStart:(g,y,b,m)=>{t.onnodedragstart?.({event:g,targetNode:null,nodes:m})},onDragStop:(g,y,b,m)=>{t.onnodedragstop?.({event:g,targetNode:null,nodes:m})}})),Jt(p,g=>E(n,g),()=>r(n)),G(g=>{qe(p,1,Qs(["svelte-flow__selection-wrapper",t.store.noPanClass]),"svelte-sf2y5e"),z(p,"role",t.store.disableKeyboardA11y?void 0:"button"),z(p,"tabindex",t.store.disableKeyboardA11y?void 0:-1),f=wt(p,"",f,g)},[()=>({width:Ci(r(i).width),height:Ci(r(i).height),transform:`translate(${r(i).x??""}px, ${r(i).y??""}px)`})]),_(u,p)};j(d,u=>{t.store.selectionRectMode==="nodes"&&r(i)&&Ui(r(i).x)&&Ui(r(i).y)&&u(c)})}_(e,l),ze()}Mt(["contextmenu","click","keydown"]);function gS(e){switch(e){case"ctrl":return 8;case"shift":return 4;case"alt":return 2;case"meta":return 1}}function hi(e,t){let{enabled:n=!0,trigger:i,type:s="keydown"}=t;function o(l){const d=Array.isArray(i)?i:[i],c=[l.metaKey,l.altKey,l.shiftKey,l.ctrlKey].reduce((u,p,f)=>p?u|1<<f:u,0);for(const u of d){const p={preventDefault:!1,enabled:!0,...u},{modifier:f,key:h,callback:g,preventDefault:y,enabled:b}=p;if(b){if(l.key!==h)continue;if(f===null||f===!1){if(c!==0)continue}else if(f!==void 0&&f?.[0]?.length>0){const x=Array.isArray(f)?f:[f];let S=!1;for(const v of x)if((Array.isArray(v)?v:[v]).reduce((w,k)=>w|gS(k),0)===c){S=!0;break}if(!S)continue}y&&l.preventDefault();const m={node:e,trigger:p,originalEvent:l};e.dispatchEvent(new CustomEvent("shortcut",{detail:m})),g?.(m)}}}let a;return n&&(a=Yd(e,s,o)),{update:l=>{const{enabled:d=!0,type:c="keydown"}=l;n&&(!d||s!==c)?a?.():!n&&d&&(a=Yd(e,c,o)),n=d,s=c,i=l.trigger},destroy:()=>{a?.()}}}function em(){const e=D(Ps),t=o=>{const a=Tp(o)?o:r(e).nodeLookup.get(o.id),l=a.parentId?m2(a.position,a.measured,a.parentId,r(e).nodeLookup,r(e).nodeOrigin):a.position,d={...a,position:l,width:a.measured?.width??a.width,height:a.measured?.height??a.height};return Ya(d)};function n(o,a,l={replace:!1}){r(e).nodes=Qn(()=>r(e).nodes).map(d=>{if(d.id===o){const c=typeof a=="function"?a(d):a;return l?.replace&&Tp(c)?c:{...d,...c}}return d})}function i(o,a,l={replace:!1}){r(e).edges=Qn(()=>r(e).edges).map(d=>{if(d.id===o){const c=typeof a=="function"?a(d):a;return l.replace&&Ck(c)?c:{...d,...c}}return d})}const s=o=>r(e).nodeLookup.get(o);return{zoomIn:r(e).zoomIn,zoomOut:r(e).zoomOut,getInternalNode:s,getNode:o=>s(o)?.internals.userNode,getNodes:o=>o===void 0?r(e).nodes:Ap(r(e).nodeLookup,o),getEdge:o=>r(e).edgeLookup.get(o),getEdges:o=>o===void 0?r(e).edges:Ap(r(e).edgeLookup,o),setZoom:(o,a)=>{const l=r(e).panZoom;return l?l.scaleTo(o,{duration:a?.duration}):Promise.resolve(!1)},getZoom:()=>r(e).viewport.zoom,setViewport:async(o,a)=>{const l=r(e).viewport;return r(e).panZoom?(await r(e).panZoom.setViewport({x:o.x??l.x,y:o.y??l.y,zoom:o.zoom??l.zoom},a),Promise.resolve(!0)):Promise.resolve(!1)},getViewport:()=>qh(r(e).viewport),setCenter:async(o,a,l)=>r(e).setCenter(o,a,l),fitView:o=>r(e).fitView(o),fitBounds:async(o,a)=>{if(!r(e).panZoom)return Promise.resolve(!1);const l=Uu(o,r(e).width,r(e).height,r(e).minZoom,r(e).maxZoom,a?.padding??.1);return await r(e).panZoom.setViewport(l,{duration:a?.duration,ease:a?.ease,interpolate:a?.interpolate}),Promise.resolve(!0)},getIntersectingNodes:(o,a=!0,l)=>{const d=hp(o),c=d?o:t(o);return c?(l||r(e).nodes).filter(u=>{const p=r(e).nodeLookup.get(u.id);if(!p||!d&&u.id===o.id)return!1;const f=Ya(p),h=qr(f,c);return a&&h>0||h>=f.width*f.height||h>=c.width*c.height}):[]},isNodeIntersecting:(o,a,l=!0)=>{const c=hp(o)?o:t(o);if(!c)return!1;const u=qr(c,a);return l&&u>0||u>=a.width*a.height||u>=c.width*c.height},deleteElements:async({nodes:o=[],edges:a=[]})=>{const{nodes:l,edges:d}=await d2({nodesToRemove:o,edgesToRemove:a,nodes:r(e).nodes,edges:r(e).edges,onBeforeDelete:r(e).onbeforedelete});return l&&(r(e).nodes=Qn(()=>r(e).nodes).filter(c=>!l.some(({id:u})=>u===c.id))),d&&(r(e).edges=Qn(()=>r(e).edges).filter(c=>!d.some(({id:u})=>u===c.id))),(l.length>0||d.length>0)&&r(e).ondelete?.({nodes:l,edges:d}),{deletedNodes:l,deletedEdges:d}},screenToFlowPosition:(o,a={snapToGrid:!0})=>{if(!r(e).domNode)return o;const l=a.snapToGrid?r(e).snapGrid:!1,{x:d,y:c,zoom:u}=r(e).viewport,{x:p,y:f}=r(e).domNode.getBoundingClientRect(),h={x:o.x-p,y:o.y-f};return Qr(h,[d,c,u],l!==null,l||[1,1])},flowToScreenPosition:o=>{if(!r(e).domNode)return o;const{x:a,y:l,zoom:d}=r(e).viewport,{x:c,y:u}=r(e).domNode.getBoundingClientRect(),p=mc(o,[a,l,d]);return{x:p.x+c,y:p.y+u}},toObject:()=>structuredClone({nodes:[...r(e).nodes],edges:[...r(e).edges],viewport:{...r(e).viewport}}),updateNode:n,updateNodeData:(o,a,l)=>{const d=r(e).nodeLookup.get(o)?.internals.userNode;if(!d)return;const c=typeof a=="function"?a(d):a;n(o,u=>({...u,data:l?.replace?c:{...u.data,...c}}))},updateEdge:i,getNodesBounds:o=>a2(o,{nodeLookup:r(e).nodeLookup,nodeOrigin:r(e).nodeOrigin}),getHandleConnections:({type:o,id:a,nodeId:l})=>Array.from(r(e).connectionLookup.get(`${l}-${o}-${a??null}`)?.values()??[])}}function Ap(e,t){const n=[];for(const i of t){const s=e.get(i);if(s){const o="internals"in s?s.internals?.userNode:s;n.push(o)}}return n}function mS(e,t){Oe(t,!0);let n=_e(t,"store",15),i=_e(t,"selectionKey",3,"Shift"),s=_e(t,"multiSelectionKey",19,()=>vc()?"Meta":"Control"),o=_e(t,"deleteKey",3,"Backspace"),a=_e(t,"panActivationKey",3," "),l=_e(t,"zoomActivationKey",19,()=>vc()?"Meta":"Control"),{deleteElements:d}=em();function c(y){return y!==null&&typeof y=="object"}function u(y){return c(y)?y.modifier||[]:[]}function p(y){return y==null?"":c(y)?y.key:y}function f(y,b){return(Array.isArray(y)?y:[y]).map(x=>{const S=p(x);return{key:S,modifier:u(x),enabled:S!==null,callback:b}})}function h(){n(n().selectionRect=null,!0),n(n().selectionKeyPressed=!1,!0),n(n().multiselectionKeyPressed=!1,!0),n(n().deleteKeyPressed=!1,!0),n(n().panActivationKeyPressed=!1,!0),n(n().zoomActivationKeyPressed=!1,!0)}function g(){const y=n().nodes.filter(m=>m.selected),b=n().edges.filter(m=>m.selected);d({nodes:y,edges:b})}ht("blur",Ot,h),ht("contextmenu",Ot,h),Ee(Ot,(y,b)=>hi?.(y,b),()=>({trigger:f(i(),()=>n(n().selectionKeyPressed=!0,!0)),type:"keydown"})),Ee(Ot,(y,b)=>hi?.(y,b),()=>({trigger:f(i(),()=>n(n().selectionKeyPressed=!1,!0)),type:"keyup"})),Ee(Ot,(y,b)=>hi?.(y,b),()=>({trigger:f(s(),()=>{n(n().multiselectionKeyPressed=!0,!0)}),type:"keydown"})),Ee(Ot,(y,b)=>hi?.(y,b),()=>({trigger:f(s(),()=>n(n().multiselectionKeyPressed=!1,!0)),type:"keyup"})),Ee(Ot,(y,b)=>hi?.(y,b),()=>({trigger:f(o(),y=>{!(y.originalEvent.ctrlKey||y.originalEvent.metaKey||y.originalEvent.shiftKey)&&!Mg(y.originalEvent)&&(n(n().deleteKeyPressed=!0,!0),g())}),type:"keydown"})),Ee(Ot,(y,b)=>hi?.(y,b),()=>({trigger:f(o(),()=>n(n().deleteKeyPressed=!1,!0)),type:"keyup"})),Ee(Ot,(y,b)=>hi?.(y,b),()=>({trigger:f(a(),()=>n(n().panActivationKeyPressed=!0,!0)),type:"keydown"})),Ee(Ot,(y,b)=>hi?.(y,b),()=>({trigger:f(a(),()=>n(n().panActivationKeyPressed=!1,!0)),type:"keyup"})),Ee(Ot,(y,b)=>hi?.(y,b),()=>({trigger:f(l(),()=>n(n().zoomActivationKeyPressed=!0,!0)),type:"keydown"})),Ee(Ot,(y,b)=>hi?.(y,b),()=>({trigger:f(l(),()=>n(n().zoomActivationKeyPressed=!1,!0)),type:"keyup"})),ze()}var vS=ye('<path fill="none" class="svelte-flow__connection-path"></path>'),yS=ye('<svg class="svelte-flow__connectionline"><g><!></g></svg>');function bS(e,t){Oe(t,!0);let n=D(()=>{if(!t.store.connection.inProgress)return"";const a={sourceX:t.store.connection.from.x,sourceY:t.store.connection.from.y,sourcePosition:t.store.connection.fromPosition,targetX:t.store.connection.to.x,targetY:t.store.connection.to.y,targetPosition:t.store.connection.toPosition};switch(t.type){case Cs.Bezier:{const[l]=Dg(a);return l}case Cs.Straight:{const[l]=Og(a);return l}case Cs.Step:case Cs.SmoothStep:{const[l]=qc({...a,borderRadius:t.type===Cs.Step?0:void 0});return l}}});var i=pe(),s=ae(i);{var o=a=>{var l=yS(),d=M(l),c=M(d);{var u=f=>{var h=pe(),g=ae(h);Du(g,()=>t.LineComponent,(y,b)=>{b(y,{})}),_(f,h)},p=f=>{var h=vS();G(()=>{z(h,"d",r(n)),wt(h,t.style)}),_(f,h)};j(c,f=>{t.LineComponent?f(u):f(p,!1)})}C(d),C(l),G(f=>{z(l,"width",t.store.width),z(l,"height",t.store.height),wt(l,t.containerStyle),qe(d,0,f)},[()=>Qs(["svelte-flow__connection",s2(t.store.connection.isValid)])]),_(a,l)};j(s,a=>{t.store.connection.inProgress&&a(o)})}_(e,i),ze()}var wS=Z("<div><!></div>");function _S(e,t){Oe(t,!0);let n=_e(t,"position",3,"top-right"),i=Js(t,["$$slots","$$events","$$legacy","position","style","class","children"]),s=D(()=>`${n()}`.split("-"));var o=wS();Ns(o,l=>({class:l,style:t.style,...i}),[()=>["svelte-flow__panel",t.class,...r(s)]]);var a=M(o);Dn(a,()=>t.children??Zn),C(o),_(e,o),ze()}var xS=Z('<a href="https://svelteflow.dev" target="_blank" rel="noopener noreferrer" aria-label="Svelte Flow attribution">Svelte Flow</a>');function kS(e,t){Oe(t,!0);let n=_e(t,"position",3,"bottom-right");var i=pe(),s=ae(i);{var o=a=>{_S(a,{get position(){return n()},class:"svelte-flow__attribution","data-message":"Feel free to remove the attribution or check out how you could support us: https://svelteflow.dev/support-us",children:(l,d)=>{var c=xS();_(l,c)},$$slots:{default:!0}})};j(s,a=>{t.proOptions?.hideAttribution||a(o)})}_(e,i),ze()}var SS=Z("<div><!></div>");function CS(e,t){Oe(t,!0);let n=_e(t,"domNode",15),i=_e(t,"clientWidth",15),s=_e(t,"clientHeight",15),o=D(()=>t.rest.class),a=D(()=>X0(t.rest,["id","class","nodeTypes","edgeTypes","colorMode","isValidConnection","onmove","onmovestart","onmoveend","onflowerror","ondelete","onbeforedelete","onbeforeconnect","onconnect","onconnectstart","onconnectend","onbeforereconnect","onreconnect","onreconnectstart","onreconnectend","onclickconnectstart","onclickconnectend","oninit","onselectionchange","onselectiondragstart","onselectiondrag","onselectiondragstop","onselectionstart","onselectionend","clickConnect","fitView","fitViewOptions","nodeOrigin","nodeDragThreshold","connectionDragThreshold","minZoom","maxZoom","initialViewport","connectionRadius","connectionMode","selectionMode","selectNodesOnDrag","snapGrid","defaultMarkerColor","translateExtent","nodeExtent","onlyRenderVisibleElements","autoPanOnConnect","autoPanOnNodeDrag","colorModeSSR","defaultEdgeOptions","elevateNodesOnSelect","elevateEdgesOnSelect","nodesDraggable","autoPanOnNodeFocus","nodesConnectable","elementsSelectable","nodesFocusable","edgesFocusable","disableKeyboardA11y","noDragClass","noPanClass","noWheelClass","ariaLabelConfig","autoPanSpeed","panOnScrollSpeed","zIndexMode"]));function l(u){u.currentTarget.scrollTo({top:0,left:0,behavior:"auto"}),t.rest.onscroll&&t.rest.onscroll(u)}var d=SS();Ns(d,u=>({class:["svelte-flow","svelte-flow__container",r(o),t.colorMode],"data-testid":"svelte-flow__wrapper",role:"application",onscroll:l,...r(a),[ji]:u}),[()=>({width:Ci(t.width),height:Ci(t.height)})],void 0,void 0,"svelte-mkap6j");var c=M(d);Dn(c,()=>t.children??Zn),C(d),Jt(d,u=>n(u),()=>n()),Xf(d,"clientHeight",s),Xf(d,"clientWidth",i),_(e,d),ze()}var ES=Z('<div class="svelte-flow__viewport-back svelte-flow__container"></div> <!> <div class="svelte-flow__edge-labels svelte-flow__container"></div> <!> <!> <!> <div class="svelte-flow__viewport-front svelte-flow__container"></div>',1),TS=Z("<!> <!>",1),IS=Z("<!> <!> <!> <!> <!>",1);function NS(e,t){Oe(t,!0);let n=_e(t,"paneClickDistance",3,1),i=_e(t,"nodeClickDistance",3,1),s=_e(t,"panOnScrollMode",19,()=>qa.Free),o=_e(t,"preventScrolling",3,!0),a=_e(t,"zoomOnScroll",3,!0),l=_e(t,"zoomOnDoubleClick",3,!0),d=_e(t,"zoomOnPinch",3,!0),c=_e(t,"panOnScroll",3,!1),u=_e(t,"panOnScrollSpeed",3,.5),p=_e(t,"panOnDrag",3,!0),f=_e(t,"selectionOnDrag",3,!1),h=_e(t,"connectionLineType",19,()=>Cs.Bezier),g=_e(t,"nodes",31,()=>Et([])),y=_e(t,"edges",31,()=>Et([])),b=_e(t,"viewport",15,void 0),m=Js(t,["$$slots","$$events","$$legacy","width","height","proOptions","selectionKey","deleteKey","panActivationKey","multiSelectionKey","zoomActivationKey","paneClickDistance","nodeClickDistance","onmovestart","onmoveend","onmove","oninit","onnodeclick","onnodecontextmenu","onnodedrag","onnodedragstart","onnodedragstop","onnodepointerenter","onnodepointermove","onnodepointerleave","onselectionclick","onselectioncontextmenu","onselectionstart","onselectionend","onedgeclick","onedgecontextmenu","onedgepointerenter","onedgepointerleave","onpaneclick","onpanecontextmenu","panOnScrollMode","preventScrolling","zoomOnScroll","zoomOnDoubleClick","zoomOnPinch","panOnScroll","panOnScrollSpeed","panOnDrag","selectionOnDrag","connectionLineComponent","connectionLineStyle","connectionLineContainerStyle","connectionLineType","attributionPosition","children","nodes","edges","viewport"]),x=Bk({props:m,width:t.width,height:t.height,get nodes(){return g()},set nodes(v){g(v)},get edges(){return y()},set edges(v){y(v)},get viewport(){return b()},set viewport(v){b(v)}});const S=Au(du);S&&S.setStore&&S.setStore(x),Hh(du,{provider:!1,getStore(){return x}}),ut(()=>{const v={nodes:x.selectedNodes,edges:x.selectedEdges};Qn(()=>t.onselectionchange)?.(v);for(const A of x.selectionChangeHandlers.values())A(v)}),jt(()=>{x.reset()}),CS(e,{get colorMode(){return x.colorMode},get width(){return t.width},get height(){return t.height},get rest(){return m},get domNode(){return x.domNode},set domNode(v){x.domNode=v},get clientWidth(){return x.width},set clientWidth(v){x.width=v},get clientHeight(){return x.height},set clientHeight(v){x.height=v},children:(v,A)=>{var w=IS(),k=ae(w);mS(k,{get selectionKey(){return t.selectionKey},get deleteKey(){return t.deleteKey},get panActivationKey(){return t.panActivationKey},get multiSelectionKey(){return t.multiSelectionKey},get zoomActivationKey(){return t.zoomActivationKey},get store(){return x},set store(I){x=I}});var N=q(k,2);Wk(N,{get panOnScrollMode(){return s()},get preventScrolling(){return o()},get zoomOnScroll(){return a()},get zoomOnDoubleClick(){return l()},get zoomOnPinch(){return d()},get panOnScroll(){return c()},get panOnScrollSpeed(){return u()},get panOnDrag(){return p()},get paneClickDistance(){return n()},get selectionOnDrag(){return f()},get onmovestart(){return t.onmovestart},get onmove(){return t.onmove},get onmoveend(){return t.onmoveend},get oninit(){return t.oninit},get store(){return x},set store(I){x=I},children:(I,H)=>{jk(I,{get onpaneclick(){return t.onpaneclick},get onpanecontextmenu(){return t.onpanecontextmenu},get onselectionstart(){return t.onselectionstart},get onselectionend(){return t.onselectionend},get panOnDrag(){return p()},get paneClickDistance(){return n()},get selectionOnDrag(){return f()},get store(){return x},set store(P){x=P},children:(P,T)=>{var R=TS(),B=ae(R);Gk(B,{get store(){return x},set store(F){x=F},children:(F,Y)=>{var J=ES(),ie=q(ae(J),2);uS(ie,{get onedgeclick(){return t.onedgeclick},get onedgecontextmenu(){return t.onedgecontextmenu},get onedgepointerenter(){return t.onedgepointerenter},get onedgepointerleave(){return t.onedgepointerleave},get store(){return x},set store(ge){x=ge}});var ve=q(ie,4);bS(ve,{get type(){return h()},get LineComponent(){return t.connectionLineComponent},get containerStyle(){return t.connectionLineContainerStyle},get style(){return t.connectionLineStyle},get store(){return x},set store(ge){x=ge}});var re=q(ve,2);tS(re,{get nodeClickDistance(){return i()},get onnodeclick(){return t.onnodeclick},get onnodecontextmenu(){return t.onnodecontextmenu},get onnodepointerenter(){return t.onnodepointerenter},get onnodepointermove(){return t.onnodepointermove},get onnodepointerleave(){return t.onnodepointerleave},get onnodedrag(){return t.onnodedrag},get onnodedragstart(){return t.onnodedragstart},get onnodedragstop(){return t.onnodedragstop},get store(){return x},set store(ge){x=ge}});var me=q(re,2);hS(me,{get onselectionclick(){return t.onselectionclick},get onselectioncontextmenu(){return t.onselectioncontextmenu},get onnodedrag(){return t.onnodedrag},get onnodedragstart(){return t.onnodedragstart},get onnodedragstop(){return t.onnodedragstop},get store(){return x},set store(ge){x=ge}}),Kt(2),_(F,J)},$$slots:{default:!0}});var V=q(B,2);{let F=D(()=>!!(x.selectionRect&&x.selectionRectMode==="user")),Y=D(()=>x.selectionRect?.width),J=D(()=>x.selectionRect?.height),ie=D(()=>x.selectionRect?.x),ve=D(()=>x.selectionRect?.y);$g(V,{get isVisible(){return r(F)},get width(){return r(Y)},get height(){return r(J)},get x(){return r(ie)},get y(){return r(ve)}})}_(P,R)},$$slots:{default:!0}})},$$slots:{default:!0}});var L=q(N,2);kS(L,{get proOptions(){return t.proOptions},get position(){return t.attributionPosition}});var X=q(L,2);Zk(X,{get store(){return x}});var O=q(X,2);Dn(O,()=>t.children??Zn),_(v,w)},$$slots:{default:!0}}),ze()}var Zi;(function(e){e.Lines="lines",e.Dots="dots",e.Cross="cross"})(Zi||(Zi={}));var PS=ye("<circle></circle>");function MS(e,t){var n=PS();G(()=>{z(n,"cx",t.radius),z(n,"cy",t.radius),z(n,"r",t.radius),qe(n,0,Qs(["svelte-flow__background-pattern","dots",t.class]))}),_(e,n)}var AS=ye("<path></path>");function DS(e,t){Oe(t,!0);var n=AS();G(()=>{z(n,"stroke-width",t.lineWidth),z(n,"d",`M${t.dimensions[0]/2} 0 V${t.dimensions[1]} M0 ${t.dimensions[1]/2} H${t.dimensions[0]}`),qe(n,0,Qs(["svelte-flow__background-pattern",t.variant,t.class]))}),_(e,n),ze()}const RS={[Zi.Dots]:1,[Zi.Lines]:1,[Zi.Cross]:6};var OS=ye('<svg data-testid="svelte-flow__background"><pattern patternUnits="userSpaceOnUse"><!></pattern><rect x="0" y="0" width="100%" height="100%"></rect></svg>');function zS(e,t){Oe(t,!0);let n=_e(t,"variant",19,()=>Zi.Dots),i=_e(t,"gap",3,20),s=_e(t,"lineWidth",3,1),o=D(Ps),a=D(()=>n()===Zi.Dots),l=D(()=>n()===Zi.Cross),d=D(()=>Array.isArray(i())?i():[i(),i()]),c=D(()=>`background-pattern-${r(o).flowId}-${t.id??""}`),u=D(()=>[r(d)[0]*r(o).viewport.zoom||1,r(d)[1]*r(o).viewport.zoom||1]),p=D(()=>(t.size??RS[n()])*r(o).viewport.zoom),f=D(()=>r(l)?[r(p),r(p)]:r(u)),h=D(()=>r(a)?[r(p)/2,r(p)/2]:[r(f)[0]/2,r(f)[1]/2]);var g=OS();let y;var b=M(g),m=M(b);{var x=A=>{{let w=D(()=>r(p)/2);MS(A,{get radius(){return r(w)},get class(){return t.patternClass}})}},S=A=>{DS(A,{get dimensions(){return r(f)},get variant(){return n()},get lineWidth(){return s()},get class(){return t.patternClass}})};j(m,A=>{r(a)?A(x):A(S,!1)})}C(b);var v=q(b);C(g),G(()=>{qe(g,0,Qs(["svelte-flow__background","svelte-flow__container",t.class])),y=wt(g,"",y,{"--xy-background-color-props":t.bgColor,"--xy-background-pattern-color-props":t.patternColor}),z(b,"id",r(c)),z(b,"x",r(o).viewport.x%r(u)[0]),z(b,"y",r(o).viewport.y%r(u)[1]),z(b,"width",r(u)[0]),z(b,"height",r(u)[1]),z(b,"patternTransform",`translate(-${r(h)[0]},-${r(h)[1]})`),z(v,"fill",`url(#${r(c)})`)}),_(e,g),ze()}var LS=Z("<div><!></div>");function Dp(e,t){Oe(t,!0);let n=_e(t,"variant",19,()=>Vr.Handle),i=_e(t,"minWidth",3,10),s=_e(t,"minHeight",3,10),o=_e(t,"maxWidth",19,()=>Number.MAX_VALUE),a=_e(t,"maxHeight",19,()=>Number.MAX_VALUE),l=_e(t,"keepAspectRatio",3,!1),d=_e(t,"autoScale",3,!0),c=Js(t,["$$slots","$$events","$$legacy","nodeId","position","variant","color","minWidth","minHeight","maxWidth","maxHeight","keepAspectRatio","resizeDirection","autoScale","shouldResize","onResizeStart","onResize","onResizeEnd","class","children"]);const u=Ps(),p=ef();let f=D(()=>typeof t.nodeId=="string"?t.nodeId:p);if(!r(f))throw new Error("Either pass a nodeId or use within a Custom Node component");let h,g=$(null),y=D(()=>n()===Vr.Line),b=D(()=>{let v=r(y)?"right":"bottom-right";return t.position??v}),m=D(()=>r(b).split("-"));tr(()=>(h&&E(g,dk({domNode:h,nodeId:r(f),getStoreItems:()=>({nodeLookup:u.nodeLookup,transform:[u.viewport.x,u.viewport.y,u.viewport.zoom],snapGrid:u.snapGrid??void 0,snapToGrid:!!u.snapGrid,nodeOrigin:u.nodeOrigin,paneDomNode:u.domNode}),onChange:(v,A)=>{const w=new Map;w.set(r(f),v);for(const k of A)w.set(k.id,{x:k.position.x,y:k.position.y});u.nodes=u.nodes.map(k=>{const N=w.get(k.id),L=!t.resizeDirection||t.resizeDirection==="horizontal",X=!t.resizeDirection||t.resizeDirection==="vertical";return N?{...k,position:{x:L?N.x??k.position.x:k.position.x,y:X?N.y??k.position.y:k.position.y},width:L?N.width??k.width:k.width,height:X?N.height??k.height:k.height}:k})}}),!0),()=>{r(g)?.destroy()})),Fh(()=>{r(g)?.update({controlPosition:r(b),boundaries:{minWidth:i(),minHeight:s(),maxWidth:o(),maxHeight:a()},keepAspectRatio:!!l(),resizeDirection:t.resizeDirection,onResizeStart:t.onResizeStart,onResize:t.onResize,onResizeEnd:t.onResizeEnd,shouldResize:t.shouldResize})});var x=LS();Ns(x,(v,A)=>({class:v,...c,[ji]:A}),[()=>["svelte-flow__resize-control",u.noDragClass,...r(m),n(),t.class],()=>({"border-color":r(y)?t.color:void 0,"background-color":r(y)?void 0:t.color,scale:r(y)||!d()?void 0:Math.max(1/u.viewport.zoom,1)})]);var S=M(x);Dn(S,()=>t.children??Zn),C(x),Jt(x,v=>h=v,()=>h),_(e,x),ze()}var HS=Z("<!> <!>",1);function FS(e,t){Oe(t,!0);let n=_e(t,"isVisible",3,!0),i=_e(t,"autoScale",3,!0),s=Js(t,["$$slots","$$events","$$legacy","isVisible","nodeId","handleClass","handleStyle","lineClass","lineStyle","autoScale"]);var o=pe(),a=ae(o);{var l=d=>{var c=HS(),u=ae(c);it(u,16,()=>sk,f=>f,(f,h)=>{Dp(f,sc({get class(){return t.lineClass},get style(){return t.lineStyle},get nodeId(){return t.nodeId},get position(){return h},get autoScale(){return i()},get variant(){return Vr.Line}},()=>s))});var p=q(u,2);it(p,16,()=>ik,f=>f,(f,h)=>{Dp(f,sc({get class(){return t.handleClass},get style(){return t.handleStyle},get nodeId(){return t.nodeId},get position(){return h},get autoScale(){return i()}},()=>s))}),_(d,c)};j(a,d=>{n()&&d(l)})}_(e,o),ze()}function tm(){const e=D(Ps),t=D(()=>r(e).domNode),n=D(()=>r(e).updateNodeInternals),i=ef();return o=>{if(!o&&!i)throw new Error("When using outside of a node, you must provide an id.");const a=o?Array.isArray(o)?o:[o]:[i],l=new Map;a.forEach(d=>{const c=r(t)?.querySelector(`.svelte-flow__node[data-id="${d}"]`);c&&l.set(d,{id:d,nodeElement:c,force:!0})}),requestAnimationFrame(()=>r(n)(l))}}function nm(e){return e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement||!!e.target?.closest?.(".cm-editor")}const BS="1.0.0",qS={dt:{pathsim_name:"dt",type:"number",default:"0.01",description:"transient simulation timestep in time units, default see Â´SIM_TIMESTEPÂ´ in Â´_constants.pyÂ´"},dt_min:{pathsim_name:"dt_min",type:"number",default:"1e-16",description:"lower bound for transient simulation timestep, default see Â´SIM_TIMESTEP_MINÂ´ in Â´_constants.pyÂ´"},dt_max:{pathsim_name:"dt_max",type:"any",default:null,description:"upper bound for transient simulation timestep, default see Â´SIM_TIMESTEP_MAXÂ´ in Â´_constants.pyÂ´"},solver:{pathsim_name:"Solver",type:"string",default:'"SSPRK22"',description:"ODE solver class for numerical integration from Â´pathsim.solversÂ´, default is Â´pathsim.solvers.ssprk22.SSPRK22Â´ (2nd order expl. Runge Kutta)"},ftol:{pathsim_name:"tolerance_fpi",type:"number",default:"1e-10",description:"absolute tolerance for convergence of algebraic loops and internal optimizers of implicit ODE solvers, default see Â´SIM_TOLERANCE_FPIÂ´ in Â´_constants.pyÂ´"},iterations_max:{pathsim_name:"iterations_max",type:"integer",default:"200",description:"maximum allowed number of iterations for implicit ODE solver optimizers and algebraic loop solver, default see Â´SIM_ITERATIONS_MAXÂ´ in Â´_constants.pyÂ´"},log:{pathsim_name:"log",type:"boolean",default:"True",description:"flag to enable logging, default see Â´LOG_ENABLEÂ´ in Â´_constants.pyÂ´ (alternatively a path to a log file can be specified)"},rtol:{pathsim_name:"tolerance_lte_rel",type:"number",default:"0.0001",description:"Relative error tolerance for adaptive timestep control"},atol:{pathsim_name:"tolerance_lte_abs",type:"number",default:"1e-08",description:"Absolute error tolerance for adaptive timestep control"},duration:{pathsim_name:"duration",type:"number",default:"10.0",description:"Total simulation time"}},Rp={ghostTraces:{default:"0"},plotResults:{default:"true"}};function ws(e){return qS[e]?.default??""}const Wi={duration:ws("duration"),dt:ws("dt"),solver:ws("solver")||"SSPRK22",adaptive:!0,atol:ws("atol"),rtol:ws("rtol"),ftol:ws("ftol"),dt_min:ws("dt_min"),dt_max:ws("dt_max"),ghostTraces:parseInt(Rp.ghostTraces?.default),plotResults:Rp.plotResults?.default==="true"},In={duration:"",dt:"",solver:"SSPRK22",adaptive:!0,atol:"",rtol:"",ftol:"",dt_min:"",dt_max:"",ghostTraces:0,plotResults:!0},Ji="#0070C0",Wr={default:"#969696"},VS=[Ji,"#E57373","#FFB74D","#FFF176","#81C784","#4DB6AC","#4DD0E1","#64B5F6","#BA68C8","#F06292","#90A4AE","#FFFFFF"];function tf(e){const{name:t,category:n,description:i=`${t} block`,blockClass:s,inputs:o=["in 0"],outputs:a=["out 0"],minInputs:l=1,minOutputs:d=1,maxInputs:c=null,maxOutputs:u=null,syncPorts:p,shape:f,params:h={}}=e,g=Object.entries(h).map(([y,b])=>({name:y,type:b.type,default:b.default,description:b.description,min:b.min,max:b.max,options:b.options}));return{type:s,name:t,category:n,description:i,blockClass:s,shape:f,ports:{inputs:o.map(y=>({name:y,direction:"input",color:Wr.default})),outputs:a.map(y=>({name:y,direction:"output",color:Wr.default})),minInputs:l,minOutputs:d,maxInputs:c,maxOutputs:u,syncPorts:p},params:g}}const bc={Constant:{blockClass:"Constant",description:"Produces a constant output signal (SISO).",docstringHtml:`<p>Produces a constant output signal (SISO).</p>
<div class="math">
\\begin{equation*}
y(t) = const.
\\end{equation*}
</div>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>value <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>constant defining block output</dd>
</dl>
</div>
`,params:{value:{type:"integer",default:"1",description:"constant defining block output"}},inputs:[],outputs:["out"]},Source:{blockClass:"Source",description:"Source that produces an arbitrary time dependent output defined by `func` (callable).",docstringHtml:`<p>Source that produces an arbitrary time dependent output defined by <cite>func</cite> (callable).</p>
<div class="math">
\\begin{equation*}
y(t) = \\mathrm{func}(t)
\\end{equation*}
</div>
<div class="section" id="note">
<h3>Note</h3>
<p>This block is purely algebraic and its internal function (<cite>func</cite>) will
be called multiple times per timestep, each time when <cite>Simulation._update(t)</cite>
is called in the global simulation loop.</p>
</div>
<div class="section" id="example">
<h3>Example</h3>
<p>For example a ramp:</p>
<pre class="code python literal-block">
from pathsim.blocks import Source

src = Source(lambda t : t)
</pre>
<p>or a simple sinusoid with some frequency:</p>
<pre class="code python literal-block">
import numpy as np
from pathsim.blocks import Source

#some parameter
omega = 100

#the function that gets evaluated
def f(t):
    return np.sin(omega * t)

src = Source(f)
</pre>
<p>Because the <cite>Source</cite> block only has a single argument, it can be
used to decorate a function and make it a <cite>PathSim</cite> block. This might
be handy in some cases to keep definitions concise and localized
in the code:</p>
<pre class="code python literal-block">
import numpy as np
from pathsim.blocks import Source

#does the same as the definition above

&#64;Source
def src(t):
    omega = 100
    return np.sin(omega * t)

#'src' is now a PathSim block
</pre>
</div>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>func <span class="classifier-delimiter">:</span> <span class="classifier">callable</span></dt>
<dd>function defining time dependent block output</dd>
</dl>
</div>
`,params:{func:{type:"callable",default:null,description:"function defining time dependent block output"}},inputs:[],outputs:["out"]},SinusoidalSource:{blockClass:"SinusoidalSource",description:"Source block that generates a sinusoid wave",docstringHtml:`<p>Source block that generates a sinusoid wave</p>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>frequency <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>frequency of the sinusoid</dd>
<dt>amplitude <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>amplitude of the sinusoid</dd>
<dt>phase <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>phase of the sinusoid</dd>
</dl>
</div>
`,params:{frequency:{type:"integer",default:"1",description:"frequency of the sinusoid"},amplitude:{type:"integer",default:"1",description:"amplitude of the sinusoid"},phase:{type:"integer",default:"0",description:"phase of the sinusoid"}},inputs:[],outputs:["out"]},StepSource:{blockClass:"StepSource",description:"Discrete time unit step (or multi step) source block.",docstringHtml:`<p>Discrete time unit step (or multi step) source block.</p>
<p>Utilizes a scheduled event to set the block output
to the specified output levels at the defined event times.</p>
<p>The arguments can be vectorial and in that case, the output is set to the
amplitude that corresponds to the defined delay like a zero-order-hold stage.
This functionality enables adding external or time series measurement data
into the system.</p>
<div class="section" id="examples">
<h3>Examples</h3>
<p>This is how to use the source as a unit step source:</p>
<pre class="code python literal-block">
from pathsim.blocks import StepSource

#default, starts at 0, jumps to 1
stp = StepSource()
</pre>
<p>And this is how to configure it with multiple consecutive steps:</p>
<pre class="code python literal-block">
from pathsim.blocks import StepSource

#starts at 0, jumps to 1 at 1, jumps to -1 at 2 and jumps back to 0 at 3
stp = StepSource(amplitude=[1, -1, 0], tau=[1, 2, 3])
</pre>
<p>Similarly implementing measured time series data via zoh:</p>
<pre class="code python literal-block">
import numpy as np
from pathsim.blocks import StepSource

#some random time series arrays
times, data = np.linspace(0, 100, 1000), np.random.rand(1000)

#pass them to the block
stp = StepSource(amplitude=data, tau=times)
</pre>
</div>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>amplitude <span class="classifier-delimiter">:</span> <span class="classifier">float | list[float]</span></dt>
<dd>amplitude of the step signal, or amplitudes / output
levels of the multiple steps</dd>
<dt>tau <span class="classifier-delimiter">:</span> <span class="classifier">float | list[float]</span></dt>
<dd>delay of the step, or delays of the different steps</dd>
</dl>
</div>
<div class="section" id="attributes">
<h3>Attributes</h3>
<dl class="docutils">
<dt>Evt <span class="classifier-delimiter">:</span> <span class="classifier">ScheduleList</span></dt>
<dd>internal scheduled event directly accessible</dd>
<dt>events <span class="classifier-delimiter">:</span> <span class="classifier">list[ScheduleList]</span></dt>
<dd>list of interna events</dd>
</dl>
</div>
`,params:{amplitude:{type:"integer",default:"1",description:"amplitude of the step signal, or amplitudes / output levels of the multiple steps"},tau:{type:"number",default:"0.0",description:"delay of the step, or delays of the different steps"}},inputs:[],outputs:["out"]},PulseSource:{blockClass:"PulseSource",description:"Generates a periodic pulse waveform with defined rise and fall times.",docstringHtml:`<p>Generates a periodic pulse waveform with defined rise and fall times.</p>
<p>Scheduled events trigger phase changes (low, rising, high, falling),
and the <cite>update</cite> method calculates the output value based on the
current phase, performing linear interpolation during rise and fall.</p>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>amplitude <span class="classifier-delimiter">:</span> <span class="classifier">float, optional</span></dt>
<dd>Peak amplitude of the pulse. Default is 1.0.</dd>
<dt>T <span class="classifier-delimiter">:</span> <span class="classifier">float, optional</span></dt>
<dd>Period of the pulse train. Must be positive. Default is 1.0.</dd>
<dt>t_rise <span class="classifier-delimiter">:</span> <span class="classifier">float, optional</span></dt>
<dd>Duration of the rising edge. Default is 0.0.</dd>
<dt>t_fall <span class="classifier-delimiter">:</span> <span class="classifier">float, optional</span></dt>
<dd>Duration of the falling edge. Default is 0.0.</dd>
<dt>tau <span class="classifier-delimiter">:</span> <span class="classifier">float, optional</span></dt>
<dd>Initial delay before the first pulse cycle begins. Default is 0.0.</dd>
<dt>duty <span class="classifier-delimiter">:</span> <span class="classifier">float, optional</span></dt>
<dd>Duty cycle, ratio of the pulse ON duration (plateau time only)
to the total period T (must be between 0 and 1). Default is 0.5.
The high plateau duration is <cite>T * duty</cite>.</dd>
</dl>
</div>
<div class="section" id="attributes">
<h3>Attributes</h3>
<dl class="docutils">
<dt>events <span class="classifier-delimiter">:</span> <span class="classifier">list[Schedule]</span></dt>
<dd>Internal scheduled events triggering phase transitions.</dd>
<dt>_phase <span class="classifier-delimiter">:</span> <span class="classifier">str</span></dt>
<dd>Current phase of the pulse ('low', 'rising', 'high', 'falling').</dd>
<dt>_phase_start_time <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>Simulation time when the current phase began.</dd>
</dl>
</div>
`,params:{amplitude:{type:"number",default:"1.0",description:"Peak amplitude of the pulse. Default is 1.0."},T:{type:"number",default:"1.0",description:"Period of the pulse train. Must be positive. Default is 1.0."},t_rise:{type:"number",default:"0.0",description:"Duration of the rising edge. Default is 0.0."},t_fall:{type:"number",default:"0.0",description:"Duration of the falling edge. Default is 0.0."},tau:{type:"number",default:"0.0",description:"Initial delay before the first pulse cycle begins. Default is 0.0."},duty:{type:"number",default:"0.5",description:"Duty cycle, ratio of the pulse ON duration (plateau time only) to the total period T (must be between 0 and 1). Default is 0.5. The high plateau duration is `T * duty`."}},inputs:[],outputs:["out"]},TriangleWaveSource:{blockClass:"TriangleWaveSource",description:"Source block that generates an analog triangle wave",docstringHtml:`<p>Source block that generates an analog triangle wave</p>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>frequency <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>frequency of the triangle wave</dd>
<dt>amplitude <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>amplitude of the triangle wave</dd>
<dt>phase <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>phase of the triangle wave</dd>
</dl>
</div>
`,params:{frequency:{type:"integer",default:"1",description:"frequency of the triangle wave"},amplitude:{type:"integer",default:"1",description:"amplitude of the triangle wave"},phase:{type:"integer",default:"0",description:"phase of the triangle wave"}},inputs:[],outputs:["out"]},SquareWaveSource:{blockClass:"SquareWaveSource",description:"Discrete time square wave source.",docstringHtml:`<p>Discrete time square wave source.</p>
<p>Utilizes scheduled events to periodically set
the block output at discrete times.</p>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>amplitude <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>amplitude of the square wave signal</dd>
<dt>frequency <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>frequency of the square wave signal</dd>
<dt>phase <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>phase of the square wave signal</dd>
</dl>
</div>
<div class="section" id="attributes">
<h3>Attributes</h3>
<dl class="docutils">
<dt>events <span class="classifier-delimiter">:</span> <span class="classifier">list[Schedule]</span></dt>
<dd>internal scheduled events</dd>
</dl>
</div>
`,params:{amplitude:{type:"integer",default:"1",description:"amplitude of the square wave signal"},frequency:{type:"integer",default:"1",description:"frequency of the square wave signal"},phase:{type:"integer",default:"0",description:"phase of the square wave signal"}},inputs:[],outputs:["out"]},GaussianPulseSource:{blockClass:"GaussianPulseSource",description:"Source block that generates a gaussian pulse",docstringHtml:`<p>Source block that generates a gaussian pulse</p>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>amplitude <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>amplitude of the gaussian pulse</dd>
<dt>f_max <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>maximum frequency component of the gaussian pulse (steepness)</dd>
<dt>tau <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>time delay of the gaussian pulse</dd>
</dl>
</div>
`,params:{amplitude:{type:"integer",default:"1",description:"amplitude of the gaussian pulse"},f_max:{type:"number",default:"1000.0",description:"maximum frequency component of the gaussian pulse (steepness)"},tau:{type:"number",default:"0.0",description:"time delay of the gaussian pulse"}},inputs:[],outputs:["out"]},ChirpPhaseNoiseSource:{blockClass:"ChirpPhaseNoiseSource",description:"Chirp source, sinusoid with frequency ramp up and ramp down, plus phase noise.",docstringHtml:`<p>Chirp source, sinusoid with frequency ramp up and ramp down, plus phase noise.</p>
<p>This works by using a time dependent triangle wave for the frequency
and integrating it with a numerical integration engine to get a
continuous phase. This phase is then used to evaluate a sinusoid.</p>
<p>Additionally the chirp source can have white and cumulative phase noise.
Mathematically it looks like this for the contributions to the phase from
the triangular wave:</p>
<div class="math">
\\begin{equation*}
\\varphi_t(t) = \\int_0^t \\mathrm{tri}_{f_0, B, T}(\\tau) \\, d\\tau
\\end{equation*}
</div>
<p>And from the white (w) and cumulative (c) noise:</p>
<div class="math">
\\begin{equation*}
\\varphi_n(t) = \\sigma_w \\, n_w(t) + \\sigma_c \\int_0^t n_c(\\tau) \\, d\\tau
\\end{equation*}
</div>
<p>The phase contributions are then used to evaluate a sinusoid to get the final chirp signal:</p>
<div class="math">
\\begin{equation*}
y(t) = A \\sin(\\varphi_t(t) + \\varphi_n(t) + \\varphi_0)
\\end{equation*}
</div>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>amplitude <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>amplitude of the chirp signal</dd>
<dt>f0 <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>start frequency of the chirp signal</dd>
<dt>BW <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>bandwidth of the frequency ramp of the chirp signal</dd>
<dt>T <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>period of the frequency ramp of the chirp signal</dd>
<dt>phase <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>phase of sinusoid (initial, radians)</dd>
<dt>sig_cum <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>weight for cumulative phase noise contribution</dd>
<dt>sig_white <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>weight for white phase noise contribution</dd>
<dt>sampling_period <span class="classifier-delimiter">:</span> <span class="classifier">float, None</span></dt>
<dd>time between phase noise samples. If None,
noise is sampled every timestep (default is 0.1)</dd>
</dl>
</div>
<div class="section" id="attributes">
<h3>Attributes</h3>
<dl class="docutils">
<dt>noise_1 <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>internal noise value for white phase noise</dd>
<dt>noise_2 <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>internal noise value for cumulative phase noise</dd>
<dt>events <span class="classifier-delimiter">:</span> <span class="classifier">list[Schedule]</span></dt>
<dd>scheduled event for periodic sampling (only if sampling_period is set)</dd>
</dl>
</div>
`,params:{amplitude:{type:"integer",default:"1",description:"amplitude of the chirp signal"},f0:{type:"integer",default:"1",description:"start frequency of the chirp signal"},BW:{type:"integer",default:"1",description:"bandwidth of the frequency ramp of the chirp signal"},T:{type:"integer",default:"1",description:"period of the frequency ramp of the chirp signal"},phase:{type:"integer",default:"0",description:"phase of sinusoid (initial, radians)"},sig_cum:{type:"integer",default:"0",description:"weight for cumulative phase noise contribution"},sig_white:{type:"integer",default:"0",description:"weight for white phase noise contribution"},sampling_period:{type:"number",default:"0.1",description:"time between phase noise samples. If None, noise is sampled every timestep (default is 0.1)"}},inputs:[],outputs:["out"]},ClockSource:{blockClass:"ClockSource",description:"Discrete time clock source block.",docstringHtml:`<p>Discrete time clock source block.</p>
<p>Utilizes scheduled events to periodically set
the block output to 0 or 1 at discrete times.</p>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>T <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>period of the clock</dd>
<dt>tau <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>clock delay</dd>
</dl>
</div>
<div class="section" id="attributes">
<h3>Attributes</h3>
<dl class="docutils">
<dt>events <span class="classifier-delimiter">:</span> <span class="classifier">list[Schedule]</span></dt>
<dd>internal scheduled event list</dd>
</dl>
</div>
`,params:{T:{type:"integer",default:"1",description:"period of the clock"},tau:{type:"integer",default:"0",description:"clock delay"}},inputs:[],outputs:["out"]},WhiteNoise:{blockClass:"WhiteNoise",description:"White noise source with Gaussian distribution.",docstringHtml:`<p>White noise source with Gaussian distribution.</p>
<p>Generates uncorrelated random samples with either constant amplitude
(<tt class="docutils literal">standard_deviation</tt> mode) or timestep-scaled amplitude for stochastic
integration (<tt class="docutils literal">spectral_density</tt> mode).</p>
<p>In spectral density mode, output is scaled as â(Sâ/dt) so that integrating
the noise yields correct statistical properties (Wiener process).</p>
<div class="section" id="note">
<h3>Note</h3>
<p>If <tt class="docutils literal">spectral_density</tt> is provided, it takes precedence over <tt class="docutils literal">standard_deviation</tt>.
If <tt class="docutils literal">sampling_period</tt> is set, noise is sampled at fixed intervals (zero-order hold).</p>
</div>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>standard_deviation <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>output standard deviation for constant-amplitude mode (default: 1.0)</dd>
<dt>spectral_density <span class="classifier-delimiter">:</span> <span class="classifier">float, optional</span></dt>
<dd>power spectral density Sâ in [signalÂ²/Hz]</dd>
<dt>sampling_period <span class="classifier-delimiter">:</span> <span class="classifier">float, optional</span></dt>
<dd>time between samples, if None samples every timestep</dd>
<dt>seed <span class="classifier-delimiter">:</span> <span class="classifier">int, optional</span></dt>
<dd>random seed for reproducibility</dd>
</dl>
</div>
`,params:{standard_deviation:{type:"number",default:"1.0",description:"output standard deviation for constant-amplitude mode (default: 1.0)"},spectral_density:{type:"any",default:null,description:"power spectral density Sâ in [signalÂ²/Hz]"},sampling_period:{type:"any",default:null,description:"time between samples, if None samples every timestep"},seed:{type:"any",default:null,description:"random seed for reproducibility"}},inputs:[],outputs:["out"]},PinkNoise:{blockClass:"PinkNoise",description:"Pink noise (1/f noise) source using the Voss-McCartney algorithm.",docstringHtml:`<p>Pink noise (1/f noise) source using the Voss-McCartney algorithm.</p>
<p>Generates noise with power spectral density proportional to 1/f, where
lower frequencies have more power than higher frequencies.</p>
<p>The algorithm maintains <tt class="docutils literal">num_octaves</tt> independent random values representing
different frequency bands. At each sample, one octave is updated based on the
binary representation of the sample counter, creating the characteristic 1/f
spectrum through the superposition of different update rates.</p>
<div class="section" id="note">
<h3>Note</h3>
<p>If <tt class="docutils literal">spectral_density</tt> is provided, it takes precedence over <tt class="docutils literal">standard_deviation</tt>.
If <tt class="docutils literal">sampling_period</tt> is set, noise is sampled at fixed intervals (zero-order hold).</p>
</div>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>standard_deviation <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>approximate output standard deviation (default: 1.0)</dd>
<dt>spectral_density <span class="classifier-delimiter">:</span> <span class="classifier">float, optional</span></dt>
<dd>power spectral density, output scaled as â(Sâ/(NÂ·dt))</dd>
<dt>num_octaves <span class="classifier-delimiter">:</span> <span class="classifier">int</span></dt>
<dd>number of frequency bands in algorithm (default: 16)</dd>
<dt>sampling_period <span class="classifier-delimiter">:</span> <span class="classifier">float, optional</span></dt>
<dd>time between samples, if None samples every timestep</dd>
<dt>seed <span class="classifier-delimiter">:</span> <span class="classifier">int, optional</span></dt>
<dd>random seed for reproducibility</dd>
</dl>
</div>
`,params:{standard_deviation:{type:"number",default:"1.0",description:"approximate output standard deviation (default: 1.0)"},spectral_density:{type:"any",default:null,description:"power spectral density, output scaled as â(Sâ/(NÂ·dt))"},num_octaves:{type:"integer",default:"16",description:"number of frequency bands in algorithm (default: 16)"},sampling_period:{type:"any",default:null,description:"time between samples, if None samples every timestep"},seed:{type:"any",default:null,description:"random seed for reproducibility"}},inputs:[],outputs:["out"]},RandomNumberGenerator:{blockClass:"RandomNumberGenerator",description:"Generates a random output value using `numpy.random.rand`.",docstringHtml:`<p>Generates a random output value using <cite>numpy.random.rand</cite>.</p>
<p>If no <cite>sampling_period</cite> (None) is specified, every simulation timestep gets
a random value. Otherwise an internal <cite>Schedule</cite> event is used to periodically
sample a random value and set the output like a zero-order-hold stage.</p>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>sampling_period <span class="classifier-delimiter">:</span> <span class="classifier">float, None</span></dt>
<dd>time between random samples</dd>
</dl>
</div>
<div class="section" id="attributes">
<h3>Attributes</h3>
<dl class="docutils">
<dt>_sample <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>internal random number state in case that
no <cite>sampling_period</cite> is provided</dd>
<dt>Evt <span class="classifier-delimiter">:</span> <span class="classifier">Schedule</span></dt>
<dd>internal event that periodically samples a random
value in case <cite>sampling_period</cite> is provided</dd>
</dl>
</div>
`,params:{sampling_period:{type:"any",default:null,description:"time between random samples"}},inputs:[],outputs:["out"]},Integrator:{blockClass:"Integrator",description:"Integrates the input signal.",docstringHtml:`<p>Integrates the input signal.</p>
<p>Uses a numerical integration engine like this:</p>
<div class="math">
\\begin{equation*}
y(t) = \\int_0^t u(\\tau) \\ d \\tau
\\end{equation*}
</div>
<p>or in differential form like this:</p>
<div class="math">
\\begin{equation*}
\\begin{align}
    \\dot{x}(t) &amp;= u(t) \\\\
           y(t) &amp;= x(t)
\\end{align}
\\end{equation*}
</div>
<p>The Integrator block is inherently MIMO capable, so <cite>u</cite>
and <cite>y</cite> can be vectors.</p>
<div class="section" id="example">
<h3>Example</h3>
<p>This is how to initialize the integrator:</p>
<pre class="code python literal-block">
#initial value 0.0
i1 = Integrator()

#initial value 2.5
i2 = Integrator(2.5)
</pre>
</div>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>initial_value <span class="classifier-delimiter">:</span> <span class="classifier">float, array</span></dt>
<dd>initial value of integrator</dd>
</dl>
</div>
`,params:{initial_value:{type:"number",default:"0.0",description:"initial value of integrator"}},inputs:null,outputs:null},Differentiator:{blockClass:"Differentiator",description:"Differentiates the input signal.",docstringHtml:`<p>Differentiates the input signal.</p>
<p>Uses a first order transfer function with a pole at the origin which implements
a high pass filter. Supports vector input.</p>
<div class="math">
\\begin{equation*}
H_\\mathrm{diff}(s) = \\frac{s}{1 + s / f_\\mathrm{max}}
\\end{equation*}
</div>
<p>The approximation holds for signals up to a frequency of approximately f_max.</p>
<div class="section" id="note">
<h3>Note</h3>
<p>Depending on <cite>f_max</cite>, the resulting system might become stiff or ill conditioned!
As a practical choice set <cite>f_max</cite> to 3x the highest expected signal frequency.</p>
</div>
<div class="section" id="note-1">
<h3>Note</h3>
<p>Since this is an approximation of real differentiation, the approximation will not hold
if there are high frequency components present in the signal. For example if you have
discontinuities such as steps or squere waves.</p>
</div>
<div class="section" id="example">
<h3>Example</h3>
<p>The block is initialized like this:</p>
<pre class="code python literal-block">
#cutoff at 1kHz
D = Differentiator(f_max=1e3)
</pre>
</div>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>f_max <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>highest expected signal frequency</dd>
</dl>
</div>
<div class="section" id="attributes">
<h3>Attributes</h3>
<dl class="docutils">
<dt>op_dyn <span class="classifier-delimiter">:</span> <span class="classifier">DynamicOperator</span></dt>
<dd>internal dynamic operator for ODE component</dd>
<dt>op_alg <span class="classifier-delimiter">:</span> <span class="classifier">DynamicOperator</span></dt>
<dd>internal algebraic operator</dd>
</dl>
</div>
`,params:{f_max:{type:"number",default:"100.0",description:"highest expected signal frequency"}},inputs:null,outputs:null},Delay:{blockClass:"Delay",description:"Delays the input signal by a time constant 'tau' in seconds.",docstringHtml:`<p>Delays the input signal by a time constant 'tau' in seconds.</p>
<p>Mathematically this block creates a time delay of the input signal like this:</p>
<div class="math">
\\begin{equation*}
y(t) =
\\begin{cases}
x(t - \\tau) &amp; , t \\geq \\tau \\\\
0            &amp; , t &lt; \\tau
\\end{cases}
\\end{equation*}
</div>
<div class="section" id="note">
<h3>Note</h3>
<p>The internal adaptive buffer uses interpolation for the evaluation. This is
required to be compatible with variable step solvers. It has a drawback however.
The order of the ode solver used will degrade when this block is used, due to
the interpolation.</p>
</div>
<div class="section" id="note-1">
<h3>Note</h3>
<p>This block supports vector input, meaning we can have multiple parallel
delay paths through this block.</p>
</div>
<div class="section" id="example">
<h3>Example</h3>
<p>The block is initialized like this:</p>
<pre class="code python literal-block">
#5 time units delay
D = Delay(tau=5)
</pre>
</div>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>tau <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>delay time constant</dd>
</dl>
</div>
<div class="section" id="attributes">
<h3>Attributes</h3>
<dl class="docutils">
<dt>_buffer <span class="classifier-delimiter">:</span> <span class="classifier">AdaptiveBuffer</span></dt>
<dd>internal interpolatable adaptive rolling buffer</dd>
</dl>
</div>
`,params:{tau:{type:"number",default:"0.001",description:"delay time constant"}},inputs:null,outputs:null},ODE:{blockClass:"ODE",description:"Ordinary differential equation (ODE) defined by its right hand side function.",docstringHtml:`<p>Ordinary differential equation (ODE) defined by its right hand side function.</p>
<div class="math">
\\begin{equation*}
\\begin{align}
    \\dot{x}(t) &amp;= \\mathrm{func}(x(t), u(t), t) \\\\
           y(t) &amp;= x(t)
\\end{align}
\\end{equation*}
</div>
<p>with inhomogenity (input) <cite>u</cite> and state vector <cite>x</cite>. The function can be nonlinear
and the ODE can be of arbitrary order. The block utilizes the integration engine
to solve the ODE by integrating the <cite>func</cite>, which is the right hand side function.</p>
<div class="section" id="example">
<h3>Example</h3>
<p>For example a linear 1st order ODE:</p>
<pre class="code python literal-block">
ode = ODE(lambda x, u, t: -x)
</pre>
<p>Or something more complex like the <cite>Van der Pol</cite> system, where it makes sense to
also specify the jacobian, which improves convergence for implicit solvers but is
not needed in most cases:</p>
<pre class="code python literal-block">
import numpy as np

#initial condition
x0 = np.array([2, 0])

#van der Pol parameter
mu = 1000

def func(x, u, t):
    return np.array([x[1], mu*(1 - x[0]**2)*x[1] - x[0]])

#analytical jacobian (optional)
def jac(x, u, t):
    return np.array(
        [[0                , 1               ],
         [-mu*2*x[0]*x[1]-1, mu*(1 - x[0]**2)]]
         )

#finally the block
vdp = ODE(func, x0, jac)
</pre>
</div>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>func <span class="classifier-delimiter">:</span> <span class="classifier">callable</span></dt>
<dd>right hand side function of ODE</dd>
<dt>initial_value <span class="classifier-delimiter">:</span> <span class="classifier">array[float]</span></dt>
<dd>initial state / initial condition</dd>
<dt>jac <span class="classifier-delimiter">:</span> <span class="classifier">callable, None</span></dt>
<dd>jacobian of 'func' or 'None'</dd>
</dl>
</div>
<div class="section" id="attributes">
<h3>Attributes</h3>
<dl class="docutils">
<dt>op_dyn <span class="classifier-delimiter">:</span> <span class="classifier">DynamicOperator</span></dt>
<dd>internal dynamic operator for ODE right hand side 'func'</dd>
</dl>
</div>
`,params:{func:{type:"callable",default:null,description:"right hand side function of ODE"},initial_value:{type:"number",default:"0.0",description:"initial state / initial condition"},jac:{type:"any",default:null,description:"jacobian of 'func' or 'None'"}},inputs:null,outputs:null},DynamicalSystem:{blockClass:"DynamicalSystem",description:"This block implements a nonlinear dynamical system / nonlinear state space model.",docstringHtml:`<p>This block implements a nonlinear dynamical system / nonlinear state space model.</p>
<p>Its basically the same as the <cite>ODE</cite> block with the addition of an output equation
that takes the state, input and time as arguments:</p>
<div class="math">
\\begin{equation*}
\\begin{align}
    \\dot{x}(t) &amp;= \\mathrm{func}_\\mathrm{dyn}(x(t), u(t), t) \\\\
           y(t) &amp;= \\mathrm{func}_\\mathrm{alg}(x(t), u(t), t)
\\end{align}
\\end{equation*}
</div>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>func_dyn <span class="classifier-delimiter">:</span> <span class="classifier">callable</span></dt>
<dd>right hand side function of ode-part of the system</dd>
<dt>func_alg <span class="classifier-delimiter">:</span> <span class="classifier">callable</span></dt>
<dd>output function of the system</dd>
<dt>initial_value <span class="classifier-delimiter">:</span> <span class="classifier">array[float]</span></dt>
<dd>initial state / initial condition</dd>
<dt>jac_dyn <span class="classifier-delimiter">:</span> <span class="classifier">callable | None</span></dt>
<dd>optional jacobian of <cite>func_dyn</cite> to improve convergence
for implicit ode solvers</dd>
</dl>
</div>
<div class="section" id="attributes">
<h3>Attributes</h3>
<dl class="docutils">
<dt>op_dyn <span class="classifier-delimiter">:</span> <span class="classifier">DynamicOperator</span></dt>
<dd>internal dynamic operator for <cite>func_dyn</cite></dd>
<dt>op_alg <span class="classifier-delimiter">:</span> <span class="classifier">DynamicOperator</span></dt>
<dd>internal dynamic operator for <cite>func_alg</cite></dd>
</dl>
</div>
`,params:{func_dyn:{type:"callable",default:null,description:"right hand side function of ode-part of the system"},func_alg:{type:"callable",default:null,description:"output function of the system"},initial_value:{type:"number",default:"0.0",description:"initial state / initial condition"},jac_dyn:{type:"any",default:null,description:"optional jacobian of `func_dyn` to improve convergence for implicit ode solvers"}},inputs:null,outputs:null},StateSpace:{blockClass:"StateSpace",description:"Linear time invariant (LTI) multi input multi output (MIMO) state space model.",docstringHtml:`<p>Linear time invariant (LTI) multi input multi output (MIMO) state space model.</p>
<div class="math">
\\begin{equation*}
\\begin{align}
    \\dot{x} &amp;= \\mathbf{A} x + \\mathbf{B} u \\\\
           y &amp;= \\mathbf{C} x + \\mathbf{D} u
\\end{align}
\\end{equation*}
</div>
<p>where <cite>A</cite>, <cite>B</cite>, <cite>C</cite> and <cite>D</cite> are the state space matrices, <cite>x</cite> is the state,
<cite>u</cite> the input and <cite>y</cite> the output vector.</p>
<div class="section" id="example">
<h3>Example</h3>
<p>A SISO state space block with two internal states can be initialized
like this:</p>
<pre class="code python literal-block">
S = StateSpace(
    A=-np.eye(2),
    B=np.ones((2, 1)),
    C=np.ones((1, 2)),
    D=1.0
    )
</pre>
<p>and a MIMO (2 in, 2 out) state space block with three internal states
can be initialized like this:</p>
<pre class="code python literal-block">
S = StateSpace(
    A=-np.eye(3),
    B=np.ones((3, 2)),
    C=np.ones((2, 3)),
    D=np.ones((2, 2))
    )
</pre>
</div>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>A, B, C, D <span class="classifier-delimiter">:</span> <span class="classifier">array_like</span></dt>
<dd>real valued state space matrices</dd>
<dt>initial_value <span class="classifier-delimiter">:</span> <span class="classifier">array_like, None</span></dt>
<dd>initial state / initial condition</dd>
</dl>
</div>
<div class="section" id="attributes">
<h3>Attributes</h3>
<dl class="docutils">
<dt>op_dyn <span class="classifier-delimiter">:</span> <span class="classifier">DynamicOperator</span></dt>
<dd>internal dynamic operator for state equation</dd>
<dt>op_alg <span class="classifier-delimiter">:</span> <span class="classifier">DynamicOperator</span></dt>
<dd>internal algebraic operator for mapping to outputs</dd>
</dl>
</div>
`,params:{A:{type:"number",default:"-1.0",description:""},B:{type:"number",default:"1.0",description:""},C:{type:"number",default:"-1.0",description:""},D:{type:"number",default:"1.0",description:"real valued state space matrices"},initial_value:{type:"any",default:null,description:"initial state / initial condition"}},inputs:null,outputs:null},PT1:{blockClass:"PT1",description:"First-order lag element (PT1).",docstringHtml:`<p>First-order lag element (PT1).</p>
<p>The transfer function is defined as</p>
<div class="math">
\\begin{equation*}
H(s) = \\frac{K}{1 + T s}
\\end{equation*}
</div>
<p>where <cite>K</cite> is the static gain and <cite>T</cite> is the time constant.</p>
<div class="section" id="example">
<h3>Example</h3>
<p>The block is initialized like this:</p>
<pre class="code python literal-block">
pt1 = PT1(K=2.0, T=0.5)
</pre>
</div>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>K <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>static gain</dd>
<dt>T <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>time constant in seconds (must be &gt; 0)</dd>
</dl>
</div>
`,params:{K:{type:"number",default:"1.0",description:"static gain"},T:{type:"number",default:"1.0",description:"time constant in seconds (must be > 0)"}},inputs:["in"],outputs:["out"]},PT2:{blockClass:"PT2",description:"Second-order lag element (PT2).",docstringHtml:`<p>Second-order lag element (PT2).</p>
<p>The transfer function is defined as</p>
<div class="math">
\\begin{equation*}
H(s) = \\frac{K}{1 + 2 d T s + T^2 s^2}
\\end{equation*}
</div>
<p>where <cite>K</cite> is the static gain, <cite>T</cite> is the time constant
(related to the natural frequency by <span class="math">\\(\\omega_n = 1/T\\)</span>)
and <cite>d</cite> is the damping ratio.</p>
<p>The damping ratio <cite>d</cite> controls the transient behavior:</p>
<ul class="simple">
<li><span class="math">\\(d &lt; 1\\)</span>: underdamped (oscillatory)</li>
<li><span class="math">\\(d = 1\\)</span>: critically damped</li>
<li><span class="math">\\(d &gt; 1\\)</span>: overdamped</li>
</ul>
<div class="section" id="example">
<h3>Example</h3>
<p>The block is initialized like this:</p>
<pre class="code python literal-block">
#underdamped second-order system
pt2 = PT2(K=1.0, T=0.1, d=0.3)
</pre>
</div>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>K <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>static gain</dd>
<dt>T <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>time constant in seconds (must be &gt; 0)</dd>
<dt>d <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>damping ratio (must be &gt;= 0)</dd>
</dl>
</div>
`,params:{K:{type:"number",default:"1.0",description:"static gain"},T:{type:"number",default:"1.0",description:"time constant in seconds (must be > 0)"},d:{type:"number",default:"1.0",description:"damping ratio (must be >= 0)"}},inputs:["in"],outputs:["out"]},LeadLag:{blockClass:"LeadLag",description:"Lead-Lag compensator.",docstringHtml:`<p>Lead-Lag compensator.</p>
<p>The transfer function is defined as</p>
<div class="math">
\\begin{equation*}
H(s) = K \\frac{T_1 s + 1}{T_2 s + 1}
\\end{equation*}
</div>
<p>where <cite>K</cite> is the static gain, <cite>T1</cite> is the lead time constant
and <cite>T2</cite> is the lag time constant.</p>
<ul class="simple">
<li><span class="math">\\(T_1 &gt; T_2\\)</span>: lead compensator (phase advance)</li>
<li><span class="math">\\(T_1 &lt; T_2\\)</span>: lag compensator (phase lag)</li>
<li><span class="math">\\(T_1 = T_2\\)</span>: pure gain</li>
</ul>
<div class="section" id="example">
<h3>Example</h3>
<p>The block is initialized like this:</p>
<pre class="code python literal-block">
#lead compensator
ll = LeadLag(K=1.0, T1=0.5, T2=0.1)
</pre>
</div>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>K <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>static gain</dd>
<dt>T1 <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>lead (numerator) time constant in seconds</dd>
<dt>T2 <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>lag (denominator) time constant in seconds (must be &gt; 0)</dd>
</dl>
</div>
`,params:{K:{type:"number",default:"1.0",description:"static gain"},T1:{type:"number",default:"1.0",description:"lead (numerator) time constant in seconds"},T2:{type:"number",default:"1.0",description:"lag (denominator) time constant in seconds (must be > 0)"}},inputs:["in"],outputs:["out"]},PID:{blockClass:"PID",description:"Proportional-Integral-Differentiation (PID) controller.",docstringHtml:`<p>Proportional-Integral-Differentiation (PID) controller.</p>
<p>The transfer function is defined as</p>
<div class="math">
\\begin{equation*}
H(s) = K_p + K_i \\frac{1}{s} + K_d \\frac{s}{1 + s / f_\\mathrm{max}}
\\end{equation*}
</div>
<p>where the differentiation is approximated by a high pass filter that holds
for signals up to a frequency of approximately <cite>f_max</cite>.</p>
<p>Internally realized as a linear state space model with two states
(differentiator filter state and integrator state).</p>
<div class="section" id="note">
<h3>Note</h3>
<p>Depending on <cite>f_max</cite>, the resulting system might become stiff or ill conditioned!
As a practical choice set <cite>f_max</cite> to 3x the highest expected signal frequency.
Since this block uses an approximation of real differentiation, the approximation will
not hold if there are high frequency components present in the signal. For example if
you have discontinuities such as steps or square waves.</p>
</div>
<div class="section" id="example">
<h3>Example</h3>
<p>The block is initialized like this:</p>
<pre class="code python literal-block">
#cutoff at 1kHz
pid = PID(Kp=2, Ki=0.5, Kd=0.1, f_max=1e3)
</pre>
</div>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>Kp <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>proportional controller coefficient</dd>
<dt>Ki <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>integral controller coefficient</dd>
<dt>Kd <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>differentiator controller coefficient</dd>
<dt>f_max <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>highest expected signal frequency</dd>
</dl>
</div>
`,params:{Kp:{type:"integer",default:"0",description:"proportional controller coefficient"},Ki:{type:"integer",default:"0",description:"integral controller coefficient"},Kd:{type:"integer",default:"0",description:"differentiator controller coefficient"},f_max:{type:"integer",default:"100",description:"highest expected signal frequency"}},inputs:["in"],outputs:["out"]},AntiWindupPID:{blockClass:"AntiWindupPID",description:"Proportional-Integral-Differentiation (PID) controller with anti-windup mechanism (back-calculation).",docstringHtml:`<p>Proportional-Integral-Differentiation (PID) controller with anti-windup mechanism (back-calculation).</p>
<p>Anti-windup mechanisms are needed when the magnitude of the control signal
from the PID controller is limited by some real world saturation. In these cases,
the integrator will continue to accumulate the control error and &quot;wind itself up&quot;.
Once the setpoint is reached, this can result in significant overshoots. This
implementation adds a conditional feedback term to the internal integrator that
&quot;unwinds&quot; it when the PID output crosses some limits. This is pretty much a
deadzone feedback element for the integrator.</p>
<p>Mathematically, this block implements the following set of ODEs</p>
<div class="math">
\\begin{equation*}
\\begin{align}
\\dot{x}_1 &amp;= f_\\mathrm{max} (u - x_1) \\\\
\\dot{x}_2 &amp;= u - w
\\end{align}
\\end{equation*}
</div>
<p>with the anti-windup feedback (depending on the pid output)</p>
<div class="math">
\\begin{equation*}
w = K_s (y - \\min(\\max(y, y_\\mathrm{min}), y_\\mathrm{max}))
\\end{equation*}
</div>
<p>and the output itself</p>
<div class="math">
\\begin{equation*}
y = K_p u + K_d f_\\mathrm{max} (u - x_1) + K_i x_2
\\end{equation*}
</div>
<div class="section" id="note">
<h3>Note</h3>
<p>Depending on <cite>f_max</cite>, the resulting system might become stiff or ill conditioned!
As a practical choice set <cite>f_max</cite> to 3x the highest expected signal frequency.
Since this block uses an approximation of real differentiation, the approximation will
not hold if there are high frequency components present in the signal. For example if
you have discontinuities such as steps or square waves.</p>
</div>
<div class="section" id="example">
<h3>Example</h3>
<p>The block is initialized like this:</p>
<pre class="code python literal-block">
#cutoff at 1kHz, windup limits at [-5, 5]
pid = AntiWindupPID(Kp=2, Ki=0.5, Kd=0.1, f_max=1e3, limits=[-5, 5])
</pre>
</div>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>Kp <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>proportional controller coefficient</dd>
<dt>Ki <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>integral controller coefficient</dd>
<dt>Kd <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>differentiator controller coefficient</dd>
<dt>f_max <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>highest expected signal frequency</dd>
<dt>Ks <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>feedback term for back calculation for anti-windup control of integrator</dd>
<dt>limits <span class="classifier-delimiter">:</span> <span class="classifier">array_like[float]</span></dt>
<dd>lower and upper limit for PID output that triggers anti-windup of integrator</dd>
</dl>
</div>
`,params:{Kp:{type:"integer",default:"0",description:"proportional controller coefficient"},Ki:{type:"integer",default:"0",description:"integral controller coefficient"},Kd:{type:"integer",default:"0",description:"differentiator controller coefficient"},f_max:{type:"integer",default:"100",description:"highest expected signal frequency"},Ks:{type:"integer",default:"10",description:"feedback term for back calculation for anti-windup control of integrator"},limits:{type:"array",default:"[-10, 10]",description:"lower and upper limit for PID output that triggers anti-windup of integrator"}},inputs:["in"],outputs:["out"]},RateLimiter:{blockClass:"RateLimiter",description:"Rate limiter block that limits the rate of change of a signal.",docstringHtml:`<p>Rate limiter block that limits the rate of change of a signal.</p>
<p>Implements a continuous-time rate limiter as a first-order tracking system
with clipped rate of change:</p>
<div class="math">
\\begin{equation*}
\\dot{x} = \\mathrm{clip}\\left(f_\\mathrm{max} (u - x),\\; -r,\\; r\\right)
\\end{equation*}
</div>
<p>where <cite>r</cite> is the maximum allowed rate and <cite>f_max</cite> controls the tracking
bandwidth when the signal is not rate-limited. The output is the state
<span class="math">\\(y = x\\)</span>.</p>
<div class="section" id="note">
<h3>Note</h3>
<p>The parameter <cite>f_max</cite> should be set high enough that the output tracks
the input without lag when the rate is within limits.</p>
</div>
<div class="section" id="example">
<h3>Example</h3>
<p>The block is initialized like this:</p>
<pre class="code python literal-block">
#max rate of 10 units/s
rl = RateLimiter(rate=10.0, f_max=1e3)
</pre>
</div>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>rate <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>maximum rate of change (positive value)</dd>
<dt>f_max <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>tracking bandwidth parameter</dd>
</dl>
</div>
`,params:{rate:{type:"number",default:"1.0",description:"maximum rate of change (positive value)"},f_max:{type:"integer",default:"100",description:"tracking bandwidth parameter"}},inputs:["in"],outputs:["out"]},Backlash:{blockClass:"Backlash",description:"Backlash (mechanical play) element.",docstringHtml:`<p>Backlash (mechanical play) element.</p>
<p>Models the hysteresis-like behavior of mechanical backlash in gears,
couplings and other systems with play. The output only tracks the input
after the input has moved through the full backlash width.</p>
<div class="math">
\\begin{equation*}
\\dot{x} = f_\\mathrm{max} \\left((u - x) - \\mathrm{clip}(u - x,\\; -w/2,\\; w/2)\\right)
\\end{equation*}
</div>
<p>where <cite>w</cite> is the total backlash width. Inside the dead zone <span class="math">\\(|u - x| \\leq w/2\\)</span>
the output does not move. Once the input pushes past the edge, the output
tracks with bandwidth <cite>f_max</cite>.</p>
<div class="section" id="example">
<h3>Example</h3>
<p>The block is initialized like this:</p>
<pre class="code python literal-block">
#backlash with 0.5 units of total play
bl = Backlash(width=0.5, f_max=1e3)
</pre>
</div>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>width <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>total backlash width (play)</dd>
<dt>f_max <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>tracking bandwidth parameter when engaged</dd>
</dl>
</div>
`,params:{width:{type:"number",default:"1.0",description:"total backlash width (play)"},f_max:{type:"integer",default:"100",description:"tracking bandwidth parameter when engaged"}},inputs:["in"],outputs:["out"]},Deadband:{blockClass:"Deadband",description:"Deadband (dead zone) element.",docstringHtml:`<p>Deadband (dead zone) element.</p>
<p>Outputs zero when the input is within the dead zone, and passes
the signal shifted by the zone boundary otherwise:</p>
<div class="math">
\\begin{equation*}
y = \\begin{cases}
    u - u_\\mathrm{upper} &amp; \\text{if } u &gt; u_\\mathrm{upper} \\\\
    0 &amp; \\text{if } u_\\mathrm{lower} \\leq u \\leq u_\\mathrm{upper} \\\\
    u - u_\\mathrm{lower} &amp; \\text{if } u &lt; u_\\mathrm{lower}
\\end{cases}
\\end{equation*}
</div>
<p>or equivalently <span class="math">\\(y = u - \\mathrm{clip}(u,\\; u_\\mathrm{lower},\\; u_\\mathrm{upper})\\)</span>.</p>
<div class="section" id="example">
<h3>Example</h3>
<p>The block is initialized like this:</p>
<pre class="code python literal-block">
#symmetric dead zone of width 0.2
db = Deadband(lower=-0.1, upper=0.1)
</pre>
</div>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>lower <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>lower bound of the dead zone</dd>
<dt>upper <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>upper bound of the dead zone</dd>
</dl>
</div>
`,params:{lower:{type:"number",default:"-1.0",description:"lower bound of the dead zone"},upper:{type:"number",default:"1.0",description:"upper bound of the dead zone"}},inputs:["in"],outputs:["out"]},TransferFunctionNumDen:{blockClass:"TransferFunctionNumDen",description:"This block defines a LTI (SISO) transfer function.",docstringHtml:`<p>This block defines a LTI (SISO) transfer function.</p>
<p>The transfer function is defined in polynomial (numerator-denominator) form</p>
<div class="math">
\\begin{equation*}
\\mathbf{H}(s) = \\frac{b_n + b_{n-1} s + \\dots + b_{0} s^n}{a_m + a_{m-1} s + \\dots + a_{0} s^m}
\\end{equation*}
</div>
<p>where <cite>Num</cite> is the list of numerator polynomial coefficients and <cite>Den</cite> the
list of denominator coefficients.</p>
<p>Upon initialization, the state space realization of the transfer function is
computed using <cite>scipy.signal.TransferFunction(Num, Den).to_ss()</cite>.</p>
<p>The resulting state space model of the form</p>
<div class="math">
\\begin{equation*}
\\begin{align}
    \\dot{x} &amp;= \\mathbf{A} x + \\mathbf{B} u \\\\
           y &amp;= \\mathbf{C} x + \\mathbf{D} u
\\end{align}
\\end{equation*}
</div>
<p>is handled the same as the 'StateSpace' block, where <cite>A</cite>, <cite>B</cite>, <cite>C</cite> and <cite>D</cite>
are the state space matrices, <cite>x</cite> is the internal state, <cite>u</cite> the input and
<cite>y</cite> the output vector.</p>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>Num <span class="classifier-delimiter">:</span> <span class="classifier">array_like</span></dt>
<dd>numerator polynomial coefficients</dd>
<dt>Den <span class="classifier-delimiter">:</span> <span class="classifier">array_like</span></dt>
<dd>denominator polynomial coefficients</dd>
</dl>
</div>
`,params:{Num:{type:"array",default:"[1]",description:"numerator polynomial coefficients"},Den:{type:"array",default:"[1, 1]",description:"denominator polynomial coefficients"}},inputs:["in"],outputs:["out"]},TransferFunctionZPG:{blockClass:"TransferFunctionZPG",description:"This block defines a LTI (SISO) transfer function.",docstringHtml:`<p>This block defines a LTI (SISO) transfer function.</p>
<p>The transfer function is defined in zeros-poles-gain (ZPG) form</p>
<div class="math">
\\begin{equation*}
\\mathbf{H}(s) = k \\frac{(s - z_1)(s - z_2)\\cdots(s - z_m)}{(s - p_1)(s - p_2)\\cdots(s - p_n)}
\\end{equation*}
</div>
<p>where <cite>Zeros</cite> are the scalar (possibly complex conjugate) zeros of the
transfer function, and <cite>Poles</cite> are the poles (denominator zeros) of the
transfer function. <cite>Gain</cite> is the scalar factor <cite>k</cite>.</p>
<p>Upon initialization, the state space realization of the transfer function is
computed using <cite>scipy.signal.ZerosPolesGain(Zeros, Poles, Gain).to_ss()</cite>.</p>
<p>The resulting state space model of the form</p>
<div class="math">
\\begin{equation*}
\\begin{align}
    \\dot{x} &amp;= \\mathbf{A} x + \\mathbf{B} u \\\\
           y &amp;= \\mathbf{C} x + \\mathbf{D} u
\\end{align}
\\end{equation*}
</div>
<p>is handled the same as the 'StateSpace' block, where <cite>A</cite>, <cite>B</cite>, <cite>C</cite> and <cite>D</cite>
are the state space matrices, <cite>x</cite> is the internal state, <cite>u</cite> the input and
<cite>y</cite> the output vector.</p>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>Poles <span class="classifier-delimiter">:</span> <span class="classifier">array_like</span></dt>
<dd>transfer function poles</dd>
<dt>Zeros <span class="classifier-delimiter">:</span> <span class="classifier">array_like</span></dt>
<dd>transfer function zeros</dd>
<dt>Gain <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>gain term of transfer function</dd>
</dl>
</div>
`,params:{Zeros:{type:"array",default:"[]",description:"transfer function zeros"},Poles:{type:"array",default:"[-1]",description:"transfer function poles"},Gain:{type:"number",default:"1.0",description:"gain term of transfer function"}},inputs:["in"],outputs:["out"]},ButterworthLowpassFilter:{blockClass:"ButterworthLowpassFilter",description:"Direct implementation of a low pass butterworth filter block.",docstringHtml:`<p>Direct implementation of a low pass butterworth filter block.</p>
<p>Follows the same structure as the 'StateSpace' block in the
'pathsim.blocks' module. The numerator and denominator of the
filter transfer function are generated and then the transfer
function is realized as a state space model.</p>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>Fc <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>corner frequency of the filter in [Hz]</dd>
<dt>n <span class="classifier-delimiter">:</span> <span class="classifier">int</span></dt>
<dd>filter order</dd>
</dl>
</div>
`,params:{Fc:{type:"integer",default:"100",description:"corner frequency of the filter in [Hz]"},n:{type:"integer",default:"2",description:"filter order"}},inputs:["in"],outputs:["out"]},ButterworthHighpassFilter:{blockClass:"ButterworthHighpassFilter",description:"Direct implementation of a high pass butterworth filter block.",docstringHtml:`<p>Direct implementation of a high pass butterworth filter block.</p>
<p>Follows the same structure as the 'StateSpace' block in the
'pathsim.blocks' module. The numerator and denominator of the
filter transfer function are generated and then the transfer
function is realized as a state space model.</p>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>Fc <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>corner frequency of the filter in [Hz]</dd>
<dt>n <span class="classifier-delimiter">:</span> <span class="classifier">int</span></dt>
<dd>filter order</dd>
</dl>
</div>
`,params:{Fc:{type:"integer",default:"100",description:"corner frequency of the filter in [Hz]"},n:{type:"integer",default:"2",description:"filter order"}},inputs:["in"],outputs:["out"]},ButterworthBandpassFilter:{blockClass:"ButterworthBandpassFilter",description:"Direct implementation of a bandpass butterworth filter block.",docstringHtml:`<p>Direct implementation of a bandpass butterworth filter block.</p>
<p>Follows the same structure as the 'StateSpace' block in the
'pathsim.blocks' module. The numerator and denominator of the
filter transfer function are generated and then the transfer
function is realized as a state space model.</p>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>Fc <span class="classifier-delimiter">:</span> <span class="classifier">list[float]</span></dt>
<dd>corner frequencies (left, right) of the filter in [Hz]</dd>
<dt>n <span class="classifier-delimiter">:</span> <span class="classifier">int</span></dt>
<dd>filter order</dd>
</dl>
</div>
`,params:{Fc:{type:"array",default:"[50, 100]",description:"corner frequencies (left, right) of the filter in [Hz]"},n:{type:"integer",default:"2",description:"filter order"}},inputs:["in"],outputs:["out"]},ButterworthBandstopFilter:{blockClass:"ButterworthBandstopFilter",description:"Direct implementation of a bandstop butterworth filter block.",docstringHtml:`<p>Direct implementation of a bandstop butterworth filter block.</p>
<p>Follows the same structure as the 'StateSpace' block in the
'pathsim.blocks' module. The numerator and denominator of the
filter transfer function are generated and then the transfer
function is realized as a state space model.</p>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>Fc <span class="classifier-delimiter">:</span> <span class="classifier">tuple[float], list[float]</span></dt>
<dd>corner frequencies (left, right) of the filter in [Hz]</dd>
<dt>n <span class="classifier-delimiter">:</span> <span class="classifier">int</span></dt>
<dd>filter order</dd>
</dl>
</div>
`,params:{Fc:{type:"array",default:"[50, 100]",description:"corner frequencies (left, right) of the filter in [Hz]"},n:{type:"integer",default:"2",description:"filter order"}},inputs:["in"],outputs:["out"]},Adder:{blockClass:"Adder",description:"Summs / adds up all input signals to a single output signal (MISO)",docstringHtml:`<p>Summs / adds up all input signals to a single output signal (MISO)</p>
<p>This is how it works in the default case</p>
<div class="math">
\\begin{equation*}
y(t) = \\sum_i u_i(t)
\\end{equation*}
</div>
<p>and like this when additional operations are defined</p>
<div class="math">
\\begin{equation*}
y(t) = \\sum_i \\mathrm{op}_i \\cdot u_i(t)
\\end{equation*}
</div>
<div class="section" id="example">
<h3>Example</h3>
<p>This is the default initialization that just adds up all the inputs:</p>
<pre class="code python literal-block">
A = Adder()
</pre>
<p>and this is the initialization with specific operations that subtracts
the second from first input and neglects all others:</p>
<pre class="code python literal-block">
A = Adder('+-')
</pre>
</div>
<div class="section" id="note">
<h3>Note</h3>
<p>This block is purely algebraic and its operation (<cite>op_alg</cite>) will be called
multiple times per timestep, each time when <cite>Simulation._update(t)</cite> is
called in the global simulation loop.</p>
</div>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>operations <span class="classifier-delimiter">:</span> <span class="classifier">str, optional</span></dt>
<dd>optional string of operations to be applied before
summation, i.e. '+-' will compute the difference,
'None' will just perform regular sum</dd>
</dl>
</div>
<div class="section" id="attributes">
<h3>Attributes</h3>
<dl class="docutils">
<dt>_ops <span class="classifier-delimiter">:</span> <span class="classifier">dict</span></dt>
<dd>dict that maps string operations to numerical</dd>
<dt>_ops_array <span class="classifier-delimiter">:</span> <span class="classifier">array_like</span></dt>
<dd>operations converted to array</dd>
<dt>op_alg <span class="classifier-delimiter">:</span> <span class="classifier">Operator</span></dt>
<dd>internal algebraic operator</dd>
</dl>
</div>
`,params:{operations:{type:"any",default:null,description:"optional string of operations to be applied before summation, i.e. '+-' will compute the difference, 'None' will just perform regular sum"}},inputs:null,outputs:["out"]},Multiplier:{blockClass:"Multiplier",description:"Multiplies all signals from all input ports (MISO).",docstringHtml:`<p>Multiplies all signals from all input ports (MISO).</p>
<div class="math">
\\begin{equation*}
y(t) = \\prod_i u_i(t)
\\end{equation*}
</div>
<div class="section" id="note">
<h3>Note</h3>
<p>This block is purely algebraic and its operation (<cite>op_alg</cite>) will be called
multiple times per timestep, each time when <cite>Simulation._update(t)</cite> is
called in the global simulation loop.</p>
</div>
<div class="section" id="attributes">
<h3>Attributes</h3>
<dl class="docutils">
<dt>op_alg <span class="classifier-delimiter">:</span> <span class="classifier">Operator</span></dt>
<dd>internal algebraic operator that wraps 'prod'</dd>
</dl>
</div>
`,params:{},inputs:null,outputs:["out"]},Amplifier:{blockClass:"Amplifier",description:"Amplifies the input signal by multiplication with a constant gain term.",docstringHtml:`<p>Amplifies the input signal by multiplication with a constant gain term.</p>
<p>Like this:</p>
<div class="math">
\\begin{equation*}
y(t) = \\mathrm{gain} \\cdot u(t)
\\end{equation*}
</div>
<div class="section" id="note">
<h3>Note</h3>
<p>This block is purely algebraic and its operation (<cite>op_alg</cite>) will be called
multiple times per timestep, each time when <cite>Simulation._update(t)</cite> is
called in the global simulation loop.</p>
</div>
<div class="section" id="example">
<h3>Example</h3>
<p>The block is initialized like this:</p>
<pre class="code python literal-block">
#amplification by factor 5
A = Amplifier(gain=5)
</pre>
</div>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>gain <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>amplifier gain</dd>
</dl>
</div>
<div class="section" id="attributes">
<h3>Attributes</h3>
<dl class="docutils">
<dt>op_alg <span class="classifier-delimiter">:</span> <span class="classifier">Operator</span></dt>
<dd>internal algebraic operator</dd>
</dl>
</div>
`,params:{gain:{type:"number",default:"1.0",description:"amplifier gain"}},inputs:null,outputs:null},Function:{blockClass:"Function",description:"Arbitrary MIMO function block, defined by a function or `lambda` expression.",docstringHtml:`<p>Arbitrary MIMO function block, defined by a function or <cite>lambda</cite> expression.</p>
<p>The function can have multiple arguments that are then provided
by the input channels of the function block.</p>
<p>Form multi input, the function has to specify multiple arguments
and for multi output, the aoutputs have to be provided as a
tuple or list.</p>
<p>In the context of the global system, this block implements algebraic
components of the global system ODE/DAE.</p>
<div class="math">
\\begin{equation*}
\\vec{y} = \\mathrm{func}(\\vec{u})
\\end{equation*}
</div>
<div class="section" id="note">
<h3>Note</h3>
<p>This block is purely algebraic and its operation (<cite>op_alg</cite>) will be called
multiple times per timestep, each time when <cite>Simulation._update(t)</cite> is
called in the global simulation loop.
Therefore <cite>func</cite> must be purely algebraic and not introduce states,
delay, etc. For interfacing with external stateful APIs, use the
<cite>Wrapper</cite> block.</p>
</div>
<div class="section" id="note-1">
<h3>Note</h3>
<p>If the outputs are provided as a single numpy array, they are
considered a single output. For MIMO, output has to be tuple.</p>
</div>
<div class="section" id="example">
<h3>Example</h3>
<p>consider the function:</p>
<pre class="code python literal-block">
from pathsim.blocks import Function

def f(a, b, c):
    return a**2, a*b, b/c

fn = Function(f)
</pre>
<p>then, when the block is updated, the input channels of the block are
assigned to the function arguments following this scheme:</p>
<pre class="code literal-block">
inputs[0] -&gt; a
inputs[1] -&gt; b
inputs[2] -&gt; c
</pre>
<p>and the function outputs are assigned to the
output channels of the block in the same way:</p>
<pre class="code literal-block">
a**2 -&gt; outputs[0]
a*b  -&gt; outputs[1]
b/c  -&gt; outputs[2]
</pre>
<p>Because the <cite>Function</cite> block only has a single argument, it can be
used to decorate a function and make it a <cite>PathSim</cite> block. This might
be handy in some cases to keep definitions concise and localized
in the code:</p>
<pre class="code python literal-block">
from pathsim.blocks import Function

#does the same as the definition above

&#64;Function
def fn(a, b, c):
    return a**2, a*b, b/c

#'fn' is now a PathSim block
</pre>
</div>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>func <span class="classifier-delimiter">:</span> <span class="classifier">callable</span></dt>
<dd>MIMO function that defines algebraic block IO behaviour, signature <cite>func(*tuple)</cite></dd>
</dl>
</div>
<div class="section" id="attributes">
<h3>Attributes</h3>
<dl class="docutils">
<dt>op_alg <span class="classifier-delimiter">:</span> <span class="classifier">Operator</span></dt>
<dd>internal algebraic operator that wraps <cite>func</cite></dd>
</dl>
</div>
`,params:{func:{type:"callable",default:null,description:"MIMO function that defines algebraic block IO behaviour, signature `func(*tuple)`"}},inputs:null,outputs:null},Sin:{blockClass:"Sin",description:"Sine operator block.",docstringHtml:`<p>Sine operator block.</p>
<p>This block supports vector inputs. This is the operation it does:</p>
<div class="math">
\\begin{equation*}
\\vec{y} = \\sin(\\vec{u})
\\end{equation*}
</div>
<div class="section" id="attributes">
<h3>Attributes</h3>
<dl class="docutils">
<dt>op_alg <span class="classifier-delimiter">:</span> <span class="classifier">Operator</span></dt>
<dd>internal algebraic operator</dd>
</dl>
</div>
`,params:{},inputs:null,outputs:null},Cos:{blockClass:"Cos",description:"Cosine operator block.",docstringHtml:`<p>Cosine operator block.</p>
<p>This block supports vector inputs. This is the operation it does:</p>
<div class="math">
\\begin{equation*}
\\vec{y} = \\cos(\\vec{u})
\\end{equation*}
</div>
<div class="section" id="attributes">
<h3>Attributes</h3>
<dl class="docutils">
<dt>op_alg <span class="classifier-delimiter">:</span> <span class="classifier">Operator</span></dt>
<dd>internal algebraic operator</dd>
</dl>
</div>
`,params:{},inputs:null,outputs:null},Tan:{blockClass:"Tan",description:"Tangent operator block.",docstringHtml:`<p>Tangent operator block.</p>
<p>This block supports vector inputs. This is the operation it does:</p>
<div class="math">
\\begin{equation*}
\\vec{y} = \\tan(\\vec{u})
\\end{equation*}
</div>
<div class="section" id="attributes">
<h3>Attributes</h3>
<dl class="docutils">
<dt>op_alg <span class="classifier-delimiter">:</span> <span class="classifier">Operator</span></dt>
<dd>internal algebraic operator</dd>
</dl>
</div>
`,params:{},inputs:null,outputs:null},Tanh:{blockClass:"Tanh",description:"Hyperbolic tangent operator block.",docstringHtml:`<p>Hyperbolic tangent operator block.</p>
<p>This block supports vector inputs. This is the operation it does:</p>
<div class="math">
\\begin{equation*}
\\vec{y} = \\tanh(\\vec{u})
\\end{equation*}
</div>
<div class="section" id="attributes">
<h3>Attributes</h3>
<dl class="docutils">
<dt>op_alg <span class="classifier-delimiter">:</span> <span class="classifier">Operator</span></dt>
<dd>internal algebraic operator</dd>
</dl>
</div>
`,params:{},inputs:null,outputs:null},Abs:{blockClass:"Abs",description:"Absolute value operator block.",docstringHtml:`<p>Absolute value operator block.</p>
<p>This block supports vector inputs. This is the operation it does:</p>
<div class="math">
\\begin{equation*}
\\vec{y} = \\vert| \\vec{u} \\vert|
\\end{equation*}
</div>
<div class="section" id="attributes">
<h3>Attributes</h3>
<dl class="docutils">
<dt>op_alg <span class="classifier-delimiter">:</span> <span class="classifier">Operator</span></dt>
<dd>internal algebraic operator</dd>
</dl>
</div>
`,params:{},inputs:null,outputs:null},Sqrt:{blockClass:"Sqrt",description:"Square root operator block.",docstringHtml:`<p>Square root operator block.</p>
<p>This block supports vector inputs. This is the operation it does:</p>
<div class="math">
\\begin{equation*}
\\vec{y} = \\sqrt{|\\vec{u}|}
\\end{equation*}
</div>
<div class="section" id="attributes">
<h3>Attributes</h3>
<dl class="docutils">
<dt>op_alg <span class="classifier-delimiter">:</span> <span class="classifier">Operator</span></dt>
<dd>internal algebraic operator</dd>
</dl>
</div>
`,params:{},inputs:null,outputs:null},Exp:{blockClass:"Exp",description:"Exponential operator block.",docstringHtml:`<p>Exponential operator block.</p>
<p>This block supports vector inputs. This is the operation it does:</p>
<div class="math">
\\begin{equation*}
\\vec{y} = e^{\\vec{u}}
\\end{equation*}
</div>
<div class="section" id="attributes">
<h3>Attributes</h3>
<dl class="docutils">
<dt>op_alg <span class="classifier-delimiter">:</span> <span class="classifier">Operator</span></dt>
<dd>internal algebraic operator</dd>
</dl>
</div>
`,params:{},inputs:null,outputs:null},Log:{blockClass:"Log",description:"Natural logarithm operator block.",docstringHtml:`<p>Natural logarithm operator block.</p>
<p>This block supports vector inputs. This is the operation it does:</p>
<div class="math">
\\begin{equation*}
\\vec{y} = \\ln(\\vec{u})
\\end{equation*}
</div>
<div class="section" id="attributes">
<h3>Attributes</h3>
<dl class="docutils">
<dt>op_alg <span class="classifier-delimiter">:</span> <span class="classifier">Operator</span></dt>
<dd>internal algebraic operator</dd>
</dl>
</div>
`,params:{},inputs:null,outputs:null},Log10:{blockClass:"Log10",description:"Base-10 logarithm operator block.",docstringHtml:`<p>Base-10 logarithm operator block.</p>
<p>This block supports vector inputs. This is the operation it does:</p>
<div class="math">
\\begin{equation*}
\\vec{y} = \\log_{10}(\\vec{u})
\\end{equation*}
</div>
<div class="section" id="attributes">
<h3>Attributes</h3>
<dl class="docutils">
<dt>op_alg <span class="classifier-delimiter">:</span> <span class="classifier">Operator</span></dt>
<dd>internal algebraic operator</dd>
</dl>
</div>
`,params:{},inputs:null,outputs:null},Mod:{blockClass:"Mod",description:"Modulo operator block.",docstringHtml:`<p>Modulo operator block.</p>
<p>This block supports vector inputs. This is the operation it does:</p>
<div class="math">
\\begin{equation*}
\\vec{y} = \\vec{u} \\bmod m
\\end{equation*}
</div>
<div class="section" id="note">
<h3>Note</h3>
<p>modulo is not differentiable at discontinuities</p>
</div>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>modulus <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>modulus value</dd>
</dl>
</div>
<div class="section" id="attributes">
<h3>Attributes</h3>
<dl class="docutils">
<dt>op_alg <span class="classifier-delimiter">:</span> <span class="classifier">Operator</span></dt>
<dd>internal algebraic operator</dd>
</dl>
</div>
`,params:{modulus:{type:"number",default:"1.0",description:"modulus value Attributes ----------"}},inputs:null,outputs:null},Clip:{blockClass:"Clip",description:"Clipping/saturation operator block.",docstringHtml:`<p>Clipping/saturation operator block.</p>
<p>This block supports vector inputs. This is the operation it does:</p>
<div class="math">
\\begin{equation*}
\\vec{y} = \\text{clip}(\\vec{u}, u_{min}, u_{max})
\\end{equation*}
</div>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>min_val <span class="classifier-delimiter">:</span> <span class="classifier">float, array_like</span></dt>
<dd>minimum clipping value</dd>
<dt>max_val <span class="classifier-delimiter">:</span> <span class="classifier">float, array_like</span></dt>
<dd>maximum clipping value</dd>
</dl>
</div>
<div class="section" id="attributes">
<h3>Attributes</h3>
<dl class="docutils">
<dt>op_alg <span class="classifier-delimiter">:</span> <span class="classifier">Operator</span></dt>
<dd>internal algebraic operator</dd>
</dl>
</div>
`,params:{min_val:{type:"number",default:"-1.0",description:"minimum clipping value"},max_val:{type:"number",default:"1.0",description:"maximum clipping value Attributes ----------"}},inputs:null,outputs:null},Pow:{blockClass:"Pow",description:"Raise to power operator block.",docstringHtml:`<p>Raise to power operator block.</p>
<p>This block supports vector inputs. This is the operation it does:</p>
<div class="math">
\\begin{equation*}
\\vec{y} = \\vec{u}^{p}
\\end{equation*}
</div>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>exponent <span class="classifier-delimiter">:</span> <span class="classifier">float, array_like</span></dt>
<dd>exponent to raise the input to the power of</dd>
</dl>
</div>
<div class="section" id="attributes">
<h3>Attributes</h3>
<dl class="docutils">
<dt>op_alg <span class="classifier-delimiter">:</span> <span class="classifier">Operator</span></dt>
<dd>internal algebraic operator</dd>
</dl>
</div>
`,params:{exponent:{type:"integer",default:"2",description:"exponent to raise the input to the power of Attributes ----------"}},inputs:null,outputs:null},Switch:{blockClass:"Switch",description:"Switch block that selects between its inputs.",docstringHtml:`<p>Switch block that selects between its inputs.</p>
<div class="section" id="example">
<h3>Example</h3>
<p>The block is initialized like this:</p>
<pre class="code python literal-block">
#default None -&gt; no passthrough
s1 = Switch()

#selecting port 2 as passthrough
s2 = Switch(2)

#change the state of the switch to port 3
s2.select(3)
</pre>
<p>Sets block output depending on <cite>self.state</cite> like this:</p>
<pre class="code literal-block">
state == None -&gt; outputs[0] = 0

state == 0 -&gt; outputs[0] = inputs[0]

state == 1 -&gt; outputs[0] = inputs[1]

state == 2 -&gt; outputs[0] = inputs[2]

...
</pre>
</div>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>state <span class="classifier-delimiter">:</span> <span class="classifier">int, None</span></dt>
<dd>state of the switch</dd>
</dl>
</div>
`,params:{state:{type:"any",default:null,description:"state of the switch"}},inputs:null,outputs:["out"]},LUT:{blockClass:"LUT",description:"N-dimensional lookup table with linear interpolation functionality.",docstringHtml:`<p>N-dimensional lookup table with linear interpolation functionality.</p>
<p>This class implements a multi-dimensional lookup table that uses scipy's
LinearNDInterpolator <a class="footnote-reference" href="#scipy" id="footnote-reference-1">[1]</a> for piecewise linear interpolation in N-dimensional
space. The interpolation is based on Delaunay triangulation of the input points,
providing smooth linear interpolation between data points. For points outside
the convex hull of the input data, the interpolator returns NaN values.</p>
<p>The LUT acts as a Function block.</p>
<div class="section" id="references">
<h3>References</h3>
<table class="docutils footnote" frame="void" id="scipy" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#footnote-reference-1">[1]</a></td><td><a class="reference external" href="https://docs.scipy.org/doc/scipy-1.16.1/reference/generated/scipy.interpolate.LinearNDInterpolator.html">https://docs.scipy.org/doc/scipy-1.16.1/reference/generated/scipy.interpolate.LinearNDInterpolator.html</a></td></tr>
</tbody>
</table>
</div>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>points <span class="classifier-delimiter">:</span> <span class="classifier">array_like of shape (n, ndim)</span></dt>
<dd>2-D array of data point coordinates where n is the number of points
and ndim is the dimensionality of the space. Each row represents a
single data point in ndim-dimensional space.</dd>
<dt>values <span class="classifier-delimiter">:</span> <span class="classifier">array_like of shape (n,) or (n, m)</span></dt>
<dd>N-D array of data values at the corresponding points. If 1-D, represents
scalar values at each point. If 2-D, each column represents a different
output dimension (m output values per input point).</dd>
</dl>
</div>
<div class="section" id="attributes">
<h3>Attributes</h3>
<dl class="docutils">
<dt>points <span class="classifier-delimiter">:</span> <span class="classifier">ndarray</span></dt>
<dd>Stored array of input point coordinates.</dd>
<dt>values <span class="classifier-delimiter">:</span> <span class="classifier">ndarray</span></dt>
<dd>Stored array of output values at each point.</dd>
<dt>inter <span class="classifier-delimiter">:</span> <span class="classifier">scipy.interpolate.LinearNDInterpolator</span></dt>
<dd>The scipy linear interpolator object used for interpolation.</dd>
</dl>
</div>
`,params:{points:{type:"any",default:null,description:"2-D array of data point coordinates where n is the number of points and ndim is the dimensionality of the space. Each row represents a single data point in ndim-dimensional space."},values:{type:"any",default:null,description:"N-D array of data values at the corresponding points. If 1-D, represents scalar values at each point. If 2-D, each column represents a different output dimension (m output values per input point)."}},inputs:null,outputs:null},LUT1D:{blockClass:"LUT1D",description:"One-dimensional lookup table with linear interpolation functionality.",docstringHtml:`<p>One-dimensional lookup table with linear interpolation functionality.</p>
<p>This class implements a 1-dimensional lookup table that uses scipy's interp1d <a class="footnote-reference" href="#scipy" id="footnote-reference-1">[1]</a>
for piecewise linear interpolation along a single axis. The interpolation
provides linear interpolation between adjacent data points and supports
extrapolation beyond the input data range using the 'extrapolate' fill mode.</p>
<p>The LUT1D acts as a Function block.</p>
<div class="section" id="references">
<h3>References</h3>
<table class="docutils footnote" frame="void" id="scipy" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#footnote-reference-1">[1]</a></td><td><a class="reference external" href="https://docs.scipy.org/doc/scipy-1.16.1/reference/generated/scipy.interpolate.interp1d.html">https://docs.scipy.org/doc/scipy-1.16.1/reference/generated/scipy.interpolate.interp1d.html</a></td></tr>
</tbody>
</table>
</div>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>points <span class="classifier-delimiter">:</span> <span class="classifier">array_like of shape (n,)</span></dt>
<dd>1-D array of monotonically increasing data point coordinates where n
is the number of points. These represent the independent variable values
at which the dependent values are known.</dd>
<dt>values <span class="classifier-delimiter">:</span> <span class="classifier">array_like of shape (n,) or (n, m)</span></dt>
<dd>1-D or 2-D array of data values at the corresponding points. If 1-D,
represents scalar values at each point. If 2-D with shape (n, m),
each column represents a different output dimension, allowing the
lookup table to return m-dimensional vectors.</dd>
<dt>fill_value <span class="classifier-delimiter">:</span> <span class="classifier">float or str, optional</span></dt>
<dd>The value to use for points outside the interpolation range. If &quot;extrapolate&quot;,
the interpolator will use linear extrapolation. Default is &quot;extrapolate&quot;.
See <a class="reference external" href="https://docs.scipy.org/doc/scipy-1.16.1/reference/generated/scipy.interpolate.interp1d.html">https://docs.scipy.org/doc/scipy-1.16.1/reference/generated/scipy.interpolate.interp1d.html</a> for more details</dd>
</dl>
</div>
<div class="section" id="attributes">
<h3>Attributes</h3>
<dl class="docutils">
<dt>points <span class="classifier-delimiter">:</span> <span class="classifier">ndarray</span></dt>
<dd>Flattened array of input point coordinates, stored as 1-D array.</dd>
<dt>values <span class="classifier-delimiter">:</span> <span class="classifier">ndarray</span></dt>
<dd>Stored array of output values at each point, preserving original shape.</dd>
<dt>inter <span class="classifier-delimiter">:</span> <span class="classifier">scipy.interpolate.interp1d</span></dt>
<dd>The scipy 1D interpolator object used for linear interpolation with
extrapolation enabled beyond the data range.</dd>
</dl>
</div>
`,params:{points:{type:"any",default:null,description:"1-D array of monotonically increasing data point coordinates where n is the number of points. These represent the independent variable values at which the dependent values are known."},values:{type:"any",default:null,description:"1-D or 2-D array of data values at the corresponding points. If 1-D, represents scalar values at each point. If 2-D with shape (n, m), each column represents a different output dimension, allowing the lookup table to return m-dimensional vectors."},fill_value:{type:"string",default:'"extrapolate"',description:'The value to use for points outside the interpolation range. If "extrapolate", the interpolator will use linear extrapolation. Default is "extrapolate". See https://docs.scipy.org/doc/scipy-1.16.1/reference/generated/scipy.interpolate.interp1d.html for more details'}},inputs:null,outputs:null},SampleHold:{blockClass:"SampleHold",description:"Samples the inputs periodically and produces them at the output.",docstringHtml:`<p>Samples the inputs periodically and produces them at the output.</p>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>T <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>sampling period</dd>
<dt>tau <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>delay</dd>
</dl>
</div>
<div class="section" id="attributes">
<h3>Attributes</h3>
<dl class="docutils">
<dt>events <span class="classifier-delimiter">:</span> <span class="classifier">list[Schedule]</span></dt>
<dd>internal scheduled event for periodic sampling</dd>
</dl>
</div>
`,params:{T:{type:"integer",default:"1",description:"sampling period"},tau:{type:"integer",default:"0",description:"delay Attributes ----------"}},inputs:null,outputs:null},FIR:{blockClass:"FIR",description:"Models a discrete-time Finite-Impulse-Response (FIR) filter.",docstringHtml:`<p>Models a discrete-time Finite-Impulse-Response (FIR) filter.</p>
<p>This block applies an FIR filter to an input signal sampled periodically.
The output at each sample time is a weighted sum of the current and a finite number
of past input samples. The operation is triggered by a scheduled event.</p>
<p>Functionality:</p>
<div class="math">
\\begin{equation*}
y[n] = b[0] x[n] + b[1] x[n-1] + \\dots + b[N] x[n-N]
\\end{equation*}
</div>
<p>where <cite>b</cite> are the filter coefficients and <cite>N</cite> is the filter order (number of
coefficients - 1).</p>
<ol class="arabic simple">
<li>Samples the input <cite>inputs[0]</cite> at intervals of <cite>T</cite>, starting after delay <cite>tau</cite>.</li>
<li>Stores the current and past <cite>len(coefficients) - 1</cite> input samples in an internal buffer.</li>
<li>Computes the filter output using the dot product of the coefficients
and the buffered input samples.</li>
<li>Outputs the result on <cite>outputs[0]</cite>.</li>
<li>Holds the output constant between updates.</li>
</ol>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>coeffs <span class="classifier-delimiter">:</span> <span class="classifier">array_like</span></dt>
<dd>List or numpy array of FIR filter coefficients [b0, b1, ..., bN].
The number of coefficients determines the filter's order and memory.</dd>
<dt>T <span class="classifier-delimiter">:</span> <span class="classifier">float, optional</span></dt>
<dd>Sampling period (time between input samples and output updates). Default is 1.</dd>
<dt>tau <span class="classifier-delimiter">:</span> <span class="classifier">float, optional</span></dt>
<dd>Initial delay before the first sample is processed. Default is 0.</dd>
</dl>
</div>
<div class="section" id="input-ports">
<h3>Input Ports</h3>
<dl class="docutils">
<dt>inputs[0] <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>Input signal sample at the current time step.</dd>
</dl>
</div>
<div class="section" id="output-ports">
<h3>Output Ports</h3>
<dl class="docutils">
<dt>outputs[0] <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>Filtered output signal sample.</dd>
</dl>
</div>
<div class="section" id="attributes">
<h3>Attributes</h3>
<dl class="docutils">
<dt>buffer <span class="classifier-delimiter">:</span> <span class="classifier">deque</span></dt>
<dd>Internal buffer storing the most recent input samples.</dd>
<dt>events <span class="classifier-delimiter">:</span> <span class="classifier">list[Schedule]</span></dt>
<dd>Internal scheduled event triggering the filter calculation.</dd>
</dl>
</div>
`,params:{coeffs:{type:"array",default:"[1.0]",description:"List or numpy array of FIR filter coefficients [b0, b1, ..., bN]. The number of coefficients determines the filter's order and memory."},T:{type:"integer",default:"1",description:"Sampling period (time between input samples and output updates). Default is 1."},tau:{type:"integer",default:"0",description:"Initial delay before the first sample is processed. Default is 0."}},inputs:["in"],outputs:["out"]},ADC:{blockClass:"ADC",description:"Models an ideal Analog-to-Digital Converter (ADC).",docstringHtml:`<p>Models an ideal Analog-to-Digital Converter (ADC).</p>
<p>This block samples an analog input signal periodically, quantizes it
according to the specified number of bits and input span, and outputs
the resulting digital code on multiple output ports. The sampling
is triggered by a scheduled event.</p>
<p>Functionality:</p>
<ol class="arabic simple">
<li>Samples the analog input <cite>inputs[0]</cite> at intervals of <cite>T</cite>, starting after delay <cite>tau</cite>.</li>
<li>Clips the input voltage to the defined <cite>span</cite> [min_voltage, max_voltage].</li>
<li>Scales the clipped voltage to the range [0, 1].</li>
<li>Quantizes the scaled value to an integer code between 0 and 2^n_bits - 1 using flooring.</li>
<li>Converts the integer code to an n_bits binary representation.</li>
<li>Outputs the binary code on ports 0 (LSB) to n_bits-1 (MSB).</li>
</ol>
<p>Ideal characteristics:</p>
<ul class="simple">
<li>Instantaneous sampling at scheduled times.</li>
<li>Perfect, noise-free quantization.</li>
<li>No aperture jitter or other dynamic errors.</li>
</ul>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>n_bits <span class="classifier-delimiter">:</span> <span class="classifier">int, optional</span></dt>
<dd>Number of bits for the digital output code. Default is 4.</dd>
<dt>span <span class="classifier-delimiter">:</span> <span class="classifier">list[float] or tuple[float], optional</span></dt>
<dd>The valid analog input value range [min_voltage, max_voltage].
Inputs outside this range will be clipped. Default is [-1, 1].</dd>
<dt>T <span class="classifier-delimiter">:</span> <span class="classifier">float, optional</span></dt>
<dd>Sampling period (time between samples). Default is 1 time unit.</dd>
<dt>tau <span class="classifier-delimiter">:</span> <span class="classifier">float, optional</span></dt>
<dd>Initial delay before the first sample is taken. Default is 0.</dd>
</dl>
</div>
<div class="section" id="attributes">
<h3>Attributes</h3>
<dl class="docutils">
<dt>events <span class="classifier-delimiter">:</span> <span class="classifier">list[Schedule]</span></dt>
<dd>Internal scheduled event responsible for periodic sampling and conversion.</dd>
</dl>
</div>
`,params:{n_bits:{type:"integer",default:"4",description:"Number of bits for the digital output code. Default is 4."},span:{type:"array",default:"[-1, 1]",description:"The valid analog input value range [min_voltage, max_voltage]. Inputs outside this range will be clipped. Default is [-1, 1]."},T:{type:"integer",default:"1",description:"Sampling period (time between samples). Default is 1 time unit."},tau:{type:"integer",default:"0",description:"Initial delay before the first sample is taken. Default is 0."}},inputs:["in"],outputs:null},DAC:{blockClass:"DAC",description:"Models an ideal Digital-to-Analog Converter (DAC).",docstringHtml:`<p>Models an ideal Digital-to-Analog Converter (DAC).</p>
<p>This block reads a digital input code periodically from its input ports,
reconstructs the corresponding analog value based on the number of bits
and output span, and holds the output constant between updates. The update
is triggered by a scheduled event.</p>
<p>Functionality:</p>
<ol class="arabic simple">
<li>Reads the digital code from input ports 0 (LSB) to n_bits-1 (MSB) at intervals of <cite>T</cite>, starting after delay <cite>tau</cite>.</li>
<li>Interprets the inputs as an unsigned binary integer code.</li>
<li>Converts the integer code to a fractional value between 0 and (2^n_bits - 1) / 2^n_bits.</li>
<li>Scales this fractional value to the specified analog output <cite>span</cite>.</li>
<li>Outputs the resulting analog value on <cite>outputs[0]</cite>.</li>
<li>Holds the output value constant until the next scheduled update.</li>
</ol>
<p>Ideal characteristics:</p>
<ul class="simple">
<li>Instantaneous update at scheduled times.</li>
<li>Perfect, noise-free reconstruction.</li>
<li>No glitches or settling time.</li>
</ul>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>n_bits <span class="classifier-delimiter">:</span> <span class="classifier">int, optional</span></dt>
<dd>Number of digital input bits expected. Default is 4.</dd>
<dt>span <span class="classifier-delimiter">:</span> <span class="classifier">list[float] or tuple[float], optional</span></dt>
<dd>The analog output value range [min_voltage, max_voltage] corresponding
to the digital codes 0 and 2^n_bits - 1, respectively (approximately).
Default is [-1, 1].</dd>
<dt>T <span class="classifier-delimiter">:</span> <span class="classifier">float, optional</span></dt>
<dd>Update period (time between output updates). Default is 1 time unit.</dd>
<dt>tau <span class="classifier-delimiter">:</span> <span class="classifier">float, optional</span></dt>
<dd>Initial delay before the first output update. Default is 0.</dd>
</dl>
</div>
<div class="section" id="attributes">
<h3>Attributes</h3>
<dl class="docutils">
<dt>events <span class="classifier-delimiter">:</span> <span class="classifier">list[Schedule]</span></dt>
<dd>Internal scheduled event responsible for periodic updates.</dd>
</dl>
</div>
`,params:{n_bits:{type:"integer",default:"4",description:"Number of digital input bits expected. Default is 4."},span:{type:"array",default:"[-1, 1]",description:"The analog output value range [min_voltage, max_voltage] corresponding to the digital codes 0 and 2^n_bits - 1, respectively (approximately). Default is [-1, 1]."},T:{type:"integer",default:"1",description:"Update period (time between output updates). Default is 1 time unit."},tau:{type:"integer",default:"0",description:"Initial delay before the first output update. Default is 0."}},inputs:null,outputs:["out"]},Counter:{blockClass:"Counter",description:"Counts the number of detected bidirectional threshold crossings.",docstringHtml:`<p>Counts the number of detected bidirectional threshold crossings.</p>
<p>Uses zero-crossing events for the detection and sets the output
accordingly.</p>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>start <span class="classifier-delimiter">:</span> <span class="classifier">int</span></dt>
<dd>counter start (initial condition)</dd>
<dt>threshold <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>threshold for zero crossing</dd>
</dl>
</div>
<div class="section" id="attributes">
<h3>Attributes</h3>
<dl class="docutils">
<dt>E <span class="classifier-delimiter">:</span> <span class="classifier">ZeroCrossing</span></dt>
<dd>internal event manager</dd>
<dt>events <span class="classifier-delimiter">:</span> <span class="classifier">list[ZeroCrossing]</span></dt>
<dd>internal zero crossing event</dd>
</dl>
</div>
`,params:{start:{type:"integer",default:"0",description:"counter start (initial condition)"},threshold:{type:"number",default:"0.0",description:"threshold for zero crossing Attributes ----------"}},inputs:["in"],outputs:["out"]},CounterUp:{blockClass:"CounterUp",description:"Counts the number of detected unidirectional (lo->hi) threshold crossings.",docstringHtml:`<p>Counts the number of detected unidirectional (lo-&gt;hi) threshold crossings.</p>
<div class="section" id="note">
<h3>Note</h3>
<p>This is a modification of 'Counter' which only counts
unidirectional zero-crossings (low -&gt; high)</p>
</div>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>start <span class="classifier-delimiter">:</span> <span class="classifier">int</span></dt>
<dd>counter start (initial condition)</dd>
<dt>threshold <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>threshold for zero crossing</dd>
</dl>
</div>
<div class="section" id="attributes">
<h3>Attributes</h3>
<dl class="docutils">
<dt>E <span class="classifier-delimiter">:</span> <span class="classifier">ZeroCrossingUp</span></dt>
<dd>internal event manager</dd>
<dt>events <span class="classifier-delimiter">:</span> <span class="classifier">list[ZeroCrossing]</span></dt>
<dd>internal zero crossing event</dd>
</dl>
</div>
`,params:{start:{type:"integer",default:"0",description:"counter start (initial condition)"},threshold:{type:"number",default:"0.0",description:"threshold for zero crossing Attributes ----------"}},inputs:["in"],outputs:["out"]},CounterDown:{blockClass:"CounterDown",description:"Counts the number of detected unidirectional (hi->lo) threshold crossings.",docstringHtml:`<p>Counts the number of detected unidirectional (hi-&gt;lo) threshold crossings.</p>
<div class="section" id="note">
<h3>Note</h3>
<p>This is a modification of 'Counter' which only counts
unidirectional zero-crossings (high -&gt; low)</p>
</div>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>start <span class="classifier-delimiter">:</span> <span class="classifier">int</span></dt>
<dd>counter start (initial condition)</dd>
<dt>threshold <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>threshold for zero crossing</dd>
</dl>
</div>
<div class="section" id="attributes">
<h3>Attributes</h3>
<dl class="docutils">
<dt>E <span class="classifier-delimiter">:</span> <span class="classifier">ZeroCrossingDown</span></dt>
<dd>internal event manager</dd>
<dt>events <span class="classifier-delimiter">:</span> <span class="classifier">list[ZeroCrossing]</span></dt>
<dd>internal zero crossing event</dd>
</dl>
</div>
`,params:{start:{type:"integer",default:"0",description:"counter start (initial condition)"},threshold:{type:"number",default:"0.0",description:"threshold for zero crossing Attributes ----------"}},inputs:["in"],outputs:["out"]},Relay:{blockClass:"Relay",description:"Relay block with hysteresis (Schmitt trigger).",docstringHtml:`<p>Relay block with hysteresis (Schmitt trigger).</p>
<p>Switches output between two values based on input crossing upper and lower
thresholds. The hysteresis prevents rapid switching when input is noisy.</p>
<p>When input rises above <cite>threshold_up</cite>, output switches to <cite>value_up</cite>.
When input falls below <cite>threshold_down</cite>, output switches to <cite>value_down</cite>.</p>
<div class="section" id="examples">
<h3>Examples</h3>
<p>Basic thermostat that turns heater on below 19Â°C, off above 21Â°C:</p>
<pre class="code python literal-block">
from pathsim.blocks import Relay

thermostat = Relay(
    threshold_up=21.0,
    threshold_down=19.0,
    value_up=0.0,
    value_down=1.0
    )
</pre>
</div>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>threshold_up <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>threshold for transitioning to upper relay state <cite>value_up</cite> (default: 1.0)</dd>
<dt>threshold_down <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>threshold for transitioning to lower relay state <cite>value_down</cite> (default: 0.0)</dd>
<dt>value_up <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>value for upper relay state (default: 1.0)</dd>
<dt>value_down <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>value for lower relay state (default: 0.0)</dd>
</dl>
</div>
<div class="section" id="attributes">
<h3>Attributes</h3>
<dl class="docutils">
<dt>events <span class="classifier-delimiter">:</span> <span class="classifier">list[ZeroCrossingUp, ZeroCrossingDown]</span></dt>
<dd>internal zero crossing events for relay state transitions</dd>
</dl>
</div>
`,params:{threshold_up:{type:"number",default:"1.0",description:"threshold for transitioning to upper relay state `value_up` (default: 1.0)"},threshold_down:{type:"number",default:"0.0",description:"threshold for transitioning to lower relay state `value_down` (default: 0.0)"},value_up:{type:"number",default:"1.0",description:"value for upper relay state (default: 1.0)"},value_down:{type:"number",default:"0.0",description:"value for lower relay state (default: 0.0)"}},inputs:["in"],outputs:["out"]},Scope:{blockClass:"Scope",description:"Block for recording time domain data with variable sampling period.",docstringHtml:`<p>Block for recording time domain data with variable sampling period.</p>
<p>A time threshold can be set by <cite>t_wait</cite> to start recording data after the simulation
time is larger then the specified waiting time, i.e. <cite>t - t_wait &gt; 0</cite>.
This is useful for recording data only after all the transients have settled.</p>
<p>The block uses an internal <cite>Schedule</cite> event, when <cite>sampling_period</cite> is provided,
otherwise it just samples at every simulation timestep.</p>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>sampling_period <span class="classifier-delimiter">:</span> <span class="classifier">float, None</span></dt>
<dd>time between samples, default is every timestep</dd>
<dt>t_wait <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>wait time before starting recording, optional</dd>
<dt>labels <span class="classifier-delimiter">:</span> <span class="classifier">list[str]</span></dt>
<dd>labels for the scope traces, and for the csv, optional</dd>
</dl>
</div>
<div class="section" id="attributes">
<h3>Attributes</h3>
<dl class="docutils">
<dt>recording_time <span class="classifier-delimiter">:</span> <span class="classifier">list[float]</span></dt>
<dd>recorded time points</dd>
<dt>recording_data <span class="classifier-delimiter">:</span> <span class="classifier">list[float]</span></dt>
<dd>recorded data points</dd>
<dt>_incremental_idx <span class="classifier-delimiter">:</span> <span class="classifier">int</span></dt>
<dd>index for incremental reading of accumulated data since last
call of incremental read</dd>
<dt>_sample_next_timestep <span class="classifier-delimiter">:</span> <span class="classifier">bool</span></dt>
<dd>flag to indicate this is a timestep to sample, only used for
event based sampling when <cite>sampling_period</cite> is provided as an arg</dd>
<dt>events <span class="classifier-delimiter">:</span> <span class="classifier">list[Schedule]</span></dt>
<dd>internal scheduled event for periodic input sampling when
<cite>sampling_period</cite> is provided</dd>
</dl>
</div>
`,params:{sampling_period:{type:"any",default:null,description:"time between samples, default is every timestep"},t_wait:{type:"number",default:"0.0",description:"wait time before starting recording, optional"},labels:{type:"any",default:null,description:"labels for the scope traces, and for the csv, optional"}},inputs:null,outputs:[]},Spectrum:{blockClass:"Spectrum",description:"Block for fourier spectrum analysis (spectrum analyzer).",docstringHtml:`<p>Block for fourier spectrum analysis (spectrum analyzer).</p>
<p>Computes continuous time running fourier transform (RFT) of the incoming signal.</p>
<p>A time threshold can be set by 't_wait' to start recording data only after the
simulation time is larger then the specified waiting time, i.e. 't - t_wait &gt; dt'.
This is useful for recording the steady state after all the transients have settled.</p>
<p>An exponential forgetting factor 'alpha' can be specified for realtime spectral
analysis. It biases the spectral components exponentially to the most recent signal
values by applying a single sided exponential window like this:</p>
<div class="math">
\\begin{equation*}
\\int_0^t u(\\tau) \\exp(\\alpha (t-\\tau))  \\exp(-j \\omega \\tau)\\ d \\tau
\\end{equation*}
</div>
<p>It is also known as the 'exponentially forgetting transform' (EFT) and a form of
short time fourier transform (STFT). It is implemented as a 1st order statespace model</p>
<div class="math">
\\begin{equation*}
\\dot{x} = - \\alpha  x +  \\exp(-j \\omega t) u
\\end{equation*}
</div>
<p>where 'u' is the input signal and 'x' is the state variable that represents the
complex fourier coefficient to the frequency 'omega'. The ODE is integrated using the
numerical integration engine of the block.</p>
<div class="section" id="example">
<h3>Example</h3>
<p>This is how to initialize it:</p>
<pre class="code python literal-block">
import numpy as np

#linear frequencies (0Hz, DC -&gt; 1kHz)
sp1 = Spectrum(
    freq=np.linspace(0, 1e3, 100),
    labels=['x1', 'x2'] #labels for two inputs
    )

#log frequencies (1Hz -&gt; 1kHz)
sp2 = Spectrum(
    freq=np.logspace(0, 3, 100)
    )

#log frequencies including DC (0Hz, DC + 1Hz -&gt; 1kHz)
sp3 = Spectrum(
    freq=np.hstack([0.0, np.logspace(0, 3, 100)])
    )

#arbitrary frequencies
sp4 = Spectrum(
    freq=np.array([0, 0.5, 20, 1e3])
    )
</pre>
</div>
<div class="section" id="note">
<h3>Note</h3>
<p>This block is relatively slow! But it is valuable for long running simulations
with few evaluation frequencies, where just FFT'ing the time series data
wouldnt be efficient OR if only the evaluation at weirdly spaced frequencies
is required. Otherwise its more efficient to just do an FFT on the time
series recording after the simulation has finished.</p>
</div>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>freq <span class="classifier-delimiter">:</span> <span class="classifier">array[float]</span></dt>
<dd>list of evaluation frequencies for RFT, can be arbitrarily spaced</dd>
<dt>t_wait <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>wait time before starting RFT</dd>
<dt>alpha <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>exponential forgetting factor for realtime spectrum</dd>
<dt>labels <span class="classifier-delimiter">:</span> <span class="classifier">list[str]</span></dt>
<dd>labels for the inputs</dd>
</dl>
</div>
`,params:{freq:{type:"array",default:"[]",description:"list of evaluation frequencies for RFT, can be arbitrarily spaced"},t_wait:{type:"number",default:"0.0",description:"wait time before starting RFT"},alpha:{type:"number",default:"0.0",description:"exponential forgetting factor for realtime spectrum"},labels:{type:"array",default:"[]",description:"labels for the inputs"}},inputs:null,outputs:[]},Subsystem:{blockClass:"Subsystem",description:"Subsystem class that holds its own blocks and connecions and",docstringHtml:`<p>Subsystem class that holds its own blocks and connecions and
can natively interface with the main simulation loop.</p>
<p>IO interface is realized by a special 'Interface' block, that has extra
methods for setting and getting inputs and outputs and serves
as the interface of the internal blocks to the outside.</p>
<p>The subsystem doesnt use its 'inputs' and 'outputs' dicts directly.
It exclusively handles data transfer via the 'Interface' block.</p>
<p>This class can be used just like any other block during the simulation,
since it implements the required methods 'update' for the fixed-point
iteration (resolving algebraic loops with instant time blocks),
the 'step' method that performs timestepping (especially for dynamic
blocks with internal states) and the 'solve' method for solving the
implicit update equation for implicit solvers.</p>
<div class="section" id="example">
<h3>Example</h3>
<p>This is how we can wrap up multiple blocks within a subsystem.
In this case vanderpol system built from discrete components
instead of using an ODE block (in practice you should use
a monolithic ODE whenever possible due to performance).</p>
<pre class="code python literal-block">
from pathsim import Subsystem, Interface, Connection
from pathsim.blocks import Integrator, Function

#van der Pol parameter
mu = 1000

#blocks in the subsystem
If = Interface() # this is the interface to the outside
I1 = Integrator(2)
I2 = Integrator(0)
Fn = Function(lambda x1, x2: mu*(1 - x1**2)*x2 - x1)

sub_blocks = [If, I1, I2, Fn]

#connections in the subsystem
sub_connections = [
    Connection(I2, I1, Fn[1], If[1]),
    Connection(I1, Fn, If),
    Connection(Fn, I2)
    ]

#the subsystem acts just like a normal block
vdp = Subsystem(sub_blocks, sub_connections)
</pre>
</div>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>blocks <span class="classifier-delimiter">:</span> <span class="classifier">list[Block] | None</span></dt>
<dd>internal blocks of the subsystem</dd>
<dt>connections <span class="classifier-delimiter">:</span> <span class="classifier">list[Connection] | None</span></dt>
<dd>internal connections of the subsystem</dd>
</dl>
<p>events : list[Event] | None
tolerance_fpi : float</p>
<blockquote>
absolute tolerance for convergence of algebraic loops
default see Â´SIM_TOLERANCE_FPIÂ´ in Â´_constants.pyÂ´</blockquote>
<dl class="docutils">
<dt>iterations_max <span class="classifier-delimiter">:</span> <span class="classifier">int</span></dt>
<dd>maximum allowed number of iterations for algebraic loop
solver, default see Â´SIM_ITERATIONS_MAXÂ´ in Â´_constants.pyÂ´</dd>
</dl>
</div>
<div class="section" id="attributes">
<h3>Attributes</h3>
<dl class="docutils">
<dt>interface <span class="classifier-delimiter">:</span> <span class="classifier">Interface</span></dt>
<dd>internal interface block for data transfer to the outside</dd>
<dt>graph <span class="classifier-delimiter">:</span> <span class="classifier">Graph</span></dt>
<dd>internal graph representation for fast system funcion
evluations using DAG with algebraic depths</dd>
<dt>boosters <span class="classifier-delimiter">:</span> <span class="classifier">None | list[ConnectionBooster]</span></dt>
<dd>list of boosters (fixed point accelerators) that wrap
algebraic loop closing connections assembled from the
system graph</dd>
</dl>
</div>
`,params:{},inputs:[],outputs:[]},Interface:{blockClass:"Interface",description:"Bare-bone block that serves as a data interface for the 'Subsystem' class.",docstringHtml:`<p>Bare-bone block that serves as a data interface for the 'Subsystem' class.</p>
<p>It works like this:</p>
<ul class="simple">
<li>Internal blocks of the subsystem are connected to the inputs and outputs
of this Interface block via the internal connections.</li>
<li>It behaves like a normal block (inherits the main 'Block' class methods).</li>
<li>It implements some special methods to get and set the inputs and outputs
of the blocks, that are used to translate between the internal blocks of the
subsystem and the inputs and outputs of the subsystem.</li>
<li>Handles data transfer to and from the internal subsystem blocks
to and from the inputs and outputs of the subsystem.</li>
</ul>
`,params:{},inputs:[],outputs:[]},Process:{blockClass:"Process",description:"Simplified version of the `ResidenceTime` model block",docstringHtml:`<p>Simplified version of the <cite>ResidenceTime</cite> model block
with all inputs being summed equally and only the state
and the flux being returned to the output</p>
<p>This block implements an internal 1st order linear ode with
multiple inputs, outputs and no direct passthrough.</p>
<p>The internal ODE with inputs <span class="math">\\(u_i\\)</span> :</p>
<div class="math">
\\begin{equation*}
\\dot{x} = - x / \\tau + \\mathrm{src} + \\sum_i u_i
\\end{equation*}
</div>
<p>And the output equations for output <cite>i=0</cite> and <cite>i=1</cite>:</p>
<div class="math">
\\begin{equation*}
y_0 = x
\\end{equation*}
</div>
<div class="math">
\\begin{equation*}
y_1 = x / \\tau
\\end{equation*}
</div>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>tau <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>residence time, inverse natural frequency (eigenvalue)</dd>
<dt>initial_value <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>initial value of state / initial quantity of process</dd>
<dt>source_term <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>constant source term / generation term of the process</dd>
</dl>
</div>
`,params:{tau:{type:"integer",default:"1",description:"residence time, inverse natural frequency (eigenvalue)"},initial_value:{type:"integer",default:"0",description:"initial value of state / initial quantity of process"},source_term:{type:"integer",default:"0",description:"constant source term / generation term of the process"}},inputs:null,outputs:["x","x/tau"]},Bubbler4:{blockClass:"Bubbler4",description:"Tritium bubbling system with sequential vial collection stages.",docstringHtml:`<p>Tritium bubbling system with sequential vial collection stages.</p>
<p>This block models a tritium collection system used in fusion reactor blanket
purge gas processing. The system bubbles tritium-containing gas through a series
of liquid-filled vials to capture and concentrate tritium for measurement and
inventory tracking.</p>
<div class="section" id="physical-description">
<h3>Physical Description</h3>
<p>The bubbler consists of two parallel processing chains:</p>
<p><strong>Soluble Chain (Vials 1-2):</strong>
Tritium already in soluble forms (HTO, HT) flows sequentially through
vials 1 and 2. Each vial has a collection efficiency <span class="math">\\(\\eta_{vial}\\)</span>,
representing the fraction of tritium that dissolves into the liquid phase
and is retained.</p>
<p><strong>Insoluble Chain (Vials 3-4):</strong>
Tritium in insoluble forms (Tâ, organically bound) first undergoes catalytic
conversion to soluble forms with efficiency <span class="math">\\(\\alpha_{conv}\\)</span>. The
converted tritium, along with uncaptured soluble tritium from the first chain,
then flows through vials 3 and 4 with the same collection efficiency.</p>
</div>
<div class="section" id="mathematical-formulation">
<h3>Mathematical Formulation</h3>
<p>The system is governed by the following differential equations for the
vial inventories <span class="math">\\(x_i\\)</span>:</p>
<div class="math">
\\begin{equation*}
\\frac{dx_1}{dt} &amp;= \\eta_{vial} \\cdot u_{sol}
\\end{equation*}
</div>
<div class="math">
\\begin{equation*}
\\frac{dx_2}{dt} &amp;= \\eta_{vial} \\cdot (1-\\eta_{vial}) \\cdot u_{sol}
\\end{equation*}
</div>
<div class="math">
\\begin{equation*}
\\frac{dx_3}{dt} &amp;= \\eta_{vial} \\cdot [\\alpha_{conv} \\cdot u_{insol} + (1-\\eta_{vial})^2 \\cdot u_{sol}]
\\end{equation*}
</div>
<div class="math">
\\begin{equation*}
\\frac{dx_4}{dt} &amp;= \\eta_{vial} \\cdot (1-\\eta_{vial}) \\cdot [\\alpha_{conv} \\cdot u_{insol} + (1-\\eta_{vial})^2 \\cdot u_{sol}]
\\end{equation*}
</div>
<p>The sample output represents uncaptured tritium exiting the system:</p>
<div class="math">
\\begin{equation*}
y_{sample} = (1-\\alpha_{conv}) \\cdot u_{insol} + (1-\\eta_{vial})^2 \\cdot [\\alpha_{conv} \\cdot u_{insol} + (1-\\eta_{vial})^2 \\cdot u_{sol}]
\\end{equation*}
</div>
<dl class="docutils">
<dt>Where:</dt>
<dd><ul class="first last simple">
<li><span class="math">\\(u_{sol}\\)</span> = soluble tritium input flow rate</li>
<li><span class="math">\\(u_{insol}\\)</span> = insoluble tritium input flow rate</li>
<li><span class="math">\\(\\eta_{vial}\\)</span> = vial collection efficiency</li>
<li><span class="math">\\(\\alpha_{conv}\\)</span> = conversion efficiency from insoluble to soluble</li>
<li><span class="math">\\(x_i\\)</span> = tritium inventory in vial i</li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>conversion_efficiency <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>Conversion efficiency from insoluble to soluble forms (<span class="math">\\(\\alpha_{conv}\\)</span>),
between 0 and 1.</dd>
<dt>vial_efficiency <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>Collection efficiency of each vial (<span class="math">\\(\\eta_{vial}\\)</span>), between 0 and 1.</dd>
<dt>replacement_times <span class="classifier-delimiter">:</span> <span class="classifier">float | list[float] | list[list[float]]</span></dt>
<dd>Times at which each vial is replaced with a fresh one. If None, no
replacement events are created. If a single value is provided, it is
used for all vials. If a single list of floats is provided, it will be
used for all vials. If a list of lists is provided, each sublist
corresponds to the replacement times for each vial.</dd>
</dl>
</div>
<div class="section" id="notes">
<h3>Notes</h3>
<p>Vial replacement is modeled as instantaneous reset events that set the
corresponding vial inventory to zero, simulating the physical replacement
of a full vial with an empty one.</p>
</div>
`,params:{conversion_efficiency:{type:"number",default:"0.9",description:"Conversion efficiency from insoluble to soluble forms (:math:`\\alpha_{conv}`), between 0 and 1."},vial_efficiency:{type:"number",default:"0.9",description:"Collection efficiency of each vial (:math:`\\eta_{vial}`), between 0 and 1."},replacement_times:{type:"any",default:null,description:"Times at which each vial is replaced with a fresh one. If None, no replacement events are created. If a single value is provided, it is used for all vials. If a single list of floats is provided, it will be used for all vials. If a list of lists is provided, each sublist corresponds to the replacement times for each vial."}},inputs:["sample_in_soluble","sample_in_insoluble"],outputs:["vial1","vial2","vial3","vial4","sample_out"]},Splitter:{blockClass:"Splitter",description:"Splitter block that splits the input signal into multiple",docstringHtml:`<p>Splitter block that splits the input signal into multiple
outputs weighted with the specified fractions.</p>
<div class="section" id="note">
<h3>Note</h3>
<p>The output fractions must sum to one.</p>
</div>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>fractions <span class="classifier-delimiter">:</span> <span class="classifier">np.ndarray | list</span></dt>
<dd>fractions to split the input signal into,
must sum up to one</dd>
</dl>
</div>
`,params:{fractions:{type:"any",default:null,description:"fractions to split the input signal into, must sum up to one"}},inputs:["in"],outputs:null},GLC:{blockClass:"GLC",description:"Gas Liquid Contactor model block.",docstringHtml:`<p>Gas Liquid Contactor model block. Inherits from Function block.</p>
<p>More details about the model can be found in: <a class="reference external" href="https://doi.org/10.13182/FST95-A30485">https://doi.org/10.13182/FST95-A30485</a></p>
<dl class="docutils">
<dt>Args:</dt>
<dd>P_in: Inlet operating pressure [Pa]
L: Column height [m]
D: Column diameter [m]
T: Temperature [K]
g: Gravitational acceleration [m/s^2], default is 9.81
initial_nb_of_elements: Initial number of elements for BVP solver
BCs: Boundary conditions type, &quot;C-C&quot; (Closed-Closed) or &quot;O-C&quot; (Open-Closed), default is &quot;C-C&quot;</dd>
</dl>
`,params:{P_in:{type:"any",default:null,description:"L: Column height [m]"},L:{type:"any",default:null,description:"D: Column diameter [m]"},D:{type:"any",default:null,description:"T: Temperature [K]"},T:{type:"any",default:null,description:"g: Gravitational acceleration [m/s^2], default is 9.81"},BCs:{type:"any",default:null,description:""},g:{type:"number",default:"9.80665",description:"initial_nb_of_elements: Initial number of elements for BVP solver"},initial_nb_of_elements:{type:"integer",default:"20",description:'BCs: Boundary conditions type, "C-C" (Closed-Closed) or "O-C" (Open-Closed), default is "C-C"'}},inputs:["c_T_in","flow_l","y_T2_inlet","flow_g"],outputs:["c_T_out","y_T2_out","eff","P_out","Q_l","Q_g_out","n_T_out_liquid","n_T_out_gas"]}},im={Sources:["Constant","Source","SinusoidalSource","StepSource","PulseSource","TriangleWaveSource","SquareWaveSource","GaussianPulseSource","ChirpPhaseNoiseSource","ClockSource","WhiteNoise","PinkNoise","RandomNumberGenerator"],Dynamic:["Integrator","Differentiator","Delay","ODE","DynamicalSystem","StateSpace","PT1","PT2","LeadLag","PID","AntiWindupPID","RateLimiter","Backlash","Deadband","TransferFunctionNumDen","TransferFunctionZPG","ButterworthLowpassFilter","ButterworthHighpassFilter","ButterworthBandpassFilter","ButterworthBandstopFilter"],Algebraic:["Adder","Multiplier","Amplifier","Function","Sin","Cos","Tan","Tanh","Abs","Sqrt","Exp","Log","Log10","Mod","Clip","Pow","Switch","LUT","LUT1D"],Mixed:["SampleHold","FIR","ADC","DAC","Counter","CounterUp","CounterDown","Relay"],Recording:["Scope","Spectrum"],Chemical:["Process","Bubbler4","Splitter","GLC"]},WS={ADC:"pathsim.blocks",Abs:"pathsim.blocks",Adder:"pathsim.blocks",Amplifier:"pathsim.blocks",AntiWindupPID:"pathsim.blocks",Backlash:"pathsim.blocks",Bubbler4:"pathsim_chem.tritium",ButterworthBandpassFilter:"pathsim.blocks",ButterworthBandstopFilter:"pathsim.blocks",ButterworthHighpassFilter:"pathsim.blocks",ButterworthLowpassFilter:"pathsim.blocks",ChirpPhaseNoiseSource:"pathsim.blocks",Clip:"pathsim.blocks",ClockSource:"pathsim.blocks",Constant:"pathsim.blocks",Cos:"pathsim.blocks",Counter:"pathsim.blocks",CounterDown:"pathsim.blocks",CounterUp:"pathsim.blocks",DAC:"pathsim.blocks",Deadband:"pathsim.blocks",Delay:"pathsim.blocks",Differentiator:"pathsim.blocks",DynamicalSystem:"pathsim.blocks",Exp:"pathsim.blocks",FIR:"pathsim.blocks",Function:"pathsim.blocks",GLC:"pathsim_chem.tritium",GaussianPulseSource:"pathsim.blocks",Integrator:"pathsim.blocks",LUT:"pathsim.blocks",LUT1D:"pathsim.blocks",LeadLag:"pathsim.blocks",Log:"pathsim.blocks",Log10:"pathsim.blocks",Mod:"pathsim.blocks",Multiplier:"pathsim.blocks",ODE:"pathsim.blocks",PID:"pathsim.blocks",PT1:"pathsim.blocks",PT2:"pathsim.blocks",PinkNoise:"pathsim.blocks",Pow:"pathsim.blocks",Process:"pathsim_chem.tritium",PulseSource:"pathsim.blocks",RandomNumberGenerator:"pathsim.blocks",RateLimiter:"pathsim.blocks",Relay:"pathsim.blocks",SampleHold:"pathsim.blocks",Scope:"pathsim.blocks",Sin:"pathsim.blocks",SinusoidalSource:"pathsim.blocks",Source:"pathsim.blocks",Spectrum:"pathsim.blocks",Splitter:"pathsim_chem.tritium",Sqrt:"pathsim.blocks",SquareWaveSource:"pathsim.blocks",StateSpace:"pathsim.blocks",StepSource:"pathsim.blocks",Switch:"pathsim.blocks",Tan:"pathsim.blocks",Tanh:"pathsim.blocks",TransferFunctionNumDen:"pathsim.blocks",TransferFunctionZPG:"pathsim.blocks",TriangleWaveSource:"pathsim.blocks",WhiteNoise:"pathsim.blocks"};function KS(e){if(e==null||e==="None"||e==="")return null;let t=String(e).trim();return t.length===0||((t.startsWith("'")&&t.endsWith("'")||t.startsWith('"')&&t.endsWith('"'))&&(t=t.slice(1,-1)),t.length===0)?null:[...t]}const jS={Scope:{param:"labels",direction:"input"},Spectrum:{param:"labels",direction:"input"},Adder:{param:"operations",direction:"input",parser:KS}};function XS(e){const t=jS[e];return t?Array.isArray(t)?t:[t]:[]}const GS=new Set(["Integrator","Differentiator","Delay","Amplifier","Sin","Cos","Tan","Tanh","Abs","Sqrt","Exp","Log","Log10","Mod","Clip","Pow","SampleHold"]);class US{nodes=new Map;byCategory=new Map;register(t){this.nodes.set(t.type,t);const n=this.byCategory.get(t.category)||[];n.push(t),this.byCategory.set(t.category,n)}get(t){return this.nodes.get(t)}getByCategory(t){return this.byCategory.get(t)||[]}getAllCategories(){return Array.from(this.byCategory.keys())}getAll(){return Array.from(this.nodes.values())}has(t){return this.nodes.has(t)}get size(){return this.nodes.size}}const Qt=new US;function YS(e,t,n){const i={};for(const[c,u]of Object.entries(n.params))i[c]={type:u.type,default:u.default,description:u.description,min:u.min,max:u.max,options:u.options};let s,o;n.inputs===null?(s=void 0,o=null):n.inputs.length>0?(s=n.inputs,o=n.inputs.length):(s=[],o=0);let a,l;n.outputs===null?(a=void 0,l=null):n.outputs.length>0?(a=n.outputs,l=n.outputs.length):(a=[],l=0);const d=tf({name:e,category:t,blockClass:n.blockClass,description:n.description,inputs:s,outputs:a,maxInputs:o,maxOutputs:l,syncPorts:GS.has(e),params:i});n.docstringHtml&&(d.docstring=n.docstringHtml),Qt.register(d)}function ZS(){for(const[e,t]of Object.entries(im))for(const n of t){const i=bc[n];i?YS(n,e,i):console.warn(`Block "${n}" not found in extracted blocks`)}}ZS();const Pd=tf({name:"Subsystem",category:"Subsystem",description:"",blockClass:"Subsystem",inputs:[],outputs:[],minInputs:0,minOutputs:0,maxInputs:null,maxOutputs:null,shape:"rect",params:{}}),Md=tf({name:"Interface",category:"Subsystem",description:"",blockClass:"Interface",inputs:[],outputs:[],minInputs:0,minOutputs:0,maxInputs:null,maxOutputs:null,shape:"rect",params:{}});function JS(){const e=bc.Subsystem,t=bc.Interface;e&&(Pd.description=e.description,Pd.docstring=e.docstringHtml),t&&(Md.description=t.description,Md.docstring=t.docstringHtml),Qt.register(Pd),Qt.register(Md)}JS();const sm=new Map;function ir(e){sm.set(e.id,e)}function Op(e){return sm.get(e)}ir({id:"pill",name:"Pill",cssClass:"shape-pill",borderRadius:"20px",svgRadius:20});ir({id:"rect",name:"Rectangle",cssClass:"shape-rect",borderRadius:"4px",svgRadius:4});ir({id:"circle",name:"Circle",cssClass:"shape-circle",borderRadius:"16px",svgRadius:16});ir({id:"diamond",name:"Diamond",cssClass:"shape-diamond",borderRadius:"4px",svgRadius:4});ir({id:"mixed",name:"Mixed",cssClass:"shape-mixed",borderRadius:"12px 4px 12px 4px",svgRadius:[12,4,12,4]});ir({id:"default",name:"Default",cssClass:"shape-default",borderRadius:"8px",svgRadius:8});const QS={Sources:"pill",Dynamic:"rect",Algebraic:"rect",Mixed:"mixed",Recording:"pill",Subsystem:"rect"};function $S(e){return QS[e]||"default"}const yt={SUBSYSTEM:"Subsystem",INTERFACE:"Interface"};function om(e){if(e.shape){const i=Op(e.shape);if(i)return i.cssClass}const t=$S(e.category);return Op(t)?.cssClass||"shape-default"}function _i(e){return("type"in e,e.type)===yt.SUBSYSTEM}function Kr(e){return("type"in e,e.type)===yt.INTERFACE}const gr=nt(null),nf={subscribe:gr.subscribe,open(e){gr.set(e)},close(){gr.set(null)},isOpen(){return de(gr)!==null},getOpenId(){return de(gr)}},Ul=e=>nf.open(e),Ad=()=>nf.close();function rn(){return crypto.randomUUID()}const sn=nt(new Map),Ms=nt([]),sr=nt(new Map),Tt=nt([]),yn=nt(new Set);function eC(e){if(e.length===0)return null;let t=de(sn),n=null;for(let i=0;i<e.length;i++){const s=t.get(e[i]);if(!s||s.type!==yt.SUBSYSTEM)return null;n=s,i<e.length-1&&s.graph&&(t=new Map(s.graph.nodes.map(o=>[o.id,o])))}return n}function hn(){const e=de(Tt);if(e.length===0)return{nodes:de(sn),connections:de(Ms),annotations:de(sr),events:new Map};const t=eC(e);if(!t||!t.graph)return{nodes:new Map,connections:[],annotations:new Map,events:new Map};const n=t.graph.nodes.map(i=>i.type===yt.INTERFACE?{...i,name:t.name,color:t.color,outputs:t.inputs.map((s,o)=>({id:`${i.id}-output-${o}`,nodeId:i.id,name:`in ${o}`,direction:"output",index:o,color:s.color})),inputs:t.outputs.map((s,o)=>({id:`${i.id}-input-${o}`,nodeId:i.id,name:`out ${o}`,direction:"input",index:o,color:s.color}))}:i);return{nodes:new Map(n.map(i=>[i.id,i])),connections:t.graph.connections,annotations:new Map((t.graph.annotations||[]).map(i=>[i.id,i])),events:new Map((t.graph.events||[]).map(i=>[i.id,i]))}}function qn(e,t){e.length!==0&&sn.update(n=>{const i=new Map(n),s=(o,a)=>{if(a.length===0)return o;const[l,...d]=a,c=o.get(l);if(!c||c.type!==yt.SUBSYSTEM)return o;const u=new Map(o);if(d.length===0){const p=t(c.graph||{nodes:[],connections:[]});u.set(l,{...c,graph:p})}else{const p=new Map((c.graph?.nodes||[]).map(h=>[h.id,h])),f=s(p,d);u.set(l,{...c,graph:{nodes:Array.from(f.values()),connections:c.graph?.connections||[],annotations:c.graph?.annotations,events:c.graph?.events}})}return u};return s(i,e)})}function sf(e,t){const n=de(Tt);n.length===0?sn.update(e):qn(n,i=>({...i,nodes:t(i.nodes)}))}function eo(e,t){sf(n=>{const i=n.get(e);if(i){const s=new Map(n);return s.set(e,t(i)),s}return n},n=>n.map(i=>i.id===e?t(i):i))}function tC(e){sf(t=>{const n=new Map(t);return n.set(e.id,e),n},t=>[...t,e])}function of(e){const t=de(Tt);t.length===0?Ms.update(e):qn(t,n=>({...n,connections:e(n.connections)}))}function Wc(e,t,n){const i=de(Tt);i.length===0?(sn.update(e),Ms.update(n)):qn(i,s=>({...s,nodes:t(s.nodes),connections:n(s.connections)}))}function Kc(e,t){const n=de(Tt);n.length===0?sr.update(e):qn(n,i=>({...i,annotations:t(i.annotations||[])}))}function nC(){return de(Tt).length===0}const af=ci([sn,Tt],()=>hn().nodes),iC=ci([sn,Ms,Tt],()=>hn().connections),sC=ci([sn,sr,Tt],()=>hn().annotations),oC=ci([sn,Tt],()=>hn().events),aC=ci(af,e=>Array.from(e.values())),rC=ci([af,yn],([e,t])=>Array.from(t).map(n=>e.get(n)).filter(n=>n!==void 0)),lC=ci([sn,Tt],([e,t])=>{const n=[{id:"",name:"Root"}];let i=e;for(const s of t){const o=i.get(s);o&&o.type===yt.SUBSYSTEM&&(n.push({id:s,name:o.name}),o.graph&&(i=new Map(o.graph.nodes.map(a=>[a.id,a]))))}return n}),_n={DEFAULT:11,MIN:8,MAX:24,STEP:1};function cC(e){const t=rn(),n={id:t,position:e,content:"",width:200,height:100,fontSize:_n.DEFAULT};return Kc(i=>{const s=new Map(i);return s.set(t,n),s},i=>[...i,n]),t}function am(e,t){Kc(n=>{const i=n.get(e);if(i){const s=new Map(n);return s.set(e,{...i,...t}),s}return n},n=>n.map(i=>i.id===e?{...i,...t}:i))}function dC(e,t){am(e,{position:t})}function uC(e){Kc(t=>{const n=new Map(t);return n.delete(e),n},t=>t.filter(n=>n.id!==e))}function fC(e){return hn().annotations.get(e)}const Yl=nt({top:100,right:20,bottom:20,left:70});function pC(e){Yl.set(e)}const rm=nt(0);function Qi(){rm.update(e=>e+1)}const lm=nt(0),cm=nt(0);function hC(){lm.update(e=>e+1)}function gC(){cm.update(e=>e+1)}const dm=nt({x:0,y:0,id:0});function mC(e){dm.update(t=>({...e,id:t.id+1}))}const um=nt({nodeId:"",id:0});function vC(e){um.update(t=>({nodeId:e,id:t.id+1}))}const fm=nt(0);function Mr(){fm.update(e=>e+1)}const pm=nt({x:0,y:0,id:0});function yC(e){pm.update(t=>({...e,id:t.id+1}))}const hm=nt({nodeIds:[],addToSelection:!1,id:0});function bi(e,t=!1){hm.update(n=>({nodeIds:e,addToSelection:t,id:n.id+1}))}const gm=nt({annotationId:"",id:0});function bC(e){gm.update(t=>({annotationId:e,id:t.id+1}))}const mm=nt({nodeId:"",position:{x:0,y:0},cursorScreen:null,id:0});function wC(e,t,n){mm.update(i=>({nodeId:e,position:t,cursorScreen:n??null,id:i.id+1}))}let uu=null,fu=null;function _C(e){uu=e}function xi(e){return uu?uu(e):e}function xC(e){fu=e}function zp(){return fu?fu():!1}function kC(){const e=document.querySelector(".svelte-flow");if(!e)return{x:400,y:300};const t=e.getBoundingClientRect(),n={x:t.left+t.width/2,y:t.top+t.height/2};return xi(n)}function SC(e){Tt.update(t=>[...t,e]),yn.set(new Set),setTimeout(()=>Qi(),0)}function CC(){Tt.update(e=>e.slice(0,-1)),yn.set(new Set),setTimeout(()=>Qi(),0)}function EC(e){const t=de(Tt).length;e!==t&&(Tt.update(n=>n.slice(0,e)),yn.set(new Set),setTimeout(()=>Qi(),0))}function TC(e){Tt.set(e),yn.set(new Set),setTimeout(()=>Qi(),0)}function IC(){return de(Tt).length===0}function NC(){return de(Tt)}function Lp(e,t,n){return n.map((i,s)=>({id:`${e}-${t}-${s}`,nodeId:e,name:i.name,direction:t,index:s,color:i.color||Wr.default}))}function vm(e,t){for(const n of e)if(n.type===yt.SUBSYSTEM&&n.graph){if(n.graph.nodes.some(o=>o.id===t))return n;const s=vm(n.graph.nodes,t);if(s)return s}return null}function ym(e,t,n){const i=n??rn(),s={...e,id:i,position:{...t},inputs:e.inputs.map((o,a)=>({...o,id:`${i}-input-${a}`,nodeId:i})),outputs:e.outputs.map((o,a)=>({...o,id:`${i}-output-${a}`,nodeId:i}))};return s.graph&&(s.graph=rf(s.graph)),s}function rf(e){const t=new Map,n=e.nodes.map(a=>{const l=rn();t.set(a.id,l);const d={...a,id:l,inputs:a.inputs.map((c,u)=>({...c,id:`${l}-input-${u}`,nodeId:l})),outputs:a.outputs.map((c,u)=>({...c,id:`${l}-output-${u}`,nodeId:l}))};return d.graph&&(d.graph=rf(d.graph)),d}),i=e.connections.map(a=>({...a,id:rn(),sourceNodeId:t.get(a.sourceNodeId)||a.sourceNodeId,targetNodeId:t.get(a.targetNodeId)||a.targetNodeId})),s=e.events?.map(a=>({...a,id:rn()})),o=e.annotations?.map(a=>({...a,id:rn()}));return{nodes:n,connections:i,events:s,annotations:o}}const Hp={input:e=>`in ${e}`,output:e=>`out ${e}`},PC=/-input-(\d+)$/,MC=/-output-(\d+)$/,Qa={input:(e,t)=>`${e}-input-${t}`,output:(e,t)=>`${e}-output-${t}`,parseIndex:(e,t)=>{const n=t==="input"?PC:MC,i=e.match(n);return i?parseInt(i[1],10):null},parseConnection:(e,t)=>({sourceIndex:Qa.parseIndex(e,"output"),targetIndex:Qa.parseIndex(t,"input")})};function lf(e){return{portsKey:e==="input"?"inputs":"outputs",oppositeKey:e==="input"?"outputs":"inputs",minKey:e==="input"?"minInputs":"minOutputs",maxKey:e==="input"?"maxInputs":"maxOutputs",connectionKey:e==="input"?"targetNodeId":"sourceNodeId",connectionIndexKey:e==="input"?"targetPortIndex":"sourcePortIndex",defaultName:e==="input"?"in":"out"}}function bm(e,t,n){const i=s=>{const o=s.get(t);if(!o)return s;const a=new Map(s);return a.set(t,n(o)),a};e.length===0?sn.update(i):qn(e,s=>({...s,nodes:Array.from(i(new Map(s.nodes.map(o=>[o.id,o]))).values())}))}function cf(e,t,n=!1){const s=hn().nodes.get(e);if(!s)return!1;const o=lf(t),a=de(Tt);if(s.type===yt.INTERFACE&&a.length>0){const h=a[a.length-1],g=a.slice(0,-1),y=o.oppositeKey,b=t==="input"?"output":"input";return bm(g,h,m=>{const x=m[y],S=x.length;return{...m,[y]:[...x,{id:Qa[b](h,S),nodeId:h,name:Hp[b](S),direction:b,index:S,color:Wr.default}]}}),!0}const l=Qt.get(s.type),d=l?.ports[o.maxKey],c=s[o.portsKey];if(d!=null&&c.length>=d)return!1;const u=c.length,p=l?.ports[o.portsKey]?.[u],f={id:Qa[t](e,u),nodeId:e,name:p?.name||Hp[t](u),direction:t,index:u,color:p?.color||Wr.default};return eo(e,h=>({...h,[o.portsKey]:[...h[o.portsKey],f]})),!n&&t==="input"&&l?.ports.syncPorts&&cf(e,"output",!0),!0}function df(e,t,n=!1){const s=hn().nodes.get(e);if(!s)return!1;const o=lf(t),a=Qt.get(s.type),l=a?.ports[o.minKey]??1,d=s[o.portsKey];if(d.length<=l)return!1;const c=de(Tt);if(s.type===yt.INTERFACE&&c.length>0){const p=c[c.length-1],f=c.slice(0,-1),h=o.oppositeKey;bm(f,p,g=>{const y=g[h];return y.length===0?g:{...g,[h]:y.slice(0,-1)}})}const u=d.length-1;return Wc(p=>{const f=p.get(e);if(!f)return p;const h=new Map(p);return h.set(e,{...f,[o.portsKey]:f[o.portsKey].slice(0,-1)}),h},p=>p.map(f=>f.id===e?{...f,[o.portsKey]:f[o.portsKey].slice(0,-1)}:f),p=>p.filter(f=>{const h=f[o.connectionKey],g=f[o.connectionIndexKey];return!(h===e&&g>=u)})),!n&&t==="input"&&a?.ports.syncPorts&&df(e,"output",!0),!0}function AC(e){return cf(e,"input")}function DC(e){return cf(e,"output")}function RC(e){return df(e,"input")}function OC(e){return df(e,"output")}function zC(e){if(e==null||e==="None"||e==="")return null;const t=String(e).trim();if(!t.startsWith("[")||!t.endsWith("]"))return null;try{const n=t.replace(/'/g,'"'),i=JSON.parse(n);if(Array.isArray(i)&&i.every(s=>typeof s=="string"))return i}catch{}return null}function LC(e,t,n,i){const o=hn().nodes.get(e);if(!o)return;const a=i?i(t):zC(t),l=lf(n),d=o[l.portsKey],c=d.map((p,f)=>{const h=a&&f<a.length?a[f]:`${l.defaultName} ${f}`;return p.name===h?p:{...p,name:h}});c.some((p,f)=>p.name!==d[f].name)&&eo(e,p=>({...p,[l.portsKey]:c}))}function HC(e,t,n){const i=Qt.get(e);if(!i)return console.error(`Unknown node type: ${e}`),null;const s=rn(),o={id:s,type:e,name:n||i.name,position:t,inputs:Lp(s,"input",i.ports.inputs),outputs:Lp(s,"output",i.ports.outputs),params:{}};if(e===yt.SUBSYSTEM){const l={id:rn(),type:yt.INTERFACE,name:o.name,position:{x:100,y:100},inputs:[],outputs:[],params:{}};o.graph={nodes:[l],connections:[]}}return tC(o),o}function FC(e){const n=hn().nodes.get(e);if(n){if(n.type===yt.INTERFACE){console.warn("Interface blocks cannot be deleted");return}Wc(i=>{const s=new Map(i);return s.delete(e),s},i=>i.filter(s=>s.id!==e),i=>i.filter(s=>s.sourceNodeId!==e&&s.targetNodeId!==e)),yn.update(i=>{const s=new Set(i);return s.delete(e),s})}}function BC(e,t){eo(e,n=>({...n,position:{...t}}))}function qC(e,t){const i=hn().nodes.get(e);if(!i)return;const s=de(Tt);if(i.type===yt.INTERFACE&&s.length>0){const o=s.slice(0,-1),a=s[s.length-1];o.length===0?sn.update(l=>{const d=l.get(a);if(d){const c=new Map(l);return c.set(a,{...d,name:t}),c}return l}):qn(o,l=>({...l,nodes:l.nodes.map(d=>d.id===a?{...d,name:t}:d)}));return}eo(e,o=>({...o,name:t}))}function VC(e,t){const i=hn().nodes.get(e);if(!i)return;const s=de(Tt);if(i.type===yt.INTERFACE&&s.length>0){const o=s.slice(0,-1),a=s[s.length-1];o.length===0?sn.update(l=>{const d=l.get(a);if(d){const c=new Map(l);return c.set(a,{...d,color:t}),c}return l}):qn(o,l=>({...l,nodes:l.nodes.map(d=>d.id===a?{...d,color:t}:d)}));return}eo(e,o=>({...o,color:t}))}function WC(e,t){eo(e,i=>({...i,params:{...i.params,...t}}));const n=hn().nodes.get(e);if(n)for(const i of XS(n.type))i.param in t&&LC(e,t[i.param],i.direction,i.parser)}function KC(e,t){eo(e,n=>({...n,...t}))}function jC(e){return hn().nodes.get(e)}function XC(){const e=[],t=n=>{for(const i of n)e.push(i),i.graph&&t(i.graph.nodes)};return t(Array.from(de(sn).values())),e}function GC(){const e=de(yn);if(e.size===0)return[];const t=hn(),n=[],i=[],s={x:50,y:50},o=new Map,a=[],l=[];e.forEach(p=>{const f=t.annotations.get(p);if(f){const b=rn(),m={...f,id:b,position:{x:f.position.x+s.x,y:f.position.y+s.y}};l.push(m),i.push(b);return}const h=t.nodes.get(p);if(!h||h.type===yt.INTERFACE)return;const g=rn();o.set(p,g);const y={id:g,type:h.type,name:h.name,position:{x:h.position.x+s.x,y:h.position.y+s.y},inputs:h.inputs.map((b,m)=>({...b,id:`${g}-input-${m}`,nodeId:g})),outputs:h.outputs.map((b,m)=>({...b,id:`${g}-output-${m}`,nodeId:g})),params:JSON.parse(JSON.stringify(h.params)),pinnedParams:h.pinnedParams?[...h.pinnedParams]:void 0,color:h.color};if(h.graph){const b=JSON.parse(JSON.stringify(h.graph));y.graph=rf(b)}a.push(y),n.push(g)});const d=t.connections,c=[];for(const p of d){const f=o.get(p.sourceNodeId),h=o.get(p.targetNodeId);f&&h&&c.push({id:rn(),sourceNodeId:f,sourcePortIndex:p.sourcePortIndex,targetNodeId:h,targetPortIndex:p.targetPortIndex})}(a.length>0||c.length>0)&&Wc(p=>{const f=new Map(p);for(const h of a)f.set(h.id,h);return f},p=>[...p,...a],p=>[...p,...c]),l.length>0&&Kc(p=>{const f=new Map(p);for(const h of l)f.set(h.id,h);return f},p=>[...p,...l]);const u=[...n,...i];return u.length>0&&bi(u,!1),u}function UC(e){const t=de(yn);if(t.size===0)return;const n=i=>({...i,position:{x:i.position.x+e.x,y:i.position.y+e.y}});sf(i=>{const s=new Map(i);return t.forEach(o=>{const a=s.get(o);a&&s.set(o,n(a))}),s},i=>i.map(s=>t.has(s.id)?n(s):s))}function YC(e,t){if(e.length===0)return[];const n=e.map(i=>i.id);return Wc(i=>{const s=new Map(i);for(const o of e)s.set(o.id,o);return s},i=>[...i,...e],i=>[...i,...t]),bi(n,!1),n}function ZC(e,t,n,i){const s=hn(),o=s.nodes.get(e),a=s.nodes.get(n);if(!o||!a)return console.error("Invalid node IDs for connection"),null;if(t>=o.outputs.length||i>=a.inputs.length)return console.error("Invalid port indices for connection"),null;if(s.connections.some(u=>u.targetNodeId===n&&u.targetPortIndex===i))return console.warn("Target port already has a connection"),null;const c={id:rn(),sourceNodeId:e,sourcePortIndex:t,targetNodeId:n,targetPortIndex:i};return of(u=>[...u,c]),c}function JC(e){of(t=>t.filter(n=>n.id!==e))}function QC(){const e=[];for(const n of de(Ms))e.push({connection:n});const t=(n,i)=>{const s=n instanceof Map?Array.from(n.values()):n;for(const o of s)if(o.graph){for(const a of o.graph.connections)e.push({connection:a,subsystemId:o.id});t(o.graph.nodes,o.id)}};return t(de(sn)),e}function $C(e,t){of(n=>n.map(i=>i.id===e?{...i,waypoints:t}:i))}function eE(e){const t=de(Tt);return t.length===0?!1:(qn(t,n=>({...n,events:[...n.events||[],e]})),!0)}function tE(e){const t=de(Tt);t.length!==0&&qn(t,n=>({...n,events:(n.events||[]).filter(i=>i.id!==e)}))}function nE(e,t){const n=de(Tt);n.length!==0&&qn(n,i=>({...i,events:(i.events||[]).map(s=>s.id===e?{...s,position:{...t}}:s)}))}function iE(e,t){const n=de(Tt);n.length!==0&&qn(n,i=>({...i,events:(i.events||[]).map(s=>s.id===e?{...s,name:t}:s)}))}function sE(e,t){const n=de(Tt);n.length!==0&&qn(n,i=>({...i,events:(i.events||[]).map(s=>s.id===e?{...s,params:{...s.params,...t}}:s)}))}function oE(e,t){const n=de(Tt);n.length!==0&&qn(n,i=>({...i,events:(i.events||[]).map(s=>s.id===e?{...s,color:t}:s)}))}function aE(e){return hn().events.get(e)}function rE(){return Array.from(hn().events.values())}const lE=[{type:"pathsim.events.ZeroCrossing",name:"ZeroCrossing",eventClass:"ZeroCrossing",description:"Subclass of base 'Event' that triggers if the event function crosses zero.",docstringHtml:`<p>Subclass of base 'Event' that triggers if the event function crosses zero.
This is a bidirectional zero-crossing detector.</p>
<p>Monitors system state by evaluating an event function (func_evt) with scalar output and
testing for zero crossings (sign changes).</p>
<pre class="code literal-block">
func_evt(time) -&gt; event?
</pre>
<p>If an event is detected, some action (func_act) is performed on the system state.</p>
<pre class="code literal-block">
func_evt(time) == 0 -&gt; event -&gt; func_act(time)
</pre>
<div class="section" id="example">
<h3>Example</h3>
<p>Initialize a zero-crossing event handler like this:</p>
<pre class="code python literal-block">
# define the event function
def evt(t):
    # here we have a zero-crossing at 't==10'
    return t - 10

# define the action function (callback)
def act(t):
    # do something at event resolution
    pass

# initialize the event manager
E = ZeroCrossing(
    func_evt=evt,  # the event function
    func_act=act   # the action function
    )
</pre>
</div>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>func_evt <span class="classifier-delimiter">:</span> <span class="classifier">callable</span></dt>
<dd>event function, where zeros are events</dd>
<dt>func_act <span class="classifier-delimiter">:</span> <span class="classifier">callable</span></dt>
<dd>action function for event resolution</dd>
<dt>tolerance <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>tolerance to check if detection is close to actual event</dd>
</dl>
</div>
`,params:[{name:"func_evt",type:"callable",default:"None",description:"event function, where zeros are events"},{name:"func_act",type:"callable",default:"None",description:"action function for event resolution"},{name:"tolerance",type:"number",default:"0.0001",description:"tolerance to check if detection is close to actual event"}]},{type:"pathsim.events.ZeroCrossingUp",name:"ZeroCrossingUp",eventClass:"ZeroCrossingUp",description:"Modification of standard 'ZeroCrossing' event where events are only triggered",docstringHtml:`<p>Modification of standard 'ZeroCrossing' event where events are only triggered
if the event function changes sign from negative to positive (up). Also called
unidirectional zero-crossing.</p>
`,params:[{name:"func_evt",type:"callable",default:"None",description:""},{name:"func_act",type:"callable",default:"None",description:""},{name:"tolerance",type:"number",default:"0.0001",description:""}]},{type:"pathsim.events.ZeroCrossingDown",name:"ZeroCrossingDown",eventClass:"ZeroCrossingDown",description:"Modification of standard 'ZeroCrossing' event where events are only triggered",docstringHtml:`<p>Modification of standard 'ZeroCrossing' event where events are only triggered
if the event function changes sign from positive to negative (down). Also called
unidirectional zero-crossing.</p>
`,params:[{name:"func_evt",type:"callable",default:"None",description:""},{name:"func_act",type:"callable",default:"None",description:""},{name:"tolerance",type:"number",default:"0.0001",description:""}]},{type:"pathsim.events.Schedule",name:"Schedule",eventClass:"Schedule",description:"Subclass of base 'Event' that triggers dependent on the evaluation time.",docstringHtml:`<p>Subclass of base 'Event' that triggers dependent on the evaluation time.</p>
<p>Monitors time in every timestep and triggers periodically (period). This event
does not have an event function as the event condition only depends on time.</p>
<pre class="code literal-block">
time == next_schedule_time -&gt; event
</pre>
<div class="section" id="example">
<h3>Example</h3>
<p>Initialize a scheduled event handler like this:</p>
<pre class="code python literal-block">
#define the action function (callback)
def act(t):
    #do something at event resolution
    pass

#initialize the event manager
E = Schedule(
    t_start=0,    #starting at t=0
    t_end=None,   #never ending
    t_period=3,   #triggering every 3 time units
    func_act=act  #resulting in a callback
    )
</pre>
</div>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>t_start <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>starting time for schedule</dd>
<dt>t_end <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>termination time for schedule</dd>
<dt>t_period <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>time period of schedule, when events are triggered</dd>
<dt>func_act <span class="classifier-delimiter">:</span> <span class="classifier">callable</span></dt>
<dd>action function for event resolution</dd>
<dt>tolerance <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>tolerance to check if detection is close to actual event</dd>
</dl>
</div>
`,params:[{name:"t_start",type:"number",default:"0",description:"starting time for schedule"},{name:"t_end",type:"number",default:"None",description:"termination time for schedule"},{name:"t_period",type:"number",default:"1",description:"time period of schedule, when events are triggered"},{name:"func_act",type:"callable",default:"None",description:"action function for event resolution"},{name:"tolerance",type:"number",default:"1e-16",description:"tolerance to check if detection is close to actual event"}]},{type:"pathsim.events.ScheduleList",name:"ScheduleList",eventClass:"ScheduleList",description:"Subclass of base 'Schedule' that triggers dependent on the evaluation time.",docstringHtml:`<p>Subclass of base 'Schedule' that triggers dependent on the evaluation time.</p>
<p>Monitors time in every timestep and triggers at the next event time from the
time list. This event does not have an event function as the event condition
only depends on time.</p>
<pre class="code literal-block">
time == next_scheduled_time -&gt; event
</pre>
<div class="section" id="example">
<h3>Example</h3>
<p>Initialize a scheduled event handler like this:</p>
<pre class="code python literal-block">
#define the action function (callback)
def act(t):
    #do something at event resolution
    pass

#initialize the event manager
E = ScheduleList(
    times_evt=[1, 5, 12, 300],  #event times where to trigger
    func_act=act                #resulting in a callback
    )
</pre>
</div>
<div class="section" id="parameters">
<h3>Parameters</h3>
<dl class="docutils">
<dt>times_evt <span class="classifier-delimiter">:</span> <span class="classifier">list[float]</span></dt>
<dd>list of event times in ascending order</dd>
<dt>func_act <span class="classifier-delimiter">:</span> <span class="classifier">callable</span></dt>
<dd>action function for event resolution</dd>
<dt>tolerance <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>tolerance to check if detection is close to actual event</dd>
</dl>
</div>
`,params:[{name:"times_evt",type:"array",default:"None",description:"list of event times in ascending order"},{name:"func_act",type:"callable",default:"None",description:"action function for event resolution"},{name:"tolerance",type:"number",default:"1e-16",description:"tolerance to check if detection is close to actual event"}]},{type:"pathsim.events.Condition",name:"Condition",eventClass:"Condition",description:"Subclass of base 'Event' that triggers if the event function evaluates to 'True',",docstringHtml:`<p>Subclass of base 'Event' that triggers if the event function evaluates to 'True',
i.e. the condition is satisfied.</p>
<p>Monitors system state by evaluating an event function (func_evt) with boolean output.
The event is considered detected when the event function evaluates to 'True' for the
first time. Subsequent evaluations to 'True' are not considered unless the event is reset.</p>
<pre class="code literal-block">
func_evt(time) -&gt; event?
</pre>
<p>If an event is detected, some action (func_act) is performed on the system state.</p>
<pre class="code literal-block">
func_evt(time) == True -&gt; event -&gt; func_act(time)
</pre>
<div class="section" id="note">
<h3>Note</h3>
<p>Condition event functions evaluate to boolean and are therefore not smooth.
Therefore uses bisection method for event location instead of secant method.</p>
</div>
<div class="section" id="example">
<h3>Example</h3>
<p>Initialize a conditional event handler like this:</p>
<pre class="code python literal-block">
#define the event function
def evt(t):
    return t &gt; 10

#define the action function (callback)
def act(t):
    #do something at event resolution
    pass

#initialize the event manager
E = Condition(
    func_evt=evt,  #the event function
    func_act=act   #the action function
    )
</pre>
</div>
`,params:[{name:"func_evt",type:"callable",default:"None",description:""},{name:"func_act",type:"callable",default:"None",description:""},{name:"tolerance",type:"number",default:"0.0001",description:""}]}],cE=lE;class dE{events=new Map;constructor(){for(const t of cE)this.register(t)}register(t){this.events.set(t.type,t)}get(t){return this.events.get(t)}getAll(){return Array.from(this.events.values())}has(t){return this.events.has(t)}}const ti=new dE,an=nt(new Map),Gn=nt(new Set);function Dd(e){Gn.set(e)}const uE=ci(an,e=>Array.from(e.values())),fE=ci([an,Gn],([e,t])=>Array.from(t).map(n=>e.get(n)).filter(n=>n!==void 0)),pt={events:{subscribe:an.subscribe},eventsArray:{subscribe:uE.subscribe},selectedEventIds:{subscribe:Gn.subscribe},selectedEvents:{subscribe:fE.subscribe},addEvent(e,t,n){const i=ti.get(e);if(!i)return console.error(`Unknown event type: ${e}`),null;const s=rn(),o={id:s,type:e,name:n||i.name,position:t,params:{}};return an.update(a=>{const l=new Map(a);return l.set(s,o),l}),o},removeEvent(e){an.update(t=>{const n=new Map(t);return n.delete(e),n}),Gn.update(t=>{const n=new Set(t);return n.delete(e),n})},updateEventPosition(e,t){an.update(n=>{const i=n.get(e);if(i){const s=new Map(n);return s.set(e,{...i,position:{...t}}),s}return n})},updateEventName(e,t){an.update(n=>{const i=n.get(e);if(i){const s=new Map(n);return s.set(e,{...i,name:t}),s}return n})},updateEventParams(e,t){an.update(n=>{const i=n.get(e);if(i){const s=new Map(n);return s.set(e,{...i,params:{...i.params,...t}}),s}return n})},updateEventColor(e,t){an.update(n=>{const i=n.get(e);if(i){const s=new Map(n);return s.set(e,{...i,color:t}),s}return n})},selectEvent(e,t=!1){if(t){const n=de(Gn);bi([...n,e],!0)}else bi([e],!1)},deselectEvent(e){const n=[...de(Gn)].filter(i=>i!==e);bi(n,!1)},clearSelection(){Mr()},hasSelection(){return de(Gn).size>0},clear(){an.set(new Map),Gn.set(new Set)},getEvent(e){return de(an).get(e)},getAll(){return Array.from(de(an).values())},selectAll(){const e=Array.from(de(an).keys());Gn.set(new Set(e))},duplicateSelected(){const e=de(Gn);if(e.size===0)return[];const t=de(an),n=[],i={x:50,y:50};return e.forEach(s=>{const o=t.get(s);if(!o)return;const a=rn(),l={id:a,type:o.type,name:o.name,position:{x:o.position.x+i.x,y:o.position.y+i.y},params:JSON.parse(JSON.stringify(o.params)),color:o.color};an.update(d=>{const c=new Map(d);return c.set(a,l),c}),n.push(a)}),n.length>0&&bi(n,!1),n},nudgeSelectedEvents(e){const t=de(Gn);t.size!==0&&an.update(n=>{const i=new Map(n);return t.forEach(s=>{const o=i.get(s);o&&i.set(s,{...o,position:{x:o.position.x+e.x,y:o.position.y+e.y}})}),i})},toJSON(){return Array.from(de(an).values())},fromJSON(e){!e||!Array.isArray(e)?an.set(new Map):an.set(new Map(e.map(t=>[t.id,t]))),Gn.set(new Set)}};function pE(e,t=!1){if(t){const n=de(yn);bi([...n,e],!0)}else bi([e],!1)}function hE(e){const n=[...de(yn)].filter(i=>i!==e);bi(n,!1)}function gE(){Mr()}function mE(){return de(yn).size>0}function vE(){const e=hn(),t=Array.from(e.nodes.keys()),n=nC()?Array.from(de(pt.events).keys()):Array.from(e.events.keys());bi([...t,...n],!1)}function yE(){sn.set(new Map),Ms.set([]),sr.set(new Map),Tt.set([]),yn.set(new Set)}function bE(){return{nodes:Array.from(de(sn).values()),connections:de(Ms),annotations:Array.from(de(sr).values())}}function wE(e,t,n){!e||!Array.isArray(e)?sn.set(new Map):sn.set(new Map(e.map(i=>[i.id,i]))),Ms.set(t||[]),sr.set(new Map((n||[]).map(i=>[i.id,i]))),Tt.set([]),yn.set(new Set)}function _E(){const e=[],t=(n,i,s)=>{for(const o of n)o.type!==yt.INTERFACE&&(e.push({node:o,path:[...i],pathNames:[...s],depth:i.length}),o.graph&&t(o.graph.nodes,[...i,o.id],[...s,o.name]))};return t(Array.from(de(sn).values()),[],["Root"]),e}const ee={nodes:{subscribe:af.subscribe},connections:{subscribe:iC.subscribe},annotations:{subscribe:sC.subscribe},subsystemEvents:{subscribe:oC.subscribe},selectedNodeIds:{subscribe:yn.subscribe},nodesArray:{subscribe:aC.subscribe},selectedNodes:{subscribe:rC.subscribe},currentPath:{subscribe:Tt.subscribe},breadcrumbs:{subscribe:lC.subscribe},drillDown:SC,drillUp:CC,navigateTo:EC,navigateToPath:TC,isAtRoot:IC,getCurrentPath:NC,addNode:HC,removeNode:FC,updateNodePosition:BC,updateNodeName:qC,updateNodeColor:VC,updateNodeParams:WC,updateNode:KC,getNode:jC,getAllNodes:XC,duplicateSelected:GC,nudgeSelectedNodes:UC,pasteNodes:YC,addConnection:ZC,removeConnection:JC,getAllConnections:QC,updateConnectionWaypoints:$C,addInputPort:AC,removeInputPort:RC,addOutputPort:DC,removeOutputPort:OC,addAnnotation:cC,updateAnnotation:am,updateAnnotationPosition:dC,removeAnnotation:uC,getAnnotation:fC,addSubsystemEvent:eE,removeSubsystemEvent:tE,updateSubsystemEventPosition:nE,updateSubsystemEventName:iE,updateSubsystemEventParams:sE,updateSubsystemEventColor:oE,getSubsystemEvent:aE,getSubsystemEvents:rE,selectNode:pE,deselectNode:hE,clearSelection:gE,hasSelection:mE,selectAll:vE,clear:yE,toJSON:bE,fromJSON:wE,getAllNodesWithPaths:_E},xE=50;let $i=[],Xs=[],ni=!1,Va=null,pu=!1,$n=0,Yi=null;const wm=nt({undoStack:[],redoStack:[],canUndo:!1,canRedo:!1});function jc(){wm.set({undoStack:$i,redoStack:Xs,canUndo:$i.length>0,canRedo:Xs.length>0})}function el(){return{graph:ee.toJSON(),events:pt.toJSON()}}function uf(e){$i.push(e),$i.length>xE&&$i.shift(),Xs=[],jc()}function _m(e){pu=!0;try{ee.fromJSON(e.graph.nodes,e.graph.connections,e.graph.annotations),pt.fromJSON(e.events)}finally{queueMicrotask(()=>{pu=!1})}}function kE(){return pu}function SE(e){if(ni)return e();const t=$n===0;t&&(Yi=el()),$n++;try{const n=e();return t&&Yi&&uf(Yi),n}catch(n){throw n}finally{$n--,$n===0&&(Yi=null)}}async function CE(e){if(ni)return e();const t=$n===0;t&&(Yi=el()),$n++;try{const n=await e();return t&&Yi&&uf(Yi),n}catch(n){throw n}finally{$n--,$n===0&&(Yi=null)}}function EE(){return $n>0||ni}function TE(){ni||(ni=!0,Va=el())}function IE(){ni&&(ni=!1,Va&&(uf(Va),Va=null))}function NE(){ni=!1,Va=null}function PE(){if(ni||$n>0||$i.length===0)return!1;const e=el(),t=$i.pop();return Xs.push(e),_m(t),jc(),!0}function ME(){if(ni||$n>0||Xs.length===0)return!1;const e=el(),t=Xs.pop();return $i.push(e),_m(t),jc(),!0}function AE(){$i=[],Xs=[],ni=!1,Va=null,$n=0,Yi=null,jc()}function DE(){return ni}const De={subscribe:wm.subscribe,mutate:SE,mutateAsync:CE,isInMutation:EE,beginDrag:TE,endDrag:IE,cancelDrag:NE,undo:PE,redo:ME,clear:AE,isInDrag:DE,isRestoringState:kE},Rd=nt(!1),Zl={subscribe:Rd.subscribe,toggle(){Rd.update(e=>!e)},set(e){Rd.set(e)}},xm="pathview-portLabels";function RE(){return localStorage.getItem(xm)==="true"}const xr=nt(RE());xr.subscribe(e=>{localStorage.setItem(xm,String(e))});const ff={subscribe:xr.subscribe,toggle(){xr.update(e=>!e)},set(e){xr.set(e)},get(){return de(xr)}},kr=nt(null),hu=nt(null),pf=nt({text:"",x:0,y:0,visible:!1,position:"bottom"});let Jl=null,Ql=null;function gu(e,t,n="bottom",i,s){Ql&&(clearTimeout(Ql),Ql=null),Jl=setTimeout(()=>{const o=t.getBoundingClientRect(),a=s??240,l=28,d=8,c=8;let u=n,p,f;switch(n==="bottom"&&o.bottom+d+l>window.innerHeight-c?u="top":n==="top"&&o.top-d-l<c?u="bottom":n==="right"&&o.right+d+a>window.innerWidth-c?u="left":n==="left"&&o.left-d-a<c&&(u="right"),u){case"left":p=o.left-d,f=o.top+o.height/2;break;case"right":p=o.right+d,f=o.top+o.height/2;break;case"top":p=o.left+o.width/2,f=o.top-d;break;default:p=o.left+o.width/2,f=o.bottom+d;break}if(u==="bottom"||u==="top"){const h=a/2;p-h<c?p=c+h:p+h>window.innerWidth-c&&(p=window.innerWidth-c-h)}if(u==="left"||u==="right"){const h=l/2;f-h<c?f=c+h:f+h>window.innerHeight-c&&(f=window.innerHeight-c-h)}pf.set({text:e,shortcut:i,maxWidth:s,x:p,y:f,visible:!0,position:u})},50)}function wc(){Jl&&(clearTimeout(Jl),Jl=null),Ql=setTimeout(()=>{pf.update(e=>({...e,visible:!1}))},50)}function Ue(e,t){if(typeof window>"u")return{destroy:()=>{}};let n=typeof t=="string"?t:t.text,i=typeof t=="string"?void 0:t.shortcut,s=typeof t=="string"?void 0:t.maxWidth,o=typeof t=="string"?"bottom":t.position??"bottom";function a(){n&&gu(n,e,o,i,s)}function l(){wc()}return e.addEventListener("mouseenter",a),e.addEventListener("mouseleave",l),{update(d){n=typeof d=="string"?d:d.text,i=typeof d=="string"?void 0:d.shortcut,s=typeof d=="string"?void 0:d.maxWidth,o=typeof d=="string"?"bottom":d.position??"bottom"},destroy(){e.removeEventListener("mouseenter",a),e.removeEventListener("mouseleave",l),wc()}}}var OE=Z('<span class="shortcut svelte-11extwn"> </span>'),zE=Z('<div><span class="text"> </span> <!></div>');function LE(e,t){Oe(t,!0);let n=$(Et({text:"",x:0,y:0,visible:!1,position:"bottom"}));pf.subscribe(a=>{E(n,a,!0)});var i=pe(),s=ae(i);{var o=a=>{var l=zE(),d=M(l),c=M(d,!0);C(d);var u=q(d,2);{var p=f=>{var h=OE(),g=M(h,!0);C(h),G(()=>Fe(g,r(n).shortcut)),_(f,h)};j(u,f=>{r(n).shortcut&&f(p)})}C(l),G(()=>{qe(l,1,`tooltip tooltip-${r(n).position??""}`,"svelte-11extwn"),wt(l,`left: ${r(n).x??""}px; top: ${r(n).y??""}px;${r(n).maxWidth?` max-width: ${r(n).maxWidth}px;`:""}`),Fe(c,r(n).text)}),_(a,l)};j(s,a=>{r(n).visible&&a(o)})}_(e,i),ze()}const Fp={blurOnEscape:!0,blurOnEnter:!1};function Un(e,t={}){const n={...Fp,...t};function i(s){const o=s;o.key==="Escape"&&n.blurOnEscape&&(o.stopPropagation(),e.blur()),o.key==="Enter"&&n.blurOnEnter&&!(e instanceof HTMLTextAreaElement)&&(o.stopPropagation(),e.blur())}return e.addEventListener("keydown",i),e.setAttribute("autocomplete","off"),{update(s){Object.assign(n,Fp,s)},destroy(){e.removeEventListener("keydown",i)}}}let HE=0;const Bp=500;function FE(){const{subscribe:e,set:t,update:n}=nt([]);let i=[],s=null;const o=50;function a(){if(i.length===0)return;const d=i;i=[],s=null,n(c=>{const u=[...c,...d];return u.length>Bp?u.slice(-Bp):u})}function l(){s===null&&(s=setTimeout(a,o))}return{subscribe:e,log(d,c="info"){i.push({id:HE++,timestamp:new Date,level:c,message:d}),l()},info(d){this.log(d,"info")},warn(d){this.log(d,"warning")},error(d){this.log(d,"error")},output(d){this.log(d,"output")},clear(){i=[],s&&(clearTimeout(s),s=null),t([])},getAll(){return de({subscribe:e})},flush(){s&&clearTimeout(s),a()}}}const Bt=FE(),_s=nt({...In}),Pn={subscribe:_s.subscribe,update(e){_s.update(t=>({...t,...e}))},setDuration(e){_s.update(t=>({...t,duration:e}))},setDt(e){_s.update(t=>({...t,dt:e}))},setSolver(e){_s.update(t=>({...t,solver:e}))},reset(){_s.set({...In})},get(){return de(_s)},set(e){_s.set(e)}},qp=["Sources","Dynamic","Algebraic","Mixed","Recording","Subsystem"],Hn={SIMULATION:3e5,INIT:12e4,VALIDATION:3e4},km={STARTING_WORKER:"Starting worker...",STARTING_SIMULATION:"Starting simulation..."},Gs={READY:"Ready",COMPLETE:"Complete",STOPPED:"Stopped",RUNNING:"Running"},BE={SIMULATION_COMPLETED:"Simulation completed successfully"},Sm={initialized:!1,loading:!1,error:null,progress:""},mr=nt(Sm),en={subscribe:mr.subscribe,get:()=>de(mr),set:mr.set,update:mr.update,reset:()=>mr.set(Sm)};class qE{worker=null;messageId=0;pendingRequests=new Map;isInitializing=!1;streamState={id:null,onData:null,onDone:null,onError:null};stdoutCallback=null;stderrCallback=null;async init(){const t=this.getState();if(!(this.worker&&(t.initialized||t.loading))){this.worker&&(this.worker.terminate(),this.worker=null),en.update(n=>({...n,loading:!0,error:null,progress:km.STARTING_WORKER})),this.isInitializing=!0;try{this.worker=new Worker(new URL(""+new URL("../workers/worker-BQo9QMXK.js",import.meta.url).href,import.meta.url),{type:"module"}),this.worker.onmessage=n=>{this.handleResponse(n.data)},this.worker.onerror=n=>{en.update(i=>({...i,loading:!1,error:n.message||"Worker error"}))},this.sendRequest({type:"init"}),await new Promise((n,i)=>{const s=setTimeout(()=>i(new Error("Initialization timeout")),Hn.INIT),o=en.subscribe(a=>{a.initialized&&(clearTimeout(s),o(),n()),a.error&&(clearTimeout(s),o(),i(new Error(a.error)))})})}catch(n){throw en.update(i=>({...i,loading:!1,error:n instanceof Error?n.message:String(n)})),n}}}terminate(){for(const[,t]of this.pendingRequests)clearTimeout(t.timeoutId),t.reject(new Error("Backend terminated"));this.pendingRequests.clear(),this.streamState={id:null,onData:null,onDone:null,onError:null},this.worker&&(this.worker.terminate(),this.worker=null),en.reset()}getState(){return en.get()}subscribe(t){return en.subscribe(t)}isReady(){return this.getState().initialized}isLoading(){return this.getState().loading}getError(){return this.getState().error}async exec(t,n=Hn.SIMULATION){if(this.worker||await this.init(),!this.isReady())throw new Error("Backend not initialized");const i=this.generateId();return new Promise((s,o)=>{const a=setTimeout(()=>{this.pendingRequests.has(i)&&(this.pendingRequests.delete(i),o(new Error("Execution timeout")))},n);this.pendingRequests.set(i,{resolve:()=>s(),reject:o,timeoutId:a}),this.sendRequest({type:"exec",id:i,code:t})})}async evaluate(t,n=Hn.SIMULATION){if(this.worker||await this.init(),!this.isReady())throw new Error("Backend not initialized");const i=this.generateId();return new Promise((s,o)=>{const a=setTimeout(()=>{this.pendingRequests.has(i)&&(this.pendingRequests.delete(i),o(new Error("Evaluation timeout")))},n);this.pendingRequests.set(i,{resolve:l=>{if(l===void 0){o(new Error("No value returned from eval"));return}try{s(JSON.parse(l))}catch{o(new Error(`Failed to parse eval result: ${l}`))}},reject:o,timeoutId:a}),this.sendRequest({type:"eval",id:i,expr:t})})}startStreaming(t,n,i,s){if(!this.worker){s(new Error("Backend not initialized"));return}if(!this.isReady()){s(new Error("Backend not initialized"));return}this.streamState.id&&this.stopStreaming();const o=this.generateId();this.streamState={id:o,onData:n,onDone:i,onError:s},this.sendRequest({type:"stream-start",id:o,expr:t})}stopStreaming(){!this.worker||!this.streamState.id||this.sendRequest({type:"stream-stop"})}isStreaming(){return this.streamState.id!==null}execDuringStreaming(t){if(!this.worker||!this.streamState.id){console.warn("Cannot exec during streaming: no active stream");return}this.sendRequest({type:"stream-exec",code:t})}onStdout(t){this.stdoutCallback=t}onStderr(t){this.stderrCallback=t}generateId(){return`repl_${++this.messageId}`}sendRequest(t){if(!this.worker)throw new Error("Worker not initialized");this.worker.postMessage(t)}handleResponse(t){switch(t.type){case"ready":en.update(n=>({...n,initialized:!0,loading:!1,progress:Gs.READY})),this.isInitializing=!1;break;case"progress":en.update(n=>({...n,progress:t.value||""}));break;case"ok":if(t.id&&this.pendingRequests.has(t.id)){const n=this.pendingRequests.get(t.id);clearTimeout(n.timeoutId),n.resolve(void 0),this.pendingRequests.delete(t.id)}break;case"value":if(t.id&&this.pendingRequests.has(t.id)){const n=this.pendingRequests.get(t.id);clearTimeout(n.timeoutId),n.resolve(t.value),this.pendingRequests.delete(t.id)}break;case"error":this.handleError(t);break;case"stdout":t.value&&this.stdoutCallback&&this.stdoutCallback(t.value);break;case"stderr":t.value&&this.stderrCallback&&this.stderrCallback(t.value);break;case"stream-data":if(t.id===this.streamState.id&&this.streamState.onData&&t.value)try{this.streamState.onData(JSON.parse(t.value))}catch{}break;case"stream-done":t.id===this.streamState.id&&this.streamState.onDone&&(this.streamState.onDone(),this.streamState={id:null,onData:null,onDone:null,onError:null});break}}handleError(t){const{id:n,error:i,traceback:s}=t,o=s?`${i}
${s}`:i||"Unknown error";if(n&&this.pendingRequests.has(n)){const a=this.pendingRequests.get(n);clearTimeout(a.timeoutId),a.reject(new Error(o)),this.pendingRequests.delete(n)}n===this.streamState.id&&this.streamState.onError&&(this.streamState.onError(new Error(o)),this.streamState={id:null,onData:null,onDone:null,onError:null}),en.update(a=>({...a,error:i||"Unknown error"}))}}const VE="0.7.3",WE={pathsim:"0.17.0",pathsim_chem:"0.2rc3"},KE=[{pip:"pathsim==0.17.0",required:!0,pre:!0,import:"pathsim"},{pip:"pathsim-chem==0.2rc3",required:!1,pre:!0,import:"pathsim_chem"}],jE=5,XE="flask-session";class GE{host;sessionId;messageId=0;_isStreaming=!1;streamPollTimer=null;serverInitPromise=null;broadcastChannel=null;streamState={onData:null,onDone:null,onError:null};stdoutCallback=null;stderrCallback=null;constructor(t){this.host=t.replace(/\/$/,"");const n=typeof localStorage<"u"?localStorage.getItem("flask-session-id"):null;n?this.sessionId=n:(this.sessionId=crypto.randomUUID(),typeof localStorage<"u"&&localStorage.setItem("flask-session-id",this.sessionId)),typeof BroadcastChannel<"u"&&(this.broadcastChannel=new BroadcastChannel(XE),this.broadcastChannel.onmessage=i=>{i.data?.type==="session-terminated"&&(this.serverInitPromise=null,en.reset())})}async init(){const t=this.getState();if(!(t.initialized||t.loading)){en.update(n=>({...n,loading:!0,error:null,progress:"Connecting to Flask server..."}));try{const n=await fetch(`${this.host}/api/health`,{signal:AbortSignal.timeout(Hn.INIT)});if(!n.ok)throw new Error(`Server health check failed: ${n.status}`);en.update(i=>({...i,progress:"Initializing Python worker..."})),await this.postInit({updateProgress:!0}),this.serverInitPromise=Promise.resolve(),en.update(i=>({...i,initialized:!0,loading:!1,progress:Gs.READY}))}catch(n){const i=n instanceof Error?n.message:String(n);throw en.update(s=>({...s,loading:!1,error:`Flask backend error: ${i}`})),n}}}terminate(){this.stopStreaming(),this.streamPollTimer&&(clearTimeout(this.streamPollTimer),this.streamPollTimer=null),this._isStreaming=!1,this.streamState={onData:null,onDone:null,onError:null},fetch(`${this.host}/api/session`,{method:"DELETE",headers:{"X-Session-ID":this.sessionId}}).catch(()=>{}),this.broadcastChannel?.postMessage({type:"session-terminated"}),this.serverInitPromise=null,en.reset()}getState(){return en.get()}subscribe(t){return en.subscribe(t)}isReady(){return this.getState().initialized}isLoading(){return this.getState().loading}getError(){return this.getState().error}ensureServerInit(){return this.serverInitPromise?this.serverInitPromise:(this.serverInitPromise=this.postInit({updateProgress:!1}),this.serverInitPromise.catch(()=>{this.serverInitPromise=null}),this.serverInitPromise)}async exec(t,n=Hn.SIMULATION){await this.ensureServerInit();const i=this.generateId(),o=await(await fetch(`${this.host}/api/exec`,{method:"POST",headers:{"Content-Type":"application/json","X-Session-ID":this.sessionId},body:JSON.stringify({id:i,code:t}),signal:AbortSignal.timeout(n)})).json();if(o.stdout&&this.stdoutCallback&&this.stdoutCallback(o.stdout),o.stderr&&this.stderrCallback&&this.stderrCallback(o.stderr),o.type==="error"){this.handleWorkerError(o);const a=o.traceback?`${o.error}
${o.traceback}`:o.error;throw new Error(a)}}async evaluate(t,n=Hn.SIMULATION){await this.ensureServerInit();const i=this.generateId(),o=await(await fetch(`${this.host}/api/eval`,{method:"POST",headers:{"Content-Type":"application/json","X-Session-ID":this.sessionId},body:JSON.stringify({id:i,expr:t}),signal:AbortSignal.timeout(n)})).json();if(o.stdout&&this.stdoutCallback&&this.stdoutCallback(o.stdout),o.stderr&&this.stderrCallback&&this.stderrCallback(o.stderr),o.type==="error"){this.handleWorkerError(o);const a=o.traceback?`${o.error}
${o.traceback}`:o.error;throw new Error(a)}if(o.value===void 0)throw new Error("No value returned from eval");return JSON.parse(o.value)}startStreaming(t,n,i,s){this._isStreaming&&this.stopStreaming(),this.streamPollTimer&&(clearTimeout(this.streamPollTimer),this.streamPollTimer=null);const o=this.generateId();this._isStreaming=!0,this.streamState={onData:n,onDone:i,onError:s},this.ensureServerInit().then(()=>fetch(`${this.host}/api/stream/start`,{method:"POST",headers:{"Content-Type":"application/json","X-Session-ID":this.sessionId},body:JSON.stringify({id:o,expr:t})})).then(a=>a.json()).then(a=>{if(a.type==="error")throw new Error(a.error);this.pollStreamResults()}).catch(a=>{this._isStreaming=!1,s(a instanceof Error?a:new Error(String(a))),this.streamState={onData:null,onDone:null,onError:null}})}stopStreaming(){this._isStreaming&&fetch(`${this.host}/api/stream/stop`,{method:"POST",headers:{"Content-Type":"application/json","X-Session-ID":this.sessionId}}).catch(()=>{})}isStreaming(){return this._isStreaming}execDuringStreaming(t){if(!this._isStreaming){console.warn("Cannot exec during streaming: no active stream");return}fetch(`${this.host}/api/stream/exec`,{method:"POST",headers:{"Content-Type":"application/json","X-Session-ID":this.sessionId},body:JSON.stringify({code:t})}).catch(()=>{})}onStdout(t){this.stdoutCallback=t}onStderr(t){this.stderrCallback=t}generateId(){return`repl_${++this.messageId}`}async postInit(t){const i=await(await fetch(`${this.host}/api/init`,{method:"POST",headers:{"Content-Type":"application/json","X-Session-ID":this.sessionId},body:JSON.stringify({packages:KE}),signal:AbortSignal.timeout(Hn.INIT)})).json();if(i.type==="error")throw new Error(i.error);if(i.messages)for(const s of i.messages)s.type==="stdout"&&this.stdoutCallback&&this.stdoutCallback(s.value),s.type==="stderr"&&this.stderrCallback&&this.stderrCallback(s.value),s.type==="progress"&&t.updateProgress&&en.update(o=>({...o,progress:s.value}))}handleWorkerError(t){const n=t.errorType;(n==="worker-crashed"||n==="timeout")&&(this.serverInitPromise=null,this.stderrCallback&&this.stderrCallback(`Python worker crashed, restarting on next request...
`))}async pollStreamResults(){if(this._isStreaming)try{const n=await(await fetch(`${this.host}/api/stream/poll`,{method:"POST",headers:{"Content-Type":"application/json","X-Session-ID":this.sessionId}})).json();if(!Array.isArray(n?.messages))throw new Error(n?.error||"Invalid poll response");for(const i of n.messages)if(this.handleStreamMessage(i),!this._isStreaming)return;this._isStreaming&&(this.streamPollTimer=setTimeout(()=>this.pollStreamResults(),jE))}catch(t){this._isStreaming=!1,this.streamState.onError&&this.streamState.onError(t instanceof Error?t:new Error(String(t))),this.streamState={onData:null,onDone:null,onError:null}}}handleStreamMessage(t){switch(t.type){case"stream-data":{if(this.streamState.onData&&t.value)try{this.streamState.onData(JSON.parse(t.value))}catch{}break}case"stream-done":{this._isStreaming=!1,this.streamState.onDone&&this.streamState.onDone(),this.streamState={onData:null,onDone:null,onError:null};break}case"stdout":{this.stdoutCallback&&t.value&&this.stdoutCallback(t.value);break}case"stderr":{this.stderrCallback&&t.value&&this.stderrCallback(t.value);break}case"error":{if(this._isStreaming=!1,this.streamState.onError){const i=t.traceback?`${t.error}
${t.traceback}`:t.error||"Unknown error";this.streamState.onError(new Error(i))}this.streamState={onData:null,onDone:null,onError:null};break}}}}let Fs=null,Cm="http://localhost:5000";function Em(e){Cm=e}function tl(){return Fs||(Fs=Tm("pyodide")),Fs}function Tm(e){switch(e){case"pyodide":return new qE;case"flask":return new GE(Cm);case"remote":throw new Error(`Backend type '${e}' not yet implemented`);default:throw new Error(`Unknown backend type: ${e}`)}}function Im(e){return Fs&&Fs.terminate(),Fs=Tm(e),Fs}async function UE(){if(typeof window>"u")return;const e=new URLSearchParams(window.location.search),t=e.get("backend"),n=e.get("host");t==="flask"&&(n&&Em(n),Im("flask"),await Xc())}async function YE(){if(!(typeof window>"u"||new URLSearchParams(window.location.search).has("backend")))try{const t=await fetch("/api/health",{method:"GET",signal:AbortSignal.timeout(2e3)});t.ok&&(await t.json()).status==="ok"&&(Em(window.location.origin),Im("flask"),await Xc())}catch{}}const or={subscribe:en.subscribe};async function Xc(){const e=tl();e.onStdout(n=>Bt.output(n)),e.onStderr(n=>Bt.error(n));const t=e.subscribe(n=>{n.progress&&n.loading&&Bt.info(n.progress)});try{Bt.info("Initializing Python REPL..."),await e.init(),Bt.info("Python REPL ready")}finally{t()}}async function pn(e,t){return tl().exec(e,t)}async function ZE(e,t){return tl().evaluate(e,t)}function JE(e,t,n,i){tl().startStreaming(e,t,n,i)}function Nm(){tl().stopStreaming()}const QE=`
import json
import gc
import numpy as np

def _to_json(obj):
    """Convert Python object to JSON-serializable form."""
    if hasattr(obj, 'tolist'):
        return obj.tolist()
    if isinstance(obj, (set, frozenset)):
        return list(obj)
    if isinstance(obj, bytes):
        return obj.decode('utf-8', errors='replace')
    return obj

def _step_streaming_gen():
    """Step the streaming generator and return result dict."""
    global _sim_streaming, _sim_gen
    if '_sim_gen' not in globals() or not _sim_streaming:
        return {'done': True, 'result': None}
    try:
        result = next(_sim_gen)
        return {'done': False, 'result': result}
    except StopIteration:
        _sim_streaming = False
        return {'done': True, 'result': None}

def _extract_scope_data(blocks, node_id_map, incremental=False):
    """Extract data from Scope blocks recursively.

    If incremental=True, only returns data accumulated since last read.
    """
    scope_data = {}

    def find_scopes(block_list):
        for block in block_list:
            block_name = type(block).__name__
            block_id = node_id_map.get(id(block), str(id(block)))

            if block_name == 'Scope':
                try:
                    data = block.read(incremental=incremental)
                    if data is not None:
                        time_arr, signals = data
                        labels = list(block.labels) if hasattr(block, 'labels') and block.labels else []
                        scope_data[block_id] = {
                            'time': time_arr.tolist() if hasattr(time_arr, 'tolist') else list(time_arr),
                            'signals': [s.tolist() if hasattr(s, 'tolist') else list(s) for s in signals],
                            'labels': labels
                        }
                except Exception as e:
                    print(f"Error reading Scope: {e}")
            elif block_name == 'Subsystem':
                if hasattr(block, 'blocks'):
                    find_scopes(block.blocks)

    find_scopes(blocks)
    return scope_data


def _extract_spectrum_data(blocks, node_id_map):
    """Extract data from Spectrum blocks recursively."""
    spectrum_data = {}

    def find_spectrums(block_list):
        for block in block_list:
            block_name = type(block).__name__
            block_id = node_id_map.get(id(block), str(id(block)))

            if block_name == 'Spectrum':
                try:
                    data = block.read()
                    if data is not None:
                        freq_arr, magnitude = data

                        # Convert complex to magnitude if needed
                        if np.iscomplexobj(magnitude):
                            magnitude = np.abs(magnitude)

                        freq_list = freq_arr.tolist() if hasattr(freq_arr, 'tolist') else list(freq_arr)

                        # Handle both single array and list of arrays
                        if hasattr(magnitude, 'ndim') and magnitude.ndim == 1:
                            mag_list = [magnitude.tolist()]
                        elif hasattr(magnitude, 'ndim') and magnitude.ndim == 2:
                            mag_list = [m.tolist() for m in magnitude]
                        else:
                            mag_list = [m.tolist() if hasattr(m, 'tolist') else list(m) for m in magnitude]

                        labels = list(block.labels) if hasattr(block, 'labels') and block.labels else []
                        spectrum_data[block_id] = {
                            'frequency': freq_list,
                            'magnitude': mag_list,
                            'labels': labels
                        }
                except Exception as e:
                    print(f"Error reading Spectrum: {e}")
            elif block_name == 'Subsystem':
                if hasattr(block, 'blocks'):
                    find_spectrums(block.blocks)

    find_spectrums(blocks)
    return spectrum_data


def _extract_all_data(blocks, node_id_map, node_name_map=None, incremental=False):
    """Extract all recording block data.

    If incremental=True, only returns data accumulated since last read.
    """
    return {
        'scopeData': _extract_scope_data(blocks, node_id_map, incremental=incremental),
        'spectrumData': _extract_spectrum_data(blocks, node_id_map),
        'nodeNames': node_name_map or {}
    }
`;function $E(e){return`
import sys
import traceback

_simulation_error = None

try:
${sT(e,4)}
except Exception as e:
    tb = traceback.format_exc()
    _simulation_error = f"{type(e).__name__}: {e}"
    print("=" * 60, file=sys.stderr)
    print("SIMULATION ERROR", file=sys.stderr)
    print("=" * 60, file=sys.stderr)
    print(tb, file=sys.stderr)
    print("=" * 60, file=sys.stderr)
    raise
`}function eT(e){return`
import base64

_validation_namespace = {'np': np}
_validation_errors = []

# Decode and execute code context
_code_context = base64.b64decode("${e}").decode('utf-8')
try:
    exec(_code_context, _validation_namespace)
except Exception as e:
    _validation_errors.append({
        'nodeId': '__code_context__',
        'param': '',
        'error': f"Code context error: {type(e).__name__}: {e}"
    })
`}function tT(e){return`
import json
import base64

if not _validation_errors:
    _node_params = json.loads(base64.b64decode("${e}").decode('utf-8'))

    for node_id, params in _node_params.items():
        for param_name, expr in params.items():
            if expr is None or expr == '':
                continue
            try:
                eval(str(expr), _validation_namespace)
            except Exception as e:
                _validation_errors.append({
                    'nodeId': node_id,
                    'param': param_name,
                    'error': f"{type(e).__name__}: {e}"
                })
`}const nT="{'valid': len(_validation_errors) == 0, 'errors': _validation_errors}",Pm=`
import gc
_cg = globals().get('_clean_globals', None)
if _cg is not None:
    for _var in list(globals().keys()):
        if _var not in _cg and _var != '_cg':
            try:
                del globals()[_var]
            except:
                pass
    del _cg
gc.collect()
`,Mm=`
import gc
for _var in ['_simulation_error', '_validation_errors', '_validation_namespace']:
    if _var in globals():
        try:
            del globals()[_var]
        except:
            pass
gc.collect()
`;function Am(e,t=10,n=!0){return`
_sim_gen = sim.run_streaming(
    duration=${e},
    reset=${n?"True":"False"},
    tickrate=${t},
    func_callback=lambda: _extract_all_data(blocks, _node_id_map, _node_name_map if '_node_name_map' in globals() else {}, incremental=True)
)
_sim_streaming = True
`}const iT="_step_streaming_gen()",$a=`
_sim_streaming = False
if '_sim_gen' in globals():
    try:
        _sim_gen.close()
    except:
        pass
`;function sT(e,t){const n=" ".repeat(t);return e.split(`
`).map(i=>n+i).join(`
`)}function Vp(e){return btoa(unescape(encodeURIComponent(e)))}const Wp={phase:"idle",progress:"",error:null,result:null,resultHistory:[]},nn={...nt({...Wp}),reset(){this.set({...Wp,resultHistory:[]})}};function oT(e){return e?{scopeData:Object.fromEntries(Object.entries(e.scopeData).map(([t,n])=>[t,{time:[],signals:n.signals.map(()=>[]),labels:n.labels}])),spectrumData:Object.fromEntries(Object.entries(e.spectrumData).map(([t,n])=>[t,{frequency:[],magnitude:n.magnitude.map(()=>[]),labels:n.labels}])),nodeNames:{...e.nodeNames}}:{scopeData:{},spectrumData:{},nodeNames:{}}}let _c=!1,kn=!1;function Dm(e,t,n){return n===0?[]:e?[e,...t].slice(0,n):t}function Kp(e,t){if(!e)return t;const n={...e.scopeData};for(const[i,s]of Object.entries(t.scopeData))n[i]?n[i]={time:[...n[i].time,...s.time],signals:n[i].signals.map((o,a)=>[...o,...s.signals[a]||[]]),labels:s.labels||n[i].labels}:n[i]=s;return{scopeData:n,spectrumData:t.spectrumData,nodeNames:{...e.nodeNames,...t.nodeNames}}}async function hf(){_c||(await pn(QE),_c=!0)}async function Rm(){await Xc(),await hf()}const Om=10,aT=10;async function zm(e,t){let n=e;const i=[];let s=null,o=0,a=e;function l(d){if(i.length>0&&d-o>=1e3/aT){for(;i.length>0;){const c=i.shift();n=Kp(n,c)}a=n,o=d,kn&&nn.update(c=>({...c,result:n}))}kn&&(s=requestAnimationFrame(l))}for(s=requestAnimationFrame(l),await new Promise((d,c)=>{JE(iT,u=>{u.result&&i.push(u.result)},()=>d(),u=>c(u))});i.length>0;){const d=i.shift();n=Kp(n,d)}return a=n,s!==null&&cancelAnimationFrame(s),a}async function rT(e,t,n){de(or).initialized||await Xc(),kn=!0;const s=Pn.get().ghostTraces;nn.update(o=>({...o,phase:"starting",progress:km.STARTING_SIMULATION,error:null,result:s>0?oT(o.result):o.result,resultHistory:Dm(o.result,o.resultHistory,s)}));try{await pn(Pm),_c=!1,await hf();const o=$E(e);await pn(o),await pn(Am(t,Om)),nn.update(l=>({...l,phase:"running"})),Bt.info("Streaming simulation started");const a=await zm(null,n);return await pn($a),await pn(Mm),nn.update(l=>!kn&&l.result===null?l:{...l,phase:kn?"complete":"idle",progress:kn?Gs.COMPLETE:Gs.STOPPED,result:a}),kn&&Bt.info(BE.SIMULATION_COMPLETED),a}catch(o){const a=o instanceof Error?o.message:String(o);Bt.error(`Streaming simulation failed: ${a}`);try{await pn($a)}catch{}throw nn.update(l=>({...l,phase:"error",error:a})),o}finally{kn=!1}}async function lT(e,t){if(!de(or).initialized)throw new Error("No simulation to continue. Run a simulation first.");await hf(),kn=!0,nn.update(i=>({...i,phase:"starting",progress:"Continuing simulation...",error:null,resultHistory:Dm(i.result,i.resultHistory,Pn.get().ghostTraces)}));try{await pn(`
if 'sim' not in dir() or sim is None:
    raise RuntimeError("No simulation to continue. Run a simulation first.")
		`),await pn(Am(e,Om,!1)),nn.update(o=>({...o,phase:"running"})),Bt.info("Continuing simulation (streaming)...");const i=de(nn).result,s=await zm(i,t);return await pn($a),nn.update(o=>!kn&&o.result===null?o:{...o,phase:kn?"complete":"idle",progress:kn?Gs.COMPLETE:Gs.STOPPED,result:s}),kn&&Bt.info("Simulation continued successfully"),s}catch(i){const s=i instanceof Error?i.message:String(i);Bt.error(`Continue simulation failed: ${s}`);try{await pn($a)}catch{}throw nn.update(o=>({...o,phase:"error",error:s})),i}finally{kn=!1}}async function Lm(){if(Nm(),kn=!1,nn.reset(),de(or).initialized)try{await pn($a,Hn.VALIDATION),await pn(Pm)}catch{}_c=!1}async function cT(e,t){de(or).initialized||await Rm();try{const i=Vp(e);await pn(eT(i),Hn.VALIDATION);const s=Vp(JSON.stringify(t));await pn(tT(s),Hn.VALIDATION);const o=await ZE(nT,Hn.VALIDATION);return await pn(Mm),o}catch(i){return{valid:!1,errors:[{nodeId:"__validation__",param:"",error:i instanceof Error?i.message:String(i)}]}}}async function jp(){if(Nm(),kn=!1,nn.update(t=>({...t,phase:"idle",progress:Gs.STOPPED,error:null})),!!de(or).initialized)try{await pn($a,Hn.VALIDATION),await pn(`
if 'sim' in dir() and sim is not None:
    sim.stop()
		`,Hn.VALIDATION)}catch{}}function dT(e){nn.update(t=>({...t,resultHistory:t.resultHistory.slice(0,e)}))}const mu={lineStyle:"solid",markerStyle:null},xc={xAxisScale:"linear",yAxisScale:"linear",showLegend:!1},Hm={traces:{},blocks:{}},Os=nt({...Hm}),vn={subscribe:Os.subscribe,getTraceSettings(e){return de(Os).traces[e]??{...mu}},getBlockSettings(e){return de(Os).blocks[e]??{...xc}},setTraceSettings(e,t){Os.update(n=>{const i=n.traces[e]??{...mu};return{...n,traces:{...n.traces,[e]:{...i,...t}}}})},setBlockSettings(e,t){Os.update(n=>{const i=n.blocks[e]??{...xc};return{...n,blocks:{...n.blocks,[e]:{...i,...t}}}})},setTraceLineStyle(e,t){this.setTraceSettings(e,{lineStyle:t})},setTraceMarkerStyle(e,t){this.setTraceSettings(e,{markerStyle:t})},setBlockXAxisScale(e,t){this.setBlockSettings(e,{xAxisScale:t})},setBlockYAxisScale(e,t){this.setBlockSettings(e,{yAxisScale:t})},setBlockShowLegend(e,t){this.setBlockSettings(e,{showLegend:t})},reset(){Os.set({...Hm})},get(){return de(Os)}};function vu(e,t){return`${e}-${t}`}const uT=15,fT=400,Od=.5,pT=.2;function hT(e,t){if(t<=1)return Od;const n=Od-pT;return Od-e/(t-1)*n}const Xp=["#E57373","#81C784","#64B5F6","#BA68C8","#4DD0E1","#FFB74D","#F06292","#4DB6AC","#90A4AE"];function Fm(e,t){return e===0?t:Xp[(e-1)%Xp.length]}function Bm(){return typeof document>"u"?"#0070C0":getComputedStyle(document.documentElement).getPropertyValue("--accent").trim()||"#0070C0"}const gT={solid:"solid",dash:"dash",dot:"dot"},qm={solid:"",dash:"6,3",dot:"2,2"},mT={circle:"circle",square:"square","triangle-up":"triangle-up"},Vm=224,Wm=96,Km=8;function vT(e,t,n=fT){const i=e.length;if(i===0)return{x:[],y:[],xMin:0,xMax:1,yMin:0,yMax:1};if(i<=n*2){let p=t[0],f=t[0];for(let h=1;h<i;h++)t[h]<p&&(p=t[h]),t[h]>f&&(f=t[h]);return{x:e,y:t,xMin:e[0],xMax:e[i-1],yMin:p,yMax:f}}const s=i/n,o=[],a=[];let l=1/0,d=-1/0;for(let p=0;p<n;p++){const f=Math.floor(p*s),h=Math.floor((p+1)*s);let g=f,y=f,b=t[f],m=t[f];for(let x=f+1;x<h&&x<i;x++)t[x]<b&&(b=t[x],g=x),t[x]>m&&(m=t[x],y=x);g<=y?(o.push(e[g]),a.push(t[g]),y!==g&&(o.push(e[y]),a.push(t[y]))):(o.push(e[y]),a.push(t[y]),o.push(e[g]),a.push(t[g])),b<l&&(l=b),m>d&&(d=m)}const c=e[i-1],u=t[i-1];return o[o.length-1]!==c&&(o.push(c),a.push(u)),{x:o,y:a,xMin:e[0],xMax:e[i-1],yMin:l,yMax:d}}function yT(e){let t=1/0,n=-1/0,i=1/0,s=-1/0;for(const{x:o,y:a}of e)for(let l=0;l<o.length;l++)o[l]<t&&(t=o[l]),o[l]>n&&(n=o[l]),a[l]<i&&(i=a[l]),a[l]>s&&(s=a[l]);return isFinite(t)||(t=0),isFinite(n)||(n=1),isFinite(i)||(i=0),isFinite(s)||(s=1),{xMin:t,xMax:n,yMin:i,yMax:s}}function Gp(e){return e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"k":e>=1?e.toFixed(1):e.toExponential(1)}function Da(e){return typeof document>"u"?"":getComputedStyle(document.documentElement).getPropertyValue(e).trim()}function Up(e,t){if(t==="scope"){const n=e;return{x:n.time||[],ys:n.signals||[],labels:n.labels}}else{const n=e;return{x:n.frequency?Array.from({length:n.frequency.length},(s,o)=>o):[],ys:n.magnitude||[],labels:n.labels}}}function Yp(e,t,n,i,s,o,a){const l=Fm(e,o),d={lineStyle:s.lineStyle,markerStyle:s.markerStyle,color:l,visible:s.lineStyle!==null||s.markerStyle!==null};if(!d.visible)return null;const c=vT(t,n);return{signalIndex:e,label:i,x:t,y:n,xDecimated:c.x,yDecimated:c.y,style:d,ghost:a}}function Zp(e){const{nodeId:t,type:n,title:i,data:s,ghostData:o,getTraceSettings:a,blockSettings:l,accentColor:d}=e,c=[],u=[],p=o.length;for(let g=p-1;g>=0;g--){const y=o[g];if(!y)continue;const{x:b,ys:m,labels:x}=Up(y,n);if(b.length===0)continue;const S=hT(g,p);for(let v=0;v<m.length;v++){const A=m[v];if(!A||A.length===0)continue;const w=x?.[v]??`port ${v}`,k=a(v),N=Yp(v,b,A,w,k,d,{index:g,total:p,opacity:S});N&&(c.push(N),u.push({x:b,y:A}))}}if(s){const{x:g,ys:y,labels:b}=Up(s,n);if(g.length>0)for(let m=0;m<y.length;m++){const x=y[m];if(!x||x.length===0)continue;const S=b?.[m]??`port ${m}`,v=a(m),A=Yp(m,g,x,S,v,d,null);A&&(c.push(A),u.push({x:g,y:x}))}}const f=yT(u);let h;return n==="spectrum"&&s&&(h=s.frequency),{nodeId:t,type:n,title:i,traces:c,layout:{xAxisScale:l.xAxisScale,yAxisScale:l.yAxisScale,showLegend:l.showLegend},bounds:f,frequencies:h}}function bT(e){const{fps:t,name:n="RenderQueue"}=e,i=1e3/t,s=new Map;let o=null,a=0,l=!0;function d(){l=document.visibilityState==="visible",l&&s.size>0&&o===null&&c()}typeof document<"u"&&document.addEventListener("visibilitychange",d);function c(){o===null&&(o=requestAnimationFrame(u))}function u(p){if(o=null,!l||s.size===0)return;if(p-a<i){c();return}a=p;const f=Array.from(s.values());s.clear();for(const h of f)try{h()}catch(g){console.error(`[${n}] Task error:`,g)}s.size>0&&c()}return{enqueue(p,f){s.set(p,f),l&&c()},cancel(p){s.delete(p)},isVisible(){return l},destroy(){o!==null&&(cancelAnimationFrame(o),o=null),s.clear(),typeof document<"u"&&document.removeEventListener("visibilitychange",d)}}}const wT=bT({fps:uT,name:"PlotRenderQueue"}),Sr=nt({plots:new Map,isStreaming:!1,lastUpdateTime:0}),_T=Symbol("plotDataStore");function xT(e,t,n){const i=new Map;if(!e)return i;const s=Bm(),o=(l,d)=>e.nodeNames?.[l]||d,a=(l,d)=>t.slice(0,n).map(u=>d==="scope"?u.scopeData?.[l]:u.spectrumData?.[l]).filter(u=>u!=null);if(e.scopeData)for(const[l,d]of Object.entries(e.scopeData)){const c=Zp({nodeId:l,type:"scope",title:o(l,"Scope"),data:d,ghostData:a(l,"scope"),getTraceSettings:u=>vn.getTraceSettings(vu(l,u)),blockSettings:vn.getBlockSettings(l),accentColor:s});i.set(l,c)}if(e.spectrumData)for(const[l,d]of Object.entries(e.spectrumData)){de(vn).blocks[l]||vn.setBlockYAxisScale(l,"log");const u=Zp({nodeId:l,type:"spectrum",title:o(l,"Spectrum"),data:d,ghostData:a(l,"spectrum"),getTraceSettings:p=>vn.getTraceSettings(vu(l,p)),blockSettings:vn.getBlockSettings(l),accentColor:s});i.set(l,u)}return i}let Jp=null,Qp=[],$p=0;function gf(){wT.enqueue(_T,()=>{const e=de(nn),n=de(Pn).ghostTraces??0,i=xT(e.result,e.resultHistory,n);Sr.set({plots:i,isStreaming:e.phase==="running",lastUpdateTime:Date.now()})})}nn.subscribe(e=>{(e.result!==Jp||e.resultHistory!==Qp)&&(Jp=e.result,Qp=e.resultHistory,gf())});Pn.subscribe(e=>{(e.ghostTraces??0)!==$p&&($p=e.ghostTraces??0,gf())});vn.subscribe(()=>{gf()});const Gc={subscribe:Sr.subscribe,getPlot(e){return de(Sr).plots.get(e)},getAllPlots(){return Array.from(de(Sr).plots.values())},isStreaming(){return de(Sr).isStreaming}},Ct=10,On={unit:Ct,x2:Ct*2,x4:Ct*4,x10:Ct*10,px:e=>e*Ct},kT=[Ct,Ct],ST=On.x2,Ar={baseWidth:On.px(8),baseHeight:On.x4,portSpacing:On.x2},CT=On.x4,Cr={columnWidth:On.x4,rowHeight:On.x4};function Nl(e){return Math.ceil(e/On.x2)*On.x2}function ET(e,t){return t<=0||t===1?0:-((t-1)*Ar.portSpacing)/2+e*Ar.portSpacing}function xs(e,t){const n=ET(e,t);return n===0?"50%":`calc(50% + ${n}px)`}const TT=14;function IT(e,t,n,i,s,o,a,l,d){const c=s===1||s===3,u=Math.max(t,n),p=Math.max(1,u)*Ar.portSpacing,f=i>0?7+24*i:0,h=i>0?160:0,g=o?o.length*5+20:0,y=d?Nl(d.width+24):e.length*6+20;let b=Nl(Math.max(Ar.baseWidth,y,g,h,c?p:0)),m;d&&d.height>TT*1.2?m=d.height+24+f:m=Ar.baseHeight+f;let x=b,S=Nl(c?m:Math.max(m,p));return c?(a&&(S+=Cr.rowHeight),l&&(S+=Cr.rowHeight)):(a&&(x+=Cr.columnWidth),l&&(x+=Cr.columnWidth)),{width:x,height:S}}function NT(e,t){const n=e.params?._showInputLabels??t,i=e.params?._showOutputLabels??t;return{inputs:n&&e.inputs.length>0,outputs:i&&e.outputs.length>0}}function Pl(e,t=5){return e.length>t?e.slice(0,t):e}let Ml=null;async function mf(){return Ml||(Ml=await oi(()=>import("../chunks/XbL3y5x-.js"),[],import.meta.url),Ml)}function vf(){return"https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"}const $l=new Map;function jm(e){return/\$[^$\n]+\$/.test(e)}async function PT(e){if(!e?.trim())return{html:"",hasMath:!1};const t=$l.get(e);if(t)return t;if(!jm(e)){const a={html:th(e),hasMath:!1};return $l.set(e,a),a}const n=await mf();let i=!1;const o={html:e.replace(/\$([^$\n]+)\$/g,(a,l)=>{i=!0;try{return n.default.renderToString(l.trim(),{displayMode:!1,throwOnError:!1,strict:!1,output:"html"})}catch{return`<code class="math-error">${th(l)}</code>`}}),hasMath:i};return $l.set(e,o),o}function MT(e){return $l.get(e)??null}function eh(e){const t=document.createElement("span");t.style.cssText=`
		position: absolute;
		visibility: hidden;
		white-space: nowrap;
		font-size: 10px;
		font-weight: 600;
		font-family: system-ui, -apple-system, sans-serif;
		letter-spacing: -0.2px;
	`,t.innerHTML=e,document.body.appendChild(t);const n={width:Math.ceil(t.scrollWidth),height:Math.ceil(t.scrollHeight)};return document.body.removeChild(t),n}function th(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}const AT=1e-10;function nh(e,t){return t==="log"?Math.log10(Math.max(e,AT)):e}function ih(e,t,n){if(n==="log"){const s=e>0?e:1,o=Math.max(t,s),a=Math.log10(s),l=Math.log10(o),d=l-a||1;return{scaledMin:a,scaledMax:l,range:d}}const i=t-e||1;return{scaledMin:e,scaledMax:t,range:i}}function DT(e,t=Vm,n=Wm,i=Km){const{traces:s,bounds:o,layout:a}=e;if(s.length===0)return[];const{xMin:l,xMax:d,yMin:c,yMax:u}=o,p=a.xAxisScale,f=a.yAxisScale,h=ih(l,d,p),g=ih(c,u,f),y=t-i*2,b=n-i*2;return s.map(m=>{const{xDecimated:x,yDecimated:S,style:v,ghost:A}=m,w=[];for(let k=0;k<x.length;k++){const N=x[k],L=S[k];if(p==="log"&&N<=0||f==="log"&&L<=0)continue;const X=nh(N,p),O=nh(L,f),I=i+(X-h.scaledMin)/h.range*y,H=n-i-(O-g.scaledMin)/g.range*b,P=Math.max(i,Math.min(t-i,I)),T=Math.max(i,Math.min(n-i,H)),R=w.length===0?"M":"L";w.push(`${R}${P.toFixed(1)},${T.toFixed(1)}`)}return{d:w.join(" "),color:v.color,opacity:A?.opacity??1,strokeWidth:A?.7:1,dasharray:v.lineStyle?qm[v.lineStyle]:""}})}var RT=ye('<path fill="none" stroke-linecap="round" stroke-linejoin="round"></path>'),OT=ye('<text text-anchor="middle" class="no-data-text svelte-1i5tbyr" font-size="11" font-family="Inter, sans-serif">No data</text>'),zT=Z('<div class="preview-container svelte-1i5tbyr"><svg class="svelte-1i5tbyr"><rect x="0" y="0" rx="4" class="plot-bg svelte-1i5tbyr"></rect><!></svg></div>');function LT(e,t){Oe(t,!0);const n=Vm,i=Wm,s=Km;let o=$(Et([]));const a=Gc.subscribe(g=>{const y=g.plots.get(t.nodeId);y?E(o,DT(y,n,i,s),!0):E(o,[],!0)});jt(()=>{a()});const l=D(()=>()=>r(o).length>0);var d=zT(),c=M(d),u=M(c),p=q(u);{var f=g=>{var y=pe(),b=ae(y);it(b,17,()=>r(o),_t,(m,x)=>{var S=RT();G(()=>{z(S,"d",r(x).d),z(S,"stroke",r(x).color),z(S,"stroke-width",r(x).strokeWidth),z(S,"stroke-dasharray",r(x).dasharray),z(S,"opacity",r(x).opacity)}),_(m,S)}),_(g,y)},h=g=>{var y=OT();G(()=>{z(y,"x",n/2),z(y,"y",i/2+4)}),_(g,y)};j(p,g=>{r(l)()?g(f):g(h,!1)})}C(c),C(d),G(()=>{z(c,"width",n),z(c,"height",i),z(c,"viewBox",`0 0 ${n} ${i}`),z(u,"width",n),z(u,"height",i)}),_(e,d),ze()}var HT=Z('<link rel="stylesheet"/>'),FT=Z("<div><!></div>"),BT=Z('<div class="selection-glow svelte-1d5s31p"></div>'),qT=Z('<span class="port-label svelte-1d5s31p"> </span>'),VT=Z('<div class="port-labels port-labels-input port-labels-row svelte-1d5s31p"></div>'),WT=Z('<span class="port-label svelte-1d5s31p"> </span>'),KT=Z('<div class="port-labels port-labels-input svelte-1d5s31p"></div>'),jT=Z('<span class="node-name svelte-1d5s31p"><!></span>'),XT=Z('<span class="node-name svelte-1d5s31p"> </span>'),GT=Z('<span class="node-type svelte-1d5s31p"> </span>'),UT=Z('<div class="pinned-param svelte-1d5s31p"><label class="svelte-1d5s31p"> </label> <input type="text" class="svelte-1d5s31p"/></div>'),YT=Z('<div class="pinned-params svelte-1d5s31p"></div>'),ZT=Z('<span class="port-label svelte-1d5s31p"> </span>'),JT=Z('<div class="port-labels port-labels-output port-labels-row svelte-1d5s31p"></div>'),QT=Z('<span class="port-label svelte-1d5s31p"> </span>'),$T=Z('<div class="port-labels port-labels-output svelte-1d5s31p"></div>'),eI=Z('<div><button class="port-btn svelte-1d5s31p" title="Add input">+</button> <button class="port-btn svelte-1d5s31p" title="Remove input">-</button></div>'),tI=Z('<div><button class="port-btn svelte-1d5s31p" title="Add output">+</button> <button class="port-btn svelte-1d5s31p" title="Remove output">-</button></div>'),nI=Z('<div><!> <!> <div class="node-clip svelte-1d5s31p"><!> <div class="node-inner svelte-1d5s31p"><div class="node-content svelte-1d5s31p"><!> <!></div> <!></div> <!></div> <!> <!> <!> <!></div>');function iI(e,t){Oe(t,!0);let n=_e(t,"selected",3,!1);const i=tm(),s=D(()=>Qt.get(t.data.type)),o=D(()=>r(s)?.category||"Algebraic"),a=D(()=>()=>{if(!t.data.pinnedParams?.length||!r(s))return[];const ce=new Set(r(s).params.map(xe=>xe.name));return t.data.pinnedParams.filter(xe=>ce.has(xe))}),l=D(()=>r(o)==="Recording");let d=$(!1),c=null,u=$(!1),p=$(!1),f=$(!1),h=$(!1);const g=Zl.subscribe(ce=>{E(f,ce,!0)}),y=Gc.subscribe(ce=>{E(h,ce.plots.has(t.id),!0)});let b=$(!1);const m=ff.subscribe(ce=>{E(b,ce,!0)}),x=D(()=>t.data.params?._showInputLabels),S=D(()=>t.data.params?._showOutputLabels),v=D(()=>r(x)??r(b)),A=D(()=>r(S)??r(b)),w=D(()=>r(v)&&t.data.inputs.length>0),k=D(()=>r(A)&&t.data.outputs.length>0),N=D(()=>r(w)||r(k));ut(()=>{(r(v)!==void 0||r(A)!==void 0)&&i(t.id)}),jt(()=>{g(),y(),m(),c&&clearTimeout(c)}),ut(()=>{r(f)&&r(h)&&E(u,!0)});function L(){r(l)&&(E(d,!0),c=setTimeout(()=>{r(d)&&(E(u,!0),E(p,!0))},300))}function X(){E(d,!1),E(p,!1),c&&(clearTimeout(c),c=null)}const O=D(()=>jm(t.data.name));let I=$(null),H=$(null),P=$(null);ut(()=>{if(r(O)){const ce=MT(t.data.name);if(ce){E(I,ce.html,!0);const xe=eh(ce.html);E(H,xe.width,!0),E(P,xe.height,!0),i(t.id)}else PT(t.data.name).then(xe=>{E(I,xe.html,!0);const Ve=eh(xe.html);E(H,Ve.width,!0),E(P,Ve.height,!0),i(t.id)})}else E(I,null),E(H,null),E(P,null)});const T=D(()=>r(s)?.ports.maxInputs===null),R=D(()=>r(s)?.ports.maxOutputs===null),B=D(()=>r(s)?.ports.syncPorts??!1),V=D(()=>t.data.params?._rotation||0),F=D(()=>()=>{switch(r(V)){case 1:return We.Top;case 2:return We.Right;case 3:return We.Bottom;default:return We.Left}}),Y=D(()=>()=>{switch(r(V)){case 1:return We.Bottom;case 2:return We.Left;case 3:return We.Top;default:return We.Right}}),J=D(()=>r(V)===1||r(V)===3),ie=D(()=>()=>{switch(r(V)){case 1:return"bottom";case 2:return"left";case 3:return"top";default:return"right"}}),ve=D(()=>r(a)().length),re=D(()=>r(O)&&r(H)!==null&&r(P)!==null?{width:r(H),height:r(P)}:null),me=D(()=>IT(t.data.name,t.data.inputs.length,t.data.outputs.length,r(ve),r(V),r(s)?.name,r(w),r(k),r(re))),ge=D(()=>()=>{if(!r(N))return{columns:void 0,rows:void 0,inputStyle:"",innerStyle:"",outputStyle:""};const ce=`${Cr.columnWidth}px`;let xe,Ve,lt="",et="",tt="";if(r(J)){const Ge=r(V)===1?"border-bottom":"border-top",ct=r(V)===1?"border-top":"border-bottom",mt="grid-column: 1;";if(r(w)&&r(k))Ve=`${ce} 1fr ${ce}`,r(V)===1?(lt=`${mt} grid-row: 1; ${Ge}: 1px solid var(--border);`,et=`${mt} grid-row: 2;`,tt=`${mt} grid-row: 3; ${ct}: 1px solid var(--border);`):(tt=`${mt} grid-row: 1; ${ct}: 1px solid var(--border);`,et=`${mt} grid-row: 2;`,lt=`${mt} grid-row: 3; ${Ge}: 1px solid var(--border);`);else if(r(w)){Ve=r(V)===1?`${ce} 1fr`:`1fr ${ce}`;const Nt=r(V)===1?1:2,ft=r(V)===1?2:1;lt=`${mt} grid-row: ${Nt}; ${Ge}: 1px solid var(--border);`,et=`${mt} grid-row: ${ft};`}else if(r(k)){Ve=r(V)===1?`1fr ${ce}`:`${ce} 1fr`;const Nt=r(V)===1?2:1,ft=r(V)===1?1:2;tt=`${mt} grid-row: ${Nt}; ${ct}: 1px solid var(--border);`,et=`${mt} grid-row: ${ft};`}}else{const Ge="grid-row: 1;",ct=r(V)===0?"border-right":"border-left",mt=r(V)===0?"border-left":"border-right";if(r(w)&&r(k))xe=`${ce} 1fr ${ce}`,r(V)===0?(lt=`${Ge} grid-column: 1; ${ct}: 1px solid var(--border);`,et=`${Ge} grid-column: 2;`,tt=`${Ge} grid-column: 3; ${mt}: 1px solid var(--border);`):(tt=`${Ge} grid-column: 1; ${mt}: 1px solid var(--border);`,et=`${Ge} grid-column: 2;`,lt=`${Ge} grid-column: 3; ${ct}: 1px solid var(--border);`);else if(r(w)){xe=r(V)===0?`${ce} 1fr`:`1fr ${ce}`;const Nt=r(V)===0?1:2,ft=r(V)===0?2:1;lt=`${Ge} grid-column: ${Nt}; ${ct}: 1px solid var(--border);`,et=`${Ge} grid-column: ${ft};`}else if(r(k)){xe=r(V)===0?`1fr ${ce}`:`${ce} 1fr`;const Nt=r(V)===0?2:1,ft=r(V)===0?1:2;tt=`${Ge} grid-column: ${Nt}; ${mt}: 1px solid var(--border);`,et=`${Ge} grid-column: ${ft};`}}return{columns:xe,rows:Ve,inputStyle:lt,innerStyle:et,outputStyle:tt}}),Q=D(()=>_i(t.data)),oe=D(()=>t.data.type===yt.INTERFACE),ue=D(()=>r(Q)||r(oe));function le(ce){ce.stopPropagation(),r(Q)?ee.drillDown(t.id):Ul(t.id)}function te(ce){ce.stopPropagation(),De.mutate(()=>ee.addInputPort(t.id))}const be=D(()=>r(s)?.ports.minInputs??1),fe=D(()=>r(s)?.ports.minOutputs??1);function Pe(ce){ce.stopPropagation(),t.data.inputs.length>r(be)&&De.mutate(()=>ee.removeInputPort(t.id))}function Re(ce){ce.stopPropagation(),De.mutate(()=>ee.addOutputPort(t.id))}function Se(ce){ce.stopPropagation(),t.data.outputs.length>r(fe)&&De.mutate(()=>ee.removeOutputPort(t.id))}const Ce=D(()=>()=>r(s)?om(r(s)):"shape-default"),ke=D(()=>t.data.color||"var(--accent)");function Ne(ce,xe){De.mutate(()=>ee.updateNodeParams(t.id,{[ce]:xe}))}function $e(ce){return ce==null?"":typeof ce=="object"?JSON.stringify(ce):String(ce)}function Me(ce){return ce==null?"None":typeof ce=="object"?JSON.stringify(ce):String(ce)}function Ae(){switch(r(V)){case 1:return"top";case 2:return"right";case 3:return"bottom";default:return"left"}}function xt(){switch(r(V)){case 1:return"bottom";case 2:return"left";case 3:return"top";default:return"right"}}function It(ce,xe){kr.set({nodeId:t.id,handleId:xe.id,color:r(ke)}),gu(xe.name,ce.currentTarget,Ae())}function U(ce){kr.set(null),wc()}function we(ce,xe){kr.set({nodeId:t.id,handleId:xe.id,color:r(ke)}),gu(xe.name,ce.currentTarget,xt())}function W(ce){kr.set(null),wc()}ut(()=>{n()?hu.set({nodeId:t.id,color:r(ke)}):hu.update(ce=>ce?.nodeId===t.id?null:ce)});var se=nI();Ac("1d5s31p",ce=>{var xe=HT();G(Ve=>z(xe,"href",Ve),[vf]),_(ce,xe)});let he;se.__dblclick=le;var Be=M(se);{var Ye=ce=>{var xe=FT();let Ve;var lt=M(xe);LT(lt,{get nodeId(){return t.id}}),C(xe),G(et=>Ve=qe(xe,1,`plot-preview-popup preview-${et??""}`,"svelte-1d5s31p",Ve,{visible:r(p)||r(f)}),[()=>r(ie)()]),_(ce,xe)};j(Be,ce=>{(r(u)||r(f))&&r(h)&&ce(Ye)})}var je=q(Be,2);{var rt=ce=>{var xe=BT();_(ce,xe)};j(je,ce=>{n()&&ce(rt)})}var Lt=q(je,2);let Le;var st=M(Lt);{var at=ce=>{var xe=pe(),Ve=ae(xe);{var lt=tt=>{var Ge=VT();it(Ge,21,()=>t.data.inputs,_t,(ct,mt,Nt)=>{var ft=qT(),dn=M(ft,!0);C(ft),G((Dt,zt)=>{wt(ft,`left: ${Dt??""};`),Fe(dn,zt)},[()=>xs(Nt,t.data.inputs.length),()=>Pl(r(mt).name)]),_(ct,ft)}),C(Ge),G(ct=>wt(Ge,ct),[()=>r(ge)().inputStyle]),_(tt,Ge)},et=tt=>{var Ge=KT();it(Ge,21,()=>t.data.inputs,_t,(ct,mt,Nt)=>{var ft=WT(),dn=M(ft,!0);C(ft),G((Dt,zt)=>{wt(ft,`top: ${Dt??""};`),Fe(dn,zt)},[()=>xs(Nt,t.data.inputs.length),()=>Pl(r(mt).name)]),_(ct,ft)}),C(Ge),G(ct=>wt(Ge,ct),[()=>r(ge)().inputStyle]),_(tt,Ge)};j(Ve,tt=>{r(J)?tt(lt):tt(et,!1)})}_(ce,xe)};j(st,ce=>{r(w)&&ce(at)})}var Je=q(st,2),Ze=M(Je),bt=M(Ze);{var vt=ce=>{var xe=jT(),Ve=M(xe);Ru(Ve,()=>r(I)),C(xe),_(ce,xe)},kt=ce=>{var xe=XT(),Ve=M(xe,!0);C(xe),G(()=>Fe(Ve,t.data.name)),_(ce,xe)};j(bt,ce=>{r(I)?ce(vt):ce(kt,!1)})}var gt=q(bt,2);{var At=ce=>{var xe=GT(),Ve=M(xe,!0);C(xe),G(()=>Fe(Ve,r(s).name)),_(ce,xe)};j(gt,ce=>{r(s)&&ce(At)})}C(Ze);var gn=q(Ze,2);{var on=ce=>{var xe=YT();xe.__click=Ve=>Ve.stopPropagation(),xe.__dblclick=Ve=>Ve.stopPropagation(),it(xe,21,()=>r(a)(),_t,(Ve,lt)=>{const et=D(()=>r(s).params.find(mt=>mt.name===r(lt)));var tt=pe(),Ge=ae(tt);{var ct=mt=>{var Nt=UT(),ft=M(Nt),dn=M(ft,!0);C(ft);var Dt=q(ft,2);xn(Dt),Dt.__input=zt=>Ne(r(lt),zt.currentTarget.value),Dt.__mousedown=zt=>zt.stopPropagation(),Ee(Dt,zt=>Un?.(zt)),C(Nt),G((zt,cr)=>{z(ft,"for",`pinned-${t.id??""}-${r(lt)??""}`),Fe(dn,r(lt)),z(Dt,"id",`pinned-${t.id??""}-${r(lt)??""}`),An(Dt,zt),z(Dt,"placeholder",cr)},[()=>$e(t.data.params[r(lt)]),()=>Me(r(et).default)]),ht("focus",Dt,zt=>zt.stopPropagation()),_(mt,Nt)};j(Ge,mt=>{r(et)&&mt(ct)})}_(Ve,tt)}),C(xe),_(ce,xe)};j(gn,ce=>{r(a)().length>0&&r(s)&&ce(on)})}C(Je);var Xt=q(Je,2);{var Cn=ce=>{var xe=pe(),Ve=ae(xe);{var lt=tt=>{var Ge=JT();it(Ge,21,()=>t.data.outputs,_t,(ct,mt,Nt)=>{var ft=ZT(),dn=M(ft,!0);C(ft),G((Dt,zt)=>{wt(ft,`left: ${Dt??""};`),Fe(dn,zt)},[()=>xs(Nt,t.data.outputs.length),()=>Pl(r(mt).name)]),_(ct,ft)}),C(Ge),G(ct=>wt(Ge,ct),[()=>r(ge)().outputStyle]),_(tt,Ge)},et=tt=>{var Ge=$T();it(Ge,21,()=>t.data.outputs,_t,(ct,mt,Nt)=>{var ft=QT(),dn=M(ft,!0);C(ft),G((Dt,zt)=>{wt(ft,`top: ${Dt??""};`),Fe(dn,zt)},[()=>xs(Nt,t.data.outputs.length),()=>Pl(r(mt).name)]),_(ct,ft)}),C(Ge),G(ct=>wt(Ge,ct),[()=>r(ge)().outputStyle]),_(tt,Ge)};j(Ve,tt=>{r(J)?tt(lt):tt(et,!1)})}_(ce,xe)};j(Xt,ce=>{r(k)&&ce(Cn)})}C(Lt);var zn=q(Lt,2);{var En=ce=>{var xe=eI();let Ve;var lt=M(xe);lt.__click=te,lt.__dblclick=tt=>tt.stopPropagation();var et=q(lt,2);et.__click=Pe,et.__dblclick=tt=>tt.stopPropagation(),C(xe),G(()=>{Ve=qe(xe,1,"port-controls port-controls-input svelte-1d5s31p",null,Ve,{"port-controls-left":r(V)===0,"port-controls-top":r(V)===1,"port-controls-right":r(V)===2,"port-controls-bottom":r(V)===3}),et.disabled=t.data.inputs.length<=r(be)}),_(ce,xe)};j(zn,ce=>{r(T)&&n()&&ce(En)})}var ln=q(zn,2);{var Gt=ce=>{var xe=tI();let Ve;var lt=M(xe);lt.__click=Re,lt.__dblclick=tt=>tt.stopPropagation();var et=q(lt,2);et.__click=Se,et.__dblclick=tt=>tt.stopPropagation(),C(xe),G(()=>{Ve=qe(xe,1,"port-controls port-controls-output svelte-1d5s31p",null,Ve,{"port-controls-right":r(V)===0,"port-controls-bottom":r(V)===1,"port-controls-left":r(V)===2,"port-controls-top":r(V)===3}),et.disabled=t.data.outputs.length<=r(fe)}),_(ce,xe)};j(ln,ce=>{r(R)&&n()&&!r(B)&&ce(Gt)})}var cn=q(ln,2);Ff(cn,()=>`${r(V)}-${t.data.inputs.length}`,ce=>{var xe=pe(),Ve=ae(xe);it(Ve,17,()=>t.data.inputs,_t,(lt,et,tt)=>{{let Ge=D(()=>r(F)()),ct=D(()=>r(J)?`left: ${xs(tt,t.data.inputs.length)};`:`top: ${xs(tt,t.data.inputs.length)};`);Ja(lt,{type:"target",get position(){return r(Ge)},get id(){return r(et).id},get style(){return r(ct)},class:"handle handle-input",onmouseenter:mt=>It(mt,r(et)),onmouseleave:()=>U(r(et))})}}),_(ce,xe)});var Ii=q(cn,2);Ff(Ii,()=>`${r(V)}-${t.data.outputs.length}`,ce=>{var xe=pe(),Ve=ae(xe);it(Ve,17,()=>t.data.outputs,_t,(lt,et,tt)=>{{let Ge=D(()=>r(Y)()),ct=D(()=>r(J)?`left: ${xs(tt,t.data.outputs.length)};`:`top: ${xs(tt,t.data.outputs.length)};`);Ja(lt,{type:"source",get position(){return r(Ge)},get id(){return r(et).id},get style(){return r(ct)},class:"handle handle-output",onmouseenter:mt=>we(mt,r(et)),onmouseleave:()=>W(r(et))})}}),_(ce,xe)}),C(se),G((ce,xe,Ve)=>{he=qe(se,1,`node ${ce??""}`,"svelte-1d5s31p",he,{selected:n(),vertical:r(J),"preview-hovered":r(p),"subsystem-type":r(ue),"show-labels":r(N)}),z(se,"data-rotation",r(V)),wt(se,`width: ${r(me).width??""}px; height: ${r(me).height??""}px; --node-color: ${r(ke)??""};`),Le=wt(Lt,"",Le,xe),wt(Je,Ve)},[()=>r(Ce)(),()=>({"grid-template-columns":r(ge)().columns,"grid-template-rows":r(ge)().rows}),()=>r(ge)().innerStyle]),ht("mouseenter",se,L),ht("mouseleave",se,X),_(e,se),ze()}Mt(["dblclick","click","input","mousedown"]);const vr=nt(null),yf={subscribe:vr.subscribe,open(e){vr.set(e)},close(){vr.set(null)},isOpen(){return de(vr)!==null},getOpenId(){return de(vr)}},Xm=e=>yf.open(e),zd=()=>yf.close();var sI=Z('<span class="event-type svelte-7puem2"> </span>'),oI=Z('<div><div class="diamond svelte-7puem2"><div class="diamond-inner svelte-7puem2"><span class="event-name svelte-7puem2"> </span> <!></div></div></div>');function aI(e,t){Oe(t,!0);let n=_e(t,"selected",3,!1);const i=D(()=>ti.get(t.data.type)),s=D(()=>t.data.color||"var(--accent)");function o(g){g.stopPropagation(),Xm(t.id)}var a=oI();let l;a.__dblclick=o;var d=M(a);d.__dblclick=o;var c=M(d),u=M(c),p=M(u,!0);C(u);var f=q(u,2);{var h=g=>{var y=sI(),b=M(y,!0);C(y),G(()=>Fe(b,r(i).name)),_(g,y)};j(f,g=>{r(i)&&g(h)})}C(c),C(d),C(a),G(()=>{l=qe(a,1,"event-node svelte-7puem2",null,l,{selected:n()}),wt(a,`--event-color: ${r(s)??""};`),Fe(p,t.data.name)}),_(e,a),ze()}Mt(["dblclick"]);async function rI(e){if(!e?.trim())return"";const t=await mf(),n=[];let i=e.replace(/\$\$([\s\S]*?)\$\$/g,(s,o)=>{const a=`%%MATH_BLOCK_${n.length}%%`;try{n.push(t.default.renderToString(o.trim(),{displayMode:!0,throwOnError:!1,strict:!1}))}catch{n.push(`<code class="math-error">${sh(o)}</code>`)}return a});return i=i.replace(/\$([^\$\n]+?)\$/g,(s,o)=>{const a=`%%MATH_BLOCK_${n.length}%%`;try{n.push(t.default.renderToString(o.trim(),{displayMode:!1,throwOnError:!1,strict:!1}))}catch{n.push(`<code class="math-error">${sh(o)}</code>`)}return a}),i=lI(i),n.forEach((s,o)=>{i=i.replace(`%%MATH_BLOCK_${o}%%`,s)}),i}function lI(e){let t=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return t=t.replace(/%%MATH_BLOCK_(\d+)%%/g,"%%MATH_BLOCK_$1%%"),t=t.replace(/```(\w*)\n([\s\S]*?)```/g,(n,i,s)=>`<pre><code>${s.trim()}</code></pre>`),t=t.replace(/^### (.*)$/gm,"<h3>$1</h3>"),t=t.replace(/^## (.*)$/gm,"<h2>$1</h2>"),t=t.replace(/^# (.*)$/gm,"<h1>$1</h1>"),t=t.replace(/^([-*_]){3,}\s*$/gm,"<hr>"),t=t.replace(/^&gt; (.*)$/gm,"<blockquote>$1</blockquote>"),t=t.replace(/<\/blockquote>\n<blockquote>/g,`
`),t=t.replace(/^[-*] (.*)$/gm,"<li>$1</li>"),t=t.replace(/((?:<li>.*<\/li>\n?)+)/g,"<ul>$1</ul>"),t=t.replace(/^\d+\. (.*)$/gm,"<oli>$1</oli>"),t=t.replace(/((?:<oli>.*<\/oli>\n?)+)/g,n=>"<ol>"+n.replace(/<\/?oli>/g,i=>i.replace("oli","li"))+"</ol>"),t=t.replace(/\*\*\*(.+?)\*\*\*/g,"<strong><em>$1</em></strong>"),t=t.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>"),t=t.replace(new RegExp("(?<![<])\\*([^*\\n]+?)\\*(?![>])","g"),"<em>$1</em>"),t=t.replace(/`([^`]+)`/g,"<code>$1</code>"),t=t.replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank" rel="noopener">$1</a>'),t=t.split(/\n\n+/).map(n=>n.trim()).filter(n=>n.length>0).map(n=>/^<(h[1-6]|ul|ol|blockquote|pre|hr)/.test(n)?n:`<p>${n.replace(/\n/g,"<br>")}</p>`).join(""),t}function sh(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}var cI=ye('<svg width="8" height="8" viewBox="0 0 24 24" fill="none" stroke-width="4"><polyline points="20 6 9 17 4 12"></polyline></svg>'),dI=Z("<button><!></button>"),uI=Z('<div role="dialog" tabindex="-1"><div class="color-grid svelte-10xj43v"></div> <div class="color-custom svelte-10xj43v"><label for="custom-color" class="svelte-10xj43v">CUSTOM:</label> <input id="custom-color" type="color" class="custom-color-input svelte-10xj43v"/></div></div>'),fI=Z('<div class="color-picker-wrapper svelte-10xj43v"><button aria-label="Change color"><svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><circle cx="8" cy="10" r="1.5"></circle><circle cx="12" cy="7" r="1.5"></circle><circle cx="16" cy="10" r="1.5"></circle><circle cx="15" cy="15" r="2"></circle></svg></button> <!></div>');function bf(e,t){Oe(t,!0);let n=_e(t,"defaultColor",3,Ji),i=_e(t,"popupPosition",3,"bottom"),s=_e(t,"tooltipPosition",3,"bottom"),o=_e(t,"iconSize",3,16),a=_e(t,"variant",3,"default"),l=$(!1);function d(){E(l,!r(l))}function c(w){w===n()?t.onSelect(void 0):t.onSelect(w),E(l,!1)}function u(w){const k=w.target;t.onSelect(k.value)}function p(w){w.target.closest(".color-picker-wrapper")||E(l,!1)}var f=fI();ht("click",Ot,p);var h=M(f);let g;h.__click=d;var y=M(h),b=q(M(y)),m=q(b),x=q(m),S=q(x);C(y),C(h),Ee(h,(w,k)=>Ue?.(w,k),()=>({text:"Color",position:s()}));var v=q(h,2);{var A=w=>{var k=uI();k.__click=O=>O.stopPropagation();var N=M(k);it(N,21,()=>VS,_t,(O,I)=>{var H=dI();let P;H.__click=()=>c(r(I));var T=M(H);{var R=B=>{var V=cI();G(()=>z(V,"stroke",r(I)==="#FFFFFF"||r(I)==="#FFF176"?"#333":"#fff")),_(B,V)};j(T,B=>{t.currentColor===r(I)&&B(R)})}C(H),G(()=>{P=qe(H,1,"color-option svelte-10xj43v",null,P,{selected:t.currentColor===r(I)}),wt(H,`background: ${r(I)??""};`),z(H,"title",r(I)===n()?"Default":r(I))}),_(O,H)}),C(N);var L=q(N,2),X=q(M(L),2);xn(X),X.__input=u,C(L),C(k),G(()=>{qe(k,1,`color-picker-popup popup-${i()??""}`,"svelte-10xj43v"),An(X,t.currentColor)}),_(w,k)};j(v,w=>{r(l)&&w(A)})}C(f),G(()=>{g=qe(h,1,"picker-btn svelte-10xj43v",null,g,{ghost:a()==="ghost"}),z(y,"width",o()),z(y,"height",o()),z(y,"stroke",t.iconColor||"currentColor"),z(b,"fill",t.iconColor||"currentColor"),z(m,"fill",t.iconColor||"currentColor"),z(x,"fill",t.iconColor||"currentColor"),z(S,"fill",t.iconColor||"currentColor")}),_(e,f),ze()}Mt(["click","input"]);var pI=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>'),hI=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>'),gI=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>'),mI=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><path d="M23 4v6h-6"></path><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path></svg>'),vI=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>'),yI=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path></svg>'),bI=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><path d="M9 12l2 2 4-4"></path></svg>'),wI=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><path d="M3 7v6h6"></path><path d="M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"></path></svg>'),_I=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><path d="M21 7v6h-6"></path><path d="M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3L21 13"></path></svg>'),xI=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path><polyline points="10 17 15 12 10 7"></polyline><line x1="15" y1="12" x2="3" y2="12"></line></svg>'),kI=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>'),SI=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>'),CI=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><rect x="3" y="3" width="7" height="7" rx="1"></rect><rect x="14" y="3" width="7" height="7" rx="1"></rect><rect x="3" y="14" width="7" height="7" rx="1"></rect><rect x="14" y="14" width="7" height="7" rx="1"></rect></svg>'),EI=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><polyline points="4 7 4 4 20 4 20 7"></polyline><line x1="9" y1="20" x2="15" y2="20"></line><line x1="12" y1="4" x2="12" y2="20"></line></svg>'),TI=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><line x1="12" y1="17" x2="12" y2="22"></line><path d="M5 17h14v-1.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V6h1a2 2 0 0 0 0-4H8a2 2 0 0 0 0 4h1v4.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24Z"></path></svg>'),II=ye('<svg viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><line x1="12" y1="17" x2="12" y2="22"></line><path d="M5 17h14v-1.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V6h1a2 2 0 0 0 0-4H8a2 2 0 0 0 0 4h1v4.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24Z"></path></svg>'),NI=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>'),PI=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><polyline points="20 6 9 17 4 12"></polyline></svg>'),MI=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>'),AI=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><polyline points="6 9 12 15 18 9"></polyline></svg>'),DI=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><polyline points="18 15 12 9 6 15"></polyline></svg>'),RI=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><polyline points="9 18 15 12 9 6"></polyline></svg>'),OI=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><polyline points="15 18 9 12 15 6"></polyline></svg>'),zI=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>'),LI=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>'),HI=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line><circle cx="22" cy="3" r="1.5" fill="currentColor" stroke="none"></circle></svg>'),FI=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>'),BI=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>'),qI=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect></svg>'),VI=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>'),WI=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line></svg>'),KI=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg>'),jI=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><polyline points="4 17 10 11 4 5"></polyline><line x1="12" y1="19" x2="20" y2="19"></line></svg>'),XI=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>'),GI=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>'),UI=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>'),YI=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg>'),ZI=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>'),JI=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><rect x="2" y="4" width="20" height="16" rx="2" ry="2"></rect><path d="M6 8h.001"></path><path d="M10 8h.001"></path><path d="M14 8h.001"></path><path d="M18 8h.001"></path><path d="M8 12h.001"></path><path d="M12 12h.001"></path><path d="M16 12h.001"></path><path d="M7 16h10"></path></svg>'),QI=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>'),$I=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>'),eN=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>'),tN=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg>'),nN=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><polygon points="12 2 2 7 12 12 22 7 12 2"></polygon><polyline points="2 17 12 22 22 17"></polyline><polyline points="2 12 12 17 22 12"></polyline></svg>'),iN=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline></svg>'),sN=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="12" y1="18" x2="12" y2="12"></line><line x1="9" y1="15" x2="15" y2="15"></line></svg>'),oN=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><line x1="2" y1="5" x2="8" y2="5"></line><line x1="5" y1="2" x2="5" y2="8"></line><path d="M13 5h8v16H5V13"></path></svg>'),aN=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><rect x="2" y="8" width="20" height="8" rx="2"></rect></svg>'),rN=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>'),lN=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><path d="M21 12a9 9 0 1 1-6.219-8.56"></path></svg>'),cN=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>'),dN=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>'),uN=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg>'),fN=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><rect x="3" y="12" width="4" height="9"></rect><rect x="10" y="8" width="4" height="13"></rect><rect x="17" y="4" width="4" height="17"></rect></svg>'),pN=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><rect x="3" y="3" width="18" height="18" rx="2"></rect><rect x="12" y="12" width="7" height="7" rx="1"></rect></svg>'),hN=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line><line x1="11" y1="8" x2="11" y2="14"></line><line x1="8" y1="11" x2="14" y2="11"></line></svg>'),gN=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line><line x1="8" y1="11" x2="14" y2="11"></line></svg>'),mN=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><rect x="3" y="3" width="18" height="18" rx="2"></rect></svg>'),vN=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><polygon points="5 4 15 12 5 20 5 4"></polygon><line x1="19" y1="5" x2="19" y2="19"></line></svg>'),yN=ye('<svg viewBox="0 0 24 24" fill="currentColor" stroke="none" class="svelte-1aaflua"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>'),bN=ye('<svg viewBox="0 0 24 24" fill="currentColor" stroke="none" class="svelte-1aaflua"><rect x="6" y="6" width="12" height="12" rx="1"></rect></svg>'),wN=ye('<svg viewBox="0 0 24 24" fill="currentColor" stroke="none" class="svelte-1aaflua"><path d="M5 4l10 8-10 8V4z"></path><rect x="17" y="5" width="3" height="14" rx="1"></rect></svg>'),_N=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><path d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83"></path></svg>'),xN=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path></svg>'),kN=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>'),SN=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><path d="M8 3H7a2 2 0 0 0-2 2v5a2 2 0 0 1-2 2 2 2 0 0 1 2 2v5a2 2 0 0 0 2 2h1"></path><path d="M16 3h1a2 2 0 0 1 2 2v5a2 2 0 0 0 2 2 2 2 0 0 0-2 2v5a2 2 0 0 1-2 2h-1"></path></svg>'),CN=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><rect x="3" y="3" width="18" height="18" rx="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="3" y1="15" x2="21" y2="15"></line><line x1="9" y1="3" x2="9" y2="21"></line></svg>'),EN=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>'),TN=ye('<svg viewBox="0 0 24 24" fill="currentColor" class="svelte-1aaflua"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>'),IN=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>'),NN=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>'),PN=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>'),MN=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><path d="M9 3h6"></path><path d="M10 3v6l-5 10h14l-5-10V3"></path></svg>'),AN=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.5 2.8C1.4 11.3 1 12.1 1 13v3c0 .6.4 1 1 1h2"></path><circle cx="7" cy="17" r="2"></circle><path d="M9 17h6"></path><circle cx="17" cy="17" r="2"></circle></svg>'),DN=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>'),RN=ye('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1aaflua"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>'),ON=ye('<svg viewBox="0 0 24 24" fill="currentColor" stroke="none" class="svelte-1aaflua"><text x="2" y="18" font-size="16" font-weight="700" font-family="system-ui, sans-serif">A</text><text x="14" y="18" font-size="16" font-weight="700" font-family="system-ui, sans-serif">a</text></svg>'),zN=ye('<svg viewBox="0 0 24 24" fill="currentColor" stroke="none" class="svelte-1aaflua"><text x="2" y="18" font-size="11" font-weight="700" font-family="system-ui, sans-serif">A</text><text x="10" y="18" font-size="11" font-weight="700" font-family="system-ui, sans-serif">a</text></svg>'),LN=Z('<span class="text-icon svelte-1aaflua"> </span>');function He(e,t){let n=_e(t,"size",3,14);var i=pe(),s=ae(i);{var o=l=>{var d=pI();G(()=>{z(d,"width",n()),z(d,"height",n())}),_(l,d)},a=l=>{var d=pe(),c=ae(d);{var u=f=>{var h=hI();G(()=>{z(h,"width",n()),z(h,"height",n())}),_(f,h)},p=f=>{var h=pe(),g=ae(h);{var y=m=>{var x=gI();G(()=>{z(x,"width",n()),z(x,"height",n())}),_(m,x)},b=m=>{var x=pe(),S=ae(x);{var v=w=>{var k=mI();G(()=>{z(k,"width",n()),z(k,"height",n())}),_(w,k)},A=w=>{var k=pe(),N=ae(k);{var L=O=>{var I=vI();G(()=>{z(I,"width",n()),z(I,"height",n())}),_(O,I)},X=O=>{var I=pe(),H=ae(I);{var P=R=>{var B=yI();G(()=>{z(B,"width",n()),z(B,"height",n())}),_(R,B)},T=R=>{var B=pe(),V=ae(B);{var F=J=>{var ie=bI();G(()=>{z(ie,"width",n()),z(ie,"height",n())}),_(J,ie)},Y=J=>{var ie=pe(),ve=ae(ie);{var re=ge=>{var Q=wI();G(()=>{z(Q,"width",n()),z(Q,"height",n())}),_(ge,Q)},me=ge=>{var Q=pe(),oe=ae(Q);{var ue=te=>{var be=_I();G(()=>{z(be,"width",n()),z(be,"height",n())}),_(te,be)},le=te=>{var be=pe(),fe=ae(be);{var Pe=Se=>{var Ce=xI();G(()=>{z(Ce,"width",n()),z(Ce,"height",n())}),_(Se,Ce)},Re=Se=>{var Ce=pe(),ke=ae(Ce);{var Ne=Me=>{var Ae=kI();G(()=>{z(Ae,"width",n()),z(Ae,"height",n())}),_(Me,Ae)},$e=Me=>{var Ae=pe(),xt=ae(Ae);{var It=we=>{var W=SI();G(()=>{z(W,"width",n()),z(W,"height",n())}),_(we,W)},U=we=>{var W=pe(),se=ae(W);{var he=Ye=>{var je=CI();G(()=>{z(je,"width",n()),z(je,"height",n())}),_(Ye,je)},Be=Ye=>{var je=pe(),rt=ae(je);{var Lt=st=>{var at=EI();G(()=>{z(at,"width",n()),z(at,"height",n())}),_(st,at)},Le=st=>{var at=pe(),Je=ae(at);{var Ze=vt=>{var kt=TI();G(()=>{z(kt,"width",n()),z(kt,"height",n())}),_(vt,kt)},bt=vt=>{var kt=pe(),gt=ae(kt);{var At=on=>{var Xt=II();G(()=>{z(Xt,"width",n()),z(Xt,"height",n())}),_(on,Xt)},gn=on=>{var Xt=pe(),Cn=ae(Xt);{var zn=ln=>{var Gt=NI();G(()=>{z(Gt,"width",n()),z(Gt,"height",n())}),_(ln,Gt)},En=ln=>{var Gt=pe(),cn=ae(Gt);{var Ii=xe=>{var Ve=PI();G(()=>{z(Ve,"width",n()),z(Ve,"height",n())}),_(xe,Ve)},ce=xe=>{var Ve=pe(),lt=ae(Ve);{var et=Ge=>{var ct=MI();G(()=>{z(ct,"width",n()),z(ct,"height",n())}),_(Ge,ct)},tt=Ge=>{var ct=pe(),mt=ae(ct);{var Nt=dn=>{var Dt=AI();G(()=>{z(Dt,"width",n()),z(Dt,"height",n())}),_(dn,Dt)},ft=dn=>{var Dt=pe(),zt=ae(Dt);{var cr=ns=>{var Vn=DI();G(()=>{z(Vn,"width",n()),z(Vn,"height",n())}),_(ns,Vn)},As=ns=>{var Vn=pe(),sl=ae(Vn);{var nd=is=>{var Wn=RI();G(()=>{z(Wn,"width",n()),z(Wn,"height",n())}),_(is,Wn)},id=is=>{var Wn=pe(),ol=ae(Wn);{var sd=ss=>{var ii=OI();G(()=>{z(ii,"width",n()),z(ii,"height",n())}),_(ss,ii)},od=ss=>{var ii=pe(),ad=ae(ii);{var al=os=>{var si=zI();G(()=>{z(si,"width",n()),z(si,"height",n())}),_(os,si)},to=os=>{var si=pe(),dr=ae(si);{var as=rs=>{var Ln=LI();G(()=>{z(Ln,"width",n()),z(Ln,"height",n())}),_(rs,Ln)},rl=rs=>{var Ln=pe(),ll=ae(Ln);{var rd=Ni=>{var ls=HI();G(()=>{z(ls,"width",n()),z(ls,"height",n())}),_(Ni,ls)},Ds=Ni=>{var ls=pe(),ur=ae(ls);{var cs=ds=>{var Kn=FI();G(()=>{z(Kn,"width",n()),z(Kn,"height",n())}),_(ds,Kn)},cl=ds=>{var Kn=pe(),dl=ae(Kn);{var ld=jn=>{var Pi=BI();G(()=>{z(Pi,"width",n()),z(Pi,"height",n())}),_(jn,Pi)},fr=jn=>{var Pi=pe(),cd=ae(Pi);{var ul=Mi=>{var fs=qI();G(()=>{z(fs,"width",n()),z(fs,"height",n())}),_(Mi,fs)},us=Mi=>{var fs=pe(),no=ae(fs);{var dd=ps=>{var Ai=VI();G(()=>{z(Ai,"width",n()),z(Ai,"height",n())}),_(ps,Ai)},fl=ps=>{var Ai=pe(),ud=ae(Ai);{var pl=Di=>{var hs=WI();G(()=>{z(hs,"width",n()),z(hs,"height",n())}),_(Di,hs)},fd=Di=>{var hs=pe(),hl=ae(hs);{var pd=gs=>{var Ri=KI();G(()=>{z(Ri,"width",n()),z(Ri,"height",n())}),_(gs,Ri)},gl=gs=>{var Ri=pe(),hd=ae(Ri);{var ml=Oi=>{var zi=jI();G(()=>{z(zi,"width",n()),z(zi,"height",n())}),_(Oi,zi)},vl=Oi=>{var zi=pe(),yl=ae(zi);{var bl=Li=>{var Hi=XI();G(()=>{z(Hi,"width",n()),z(Hi,"height",n())}),_(Li,Hi)},wl=Li=>{var Hi=pe(),gd=ae(Hi);{var md=ne=>{var Te=GI();G(()=>{z(Te,"width",n()),z(Te,"height",n())}),_(ne,Te)},K=ne=>{var Te=pe(),ot=ae(Te);{var Ke=qt=>{var un=UI();G(()=>{z(un,"width",n()),z(un,"height",n())}),_(qt,un)},dt=qt=>{var un=pe(),Vt=ae(un);{var Mn=Ht=>{var Qe=YI();G(()=>{z(Qe,"width",n()),z(Qe,"height",n())}),_(Ht,Qe)},bn=Ht=>{var Qe=pe(),fn=ae(Qe);{var fi=wn=>{var Xn=ZI();G(()=>{z(Xn,"width",n()),z(Xn,"height",n())}),_(wn,Xn)},Ut=wn=>{var Xn=pe(),pi=ae(Xn);{var Tn=io=>{var so=JI();G(()=>{z(so,"width",n()),z(so,"height",n())}),_(io,so)},ms=io=>{var so=pe(),Yv=ae(so);{var Zv=oo=>{var ao=QI();G(()=>{z(ao,"width",n()),z(ao,"height",n())}),_(oo,ao)},Jv=oo=>{var ao=pe(),Qv=ae(ao);{var $v=ro=>{var lo=$I();G(()=>{z(lo,"width",n()),z(lo,"height",n())}),_(ro,lo)},ey=ro=>{var lo=pe(),ty=ae(lo);{var ny=co=>{var uo=eN();G(()=>{z(uo,"width",n()),z(uo,"height",n())}),_(co,uo)},iy=co=>{var uo=pe(),sy=ae(uo);{var oy=fo=>{var po=tN();G(()=>{z(po,"width",n()),z(po,"height",n())}),_(fo,po)},ay=fo=>{var po=pe(),ry=ae(po);{var ly=ho=>{var go=nN();G(()=>{z(go,"width",n()),z(go,"height",n())}),_(ho,go)},cy=ho=>{var go=pe(),dy=ae(go);{var uy=mo=>{var vo=iN();G(()=>{z(vo,"width",n()),z(vo,"height",n())}),_(mo,vo)},fy=mo=>{var vo=pe(),py=ae(vo);{var hy=yo=>{var bo=sN();G(()=>{z(bo,"width",n()),z(bo,"height",n())}),_(yo,bo)},gy=yo=>{var bo=pe(),my=ae(bo);{var vy=wo=>{var _o=oN();G(()=>{z(_o,"width",n()),z(_o,"height",n())}),_(wo,_o)},yy=wo=>{var _o=pe(),by=ae(_o);{var wy=xo=>{var ko=aN();G(()=>{z(ko,"width",n()),z(ko,"height",n())}),_(xo,ko)},_y=xo=>{var ko=pe(),xy=ae(ko);{var ky=So=>{var Co=rN();G(()=>{z(Co,"width",n()),z(Co,"height",n())}),_(So,Co)},Sy=So=>{var Co=pe(),Cy=ae(Co);{var Ey=Eo=>{var To=lN();G(()=>{z(To,"width",n()),z(To,"height",n())}),_(Eo,To)},Ty=Eo=>{var To=pe(),Iy=ae(To);{var Ny=Io=>{var No=cN();G(()=>{z(No,"width",n()),z(No,"height",n())}),_(Io,No)},Py=Io=>{var No=pe(),My=ae(No);{var Ay=Po=>{var Mo=dN();G(()=>{z(Mo,"width",n()),z(Mo,"height",n())}),_(Po,Mo)},Dy=Po=>{var Mo=pe(),Ry=ae(Mo);{var Oy=Ao=>{var Do=uN();G(()=>{z(Do,"width",n()),z(Do,"height",n())}),_(Ao,Do)},zy=Ao=>{var Do=pe(),Ly=ae(Do);{var Hy=Ro=>{var Oo=fN();G(()=>{z(Oo,"width",n()),z(Oo,"height",n())}),_(Ro,Oo)},Fy=Ro=>{var Oo=pe(),By=ae(Oo);{var qy=zo=>{var Lo=pN();G(()=>{z(Lo,"width",n()),z(Lo,"height",n())}),_(zo,Lo)},Vy=zo=>{var Lo=pe(),Wy=ae(Lo);{var Ky=Ho=>{var Fo=hN();G(()=>{z(Fo,"width",n()),z(Fo,"height",n())}),_(Ho,Fo)},jy=Ho=>{var Fo=pe(),Xy=ae(Fo);{var Gy=Bo=>{var qo=gN();G(()=>{z(qo,"width",n()),z(qo,"height",n())}),_(Bo,qo)},Uy=Bo=>{var qo=pe(),Yy=ae(qo);{var Zy=Vo=>{var Wo=mN();G(()=>{z(Wo,"width",n()),z(Wo,"height",n())}),_(Vo,Wo)},Jy=Vo=>{var Wo=pe(),Qy=ae(Wo);{var $y=Ko=>{var jo=vN();G(()=>{z(jo,"width",n()),z(jo,"height",n())}),_(Ko,jo)},eb=Ko=>{var jo=pe(),tb=ae(jo);{var nb=Xo=>{var Go=yN();G(()=>{z(Go,"width",n()),z(Go,"height",n())}),_(Xo,Go)},ib=Xo=>{var Go=pe(),sb=ae(Go);{var ob=Uo=>{var Yo=bN();G(()=>{z(Yo,"width",n()),z(Yo,"height",n())}),_(Uo,Yo)},ab=Uo=>{var Yo=pe(),rb=ae(Yo);{var lb=Zo=>{var Jo=wN();G(()=>{z(Jo,"width",n()),z(Jo,"height",n())}),_(Zo,Jo)},cb=Zo=>{var Jo=pe(),db=ae(Jo);{var ub=Qo=>{var $o=_N();G(()=>{z($o,"width",n()),z($o,"height",n())}),_(Qo,$o)},fb=Qo=>{var $o=pe(),pb=ae($o);{var hb=ea=>{var ta=xN();G(()=>{z(ta,"width",n()),z(ta,"height",n())}),_(ea,ta)},gb=ea=>{var ta=pe(),mb=ae(ta);{var vb=na=>{var ia=kN();G(()=>{z(ia,"width",n()),z(ia,"height",n())}),_(na,ia)},yb=na=>{var ia=pe(),bb=ae(ia);{var wb=sa=>{var oa=SN();G(()=>{z(oa,"width",n()),z(oa,"height",n())}),_(sa,oa)},_b=sa=>{var oa=pe(),xb=ae(oa);{var kb=aa=>{var ra=CN();G(()=>{z(ra,"width",n()),z(ra,"height",n())}),_(aa,ra)},Sb=aa=>{var ra=pe(),Cb=ae(ra);{var Eb=la=>{var ca=EN();G(()=>{z(ca,"width",n()),z(ca,"height",n())}),_(la,ca)},Tb=la=>{var ca=pe(),Ib=ae(ca);{var Nb=da=>{var ua=TN();G(()=>{z(ua,"width",n()),z(ua,"height",n())}),_(da,ua)},Pb=da=>{var ua=pe(),Mb=ae(ua);{var Ab=fa=>{var pa=IN();G(()=>{z(pa,"width",n()),z(pa,"height",n())}),_(fa,pa)},Db=fa=>{var pa=pe(),Rb=ae(pa);{var Ob=ha=>{var ga=NN();G(()=>{z(ga,"width",n()),z(ga,"height",n())}),_(ha,ga)},zb=ha=>{var ga=pe(),Lb=ae(ga);{var Hb=ma=>{var va=PN();G(()=>{z(va,"width",n()),z(va,"height",n())}),_(ma,va)},Fb=ma=>{var va=pe(),Bb=ae(va);{var qb=ya=>{var ba=MN();G(()=>{z(ba,"width",n()),z(ba,"height",n())}),_(ya,ba)},Vb=ya=>{var ba=pe(),Wb=ae(ba);{var Kb=wa=>{var _a=AN();G(()=>{z(_a,"width",n()),z(_a,"height",n())}),_(wa,_a)},jb=wa=>{var _a=pe(),Xb=ae(_a);{var Gb=xa=>{var ka=DN();G(()=>{z(ka,"width",n()),z(ka,"height",n())}),_(xa,ka)},Ub=xa=>{var ka=pe(),Yb=ae(ka);{var Zb=Sa=>{var Ca=RN();G(()=>{z(Ca,"width",n()),z(Ca,"height",n())}),_(Sa,Ca)},Jb=Sa=>{var Ca=pe(),Qb=ae(Ca);{var $b=Ea=>{var Ta=ON();G(()=>{z(Ta,"width",n()),z(Ta,"height",n())}),_(Ea,Ta)},e0=Ea=>{var Ta=pe(),t0=ae(Ta);{var n0=Ia=>{var Rs=zN();G(()=>{z(Rs,"width",n()),z(Rs,"height",n())}),_(Ia,Rs)},i0=Ia=>{var Rs=LN(),s0=M(Rs,!0);C(Rs),G(()=>Fe(s0,t.name)),_(Ia,Rs)};j(t0,Ia=>{t.name==="font-size-decrease"?Ia(n0):Ia(i0,!1)},!0)}_(Ea,Ta)};j(Qb,Ea=>{t.name==="font-size-increase"?Ea($b):Ea(e0,!1)},!0)}_(Sa,Ca)};j(Yb,Sa=>{t.name==="tag"?Sa(Zb):Sa(Jb,!1)},!0)}_(xa,ka)};j(Xb,xa=>{t.name==="image"?xa(Gb):xa(Ub,!1)},!0)}_(wa,_a)};j(Wb,wa=>{t.name==="car"?wa(Kb):wa(jb,!1)},!0)}_(ya,ba)};j(Bb,ya=>{t.name==="flask"?ya(qb):ya(Vb,!1)},!0)}_(ma,va)};j(Lb,ma=>{t.name==="box"?ma(Hb):ma(Fb,!1)},!0)}_(ha,ga)};j(Rb,ha=>{t.name==="arrow-left"?ha(Ob):ha(zb,!1)},!0)}_(fa,pa)};j(Mb,fa=>{t.name==="arrow-right"?fa(Ab):fa(Db,!1)},!0)}_(da,ua)};j(Ib,da=>{t.name==="github"?da(Nb):da(Pb,!1)},!0)}_(la,ca)};j(Cb,la=>{t.name==="heart"?la(Eb):la(Tb,!1)},!0)}_(aa,ra)};j(xb,aa=>{t.name==="table"?aa(kb):aa(Sb,!1)},!0)}_(sa,oa)};j(bb,sa=>{t.name==="braces"?sa(wb):sa(_b,!1)},!0)}_(na,ia)};j(mb,na=>{t.name==="list"?na(vb):na(yb,!1)},!0)}_(ea,ta)};j(pb,ea=>{t.name==="clipboard"?ea(hb):ea(gb,!1)},!0)}_(Qo,$o)};j(db,Qo=>{t.name==="crosshair"?Qo(ub):Qo(fb,!1)},!0)}_(Zo,Jo)};j(rb,Zo=>{t.name==="skip-forward-filled"?Zo(lb):Zo(cb,!1)},!0)}_(Uo,Yo)};j(sb,Uo=>{t.name==="stop-filled"?Uo(ob):Uo(ab,!1)},!0)}_(Xo,Go)};j(tb,Xo=>{t.name==="play-filled"?Xo(nb):Xo(ib,!1)},!0)}_(Ko,jo)};j(Qy,Ko=>{t.name==="skip-forward"?Ko($y):Ko(eb,!1)},!0)}_(Vo,Wo)};j(Yy,Vo=>{t.name==="square"?Vo(Zy):Vo(Jy,!1)},!0)}_(Bo,qo)};j(Xy,Bo=>{t.name==="zoom-out"?Bo(Gy):Bo(Uy,!1)},!0)}_(Ho,Fo)};j(Wy,Ho=>{t.name==="zoom-in"?Ho(Ky):Ho(jy,!1)},!0)}_(zo,Lo)};j(By,zo=>{t.name==="map"?zo(qy):zo(Vy,!1)},!0)}_(Ro,Oo)};j(Ly,Ro=>{t.name==="bar-chart-2"?Ro(Hy):Ro(Fy,!1)},!0)}_(Ao,Do)};j(Ry,Ao=>{t.name==="bar-chart"?Ao(Oy):Ao(zy,!1)},!0)}_(Po,Mo)};j(My,Po=>{t.name==="moon"?Po(Ay):Po(Dy,!1)},!0)}_(Io,No)};j(Iy,Io=>{t.name==="sun"?Io(Ny):Io(Py,!1)},!0)}_(Eo,To)};j(Cy,Eo=>{t.name==="loader"?Eo(Ey):Eo(Ty,!1)},!0)}_(So,Co)};j(xy,So=>{t.name==="help-circle"?So(ky):So(Sy,!1)},!0)}_(xo,ko)};j(by,xo=>{t.name==="spacebar"?xo(wy):xo(_y,!1)},!0)}_(wo,_o)};j(my,wo=>{t.name==="new-canvas"?wo(vy):wo(yy,!1)},!0)}_(yo,bo)};j(py,yo=>{t.name==="file-plus"?yo(hy):yo(gy,!1)},!0)}_(mo,vo)};j(dy,mo=>{t.name==="activity"?mo(uy):mo(fy,!1)},!0)}_(ho,go)};j(ry,ho=>{t.name==="layers"?ho(ly):ho(cy,!1)},!0)}_(fo,po)};j(sy,fo=>{t.name==="book"?fo(oy):fo(ay,!1)},!0)}_(co,uo)};j(ty,co=>{t.name==="home"?co(ny):co(iy,!1)},!0)}_(ro,lo)};j(Qv,ro=>{t.name==="menu"?ro($v):ro(ey,!1)},!0)}_(oo,ao)};j(Yv,oo=>{t.name==="external-link"?oo(Zv):oo(Jv,!1)},!0)}_(io,so)};j(pi,io=>{t.name==="keyboard"?io(Tn):io(ms,!1)},!0)}_(wn,Xn)};j(fn,wn=>{t.name==="save"?wn(fi):wn(Ut,!1)},!0)}_(Ht,Qe)};j(Vt,Ht=>{t.name==="file"?Ht(Mn):Ht(bn,!1)},!0)}_(qt,un)};j(ot,qt=>{t.name==="folder"?qt(Ke):qt(dt,!1)},!0)}_(ne,Te)};j(gd,ne=>{t.name==="alert-triangle"?ne(md):ne(K,!1)},!0)}_(Li,Hi)};j(yl,Li=>{t.name==="info"?Li(bl):Li(wl,!1)},!0)}_(Oi,zi)};j(hd,Oi=>{t.name==="terminal"?Oi(ml):Oi(vl,!1)},!0)}_(gs,Ri)};j(hl,gs=>{t.name==="code"?gs(pd):gs(gl,!1)},!0)}_(Di,hs)};j(ud,Di=>{t.name==="eye-off"?Di(pl):Di(fd,!1)},!0)}_(ps,Ai)};j(no,ps=>{t.name==="eye"?ps(dd):ps(fl,!1)},!0)}_(Mi,fs)};j(cd,Mi=>{t.name==="stop"?Mi(ul):Mi(us,!1)},!0)}_(jn,Pi)};j(dl,jn=>{t.name==="pause"?jn(ld):jn(fr,!1)},!0)}_(ds,Kn)};j(ur,ds=>{t.name==="play"?ds(cs):ds(cl,!1)},!0)}_(Ni,ls)};j(ll,Ni=>{t.name==="upload-plus"?Ni(rd):Ni(Ds,!1)},!0)}_(rs,Ln)};j(dr,rs=>{t.name==="upload"?rs(as):rs(rl,!1)},!0)}_(os,si)};j(ad,os=>{t.name==="download"?os(al):os(to,!1)},!0)}_(ss,ii)};j(ol,ss=>{t.name==="chevron-left"?ss(sd):ss(od,!1)},!0)}_(is,Wn)};j(sl,is=>{t.name==="chevron-right"?is(nd):is(id,!1)},!0)}_(ns,Vn)};j(zt,ns=>{t.name==="chevron-up"?ns(cr):ns(As,!1)},!0)}_(dn,Dt)};j(mt,dn=>{t.name==="chevron-down"?dn(Nt):dn(ft,!1)},!0)}_(Ge,ct)};j(lt,Ge=>{t.name==="search"?Ge(et):Ge(tt,!1)},!0)}_(xe,Ve)};j(cn,xe=>{t.name==="check"?xe(Ii):xe(ce,!1)},!0)}_(ln,Gt)};j(Cn,ln=>{t.name==="x"?ln(zn):ln(En,!1)},!0)}_(on,Xt)};j(gt,on=>{t.name==="pin-filled"?on(At):on(gn,!1)},!0)}_(vt,kt)};j(Je,vt=>{t.name==="pin"?vt(Ze):vt(bt,!1)},!0)}_(st,at)};j(rt,st=>{t.name==="type"?st(Lt):st(Le,!1)},!0)}_(Ye,je)};j(se,Ye=>{t.name==="grid"?Ye(he):Ye(Be,!1)},!0)}_(we,W)};j(xt,we=>{t.name==="zap"?we(It):we(U,!1)},!0)}_(Me,Ae)};j(ke,Me=>{t.name==="exit"?Me(Ne):Me($e,!1)},!0)}_(Se,Ce)};j(fe,Se=>{t.name==="enter"?Se(Pe):Se(Re,!1)},!0)}_(te,be)};j(oe,te=>{t.name==="redo"?te(ue):te(le,!1)},!0)}_(ge,Q)};j(ve,ge=>{t.name==="undo"?ge(re):ge(me,!1)},!0)}_(J,ie)};j(V,J=>{t.name==="select-all"?J(F):J(Y,!1)},!0)}_(R,B)};j(H,R=>{t.name==="maximize"?R(P):R(T,!1)},!0)}_(O,I)};j(N,O=>{t.name==="plus"?O(L):O(X,!1)},!0)}_(w,k)};j(S,w=>{t.name==="rotate"?w(v):w(A,!1)},!0)}_(m,x)};j(g,m=>{t.name==="copy"?m(y):m(b,!1)},!0)}_(f,h)};j(c,f=>{t.name==="settings"?f(u):f(p,!1)},!0)}_(l,d)};j(s,l=>{t.name==="trash"?l(o):l(a,!1)})}_(e,i)}var HN=Z('<link rel="stylesheet"/>'),FN=Z('<div class="toolbar svelte-pxdwwx"><button class="toolbar-btn svelte-pxdwwx"><!></button> <button class="toolbar-btn svelte-pxdwwx"><!></button> <!></div>'),BN=Z('<textarea placeholder="Markdown with $math$..." spellcheck="false" class="svelte-pxdwwx"></textarea>'),qN=Z('<span class="placeholder svelte-pxdwwx">Double-click to add note...</span>'),VN=Z('<div class="rendered svelte-pxdwwx"><!></div>'),WN=Z('<div><!> <div class="annotation svelte-pxdwwx"><!> <!></div></div>');function KN(e,t){Oe(t,!0);let n=_e(t,"selected",3,!1),i=$(Et(t.data.content||"")),s=$(Et(t.data.color||Ji)),o=$(Et(t.data.fontSize||_n.DEFAULT));const a=ee.annotations.subscribe(T=>{const R=T.get(t.id);R&&(E(i,R.content||"",!0),E(s,R.color||Ji,!0),E(o,R.fontSize||_n.DEFAULT,!0))});let l=0;const d=gm.subscribe(T=>{T.id>l&&T.annotationId===t.id&&(l=T.id,E(p,!0))});jt(()=>{a(),d()});let c=$(""),u=$(void 0),p=$(!1);ut(()=>{r(i)?rI(r(i)).then(T=>{E(c,T,!0)}):E(c,"")}),ut(()=>{r(p)&&r(u)&&(r(u).focus(),r(u).selectionStart=r(u).value.length)}),ut(()=>{n()||E(p,!1)});function f(){De.beginDrag()}function h(){De.endDrag()}function g(T){const R=T.target.value;ee.updateAnnotation(t.id,{content:R})}function y(T){if(T.key==="Escape"){E(p,!1),T.stopPropagation();return}T.stopPropagation()}function b(T){n()&&(T.target.closest(".color-picker-wrapper")||E(p,!0))}function m(T){De.mutate(()=>ee.updateAnnotation(t.id,{color:T}))}function x(){const T=Math.min(r(o)+_n.STEP,_n.MAX);De.mutate(()=>ee.updateAnnotation(t.id,{fontSize:T}))}function S(){const T=Math.max(r(o)-_n.STEP,_n.MIN);De.mutate(()=>ee.updateAnnotation(t.id,{fontSize:T}))}function v(T){const R=T.currentTarget;R.scrollHeight>R.clientHeight&&T.stopPropagation()}function A(T,R){const B=Math.round(R.width/Ct)*Ct,V=Math.round(R.height/Ct)*Ct;De.mutate(()=>ee.updateAnnotation(t.id,{width:Math.max(100,B),height:Math.max(50,V)}))}var w=WN();Ac("pxdwwx",T=>{var R=HN();G(B=>z(R,"href",B),[vf]),_(T,R)});let k;var N=M(w);FS(N,{minWidth:100,minHeight:50,get isVisible(){return n()},onResizeEnd:A});var L=q(N,2);L.__dblclick=b;var X=M(L);{var O=T=>{var R=FN(),B=M(R);B.__click=x;var V=M(B);He(V,{name:"font-size-increase",size:14}),C(B),Ee(B,(ie,ve)=>Ue?.(ie,ve),()=>({text:"Increase font size",position:"top"}));var F=q(B,2);F.__click=S;var Y=M(F);He(Y,{name:"font-size-decrease",size:14}),C(F),Ee(F,(ie,ve)=>Ue?.(ie,ve),()=>({text:"Decrease font size",position:"top"}));var J=q(F,2);bf(J,{get currentColor(){return r(s)},get defaultColor(){return Ji},onSelect:m,popupPosition:"top",tooltipPosition:"top",get iconColor(){return r(s)},iconSize:14,variant:"ghost"}),C(R),G(()=>{B.disabled=r(o)>=_n.MAX,F.disabled=r(o)<=_n.MIN}),_(T,R)};j(X,T=>{n()&&T(O)})}var I=q(X,2);{var H=T=>{var R=BN();G0(R),R.__input=g,R.__keydown=y,Jt(R,B=>E(u,B),()=>r(u)),G(()=>An(R,r(i))),ht("focus",R,f),ht("blur",R,h),ht("wheel",R,v),_(T,R)},P=T=>{var R=VN(),B=M(R);{var V=Y=>{var J=pe(),ie=ae(J);Ru(ie,()=>r(c)),_(Y,J)},F=Y=>{var J=qN();_(Y,J)};j(B,Y=>{r(i)?Y(V):Y(F,!1)})}C(R),ht("wheel",R,v),_(T,R)};j(I,T=>{r(p)?T(H):T(P,!1)})}C(L),C(w),G(()=>{k=qe(w,1,"annotation-wrapper svelte-pxdwwx",null,k,{nodrag:r(p)}),wt(w,`--annotation-color: ${r(s)??""}; --annotation-font-size: ${r(o)??""}px;`)}),_(e,w),ze()}Mt(["dblclick","click","input","keydown"]);const Gm={up:{x:0,y:-1},down:{x:0,y:1},left:{x:-1,y:0},right:{x:1,y:0}},jN={up:"down",down:"up",left:"right",right:"left"},Es=On.unit,wf=0,_f=On.unit,Pt=On.unit,oh=On.unit/2,XN=On.unit/4,Pa=10;function ah(e,t){return(e+1e4)*20001+(t+1e4)}function Sn(e){return Math.round(e/Pt)}function rh(e){return e*Pt}function lh(e,t,n){const i={x:e.x-Es,y:e.y-Es,width:e.width+2*Es,height:e.height+2*Es};return{minGx:Sn(i.x-t),minGy:Sn(i.y-n),maxGx:Sn(i.x+i.width-t),maxGy:Sn(i.y+i.height-n)}}class GN{offsetX=0;offsetY=0;nodeObstacles=new Map;portStubObstacles=[];spatialHash=new Map;constructor(t){t&&this.initFromContext(t)}getBucketKey(t,n){const i=Math.floor(t/Pa),s=Math.floor(n/Pa);return ah(i,s)}getObstacleBuckets(t){const n=[],i=Math.floor(t.minGx/Pa),s=Math.floor(t.maxGx/Pa),o=Math.floor(t.minGy/Pa),a=Math.floor(t.maxGy/Pa);for(let l=i;l<=s;l++)for(let d=o;d<=a;d++)n.push(ah(l,d));return n}addToSpatialHash(t,n){for(const i of this.getObstacleBuckets(n))this.spatialHash.has(i)||this.spatialHash.set(i,new Set),this.spatialHash.get(i).add(t)}removeFromSpatialHash(t,n){for(const i of this.getObstacleBuckets(n))this.spatialHash.get(i)?.delete(t)}initFromContext(t){const{canvasBounds:n}=t;this.offsetX=Math.floor(n.x/Pt)*Pt,this.offsetY=Math.floor(n.y/Pt)*Pt,this.nodeObstacles.clear(),this.spatialHash.clear();for(const[i,s]of t.nodeBounds){const o=lh(s,this.offsetX,this.offsetY);this.nodeObstacles.set(i,o),this.addToSpatialHash(i,o)}this.updatePortStubs(t.portStubs)}updateBounds(t){this.offsetX=Math.floor(t.x/Pt)*Pt,this.offsetY=Math.floor(t.y/Pt)*Pt}updateNode(t,n){const i=this.nodeObstacles.get(t);i&&this.removeFromSpatialHash(t,i);const s=lh(n,this.offsetX,this.offsetY);this.nodeObstacles.set(t,s),this.addToSpatialHash(t,s)}removeNode(t){const n=this.nodeObstacles.get(t);n&&this.removeFromSpatialHash(t,n),this.nodeObstacles.delete(t)}updatePortStubs(t){if(this.portStubObstacles=[],t)for(const n of t){const i=Gm[n.direction],s=n.position.x+i.x*Pt,o=n.position.y+i.y*Pt,a=Sn(s-this.offsetX),l=Sn(o-this.offsetY);this.portStubObstacles.push({minGx:a,minGy:l,maxGx:a,maxGy:l})}}isWalkableAt(t,n){const i=this.getBucketKey(t,n),s=this.spatialHash.get(i);if(s)for(const o of s){const a=this.nodeObstacles.get(o);if(a&&t>=a.minGx&&t<=a.maxGx&&n>=a.minGy&&n<=a.maxGy)return!1}for(const o of this.portStubObstacles)if(t>=o.minGx&&t<=o.maxGx&&n>=o.minGy&&n<=o.maxGy)return!1;return!0}getOffset(){return{x:this.offsetX,y:this.offsetY}}}const UN=2,YN=20,ZN=2,JN=3,QN=1e4,$N={right:0,left:1,down:2,up:3},ch=[{dx:1,dy:0,dir:"right",dirIdx:0},{dx:-1,dy:0,dir:"left",dirIdx:1},{dx:0,dy:1,dir:"down",dirIdx:2},{dx:0,dy:-1,dir:"up",dirIdx:3}];function dh(e,t,n){return((e+1e4)*20001+(t+1e4))*4+n}function Al(e,t){return(e+1e4)*20001+(t+1e4)}class eP{heap=[];index=new Map;push(t){t.heapIdx=this.heap.length,this.heap.push(t),this.index.set(t.stateKey,t),this.bubbleUp(t.heapIdx)}pop(){if(this.heap.length===0)return;const t=this.heap[0];this.index.delete(t.stateKey);const n=this.heap.pop();return this.heap.length>0&&(n.heapIdx=0,this.heap[0]=n,this.bubbleDown(0)),t}get length(){return this.heap.length}updateIfBetter(t,n,i,s){const o=this.index.get(t);return o&&n<o.g?(o.g=n,o.f=n+o.h,o.parent=s,this.bubbleUp(o.heapIdx),!0):!1}has(t){return this.index.has(t)}bubbleUp(t){const n=this.heap;for(;t>0;){const i=t-1>>1;if(n[t].f>=n[i].f)break;this.swap(t,i),t=i}}bubbleDown(t){const n=this.heap,i=n.length;for(;;){const s=2*t+1,o=2*t+2;let a=t;if(s<i&&n[s].f<n[a].f&&(a=s),o<i&&n[o].f<n[a].f&&(a=o),a===t)break;this.swap(t,a),t=a}}swap(t,n){const i=this.heap,s=i[t],o=i[n];i[t]=o,i[n]=s,s.heapIdx=n,o.heapIdx=t}}function yu(e,t,n,i,s,o){const a=Sn(e.x-i.x),l=Sn(e.y-i.y),d=Sn(t.x-i.x),c=Sn(t.y-i.y),u=Sn(i.x),p=Sn(i.y),f=new Set;f.add(Al(a,l)),f.add(Al(d,c));const h=ch.find(w=>w.dir===s);if(h)for(let w=1;w<=JN;w++)f.add(Al(a+h.dx*w,l+h.dy*w));const g=(w,k)=>f.has(Al(w,k))?!0:n.isWalkableAt(w,k),y=new eP,b=new Set,m=$N[s],x=dh(a,l,m),S=uh(a,l,d,c),v={x:a,y:l,g:0,h:S,f:S,parent:null,direction:s,dirIdx:m,stateKey:x,heapIdx:0};y.push(v);let A=0;for(;y.length>0&&A<QN;){A++;const w=y.pop();if(w.x===d&&w.y===c)return{path:tP(w,i),isFallback:!1};if(b.has(w.stateKey))continue;b.add(w.stateKey);const k=jN[w.direction],N=w.parent===null;for(const{dx:L,dy:X,dir:O,dirIdx:I}of ch){if(O===k||N&&O!==s)continue;const H=w.x+L,P=w.y+X;if(!g(H,P))continue;const T=dh(H,P,I);if(b.has(T))continue;let R=1;if(w.direction!==O&&(R+=UN),o){const V=H+u,F=P+p,Y=o.get(`${V},${F}`);if(Y){const ie=O==="left"||O==="right"?Y.has("up")||Y.has("down"):Y.has("left")||Y.has("right");R+=ie?ZN:YN}}const B=w.g+R;if(!y.updateIfBetter(T,B,0,w)&&!y.has(T)){const V=uh(H,P,d,c);y.push({x:H,y:P,g:B,h:V,f:B+V,parent:w,direction:O,dirIdx:I,stateKey:T,heapIdx:0})}}}return s==="right"||s==="left"?{path:[e,{x:t.x,y:e.y},t],isFallback:!0}:{path:[e,{x:e.x,y:t.y},t],isFallback:!0}}function uh(e,t,n,i){return Math.abs(e-n)+Math.abs(t-i)}function tP(e,t){const n=[];let i=e;for(;i!==null;)n.push({x:rh(i.x)+t.x,y:rh(i.y)+t.y}),i=i.parent;return n.reverse(),n}function Um(e){if(e.length<3)return e;const t=[e[0]];for(let n=1;n<e.length-1;n++){const i=t[t.length-1],s=e[n],o=e[n+1],a=Math.sign(s.x-i.x),l=Math.sign(s.y-i.y),d=Math.sign(o.x-s.x),c=Math.sign(o.y-s.y);(a!==d||l!==c)&&t.push(s)}return t.push(e[e.length-1]),t}function kc(e){return{x:Math.round(e.x/Pt)*Pt,y:Math.round(e.y/Pt)*Pt}}function er(e,t,n){const i=Gm[t],s={x:e.x+i.x*n,y:e.y+i.y*n};return kc(s)}function Ym(e,t,n,i,s,o){const a=er(e,n,wf),l=er(t,i,_f),d=s.getOffset(),c=yu(a,l,s,d,n,o);return{path:Um(c.path),waypoints:[],isFallback:c.isFallback}}function nP(e,t,n="right",i="left"){const s=er(e,n,wf),o=er(t,i,_f),a=[s];return s.x!==o.x&&s.y!==o.y&&(n==="right"||n==="left"?a.push(kc({x:o.x,y:s.y})):a.push(kc({x:s.x,y:o.y}))),a.push(o),{path:a,waypoints:[]}}function iP(e,t=2){const n=new Map;let i=0;for(let s=0;s<e.length-1;s++){const o=e[s],a=e[s+1],l=a.x-o.x,d=a.y-o.y;let c;Math.abs(l)>Math.abs(d)?c=l>0?"right":"left":c=d>0?"down":"up";const u=Sn(o.x),p=Sn(o.y),f=Sn(a.x),h=Sn(a.y),g=Math.min(u,f),y=Math.max(u,f),b=Math.min(p,h),m=Math.max(p,h);for(let x=g;x<=y;x++)for(let S=b;S<=m;S++)if(i++,i>t){const v=`${x},${S}`;n.has(v)||n.set(v,new Set),n.get(v).add(c)}}return n}function Zm(e,t){const n=t.x-e.x,i=t.y-e.y;return Math.abs(n)>Math.abs(i)?n>0?"right":"left":i>0?"down":"up"}function sP(e){if(e.length<2)return"right";const t=e[e.length-1],n=e[e.length-2];return Zm(n,t)}function oP(e,t,n,i,s,o,a){if(o.length===0)return Ym(e,t,n,i,s,a);const l=s.getOffset(),d=[];let c=er(e,n,wf),u=n,p=!1;for(let y=0;y<o.length;y++){const b=o[y],m=kc(b.position),x=yu(c,m,s,l,u,a);if(x.isFallback&&(p=!0),d.length===0?d.push(...x.path):x.path.length>0&&d.push(...x.path.slice(1)),c=m,x.path.length>=2)u=sP(x.path);else{const S=y<o.length-1?o[y+1].position:t;u=Zm(m,S)}}const f=er(t,i,_f),h=yu(c,f,s,l,u,a);return h.isFallback&&(p=!0),d.length===0?d.push(...h.path):h.path.length>0&&d.push(...h.path.slice(1)),{path:Um(d),waypoints:o,isFallback:p}}function Bi(e){return(e||[]).filter(t=>t.isUserWaypoint)}function qi(e,t,n,i,s,o,a){return s?o.length>0?oP(e,t,n,i,s,o,a):Ym(e,t,n,i,s,a):nP(e,t,n,i)}function fh(e,t,n,i,s){const o=s.map(a=>`${a.position.x},${a.position.y}`).join(";");return`${e.x},${e.y}|${t.x},${t.y}|${n}|${i}|${o}`}const aP=8,Rt=nt({routes:new Map,context:null,grid:null,routeInputHashes:new Map});let Dl=0;const Wt={subscribe:Rt.subscribe,setContext(e,t,n){const i={nodeBounds:e,canvasBounds:t,portStubs:n};Rt.update(s=>{let o=s.grid;if(!o)o=new GN(i);else{o.updateBounds(t);const a=new Set(e.keys()),l=new Set;if(s.context)for(const d of s.context.nodeBounds.keys())l.add(d);for(const[d,c]of e)o.updateNode(d,c);for(const d of l)a.has(d)||o.removeNode(d);o.updatePortStubs(n)}return{...s,context:i,grid:o}})},updateNodeBounds(e,t){Rt.update(n=>(n.grid&&n.grid.updateNode(e,t),n.context&&n.context.nodeBounds.set(e,t),n))},recalculateRoutesForNodes(e,t,n){const i=de(Rt);if(!i.grid)return;const s=t.filter(c=>e.has(c.sourceNodeId)||e.has(c.targetNodeId));if(s.length===0)return;const o=new Map,a=(c,u,p)=>{const f=`${c}:${u}:${p}`;return o.has(f)||o.set(f,n(c,u,p)),o.get(f)},l=new Map(i.routes),d=new Map(i.routeInputHashes);for(const c of s){const u=a(c.sourceNodeId,c.sourcePortIndex,!0),p=a(c.targetNodeId,c.targetPortIndex,!1);if(!u||!p)continue;const f=Bi(c.waypoints),h=fh(u.position,p.position,u.direction,p.direction,f);if(h===i.routeInputHashes.get(c.id)&&l.has(c.id))continue;const g=qi(u.position,p.position,u.direction,p.direction,i.grid,f);l.set(c.id,g),d.set(c.id,h)}Rt.update(c=>({...c,routes:l,routeInputHashes:d}))},getRoute(e){return ci(Rt,t=>t.routes.get(e)||null)},getRouteSync(e){return de(Rt).routes.get(e)||null},calcRoute(e,t,n,i="right",s="left"){const o=de(Rt),a=Bi(e.waypoints),l=qi(t,n,i,s,o.grid,a);return Rt.update(d=>{const c=new Map(d.routes);return c.set(e.id,l),{...d,routes:c}}),l},recalculateAllRoutes(e,t){const n=de(Rt),i=++Dl,s=new Map,o=(p,f,h)=>{const g=`${p}:${f}:${h}`;return s.has(g)||s.set(g,t(p,f,h)),s.get(g)},a=new Map(n.routes),l=new Map,d=[...e].sort((p,f)=>{const h=o(p.sourceNodeId,p.sourcePortIndex,!0),g=o(p.targetNodeId,p.targetPortIndex,!1),y=o(f.sourceNodeId,f.sourcePortIndex,!0),b=o(f.targetNodeId,f.targetPortIndex,!1),m=h&&g?Math.abs(g.position.x-h.position.x)+Math.abs(g.position.y-h.position.y):0;return(y&&b?Math.abs(b.position.x-y.position.x)+Math.abs(b.position.y-y.position.y):0)-m}),c=new Map;for(const p of d){const f=`${p.sourceNodeId}:${p.sourcePortIndex}`,h=c.get(f)||[];h.push(p),c.set(f,h)}const u=[];for(const[,p]of c)u.push(...p);for(const p of u){const f=o(p.sourceNodeId,p.sourcePortIndex,!0),h=o(p.targetNodeId,p.targetPortIndex,!1);if(!f||!h)continue;const g=Bi(p.waypoints),y=qi(f.position,h.position,f.direction,h.direction,n.grid,g);a.set(p.id,y),l.set(p.id,fh(f.position,h.position,f.direction,h.direction,g))}Rt.update(p=>({...p,routes:a,routeInputHashes:l})),u.length>1&&this._refineRoutesAsync(i,u,c,o,l)},async _refineRoutesAsync(e,t,n,i,s){const o=new Map,a=new Map;let l=0;for(const[,d]of n){const c=[];for(const u of d){if(e!==Dl)return;const p=de(Rt),f=i(u.sourceNodeId,u.sourcePortIndex,!0),h=i(u.targetNodeId,u.targetPortIndex,!1);if(!f||!h)continue;const g=Bi(u.waypoints),y=qi(f.position,h.position,f.direction,h.direction,p.grid,g,o);if(a.set(u.id,y),y.path.length>0&&c.push(iP(y.path,2)),l++,l%aP===0&&(await new Promise(b=>requestAnimationFrame(()=>b())),e!==Dl))return}for(const u of c)for(const[p,f]of u){o.has(p)||o.set(p,new Set);for(const h of f)o.get(p).add(h)}}e===Dl&&Rt.update(d=>{const c=new Map(d.routes);for(const[u,p]of a)c.set(u,p);return{...d,routes:c,routeInputHashes:new Map(s)}})},invalidateRoute(e){Rt.update(t=>{const n=new Map(t.routes),i=new Map(t.routeInputHashes);return n.delete(e),i.delete(e),{...t,routes:n,routeInputHashes:i}})},invalidateRoutesForNodes(e){const n=de(ee.connections).filter(i=>e.has(i.sourceNodeId)||e.has(i.targetNodeId));Rt.update(i=>{const s=new Map(i.routes),o=new Map(i.routeInputHashes);for(const a of n)s.delete(a.id),o.delete(a.id);return{...i,routes:s,routeInputHashes:o}})},addUserWaypoint(e,t,n){let i=null;return De.mutate(()=>{const o=de(ee.connections).find(c=>c.id===e);if(!o)return;i=rn();const a={id:i,position:t,isUserWaypoint:!0},d=[...Bi(o.waypoints),a];if(ee.updateConnectionWaypoints(e,d),n){const c=de(Rt),u=n(o.sourceNodeId,o.sourcePortIndex,!0),p=n(o.targetNodeId,o.targetPortIndex,!1);if(u&&p){const f=qi(u.position,p.position,u.direction,p.direction,c.grid,d);Rt.update(h=>{const g=new Map(h.routes);return g.set(e,f),{...h,routes:g}});return}}Wt.invalidateRoute(e)}),i},addUserWaypointAtIndex(e,t,n,i){let s=null;return De.mutate(()=>{const a=de(ee.connections).find(u=>u.id===e);if(!a)return;s=rn();const l={id:s,position:t,isUserWaypoint:!0},d=Bi(a.waypoints),c=[...d.slice(0,n),l,...d.slice(n)];if(ee.updateConnectionWaypoints(e,c),i){const u=de(Rt),p=i(a.sourceNodeId,a.sourcePortIndex,!0),f=i(a.targetNodeId,a.targetPortIndex,!1);if(p&&f){const h=qi(p.position,f.position,p.direction,f.direction,u.grid,c);Rt.update(g=>{const y=new Map(g.routes);return y.set(e,h),{...g,routes:y}});return}}Wt.invalidateRoute(e)}),s},removeUserWaypoint(e,t,n){De.mutate(()=>{const s=de(ee.connections).find(a=>a.id===e);if(!s?.waypoints)return;const o=s.waypoints.filter(a=>a.id!==t||!a.isUserWaypoint);if(ee.updateConnectionWaypoints(e,o),n){const a=de(Rt),l=n(s.sourceNodeId,s.sourcePortIndex,!0),d=n(s.targetNodeId,s.targetPortIndex,!1);if(l&&d){const c=Bi(o),u=qi(l.position,d.position,l.direction,d.direction,a.grid,c);Rt.update(p=>{const f=new Map(p.routes);return f.set(e,u),{...p,routes:f}});return}}Wt.invalidateRoute(e)})},moveWaypoint(e,t,n,i){const o=de(ee.connections).find(l=>l.id===e);if(!o?.waypoints)return;const a=o.waypoints.map(l=>l.id===t?{...l,position:n}:l);if(ee.updateConnectionWaypoints(e,a),i){const l=de(Rt),d=i(o.sourceNodeId,o.sourcePortIndex,!0),c=i(o.targetNodeId,o.targetPortIndex,!1);if(d&&c){const u=Bi(a),p=qi(d.position,c.position,d.direction,c.direction,l.grid,u);Rt.update(f=>{const h=new Map(f.routes);return h.set(e,p),{...f,routes:h}});return}}Wt.invalidateRoute(e)},cleanupWaypoints(e,t){const i=de(ee.connections).find(v=>v.id===e);if(!i?.waypoints)return;const s=Bi(i.waypoints);if(s.length===0)return;let o=null,a=null;t&&(o=t(i.sourceNodeId,i.sourcePortIndex,!0),a=t(i.targetNodeId,i.targetPortIndex,!1));const l=o?.position||null,d=a?.position||null,c=15,u=5,p=(v,A,w)=>{const k=w.x-v.x,N=w.y-v.y,L=Math.sqrt(k*k+N*N);return L<1?!0:Math.abs((A.x-v.x)*N-(A.y-v.y)*k)/L<u},f=(v,A)=>Math.sqrt((v.x-A.x)**2+(v.y-A.y)**2);let h=[...s],g=!1;for(let v=h.length-1;v>0;v--)f(h[v].position,h[v-1].position)<c&&(h.splice(v,1),g=!0);const y=[];l&&y.push(l),y.push(...h.map(v=>v.position)),d&&y.push(d);const b=l?1:0,m=d?y.length-1:y.length,x=new Set;for(let v=b;v<m;v++){const A=l?v-1:v;if(A<0||A>=h.length)continue;const w=y[v-1],k=y[v],N=y[v+1];w&&N&&p(w,k,N)&&(x.add(A),g=!0)}const S=Array.from(x).sort((v,A)=>A-v);for(const v of S)h.splice(v,1);if(g){ee.updateConnectionWaypoints(e,h);const v=de(Rt);if(o&&a){const A=qi(o.position,a.position,o.direction,a.direction,v.grid,h);Rt.update(w=>{const k=new Map(w.routes);return k.set(e,A),{...w,routes:k}})}}},resetRoute(e){De.mutate(()=>{ee.updateConnectionWaypoints(e,[]),Wt.invalidateRoute(e)})},clearRoutes(){Rt.update(e=>({...e,routes:new Map,routeInputHashes:new Map}))},clearContext(){Rt.update(e=>({...e,routes:new Map,routeInputHashes:new Map,context:null,grid:null}))}};function rP(e,t=100){const n=new Map;let i=1/0,s=1/0,o=-1/0,a=-1/0;for(const d of e){const c=d.measured?.width??d.width??80,u=d.measured?.height??d.height??40,p=d.position.x-c/2,f=d.position.y-u/2;n.set(d.id,{x:p,y:f,width:c,height:u}),i=Math.min(i,p-Es),s=Math.min(s,f-Es),o=Math.max(o,p+c+Es),a=Math.max(a,f+u+Es)}const l={x:i-t,y:s-t,width:o-i+2*t,height:a-s+2*t};return{nodeBounds:n,canvasBounds:l}}const Ra=nt(null);let Yt=null;Ra.subscribe(e=>Yt=e);var lP=ye('<circle r="4"></circle>'),cP=ye('<circle r="3" class="segment-midpoint svelte-5viyfv"></circle>'),dP=ye('<g><!><g class="waypoint-group svelte-5viyfv"><!><!></g><g><path d="M -5 -2.5 L -1 -0.5 Q 0 0 -1 0.5 L -5 2.5 Q -6 3 -6 2 L -6 -2 Q -6 -3 -5 -2.5 Z"></path></g></g>');function uP(e,t){Oe(t,!0);function n(Q){switch(Q){case We.Left:return"left";case We.Right:return"right";case We.Top:return"up";case We.Bottom:return"down";default:return"right"}}function i(Q,oe,ue){return ue&&Q===t.source?{position:{x:t.sourceX,y:t.sourceY},direction:n(t.sourcePosition)}:!ue&&Q===t.target?{position:{x:t.targetX,y:t.targetY},direction:n(t.targetPosition)}:null}let s=$(null);Ra.subscribe(Q=>E(s,Q,!0));const o=D(()=>r(s)?.edgeId===t.id),a=D(()=>r(s)?.edgeId===t.id?r(s).waypointId:null);function l(Q,oe){Q.stopPropagation(),Q.preventDefault();const ue=te=>{if(!Yt||Yt.edgeId!==t.id)return;te.stopPropagation(),te.preventDefault();const be=xi({x:te.clientX,y:te.clientY}),fe={x:Math.round(be.x/Pt)*Pt,y:Math.round(be.y/Pt)*Pt};fe.x===Yt.lastSnappedPos.x&&fe.y===Yt.lastSnappedPos.y||(Yt.lastSnappedPos=fe,Wt.moveWaypoint(Yt.edgeId,Yt.waypointId,fe,Yt.getPortInfo))},le=te=>{if(!Yt)return;te.stopPropagation(),te.preventDefault(),document.removeEventListener("pointermove",ue,{capture:!0}),document.removeEventListener("pointerup",le,{capture:!0});const be=Yt;Ra.set(null),De.endDrag(),Wt.cleanupWaypoints(be.edgeId,be.getPortInfo)};Ra.set({edgeId:t.id,waypointId:oe.id,lastSnappedPos:{...oe.position},getPortInfo:i,cleanup:()=>{document.removeEventListener("pointermove",ue,{capture:!0}),document.removeEventListener("pointerup",le,{capture:!0})}}),De.beginDrag(),document.addEventListener("pointermove",ue,{capture:!0}),document.addEventListener("pointerup",le,{capture:!0})}function d(Q,oe){Q.stopPropagation(),Q.preventDefault(),Wt.removeUserWaypoint(t.id,oe.id,i)}let c=$(null),u=null;ut(()=>{u&&u(),u=Wt.getRoute(t.id).subscribe(Q=>E(c,Q,!0))});let p=$(null);const f=kr.subscribe(Q=>E(p,Q,!0));let h=$(null);const g=hu.subscribe(Q=>E(h,Q,!0));jt(()=>{u&&u(),f(),g()});const y=D(()=>()=>r(p)?t.source===r(p).nodeId&&t.sourceHandleId===r(p).handleId||t.target===r(p).nodeId&&t.targetHandleId===r(p).handleId:!1),b=D(()=>()=>r(h)?t.source===r(h).nodeId||t.target===r(h).nodeId:!1),m=D(()=>()=>r(y)()||r(b)()),x=D(()=>()=>r(y)()?r(p)?.color||"var(--accent)":r(b)()&&r(h)?.color||"var(--accent)"),S=.5,v=4.5,A=D(()=>()=>{let Q=t.sourceX,oe=t.sourceY;return t.sourcePosition==="right"?Q-=S:t.sourcePosition==="left"?Q+=S:t.sourcePosition==="bottom"?oe-=S:t.sourcePosition==="top"&&(oe+=S),{x:Q,y:oe}}),w=D(()=>()=>{let Q=t.targetX,oe=t.targetY;return t.targetPosition==="right"?Q+=v:t.targetPosition==="left"?Q-=v:t.targetPosition==="bottom"?oe+=v:t.targetPosition==="top"&&(oe-=v),{x:Q,y:oe}}),k=5;function N(Q,oe){if(Q.length<2)return"";if(Q.length===2)return`M ${Q[0].x} ${Q[0].y} L ${Q[1].x} ${Q[1].y}`;let ue=`M ${Q[0].x} ${Q[0].y}`;for(let te=1;te<Q.length-1;te++){const be=Q[te-1],fe=Q[te],Pe=Q[te+1],Re=Math.hypot(fe.x-be.x,fe.y-be.y),Se=Math.hypot(Pe.x-fe.x,Pe.y-fe.y),Ce=Math.min(oe,Re/2,Se/2);if(Ce<.5){ue+=` L ${fe.x} ${fe.y}`;continue}const ke=(be.x-fe.x)/Re,Ne=(be.y-fe.y)/Re,$e=(Pe.x-fe.x)/Se,Me=(Pe.y-fe.y)/Se,Ae=fe.x+ke*Ce,xt=fe.y+Ne*Ce,It=fe.x+$e*Ce,U=fe.y+Me*Ce;ue+=` L ${Ae} ${xt} Q ${fe.x} ${fe.y} ${It} ${U}`}const le=Q[Q.length-1];return ue+=` L ${le.x} ${le.y}`,ue}let L=$("");ut(()=>{if(r(c)?.path&&r(c).path.length>=1&&!r(c).isFallback){const Q=r(A)(),oe=r(w)(),ue=[Q,...r(c).path,oe];E(L,N(ue,k),!0)}});const X=D(()=>()=>{const Q=r(A)(),oe=r(w)(),[ue]=qc({sourceX:Q.x,sourceY:Q.y,sourcePosition:t.sourcePosition,targetX:oe.x,targetY:oe.y,targetPosition:t.targetPosition,borderRadius:8});return ue}),O=D(()=>()=>r(L)?{path:r(L),isFallback:!1}:{path:r(X)(),isFallback:!0}),I=D(()=>()=>r(c)?.waypoints?r(c).waypoints.filter(oe=>oe.isUserWaypoint):t.data?.waypoints?.filter(oe=>oe.isUserWaypoint)||[]),H=D(()=>()=>{if(!r(c)?.path||r(c).path.length<1)return[];const Q=r(A)(),oe=r(w)(),ue=[Q,...r(c).path,oe],le=r(I)(),te=20,be=(Pe,Re)=>{for(const Se of le)if(Math.hypot(Se.position.x-Pe,Se.position.y-Re)<te)return!0;return!1},fe=[];for(let Pe=0;Pe<ue.length-1;Pe++){const Re=ue[Pe],Se=ue[Pe+1];if(Math.hypot(Se.x-Re.x,Se.y-Re.y)>30){const ke=(Re.x+Se.x)/2,Ne=(Re.y+Se.y)/2;be(ke,Ne)||fe.push({x:ke,y:Ne,segmentIndex:Pe})}}return fe}),P=D(()=>()=>t.selected||r(o));function T(Q,oe){Q.stopPropagation(),Q.preventDefault();const ue=xi({x:Q.clientX,y:Q.clientY}),le={x:Math.round(ue.x/Pt)*Pt,y:Math.round(ue.y/Pt)*Pt},te=r(I)(),be=R(oe,te),fe=Wt.addUserWaypointAtIndex(t.id,le,be,i);if(fe){const Pe=Se=>{if(!Yt||Yt.edgeId!==t.id)return;Se.stopPropagation(),Se.preventDefault();const Ce=xi({x:Se.clientX,y:Se.clientY}),ke={x:Math.round(Ce.x/Pt)*Pt,y:Math.round(Ce.y/Pt)*Pt};ke.x===Yt.lastSnappedPos.x&&ke.y===Yt.lastSnappedPos.y||(Yt.lastSnappedPos=ke,Wt.moveWaypoint(Yt.edgeId,Yt.waypointId,ke,Yt.getPortInfo))},Re=Se=>{if(!Yt)return;Se.stopPropagation(),Se.preventDefault(),document.removeEventListener("pointermove",Pe,{capture:!0}),document.removeEventListener("pointerup",Re,{capture:!0});const Ce=Yt;Ra.set(null),De.endDrag(),Wt.cleanupWaypoints(Ce.edgeId,Ce.getPortInfo)};Ra.set({edgeId:t.id,waypointId:fe,lastSnappedPos:le,getPortInfo:i,cleanup:()=>{document.removeEventListener("pointermove",Pe,{capture:!0}),document.removeEventListener("pointerup",Re,{capture:!0})}}),De.beginDrag(),document.addEventListener("pointermove",Pe,{capture:!0}),document.addEventListener("pointerup",Re,{capture:!0})}}function R(Q,oe){if(oe.length===0||!r(c)?.path)return 0;const ue=r(A)(),le=r(w)(),te=[ue,...r(c).path,le],be=[0];for(let Re=1;Re<te.length;Re++){const Se=te[Re-1],Ce=te[Re];be.push(be[Re-1]+Math.hypot(Ce.x-Se.x,Ce.y-Se.y))}const fe=(be[Q]+be[Q+1])/2;let Pe=0;for(const Re of oe){let Se=1/0,Ce=0;for(let ke=0;ke<te.length;ke++){const Ne=te[ke],$e=Math.hypot(Ne.x-Re.position.x,Ne.y-Re.position.y);$e<Se&&(Se=$e,Ce=be[ke])}Ce<fe&&Pe++}return Pe}const B=D(()=>()=>{const Q=r(w)(),{isFallback:oe}=r(O)();if(!oe&&r(c)?.path&&r(c).path.length>=1){const le=r(c).path,te=Q,be=le[le.length-1],fe=te.x-be.x,Pe=te.y-be.y,Re=Math.atan2(Pe,fe)*(180/Math.PI);return{x:te.x,y:te.y,angle:Re}}const{path:ue}=r(O)();if(ue){const le=document.createElementNS("http://www.w3.org/2000/svg","path");le.setAttribute("d",ue);const te=le.getTotalLength(),be=le.getPointAtLength(te),fe=le.getPointAtLength(te-5),Pe=Math.atan2(be.y-fe.y,be.x-fe.x)*(180/Math.PI);return{x:be.x,y:be.y,angle:Pe}}return{x:Q.x,y:Q.y,angle:0}});var V=dP();let F;var Y=M(V);{let Q=D(()=>r(O)().path);$r(Y,{get id(){return t.id},get path(){return r(Q)},get style(){return t.style}})}var J=q(Y),ie=M(J);it(ie,17,()=>r(I)(),Q=>Q.id,(Q,oe)=>{var ue=lP();let le;ue.__pointerdown=te=>l(te,r(oe)),ue.__dblclick=te=>d(te,r(oe)),G(()=>{z(ue,"cx",r(oe).position.x),z(ue,"cy",r(oe).position.y),le=qe(ue,0,"waypoint-marker svelte-5viyfv",null,le,{dragging:r(o)&&r(a)===r(oe).id})}),_(Q,ue)});var ve=q(ie);it(ve,17,()=>r(H)(),Q=>Q.segmentIndex,(Q,oe)=>{var ue=cP();ue.__pointerdown=le=>T(le,r(oe).segmentIndex),G(()=>{z(ue,"cx",r(oe).x),z(ue,"cy",r(oe).y)}),_(Q,ue)}),C(J);var re=q(J),me=M(re);let ge;C(re),C(V),G((Q,oe,ue,le,te,be,fe,Pe)=>{wt(V,`--highlight-color: ${Q??""}`),F=qe(V,0,"svelte-5viyfv",null,F,oe),wt(J,`opacity: ${ue??""}; pointer-events: ${le??""};`),z(re,"transform",`translate(${te??""}, ${be??""}) rotate(${fe??""}) translate(5, 0)`),ge=qe(me,0,"edge-arrow svelte-5viyfv",null,ge,Pe)},[()=>r(x)(),()=>({highlighted:r(m)()}),()=>r(P)()?1:0,()=>r(P)()?"all":"none",()=>r(B)().x,()=>r(B)().y,()=>r(B)().angle,()=>({selected:t.selected,highlighted:r(m)()})]),_(e,V),ze()}Mt(["pointerdown","dblclick"]);let Ld=null;const Jm={registerDropHandler(e){Ld=e},handleDrop(e){Ld&&Ld(e)}},ai={nodeDuration:500,nodeStagger:50,flyDistanceMargin:100,edgeDuration:300,arrowDuration:150,initialDelay:100,fitViewDelay:50};function fP(){return typeof window>"u"?!1:new URLSearchParams(window.location.search).get("fancyloading")!=="false"}const Qm=nt(0);let La=new Map,Sc=new Map,Dr=new Map,Ts=!1,ei=null;function $m(e){e.code==="Space"&&!e.repeat&&Ts&&(e.preventDefault(),nv())}function ev(e){if(!Ts)return;e.target.closest(".svelte-flow__pane")&&nv()}function pP(){window.addEventListener("keydown",$m),document.addEventListener("click",ev,!0)}function tv(){window.removeEventListener("keydown",$m),document.removeEventListener("click",ev,!0)}function hP(){Qm.update(e=>e+1)}function nv(){Ts&&(ei&&(clearTimeout(ei),ei=null),iv())}function gP(e,t,n,i){fP()&&((Ts||ei)&&(ei&&(clearTimeout(ei),ei=null),document.querySelectorAll(".assembling").forEach(s=>{s.classList.remove("assembling")}),Ts=!1,tv()),document.body.classList.add("assembly-pending"),setTimeout(()=>{n(),setTimeout(()=>{const s=e(),o=t(),a=i();if(s.length===0){document.body.classList.remove("assembly-pending");return}mP(s,o,a),document.body.classList.remove("assembly-pending"),vP()},ai.fitViewDelay)},ai.initialDelay))}function mP(e,t,n){const i=[...e].sort(()=>Math.random()-.5),s=-n.x/n.zoom,o=-n.y/n.zoom,a=ai.flyDistanceMargin,l=s-a,d=o-a;La=new Map,Sc=new Map,i.forEach((f,h)=>{La.set(f.id,h*ai.nodeStagger),Sc.set(f.id,{x:l-f.x,y:d-f.y})}),Dr=new Map,t.forEach(f=>{const h=La.get(f.source)??0,g=La.get(f.target)??0,y=Math.max(h,g)+ai.nodeDuration*.7;Dr.set(f.id,y)}),ei&&(clearTimeout(ei),ei=null),Ts=!0,pP();const c=i.length*ai.nodeStagger,u=Math.max(...Array.from(Dr.values()),0),p=Math.max(c,u)+ai.nodeDuration+ai.edgeDuration+ai.arrowDuration+200;ei=setTimeout(iv,p)}function vP(){if(!Ts)return;const e=document.querySelectorAll(".svelte-flow__node"),t=document.querySelectorAll(".svelte-flow__edge");e.forEach(n=>{const i=n.getAttribute("data-id");if(!i)return;const s=La.get(i)??0,o=Sc.get(i)??{x:0,y:-100},a=n;a.style.setProperty("--assembly-delay",`${s}ms`),a.style.setProperty("--assembly-duration",`${ai.nodeDuration}ms`),a.style.setProperty("--fly-from-x",`${o.x}px`),a.style.setProperty("--fly-from-y",`${o.y}px`),n.classList.add("assembling")}),t.forEach(n=>{const i=n.getAttribute("data-id");if(!i)return;const s=Dr.get(i)??0,o=n,a=n.querySelector("path.svelte-flow__edge-path");if(a){const l=a.getTotalLength();o.style.setProperty("--edge-length",`${l}`)}o.style.setProperty("--assembly-delay",`${s}ms`),o.style.setProperty("--assembly-duration",`${ai.edgeDuration}ms`),n.classList.add("assembling")})}function iv(){document.querySelectorAll(".assembling").forEach(e=>{e.classList.remove("assembling");const t=e;t.style.removeProperty("--assembly-delay"),t.style.removeProperty("--assembly-duration"),t.style.removeProperty("--fly-from-x"),t.style.removeProperty("--fly-from-y"),t.style.removeProperty("--edge-length")}),document.body.classList.remove("assembly-pending"),La=new Map,Sc=new Map,Dr=new Map,Ts=!1,ei=null,tv()}const Hd={duration:300,flyDistanceMargin:100};function yP(e,t,n,i,s){let o,a;if(i&&s){const u=s(i);o=u.x-t.x,a=u.y-t.y}else{const u=n();o=-u.x/u.zoom-Hd.flyDistanceMargin-t.x,a=0}let l=0;const d=20;function c(){const u=document.querySelector(`[data-id="${e}"]`);if(!u){l++,l<d&&requestAnimationFrame(c);return}u.style.translate=`${o}px ${a}px`,u.style.scale="0.8",u.style.opacity="0",u.style.setProperty("--fly-from-x",`${o}px`),u.style.setProperty("--fly-from-y",`${a}px`),u.style.setProperty("--assembly-duration",`${Hd.duration}ms`),u.style.setProperty("--assembly-delay","0ms"),requestAnimationFrame(()=>{u.style.removeProperty("translate"),u.style.removeProperty("scale"),u.style.removeProperty("opacity"),u.classList.add("assembling"),setTimeout(()=>{u.classList.remove("assembling"),u.style.removeProperty("--fly-from-x"),u.style.removeProperty("--fly-from-y"),u.style.removeProperty("--assembly-duration"),u.style.removeProperty("--assembly-delay")},Hd.duration+50)})}requestAnimationFrame(c)}const bu=[".blk",".sub",".pvm",".json"],xf="1.0";function bP(e){const t=Qt.get(e.type),n=new Set(t?.params.map(s=>s.name)||[]),i={};for(const[s,o]of Object.entries(e.params))if(!(o==null||o==="")){if(s.startsWith("_")){i[s]=o;continue}n.has(s)&&(i[s]=o)}return i}function Uc(e){const t={...e,params:bP(e)};return t.graph?.nodes&&(t.graph={...t.graph,nodes:t.graph.nodes.map(n=>Uc(n))}),t}const Er=nt(""),yr=nt(null),Fd=ci(Er,e=>{const t=[],n=e.matchAll(/def\s+(\w+)\s*\(/g);for(const s of n)t.push(s[1]);const i=e.matchAll(/^(\w+)\s*=/gm);for(const s of i)t.push(s[1]);return[...new Set(t)]}),Fn={code:{subscribe:Er.subscribe},lastError:{subscribe:yr.subscribe},definedNames:{subscribe:Fd.subscribe},setCode(e){Er.set(e),yr.set(null)},getCode(){return de(Er)},setError(e){yr.set(e)},clearError(){yr.set(null)},hasName(e){return de(Fd).includes(e)},getDefinedNames(){return de(Fd)},clear(){Er.set(""),yr.set(null)}},Yc={JSON:"application/json",CSV:"text/csv;charset=utf-8;",SVG:"image/svg+xml",PYTHON:"text/x-python"};function Zc(e,t,n){const i=new Blob([e],{type:n}),s=URL.createObjectURL(i),o=document.createElement("a");o.href=s,o.download=t,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(s)}function sv(e,t){const n=typeof e=="string"?e:JSON.stringify(e,null,"	");Zc(n,t,Yc.JSON)}function ov(e,t){Zc(e,t,Yc.CSV)}function wP(e,t){Zc(e,t,Yc.SVG)}function _P(e,t){Zc(e,t,Yc.PYTHON)}const kf={open:!1,options:null,resolve:null},Jc=nt(kf);function xP(e){return new Promise(t=>{Jc.set({open:!0,options:{confirmText:"Confirm",cancelText:"Cancel",...e},resolve:t})})}function kP(){Jc.update(e=>(e.resolve&&e.resolve(!0),kf))}function SP(){Jc.update(e=>(e.resolve&&e.resolve(!1),kf))}const Rr={subscribe:Jc.subscribe,show:xP,confirm:kP,cancel:SP},av="pathview_autosave",CP=".pvm";let Rl=null,jr=null;const ar=nt(null);function Qc(){return"showSaveFilePicker"in window&&"showOpenFilePicker"in window}const EP={subscribe:ar.subscribe};function rv(){let e=null;return ar.subscribe(t=>e=t)(),e}function TP(){jr=null,ar.set(null)}function $c(e){const{nodes:t,connections:n,annotations:i}=ee.toJSON(),s=pt.toJSON(),o=Pn.get(),a=Fn.getCode(),l=t.map(c=>Uc(c)),d=Object.fromEntries(Object.entries(o).map(([c,u])=>[c,u===""?null:u]));return{version:BS,metadata:{created:new Date().toISOString(),modified:new Date().toISOString(),name:e||"Untitled"},graph:{nodes:l,connections:n,annotations:i},events:s,codeContext:{code:a},simulationSettings:d}}function IP(e){if(e.startsWith("pathsim.")){const t=e.split(".");return t[t.length-1]}return e}function NP(e){const t=n=>n.map(i=>{const s={...i,type:IP(i.type)};return s.graph&&(s.graph={nodes:t(s.graph.nodes||[]),connections:s.graph.connections||[],annotations:s.graph.annotations,events:s.graph.events}),s});return{...e,graph:e.graph?{...e.graph,nodes:t(e.graph.nodes||[])}:e.graph}}async function PP(e){if(e=NP(e),!e.version)throw new Error("Invalid file: missing version");if(Lm(),ee.clear(),pt.clear(),Bt.clear(),await Lh(),ee.fromJSON(e.graph?.nodes||[],e.graph?.connections||[],e.graph?.annotations||[]),e.events&&e.events.length>0&&pt.fromJSON(e.events),e.codeContext?.code?Fn.setCode(e.codeContext.code):Fn.clear(),e.simulationSettings){const t=e.simulationSettings,n={...In,solver:t.solver??In.solver,ghostTraces:t.ghostTraces??In.ghostTraces,plotResults:t.plotResults??In.plotResults,adaptive:t.adaptive??In.adaptive,duration:t.duration!=null?String(t.duration):In.duration,dt:t.dt!=null?String(t.dt):In.dt,rtol:t.rtol!=null?String(t.rtol):In.rtol,atol:t.atol!=null?String(t.atol):In.atol,ftol:t.ftol!=null?String(t.ftol):In.ftol,dt_min:t.dt_min!=null?String(t.dt_min):In.dt_min,dt_max:t.dt_max!=null?String(t.dt_max):In.dt_max};Pn.set(n)}else Pn.reset();De.clear(),hP()}function lv(){try{const e=$c("Autosave");localStorage.setItem(av,JSON.stringify(e))}catch(e){console.warn("Autosave failed:",e)}}function ph(e=500){Rl&&clearTimeout(Rl),Rl=setTimeout(()=>{lv(),Rl=null},e)}function cv(){localStorage.removeItem(av)}async function MP(){if(jr&&Qc())try{const e=$c(rv()||void 0),t=JSON.stringify(e,null,2),n=await jr.createWritable();return await n.write(t),await n.close(),!0}catch(e){console.warn("Failed to save to current file:",e)}return dv()}async function dv(){const e=(rv()||"pathview_graph")+CP;if(Qc())try{const t=await window.showSaveFilePicker({suggestedName:e,types:[{description:"PathView Model",accept:{"application/json":[".pvm",".json"]}}]}),n=t.name.replace(/\.(pvm|json)$/,""),i=$c(n),s=JSON.stringify(i,null,2),o=await t.createWritable();return await o.write(s),await o.close(),jr=t,ar.set(n),!0}catch(t){if(t.name==="AbortError")return!1;console.error("Failed to save file:",t)}return AP(e),!0}function AP(e){const t=e.replace(/\.(pvm|json)$/,""),n=$c(t);sv(n,e),ar.set(t)}function DP(){Lm(),ee.clear(),pt.clear(),Fn.clear(),Bt.clear(),Pn.reset(),De.clear(),cv(),TP()}function RP(e=3e4){const t=setInterval(lv,e);return()=>clearInterval(t)}function OP(e){if(typeof e!="object"||e===null)return"unknown";const t=e;return"type"in t&&["block","subsystem","model"].includes(t.type)?"component":"graph"in t&&"version"in t?"legacy-model":"unknown"}function uv(e,t){const n=JSON.parse(e),i=OP(n);if(i==="unknown")throw new Error("Invalid file format");return i==="legacy-model"?{version:xf,type:"model",metadata:{name:n.metadata?.name||t.replace(/\.(json|pvm)$/,""),created:n.metadata?.created||new Date().toISOString(),modified:n.metadata?.modified||new Date().toISOString()},content:{graph:n.graph,events:n.events,codeContext:n.codeContext,simulationSettings:n.simulationSettings}}:n}function Cc(e){const t=[];for(const n of e){if(n.type===yt.SUBSYSTEM||n.type===yt.INTERFACE){n.graph?.nodes&&t.push(...Cc(n.graph.nodes));continue}Qt.has(n.type)||t.push(n.type),n.graph?.nodes&&t.push(...Cc(n.graph.nodes))}return[...new Set(t)]}function zP(e,t){const n=e.node,i=Cc([n]);if(i.length>0)throw new Error(`Unknown block type(s): ${i.join(", ")}`);const s=ym(n,t);return De.mutate(()=>{ee.clearSelection(),pt.clearSelection(),ee.pasteNodes([s],[])}),[s.id]}async function LP(e,t){if(de(ee.nodesArray).length>0&&!await Rr.show({title:"Unsaved Changes",message:"Opening this file will discard your current work. Continue?",confirmText:"Discard & Open",cancelText:"Cancel"}))return{success:!1,type:"model",cancelled:!0};const i=e.content,s={version:e.version,metadata:e.metadata,graph:i.graph||{nodes:[],connections:[]},events:i.events,codeContext:i.codeContext||{code:""},simulationSettings:i.simulationSettings||In};return await PP(s),jr=t.fileHandle||null,ar.set(t.fileName?.replace(/\.(pvm|json)$/,"")||e.metadata.name||null),{success:!0,type:"model"}}async function fv(e,t){switch(e.type){case"block":case"subsystem":{const n=t.position||{x:100,y:100},i=zP(e.content,n);return{success:!0,type:e.type,nodeIds:i}}case"model":return LP(e,t);default:return{success:!1,type:e.type,error:`Unknown component type: ${e.type}`}}}async function wu(e,t={}){try{const n=await e.text(),i=uv(n,e.name);return fv(i,{...t,fileName:t.fileName||e.name})}catch(n){return{success:!1,type:"model",error:n instanceof Error?n.message:"Unknown error"}}}async function HP(e,t={}){try{const n=await fetch(e);if(!n.ok)throw new Error(`Failed to fetch file: ${n.status} ${n.statusText}`);const i=await n.text(),s=t.fileName||e.split("/").pop()||"model.pvm",o=uv(i,s);return fv(o,{...t,fileName:s})}catch(n){return{success:!1,type:"model",error:n instanceof Error?n.message:"Unknown error"}}}async function pv(e){if(Qc())try{const[t]=await window.showOpenFilePicker({types:[{description:"PathView Files",accept:{"application/json":bu}}],multiple:!1}),n=await t.getFile();return wu(n,{position:e,fileHandle:t,fileName:t.name})}catch(t){return t.name==="AbortError"?{success:!1,type:"model",cancelled:!0}:(console.error("Failed to open file:",t),{success:!1,type:"model",error:"Failed to open file. Make sure it is a valid PathView file."})}return new Promise(t=>{const n=document.createElement("input");n.type="file",n.accept=bu.join(","),n.onchange=async()=>{const i=n.files?.[0];if(!i){t({success:!1,type:"model",cancelled:!0});return}const s=await wu(i,{position:e,fileName:i.name});t(s)},n.oncancel=()=>t({success:!1,type:"model",cancelled:!0}),n.click()})}function FP(e,t){Oe(t,!0),_e(t,"edges",19,()=>[]);const{getNodes:n,getEdges:i,fitView:s,zoomIn:o,zoomOut:a,getViewport:l,setViewport:d,screenToFlowPosition:c}=em(),u=tm();function p(S,v=300){const A=n();if(A.length===0)return;let w=1/0,k=1/0,N=-1/0,L=-1/0;for(const ge of A){const Q=ge.measured?.width??ge.width??160,oe=ge.measured?.height??ge.height??60,ue=ge.origin??[.5,.5],le=ge.position.x-Q*ue[0],te=ge.position.y-oe*ue[1];w=Math.min(w,le),k=Math.min(k,te),N=Math.max(N,le+Q),L=Math.max(L,te+oe)}const X=20;w-=X,k-=X,N+=X,L+=X;const O=N-w,I=L-k,H=window.innerWidth,P=window.innerHeight,T=H-S.left-S.right,R=P-S.top-S.bottom;if(T<=0||R<=0){s({padding:.1,duration:v});return}const B=T/O,V=R/I,F=Math.min(B,V,1.5),Y=(w+N)/2,J=(k+L)/2,ie=S.left+T/2,ve=S.top+R/2,re=ie-Y*F,me=ve-J*F;d({x:re,y:me,zoom:F},{duration:v})}tr(()=>{setTimeout(()=>{const S=de(Yl);p(S,300)},200),_C(c),Jm.registerDropHandler(async S=>{const v=c({x:S.clientX,y:S.clientY}),A=S.dataTransfer?.files;if(A&&A.length>0){const N=A[0],L="."+N.name.split(".").pop()?.toLowerCase();if(bu.includes(L)){const X=await wu(N,{position:{x:v.x-80,y:v.y-30},fileName:N.name});!X.success&&!X.cancelled&&X.error&&alert(`Failed to import: ${X.error}`);return}}const w=S.dataTransfer?.getData("application/pathview-node");if(w){const N=Math.round(v.x/Ct)*Ct,L=Math.round(v.y/Ct)*Ct;De.mutate(()=>{ee.addNode(w,{x:N,y:L})});return}const k=S.dataTransfer?.getData("application/pathview-event");if(k){const N={x:v.x-40,y:v.y-40};De.mutate(()=>{if(ee.isAtRoot())pt.addEvent(k,N);else{const L=ti.get(k);if(L){const X={id:crypto.randomUUID(),type:k,name:L.name,position:N,params:{}};ee.addSubsystemEvent(X)}}});return}})});let f=0;rm.subscribe(S=>{if(S>f){const v=de(Yl);p(v,300),f=S}});let h=0;lm.subscribe(S=>{S>h&&(o({duration:200}),h=S)});let g=0;cm.subscribe(S=>{S>g&&(a({duration:200}),g=S)});let y=0;dm.subscribe(S=>{if(S.id>y){const v=l();d({x:v.x+S.x,y:v.y+S.y,zoom:v.zoom}),y=S.id}});let b=0;um.subscribe(S=>{S.id>b&&S.nodeId&&(s({nodes:[{id:S.nodeId}],padding:.5,duration:300,maxZoom:1.5}),b=S.id)}),ut(()=>{t.pendingUpdates.length>0&&setTimeout(()=>{t.pendingUpdates.forEach(S=>{typeof u=="function"&&u(S)}),t.onUpdatesProcessed()},10)}),ut(()=>{const S=setInterval(()=>{n().forEach(A=>{if(A.position){const w=ee.getNode(A.id);w&&(Math.abs(w.position.x-A.position.x)>1||Math.abs(w.position.y-A.position.y)>1)&&ee.updateNodePosition(A.id,A.position)}})},2e3);return()=>clearInterval(S)});let m=0;Qm.subscribe(S=>{if(S>m){m=S;const v=de(Yl);gP(()=>n().map(A=>({id:A.id,x:A.position.x,y:A.position.y})),()=>i().map(A=>({id:A.id,source:A.source,target:A.target})),()=>p(v,0),()=>{const A=l(),w=document.querySelector(".svelte-flow");return{zoom:A.zoom,x:A.x,y:A.y,width:w?.clientWidth??window.innerWidth,height:w?.clientHeight??window.innerHeight}})}});let x=0;mm.subscribe(S=>{S.id>x&&S.nodeId&&(x=S.id,yP(S.nodeId,S.position,()=>{const v=l(),A=document.querySelector(".svelte-flow");return{zoom:v.zoom,x:v.x,y:v.y,width:A?.clientWidth??window.innerWidth,height:A?.clientHeight??window.innerHeight}},S.cursorScreen,c))}),ze()}function BP(){const e=new URL(window.location.href).searchParams.get("theme");if(e==="dark"||e==="light")return localStorage.setItem("pathview-theme",e),document.documentElement.setAttribute("data-theme",e),e;const t=localStorage.getItem("pathview-theme");return t==="light"||t==="dark"?t:window.matchMedia("(prefers-color-scheme: light)").matches?"light":"dark"}const Tr=nt(BP());Tr.subscribe(e=>{document.documentElement.setAttribute("data-theme",e),localStorage.setItem("pathview-theme",e)});const es={subscribe:Tr.subscribe,toggle(){Tr.update(e=>e==="dark"?"light":"dark")},set(e){Tr.set(e)},get(){let e="dark";return Tr.subscribe(t=>e=t)(),e}},gi=nt({open:!1,position:{x:0,y:0},target:null}),yi={subscribe:gi.subscribe,openForNode(e,t){gi.set({open:!0,position:t,target:{type:"node",nodeId:e}})},openForEvent(e,t){gi.set({open:!0,position:t,target:{type:"event",eventId:e}})},openForSelection(e,t){gi.set({open:!0,position:t,target:{type:"selection",nodeIds:e}})},openForEdge(e,t){gi.set({open:!0,position:t,target:{type:"edge",edgeId:e}})},openForCanvas(e){gi.set({open:!0,position:e,target:{type:"canvas"}})},openForAnnotation(e,t){gi.set({open:!0,position:t,target:{type:"annotation",annotationId:e}})},openForPlot(e,t,n){gi.set({open:!0,position:n,target:{type:"plot",nodeId:e,plotEl:t}})},close(){gi.set({open:!1,position:{x:0,y:0},target:null})},getState(){return de(gi)}},Ol=nt([]),hh={subscribe:Ol.subscribe,queueUpdate(e){Ol.update(t=>[...t,...e])},clear(){Ol.set([])},get(){return de(Ol)}};function qP(e){return{id:e.id,type:"eventNode",position:{...e.position},data:e,origin:[.5,.5],selectable:!0,draggable:!0,connectable:!1,deletable:!0}}function VP(e){return{id:e.id,type:"annotation",position:{...e.position},data:e,width:e.width,height:e.height,origin:[0,0],selectable:!0,draggable:!0,connectable:!1,deletable:!0}}function gh(e){return{id:e.id,source:e.sourceNodeId,sourceHandle:Qa.output(e.sourceNodeId,e.sourcePortIndex),target:e.targetNodeId,targetHandle:Qa.input(e.targetNodeId,e.targetPortIndex),type:"orthogonal",data:{waypoints:e.waypoints},selectable:!0,deletable:!0,animated:!1}}function Sf(e){return ee.getNode(e)?.params?._rotation||0}function WP(e){return(e+1)%4}function KP(e){return e===0?2:e===2?0:e}function jP(e){return e===1?3:e===3?1:e}function XP(e){const t=e.filter(n=>n.selected);return t.length===0?[]:De.mutate(()=>{const n=[];for(const i of t){const s=Sf(i.id),o=WP(s);ee.updateNodeParams(i.id,{_rotation:o}),n.push(i.id)}return n})}function GP(e){const t=e.filter(n=>n.selected);return t.length===0?[]:De.mutate(()=>{const n=[];for(const i of t){const s=Sf(i.id),o=KP(s);o!==s&&(ee.updateNodeParams(i.id,{_rotation:o}),n.push(i.id))}return n})}function UP(e){const t=e.filter(n=>n.selected);return t.length===0?[]:De.mutate(()=>{const n=[];for(const i of t){const s=Sf(i.id),o=jP(s);o!==s&&(ee.updateNodeParams(i.id,{_rotation:o}),n.push(i.id))}return n})}function YP(e){const n=de(ee.nodesArray).find(o=>o.id===e);if(!n)return null;const i=de(ee.connections),s=new Set(i.filter(o=>o.targetNodeId===e).map(o=>o.targetPortIndex));for(let o=0;o<n.inputs.length;o++)if(!s.has(o))return o;return null}var ZP=Z('<div class="drop-zone-overlay svelte-5kezjk"><svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg></div>'),JP=Z("<!> <!>",1),QP=Z('<div class="flow-canvas svelte-5kezjk" role="application" aria-label="Flow canvas"><!> <!></div>');function $P(e,t){Oe(t,!0);let n=$("dark");const i=es.subscribe(U=>{E(n,U,!0)});let s=null;function o(){s!==null&&clearTimeout(s),s=setTimeout(()=>{s=null,w()},0)}let a={x:0,y:0};function l(U){a={x:U.clientX,y:U.clientY}}function d(U){if(nm(U))return;if(U.key==="Delete"){const se=r(I).filter(Be=>Be.selected),he=r(H).filter(Be=>Be.selected);(se.length>0||he.length>0)&&(U.preventDefault(),ge({nodes:se,edges:he}));return}if(U.key==="\\"){const se=r(H).find(he=>he.selected);if(se){U.preventDefault();const he=xi(a),Be=10,Ye=Math.round(he.x/Be)*Be,je=Math.round(he.y/Be)*Be;Wt.addUserWaypoint(se.id,{x:Ye,y:je},A)}return}if(!r(I).some(se=>se.selected))return;let W=[];U.key==="r"||U.key==="R"?(U.preventDefault(),W=XP(r(I))):U.key==="x"||U.key==="X"?(U.preventDefault(),W=GP(r(I))):(U.key==="y"||U.key==="Y")&&(U.preventDefault(),W=UP(r(I))),W.length>0&&(E(u,[...W],!0),setTimeout(()=>{const se=de(ee.connections);Wt.recalculateRoutesForNodes(new Set(W),se,A)},0))}let c=new Map,u=$(Et([]));const p=hh.subscribe(U=>{U.length>0&&(E(u,[...r(u),...U],!0),hh.clear())});xC(()=>r(I).some(U=>U.selected));let f=0;const h=fm.subscribe(U=>{U>f&&(f=U,E(I,r(I).map(we=>({...we,selected:!1})),!0),E(H,r(H).map(we=>({...we,selected:!1})),!0),yn.set(new Set),Dd(new Set))});let g=0;const y=pm.subscribe(U=>{if(U.id>g){g=U.id;const we={x:U.x,y:U.y};E(I,r(I).map(W=>W.selected?{...W,position:{x:W.position.x+we.x,y:W.position.y+we.y}}:W),!0),De.mutate(()=>{r(I).forEach(W=>{W.selected&&(W.type==="eventNode"?ee.isAtRoot()?pt.updateEventPosition(W.id,W.position):ee.updateSubsystemEventPosition(W.id,W.position):W.type==="annotation"?ee.updateAnnotationPosition(W.id,W.position):ee.updateNodePosition(W.id,W.position))})})}});let b=0;const m=hm.subscribe(U=>{if(U.id>b){b=U.id;const we=new Set(U.nodeIds);E(I,r(I).map(W=>we.has(W.id)?{...W,selected:!0}:U.addToSelection?W:{...W,selected:!1}),!0),U.addToSelection||E(H,r(H).map(W=>({...W,selected:!1})),!0),x()}});function x(){const U=r(I).filter(se=>se.selected),we=new Set,W=new Set;U.forEach(se=>{se.type==="eventNode"?W.add(se.id):se.type!=="annotation"&&we.add(se.id)}),yn.set(we),Dd(W)}const S=[i,p,h,y,m];jt(()=>{S.forEach(U=>U()),s!==null&&clearTimeout(s)});function v(){E(u,[],!0)}function A(U,we,W){const se=r(P).get(U);if(!se)return null;const he=se.data,Be=W?he.outputs:he.inputs;if(we>=Be.length)return null;const Ye=he.params?._rotation||0,je=se.measured?.width??se.width??80,rt=se.measured?.height??se.height??40,Lt=Be.length,Le=20,at=-((Lt-1)*Le)/2+we*Le;let Je=se.position.x,Ze=se.position.y,bt;const vt=W?oh:oh+XN;if(W)switch(Ye){case 1:Je+=at,Ze+=rt/2+vt,bt="down";break;case 2:Je-=je/2+vt,Ze+=at,bt="left";break;case 3:Je+=at,Ze-=rt/2+vt,bt="up";break;default:Je+=je/2+vt,Ze+=at,bt="right";break}else switch(Ye){case 1:Je+=at,Ze-=rt/2+vt,bt="up";break;case 2:Je+=je/2+vt,Ze+=at,bt="right";break;case 3:Je+=at,Ze+=rt/2+vt,bt="down";break;default:Je-=je/2+vt,Ze+=at,bt="left";break}return{position:{x:Je,y:Ze},direction:bt}}function w(){const U=r(I).filter(Be=>Be.type==="pathview");if(U.length===0){Wt.clearRoutes();return}const{nodeBounds:we,canvasBounds:W}=rP(U),se=[];for(const Be of U){const Ye=Be.data;for(let je=0;je<Ye.inputs.length;je++){const rt=A(Be.id,je,!1);rt&&se.push({position:rt.position,direction:rt.direction})}for(let je=0;je<Ye.outputs.length;je++){const rt=A(Be.id,je,!0);rt&&se.push({position:rt.position,direction:rt.direction})}}Wt.setContext(we,W,se);const he=de(ee.connections);Wt.recalculateAllRoutes(he,A)}const k={pathview:iI,eventNode:aI,annotation:KN},N={orthogonal:uP};let L=$(Et([])),X=$(Et([])),O=$(Et([])),I=$(Et([])),H=$(Et([])),P=D(()=>new Map(r(I).map(U=>[U.id,U])));ut(()=>{const U=Qn(()=>new Map(r(I).map(W=>[W.id,W]))),we=De.isRestoringState();E(I,[...r(L),...r(X),...r(O)].map(W=>{const se=U.get(W.id);return se&&!we?{...W,position:se.position,selected:se.selected}:W}),!0)});let T=!1,R=!1,B=new Set;ut(()=>{const U=new Set(r(I).map(W=>W.id)),we=[...B].filter(W=>!U.has(W));we.length>0&&!T&&(T=!0,we.forEach(W=>{const se=ee.getNode(W),he=pt.getEvent(W);!se&&!he&&c.delete(W)}),T=!1),B=U}),ut(()=>{T||r(I).forEach(U=>{if(U.type==="annotation"&&U.width&&U.height){const we=ee.getAnnotation(U.id);we&&(we.width!==U.width||we.height!==U.height)&&(T=!0,ee.updateAnnotation(U.id,{width:U.width,height:U.height}),T=!1)}})}),S.push(ee.nodes.subscribe(U=>{if(T)return;const we=Array.from(U.values()),W=[],se=new Map(r(I).map(Le=>[Le.id,Le])),he=new Set(we.map(Le=>Le.id)),Be=new Set(r(I).map(Le=>Le.id)),Ye=we.some(Le=>!Be.has(Le.id)),je=r(I).some(Le=>!he.has(Le.id)),rt=we.some(Le=>{const st=se.get(Le.id);if(!st)return!1;const at=st.data,Je=c.get(Le.id),Ze={inputs:Le.inputs.length,outputs:Le.outputs.length};return!!(Je&&(Je.inputs!==Ze.inputs||Je.outputs!==Ze.outputs)||at.name!==Le.name||at.color!==Le.color||JSON.stringify(at.params)!==JSON.stringify(Le.params)||JSON.stringify(at.pinnedParams)!==JSON.stringify(Le.pinnedParams))});if(!Ye&&!je&&!rt&&R)return;const Lt=we.map(Le=>{const st=se.get(Le.id),at=c.get(Le.id),Je={inputs:Le.inputs.length,outputs:Le.outputs.length};if(at&&(at.inputs!==Je.inputs||at.outputs!==Je.outputs)&&W.push(Le.id),c.set(Le.id,Je),st){const kt=st.data?.params?._rotation??0,gt=Le.params?._rotation??0;kt!==gt&&W.push(Le.id)}const Ze=st&&!De.isRestoringState()?st.position:{...Le.position},bt=Le.type===yt.INTERFACE;return st?{id:st.id,type:st.type,position:Ze,data:Le,origin:[.5,.5],selectable:st.selectable,draggable:st.draggable,deletable:!bt}:{id:Le.id,type:"pathview",position:Ze,data:Le,origin:[.5,.5],selectable:!0,draggable:!0,deletable:!bt}});for(const Le of c.keys())he.has(Le)||c.delete(Le);E(L,Lt,!0),W.length>0&&(E(u,[...W],!0),setTimeout(()=>{const Le=de(ee.connections);Wt.recalculateRoutesForNodes(new Set(W),Le,A)},0)),we.length>0&&!R&&setTimeout(()=>{R=!0},100)}));let V=[],F=[],Y=[];function J(){const U=V.length===0?F:Y;E(X,U.map(qP),!0)}S.push(ee.currentPath.subscribe(U=>{V=U,J(),Wt.clearContext()})),S.push(pt.eventsArray.subscribe(U=>{F=U,J()})),S.push(ee.subsystemEvents.subscribe(U=>{Y=Array.from(U.values()),J()})),S.push(ee.annotations.subscribe(U=>{E(O,Array.from(U.values()).map(VP),!0)})),S.push(ee.connections.subscribe(U=>{if(T)return;const we=new Map(r(H).map(W=>[W.id,W.selected]));E(H,U.map(W=>{const se=gh(W);return we.get(W.id)&&(se.selected=!0),se}),!0),o()}));let ie=new Map;function ve({nodes:U}){De.beginDrag(),ie.clear();for(const we of U){const W=Math.round(we.position.x/Ct)*Ct,se=Math.round(we.position.y/Ct)*Ct;ie.set(we.id,{x:W,y:se})}}function re({nodes:U}){const we=new Set;for(const W of U){if(W.type!=="pathview")continue;const se=Math.round(W.position.x/Ct)*Ct,he=Math.round(W.position.y/Ct)*Ct,Be=ie.get(W.id);if(!Be||Be.x!==se||Be.y!==he){ie.set(W.id,{x:se,y:he}),we.add(W.id);const Ye=W.measured?.width??W.width??80,je=W.measured?.height??W.height??40;Wt.updateNodeBounds(W.id,{x:se-Ye/2,y:he-je/2,width:Ye,height:je})}}if(we.size>0){const W=de(ee.connections);Wt.recalculateRoutesForNodes(we,W,A)}}function me({targetNode:U}){ie.clear(),U?.id&&U?.position&&(T=!0,U.type==="eventNode"?ee.isAtRoot()?pt.updateEventPosition(U.id,U.position):ee.updateSubsystemEventPosition(U.id,U.position):U.type==="annotation"?ee.updateAnnotationPosition(U.id,U.position):ee.updateNodePosition(U.id,U.position),T=!1),De.endDrag(),w()}function ge({nodes:U,edges:we}){if(U.length===0&&we.length===0)return;T=!0,De.mutate(()=>{U.forEach(he=>{he.type==="eventNode"?ee.isAtRoot()?pt.getEvent(he.id)&&pt.removeEvent(he.id):ee.getSubsystemEvent(he.id)&&ee.removeSubsystemEvent(he.id):he.type==="annotation"?ee.getAnnotation(he.id)&&ee.removeAnnotation(he.id):ee.getNode(he.id)&&(ee.removeNode(he.id),c.delete(he.id))}),we.forEach(he=>{const Be=de(ee.connections);let Ye=Be.find(je=>je.id===he.id);if(!Ye&&he.sourceHandle&&he.targetHandle){const je=he.sourceHandle.match(/-output-(\d+)$/),rt=he.targetHandle.match(/-input-(\d+)$/);if(je&&rt){const Lt=parseInt(je[1],10),Le=parseInt(rt[1],10);Ye=Be.find(st=>st.sourceNodeId===he.source&&st.sourcePortIndex===Lt&&st.targetNodeId===he.target&&st.targetPortIndex===Le)}}Ye&&ee.removeConnection(Ye.id)})});const W=new Set(U.map(he=>he.id));E(L,r(L).filter(he=>!W.has(he.id)),!0),E(X,r(X).filter(he=>!W.has(he.id)),!0),E(O,r(O).filter(he=>!W.has(he.id)),!0);const se=de(ee.connections);E(H,se.map(gh),!0),T=!1}function Q(U){if(!U.source||!U.target||!U.sourceHandle||!U.targetHandle)return;const we=U.sourceHandle.match(/-output-(\d+)$/),W=U.targetHandle.match(/-input-(\d+)$/);we&&W&&De.mutate(()=>{const se=parseInt(we[1],10);let he=parseInt(W[1],10);if(de(ee.connections).some(je=>je.targetNodeId===U.target&&je.targetPortIndex===he)){const je=YP(U.target);if(je!==null)he=je;else{const Lt=de(ee.nodesArray).find(st=>st.id===U.target);if(!Lt)return;const Le=Qt.get(Lt.type);if(!Le||Le.ports.maxInputs!==null)return;ee.addInputPort(U.target),he=Lt.inputs.length}}ee.addConnection(U.source,se,U.target,he)})}function oe({nodes:U}){const we=new Set,W=new Set;U?.forEach(se=>{se.type==="eventNode"?W.add(se.id):we.add(se.id)}),yn.set(we),Dd(W)}let ue=$(!1),le=0;function te(U){return U.dataTransfer?.types.includes("Files")??!1}function be(U){te(U)&&(le++,E(ue,!0))}function fe(U){te(U)&&(le--,le===0&&E(ue,!1))}function Pe(U){U.preventDefault(),le=0,E(ue,!1),Jm.handleDrop(U)}function Re(U){U.preventDefault(),U.dataTransfer&&(U.dataTransfer.dropEffect="copy")}let Se;function Ce({event:U,node:we}){if(U.preventDefault(),we.type==="eventNode"){yi.openForEvent(we.id,{x:U.clientX,y:U.clientY});return}if(we.type==="annotation"){yi.openForAnnotation(we.id,{x:U.clientX,y:U.clientY});return}const W=r(I).filter(se=>se.selected);W.length>1&&W.some(se=>se.id===we.id)?yi.openForSelection(W.map(se=>se.id),{x:U.clientX,y:U.clientY}):yi.openForNode(we.id,{x:U.clientX,y:U.clientY})}function ke({event:U,edge:we}){U.preventDefault(),yi.openForEdge(we.id,{x:U.clientX,y:U.clientY})}function Ne({event:U}){U.preventDefault(),yi.openForCanvas({x:U.clientX,y:U.clientY})}function $e(U){U.target.closest(".svelte-flow__pane")&&Qi()}var Me=QP();ht("keydown",Ot,d),Me.__dblclick=$e,Me.__mousemove=l;var Ae=M(Me);{var xt=U=>{var we=ZP();_(U,we)};j(Ae,U=>{r(ue)&&U(xt)})}var It=q(Ae,2);NS(It,sc({get nodeTypes(){return k},get edgeTypes(){return N},onconnect:Q,onnodedragstart:ve,onnodedrag:re,onnodedragstop:me,ondelete:ge,onselectionchange:oe,ondrop:U=>Pe(U.event||U),ondragover:U=>Re(U.event||U),onnodecontextmenu:Ce,onedgecontextmenu:ke,onpanecontextmenu:Ne,nodeOrigin:[.5,.5]},()=>({snapToGrid:!0,snapGrid:kT}),{deleteKeyCode:["Delete","Backspace"],selectionKeyCode:["Shift"],multiSelectionKeyCode:["Shift","Meta","Control"],get colorMode(){return r(n)},connectOnClick:!0,edgesReconnectable:!0,edgesFocusable:!0,edgesSelectable:!0,zoomOnDoubleClick:!1,proOptions:{hideAttribution:!0},get nodes(){return r(I)},set nodes(U){E(I,U,!0)},get edges(){return r(H)},set edges(U){E(H,U,!0)},children:(U,we)=>{var W=JP(),se=ae(W);FP(se,{get pendingUpdates(){return r(u)},onUpdatesProcessed:v});var he=q(se,2);zS(he,{get variant(){return Zi.Dots},get gap(){return ST},size:1}),_(U,W)},$$slots:{default:!0}})),C(Me),Jt(Me,U=>Se=U,()=>Se),ht("dragover",Me,Re),ht("dragenter",Me,be),ht("dragleave",Me,fe),_(e,Me),ze()}Mt(["dblclick","mousemove"]);var e3=Z("<button> </button>"),t3=Z("<button> </button>"),n3=Z("<button> </button>"),i3=Z("<button> </button>"),s3=Z("<button> </button>"),o3=Z('<div class="simulation-panel svelte-makk3l"><div class="settings-grid svelte-makk3l"><div class="setting-item svelte-makk3l"><label for="duration" class="svelte-makk3l"><span>Duration</span> <span class="help-icon svelte-makk3l">?</span></label> <div class="input-with-unit svelte-makk3l"><input id="duration" type="text" class="code-input svelte-makk3l" spellcheck="false"/> <span class="unit svelte-makk3l">s</span></div></div> <div class="setting-item svelte-makk3l"><label for="dt" class="svelte-makk3l"><span>Time Step</span> <span class="help-icon svelte-makk3l">?</span></label> <div class="input-with-unit svelte-makk3l"><input id="dt" type="text" class="code-input svelte-makk3l" spellcheck="false"/> <span class="unit svelte-makk3l">s</span></div></div></div> <div class="solver-section svelte-makk3l"><span class="section-label svelte-makk3l">Solver</span> <div class="solver-matrix svelte-makk3l"><div class="matrix-header corner svelte-makk3l"></div> <div class="matrix-header col-header svelte-makk3l"><span>Adaptive</span> <span class="help-icon svelte-makk3l">?</span></div> <div class="matrix-header col-header svelte-makk3l"><span>Fixed</span> <span class="help-icon svelte-makk3l">?</span></div> <div class="matrix-header row-header svelte-makk3l"><span class="rotated-text svelte-makk3l">Explicit</span> <span class="help-icon svelte-makk3l">?</span></div> <div class="matrix-cell svelte-makk3l"></div> <div class="matrix-cell svelte-makk3l"></div> <div class="matrix-header row-header svelte-makk3l"><span class="rotated-text svelte-makk3l">Implicit</span> <span class="help-icon svelte-makk3l">?</span></div> <div class="matrix-cell svelte-makk3l"></div> <div class="matrix-cell svelte-makk3l"></div></div></div> <div class="settings-grid svelte-makk3l"><div class="setting-item svelte-makk3l"><label for="rtol" class="svelte-makk3l"><span>Rel. Tolerance</span> <span class="help-icon svelte-makk3l">?</span></label> <input id="rtol" type="text" class="code-input svelte-makk3l" spellcheck="false"/></div> <div class="setting-item svelte-makk3l"><label for="atol" class="svelte-makk3l"><span>Abs. Tolerance</span> <span class="help-icon svelte-makk3l">?</span></label> <input id="atol" type="text" class="code-input svelte-makk3l" spellcheck="false"/></div> <div class="setting-item svelte-makk3l"><label for="ftol" class="svelte-makk3l"><span>FP Tolerance</span> <span class="help-icon svelte-makk3l">?</span></label> <input id="ftol" type="text" class="code-input svelte-makk3l" spellcheck="false"/></div></div> <div class="settings-grid svelte-makk3l"><div class="setting-item svelte-makk3l"><label for="dt_min" class="svelte-makk3l"><span>Min Timestep</span> <span class="help-icon svelte-makk3l">?</span></label> <div class="input-with-unit svelte-makk3l"><input id="dt_min" type="text" class="code-input svelte-makk3l" spellcheck="false"/> <span class="unit svelte-makk3l">s</span></div></div> <div class="setting-item svelte-makk3l"><label for="dt_max" class="svelte-makk3l"><span>Max Timestep</span> <span class="help-icon svelte-makk3l">?</span></label> <div class="input-with-unit svelte-makk3l"><input id="dt_max" type="text" class="code-input svelte-makk3l" spellcheck="false"/> <span class="unit svelte-makk3l">s</span></div></div></div> <div class="setting-item full-width svelte-makk3l"><span class="setting-label svelte-makk3l"><span>Ghost Traces</span> <span class="help-icon svelte-makk3l">?</span></span> <div class="ghost-selector svelte-makk3l"></div></div></div>');function a3(e,t){Oe(t,!0);let n=$(Et(Pn.get()));const i=Pn.subscribe(W=>{E(n,W,!0)});jt(i);const s={adaptive:{explicit:["RKBS32","RKCK54"],implicit:["GEAR52A","ESDIRK43"]},fixed:{explicit:["SSPRK22","RK4"],implicit:["BDF2"]}},o={adaptive:"Automatically adjusts step size for accuracy and speed",fixed:"Uses constant step size (dt) throughout simulation",explicit:"Fast, direct computation. Best for non-stiff systems",implicit:"Solves equations iteratively. Handles stiff systems",duration:"Total simulation time in seconds",dt:"Initial/fixed time step size in seconds",rtol:"Relative error tolerance for adaptive solvers",atol:"Absolute error tolerance for adaptive solvers",ftol:"Fixed-point iteration tolerance for implicit solvers and algebraic loops",dt_min:"Minimum allowed timestep for adaptive solvers",dt_max:"Maximum allowed timestep for adaptive solvers",ghostTraces:"Number of previous simulation traces to show faded"};function a(W,se){Pn.update({[W]:se})}function l(W){a("solver",W)}function d(W){W<r(n).ghostTraces&&dT(W),a("ghostTraces",W)}var c=o3(),u=M(c),p=M(u),f=M(p),h=q(M(f),2);Ee(h,(W,se)=>Ue?.(W,se),()=>o.duration),C(f);var g=q(f,2),y=M(g);xn(y),y.__input=W=>a("duration",W.currentTarget.value),Ee(y,W=>Un?.(W)),Kt(2),C(g),C(p);var b=q(p,2),m=M(b),x=q(M(m),2);Ee(x,(W,se)=>Ue?.(W,se),()=>o.dt),C(m);var S=q(m,2),v=M(S);xn(v),v.__input=W=>a("dt",W.currentTarget.value),Ee(v,W=>Un?.(W)),Kt(2),C(S),C(b),C(u);var A=q(u,2),w=q(M(A),2),k=q(M(w),2),N=q(M(k),2);Ee(N,(W,se)=>Ue?.(W,se),()=>o.adaptive),C(k);var L=q(k,2),X=q(M(L),2);Ee(X,(W,se)=>Ue?.(W,se),()=>o.fixed),C(L);var O=q(L,2),I=q(M(O),2);Ee(I,(W,se)=>Ue?.(W,se),()=>o.explicit),C(O);var H=q(O,2);it(H,21,()=>s.adaptive.explicit,_t,(W,se)=>{var he=e3();let Be;he.__click=()=>l(r(se));var Ye=M(he,!0);C(he),G(()=>{Be=qe(he,1,"solver-pill svelte-makk3l",null,Be,{selected:r(n).solver===r(se)}),Fe(Ye,r(se))}),_(W,he)}),C(H);var P=q(H,2);it(P,21,()=>s.fixed.explicit,_t,(W,se)=>{var he=t3();let Be;he.__click=()=>l(r(se));var Ye=M(he,!0);C(he),G(()=>{Be=qe(he,1,"solver-pill svelte-makk3l",null,Be,{selected:r(n).solver===r(se)}),Fe(Ye,r(se))}),_(W,he)}),C(P);var T=q(P,2),R=q(M(T),2);Ee(R,(W,se)=>Ue?.(W,se),()=>o.implicit),C(T);var B=q(T,2);it(B,21,()=>s.adaptive.implicit,_t,(W,se)=>{var he=n3();let Be;he.__click=()=>l(r(se));var Ye=M(he,!0);C(he),G(()=>{Be=qe(he,1,"solver-pill svelte-makk3l",null,Be,{selected:r(n).solver===r(se)}),Fe(Ye,r(se))}),_(W,he)}),C(B);var V=q(B,2);it(V,21,()=>s.fixed.implicit,_t,(W,se)=>{var he=i3();let Be;he.__click=()=>l(r(se));var Ye=M(he,!0);C(he),G(()=>{Be=qe(he,1,"solver-pill svelte-makk3l",null,Be,{selected:r(n).solver===r(se)}),Fe(Ye,r(se))}),_(W,he)}),C(V),C(w),C(A);var F=q(A,2),Y=M(F),J=M(Y),ie=q(M(J),2);Ee(ie,(W,se)=>Ue?.(W,se),()=>o.rtol),C(J);var ve=q(J,2);xn(ve),ve.__input=W=>a("rtol",W.currentTarget.value),Ee(ve,W=>Un?.(W)),C(Y);var re=q(Y,2),me=M(re),ge=q(M(me),2);Ee(ge,(W,se)=>Ue?.(W,se),()=>o.atol),C(me);var Q=q(me,2);xn(Q),Q.__input=W=>a("atol",W.currentTarget.value),Ee(Q,W=>Un?.(W)),C(re);var oe=q(re,2),ue=M(oe),le=q(M(ue),2);Ee(le,(W,se)=>Ue?.(W,se),()=>o.ftol),C(ue);var te=q(ue,2);xn(te),te.__input=W=>a("ftol",W.currentTarget.value),Ee(te,W=>Un?.(W)),C(oe),C(F);var be=q(F,2),fe=M(be),Pe=M(fe),Re=q(M(Pe),2);Ee(Re,(W,se)=>Ue?.(W,se),()=>o.dt_min),C(Pe);var Se=q(Pe,2),Ce=M(Se);xn(Ce),Ce.__input=W=>a("dt_min",W.currentTarget.value),Ee(Ce,W=>Un?.(W)),Kt(2),C(Se),C(fe);var ke=q(fe,2),Ne=M(ke),$e=q(M(Ne),2);Ee($e,(W,se)=>Ue?.(W,se),()=>o.dt_max),C(Ne);var Me=q(Ne,2),Ae=M(Me);xn(Ae),Ae.__input=W=>a("dt_max",W.currentTarget.value),Ee(Ae,W=>Un?.(W)),Kt(2),C(Me),C(ke),C(be);var xt=q(be,2),It=M(xt),U=q(M(It),2);Ee(U,(W,se)=>Ue?.(W,se),()=>o.ghostTraces),C(It);var we=q(It,2);it(we,20,()=>[0,1,2,3,4,5,6,7,8],_t,(W,se)=>{var he=s3();let Be;he.__click=()=>d(se);var Ye=M(he,!0);C(he),G(()=>{Be=qe(he,1,"ghost-pill svelte-makk3l",null,Be,{active:r(n).ghostTraces===se}),Fe(Ye,se)}),_(W,he)}),C(we),C(xt),C(c),G(()=>{An(y,r(n).duration),z(y,"placeholder",Wi.duration),An(v,r(n).dt),z(v,"placeholder",Wi.dt),An(ve,r(n).rtol),z(ve,"placeholder",Wi.rtol),An(Q,r(n).atol),z(Q,"placeholder",Wi.atol),An(te,r(n).ftol),z(te,"placeholder",Wi.ftol),An(Ce,r(n).dt_min),z(Ce,"placeholder",Wi.dt_min),An(Ae,r(n).dt_max),z(Ae,"placeholder",Wi.dt_max)}),_(e,c),ze()}Mt(["input","click"]);function hv(e,t,n={}){const{multiLine:i=!1,indent:s="    ",skipInternal:o=!1}=n,a=[];for(const[l,d]of Object.entries(e))d==null||d===""||o&&l.startsWith("_")||t.has(l)&&a.push(`${l}=${d}`);return i&&a.length>0?`
`+a.map(l=>s+l).join(`,
`)+`
`:a.join(", ")}function r3(e,t){const n=new Map;for(const i of e){const s=t.get(i.sourceNodeId),o=t.get(i.targetNodeId);if(!s||!o)continue;const a=`${i.sourceNodeId}:${i.sourcePortIndex}`;n.has(a)||n.set(a,{sourceVar:s,sourcePort:i.sourcePortIndex,targets:[]}),n.get(a).targets.push({varName:o,port:i.targetPortIndex})}return n}function Cf(e,t,n="    "){const i=[],s=r3(e,t);for(const{sourceVar:o,sourcePort:a,targets:l}of s.values()){const d=l.map(c=>`${c.varName}[${c.port}]`);i.push(`${n}Connection(${o}[${a}], ${d.join(", ")}),`)}return i}function Ec(e,t,n="    "){const i=[];i.push(`${e} = [`);for(const s of t)i.push(`${n}${s},`);return i.push("]"),i}function ki(e){if(!e)return"";let t="";for(const n of e)/[a-zA-Z0-9_]/.test(n)?t+=n:n===" "&&(t+="_");return t&&/^[0-9]/.test(t)&&(t="n_"+t),t.toLowerCase()}function Yn(e,t){const n=e[t];return n===""||n===null||n===void 0?Wi[t]:n}function Xr(e,t,n=!1){return hv(e,t,{multiLine:n,skipInternal:!0})}function Ef(e,t,n=!1){return hv(e,t,{multiLine:n})}function gv(e,t,n,i=!1){const s=[];for(const o of e){const a=ti.get(o.type);if(!a)continue;let l=ki(o.name);(!l||t.includes(l)||s.includes(l))&&(l=`event_${s.length}`),s.push(l);const d=new Set(a.params.map(u=>u.name)),c=Ef(o.params,d,i);c?n.push(`${l} = ${a.eventClass}(${c})`):n.push(`${l} = ${a.eventClass}()`)}return s}function mv(e,t,n,i="    "){n.push("sim = Simulation("),n.push(`${i}blocks,`),n.push(`${i}connections,`),t&&n.push(`${i}events,`),n.push(`${i}Solver=${Yn(e,"solver")},`),n.push(`${i}dt=${Yn(e,"dt")},`),n.push(`${i}dt_min=${Yn(e,"dt_min")},`);const s=Yn(e,"dt_max");s&&n.push(`${i}dt_max=${s},`),n.push(`${i}tolerance_lte_rel=${Yn(e,"rtol")},`),n.push(`${i}tolerance_lte_abs=${Yn(e,"atol")},`),n.push(`${i}tolerance_fpi=${Yn(e,"ftol")},`),n.push(")")}function Tf(e){const t=[];for(const n of e)t.push(n),_i(n)&&t.push(...Tf(n.graph?.nodes??[]));return t}function vv(e){const t=Tf(e),n=new Map;for(const i of t){if(_i(i)||Kr(i))continue;const s=Qt.get(i.type);if(!s)continue;const o=WS[s.blockClass]||"pathsim.blocks";n.has(o)||n.set(o,new Set),n.get(o).add(s.blockClass)}return n}function ed(e,t,n,i,s="",o={}){const{formatted:a=!1}=o,l=e.graph?.nodes??[],d=e.graph?.connections??[],c=e.graph?.events??[];let u=ki(e.name);(!u||n.includes(u))&&(u=`subsystem_${n.length}`),n.push(u),t.set(e.id,u);const p=s+u+"_",f=l.filter(Kr),h=l.filter(x=>!Kr(x)),g=[],y=new Map;a&&(i.push(""),i.push(`# Subsystem: ${e.name}`));for(const x of f){const S=p+"interface";g.push(S),y.set(x.id,S),i.push(`${S} = Interface()`)}for(const x of h)if(_i(x))ed(x,y,g,i,p,o);else{const S=Qt.get(x.type);if(!S)continue;let v=p+ki(x.name);(!v||g.includes(v))&&(v=`${p}block_${g.length}`),g.push(v),y.set(x.id,v);const A=new Set(S.params.map(k=>k.name)),w=Xr(x.params,A,a);w?i.push(`${v} = ${S.blockClass}(${w})`):i.push(`${v} = ${S.blockClass}()`)}for(const[x,S]of y)t.set(x,S);const b=[];if(c.length>0)for(const x of c){const S=ti.get(x.type);if(!S)continue;let v=p+ki(x.name);(!v||n.includes(v)||b.includes(v))&&(v=`${p}event_${b.length}`),b.push(v);const A=new Set(S.params.map(k=>k.name)),w=Ef(x.params,A,a);w?i.push(`${v} = ${S.eventClass}(${w})`):i.push(`${v} = ${S.eventClass}()`)}i.push(`${u} = Subsystem(`),i.push("    blocks=[");for(const x of g)i.push(`        ${x},`);i.push("    ],"),i.push("    connections=[");const m=Cf(d,y,"        ");for(const x of m)i.push(x);if(i.push("    ],"),c.length>0){i.push("    events=[");for(const x of b)i.push(`        ${x},`);i.push("    ],")}return i.push(")"),a||i.push(""),u}function l3(e){const t=new Map;for(const n of e){const i=Qt.get(n.type);if(!i)continue;const s=i.category||"Other";t.has(s)||t.set(s,[]),t.get(s).push({node:n,typeDef:i})}return t}function c3(e,t,n,i,s=!0,o=[],a=!0){const l=[],d=e.some(_i),c=o.length>0,u=new Set(o.map(m=>ti.get(m.type)?.eventClass).filter(Boolean)),p=vv(e);l.push("# IMPORTS"),l.push("import numpy as np"),d?l.push("from pathsim import Simulation, Connection, Subsystem, Interface"):l.push("from pathsim import Simulation, Connection");for(const[m]of p)l.push(`from ${m} import *`);p.has("pathsim.blocks")||l.push("from pathsim.blocks import *"),l.push(`from pathsim.solvers import ${Yn(n,"solver")}`),c&&l.push(`from pathsim.events import ${[...u].join(", ")}`),l.push(""),i.trim()&&(l.push("# CODE CONTEXT"),l.push(i.trim()),l.push("")),l.push("# BLOCKS");const f=new Map,h=[],g=e.filter(_i);for(const m of g)ed(m,f,h,l);if(e.filter(m=>!_i(m)&&!Kr(m)).forEach((m,x)=>{const S=Qt.get(m.type);if(!S){console.warn(`Unknown node type: ${m.type}`);return}let v=ki(m.name);(!v||h.includes(v))&&(v=`block_${x}`),h.push(v),f.set(m.id,v);const A=new Set(S.params.map(k=>k.name)),w=Xr(m.params,A);w?l.push(`${v} = ${S.blockClass}(${w})`):l.push(`${v} = ${S.blockClass}()`)}),l.push(""),l.push(...Ec("blocks",h)),l.push(""),s){l.push("# NODE ID MAPPING (for data extraction)"),l.push("_node_id_map = {");for(const[x,S]of f)l.push(`    id(${S}): "${x}",`);l.push("}"),l.push(""),l.push("# NODE NAME MAPPING"),l.push("_node_name_map = {");const m=Tf(e);for(const x of m){const S=x.name.replace(/"/g,'\\"');l.push(`    "${x.id}": "${S}",`)}l.push("}"),l.push("")}l.push("# CONNECTIONS"),l.push("connections = [");const b=Cf(t,f,"    ");for(const m of b)l.push(m);if(l.push("]"),l.push(""),c){l.push("# EVENTS");const m=gv(o,h,l);l.push(""),l.push(...Ec("events",m)),l.push("")}return l.push("# SIMULATION"),mv(n,c,l),a&&(l.push(""),l.push("# RUN"),l.push(`sim.run(duration=${Yn(n,"duration")}, reset=True)`)),l.join(`
`)}function d3(e,t,n,i,s=[]){const o=[],a="# "+"â".repeat(76),d=new Date().toISOString().replace("T"," ").split(".")[0];o.push("#!/usr/bin/env python3"),o.push("# -*- coding: utf-8 -*-"),o.push('"""'),o.push("PathSim Simulation"),o.push("=================="),o.push(""),o.push(`Generated by PathView on ${d}`),o.push("https://view.pathsim.org"),o.push(""),o.push("PathSim documentation: https://docs.pathsim.org"),o.push('"""'),o.push("");const c=e.some(_i),u=s.length>0,p=new Set(s.map(v=>ti.get(v.type)?.eventClass).filter(Boolean));o.push(a),o.push("# IMPORTS"),o.push(a),o.push(""),o.push("import numpy as np"),o.push("import matplotlib.pyplot as plt"),o.push(""),c?o.push("from pathsim import Simulation, Connection, Subsystem, Interface"):o.push("from pathsim import Simulation, Connection");const f=vv(e);for(const[v,A]of f){const w=[...A].sort();if(w.length===1)o.push(`from ${v} import ${w[0]}`);else{o.push(`from ${v} import (`);for(let k=0;k<w.length;k++){const N=k<w.length-1?",":"";o.push(`    ${w[k]}${N}`)}o.push(")")}}o.push(`from pathsim.solvers import ${Yn(n,"solver")}`),u&&o.push(`from pathsim.events import ${[...p].join(", ")}`),o.push(""),i.trim()&&(o.push(a),o.push("# USER-DEFINED CODE"),o.push(a),o.push(""),o.push(i.trim()),o.push("")),o.push(a),o.push("# BLOCKS"),o.push(a);const h=new Map,g=[];let y=0;const b=e,m=b.filter(_i);for(const v of m)ed(v,h,g,o,"",{formatted:!0});const x=b.filter(v=>!_i(v)&&!Kr(v)),S=l3(x);for(const v of qp){if(v==="Subsystem")continue;const A=S.get(v);if(!(!A||A.length===0)){o.push(""),o.push(`# ${v}`);for(const{node:w,typeDef:k}of A){let N=ki(w.name);(!N||g.includes(N))&&(N=`block_${y}`),g.push(N),h.set(w.id,N),y++;const L=new Set(k.params.map(O=>O.name)),X=Xr(w.params,L,!0);X?o.push(`${N} = ${k.blockClass}(${X})`):o.push(`${N} = ${k.blockClass}()`)}}}for(const[v,A]of S)if(!qp.includes(v)){o.push(""),o.push(`# ${v}`);for(const{node:w,typeDef:k}of A){let N=ki(w.name);(!N||g.includes(N))&&(N=`block_${y}`),g.push(N),h.set(w.id,N),y++;const L=new Set(k.params.map(O=>O.name)),X=Xr(w.params,L,!0);X?o.push(`${N} = ${k.blockClass}(${X})`):o.push(`${N} = ${k.blockClass}()`)}}if(o.push(""),o.push(...Ec("blocks",g)),o.push(""),o.push(a),o.push("# CONNECTIONS"),o.push(a),o.push(""),t.length===0)o.push("connections = []");else{o.push("connections = [");const v=Cf(t,h,"    ");for(const A of v)o.push(A);o.push("]")}if(o.push(""),u){o.push(a),o.push("# EVENTS"),o.push(a),o.push("");const v=gv(s,g,o,!0);o.push(""),o.push(...Ec("events",v)),o.push("")}return o.push(a),o.push("# SIMULATION"),o.push(a),o.push(""),mv(n,u,o),o.push(""),o.push(a),o.push("# MAIN"),o.push(a),o.push(""),o.push("if __name__ == '__main__':"),o.push(""),o.push("    # Run simulation"),o.push(`    sim.run(duration=${Yn(n,"duration")})`),o.push(""),o.push("    # Plot results"),o.push("    sim.plot()"),o.push("    plt.show()"),o.push(""),o.join(`
`)}async function u3(e,t,n,i,s=[],o){const a=c3(e,t,n,i,!0,s,!1),l=Yn(n,"duration");return rT(a,String(l),o)}function f3(e,t,n,i,s=[]){return d3(e,t,n,i,s)}function If(e,t,n){const i=Qt.get(e.type);if(!i)return"";if(e.type===yt.INTERFACE){const l=t||ee.getAllNodes(),d=vm(l,e.id);return d?If(d,t,n):"# Interface block (no parent subsystem found)"}const s=ki(e.name)||"block";if(e.type===yt.SUBSYSTEM&&t&&n){const l=[];return ed(e,new Map,[],l,"",{formatted:!0}),l.join(`
`)}const o=new Set(i.params.map(l=>l.name)),a=Xr(e.params,o,!0);return a?`${s} = ${i.blockClass}(${a})`:`${s} = ${i.blockClass}()`}function yv(e){const t=ti.get(e.type);if(!t)return"";const n=ki(e.name)||"event",i=new Set(t.params.map(o=>o.name)),s=Ef(e.params,i,!0);return s?`${n} = ${t.eventClass}(${s})`:`${n} = ${t.eventClass}()`}function p3(e){const t={};for(const n of e){const i=Qt.get(n.type);if(!i)continue;const s=new Set(i.params.map(a=>a.name)),o={};for(const[a,l]of Object.entries(n.params))l==null||l===""||a.startsWith("_")||s.has(a)&&(o[a]=String(l));Object.keys(o).length>0&&(t[n.id]=o)}return t}async function h3(e,t){const n=p3(e);return cT(t,n)}function bv(e){const t=new RegExp("(?<![.\\w])([a-zA-Z_][a-zA-Z0-9_]*)","g"),n=new Set;let i;for(;(i=t.exec(e))!==null;)n.add(i[1]);return n}const g3=new Set(["True","False","None","and","or","not","in","is","if","else","elif","for","while","def","class","return","yield","import","from","as","try","except","finally","with","lambda","pass","break","continue","raise","global","nonlocal","assert","del","print","len","range","list","dict","set","tuple","str","int","float","bool","type","np","numpy","math","sin","cos","tan","exp","log","sqrt","pi","abs","min","max","sum","any","all","map","filter","zip","enumerate"]);function wv(e,t){if(!e.trim()||t.size===0)return"";const n=e.split(`
`),i=[];let s=!1,o=0;const a=new Set([...t].filter(l=>!g3.has(l)));if(a.size===0)return"";for(let l=0;l<n.length;l++){const d=n[l],c=d.trim(),u=c.match(/^def\s+([a-zA-Z_][a-zA-Z0-9_]*)\s*\(/);if(u&&a.has(u[1])){s=!0,o=d.search(/\S/),i.push(d);continue}const p=c.match(/^([a-zA-Z_][a-zA-Z0-9_]*)\s*=/);if(p&&a.has(p[1])&&!s){i.push(d);continue}if(s){const f=d.search(/\S/);c===""||f>o?i.push(d):s=!1}}return i.join(`
`).trim()}function _v(e){const t=[];for(const n of Object.values(e.params))n!=null&&n!==""&&t.push(String(n));if(e.graph)for(const n of e.graph.nodes)t.push(..._v(n));return t}function xv(e,t){if(e.graph)for(const n of e.graph.nodes){const i=Qt.get(n.type);i&&i.blockClass!=="Subsystem"&&i.blockClass!=="Interface"&&t.add(i.blockClass),n.type===yt.SUBSYSTEM&&xv(n,t)}}function kv(e,t){const n=Qt.get(e.type);if(!n)return"";const i=[];if(i.push("import numpy as np"),e.type===yt.SUBSYSTEM){i.push("from pathsim import Subsystem, Interface, Connection");const l=new Set;xv(e,l),l.size>0&&i.push(`from pathsim.blocks import ${[...l].sort().join(", ")}`)}else i.push(`from pathsim.blocks import ${n.blockClass}`);const s=e.type===yt.SUBSYSTEM?_v(e).join(" "):Object.values(e.params).filter(l=>l!=null&&l!=="").join(" "),o=bv(s),a=wv(t,o);return a&&(i.push(""),i.push(a)),i.push(""),i.join(`
`)}function Sv(e,t){const n=ti.get(e.type);if(!n)return"";const i=[];i.push("import numpy as np"),i.push(`from pathsim.events import ${n.eventClass}`);const s=Object.values(e.params).filter(l=>l!=null&&l!=="").join(" "),o=bv(s),a=wv(t,o);return a&&(i.push(""),i.push(a)),i.push(""),i.join(`
`)}function m3(e){return bc[e]?.docstringHtml}const Ft={keyword:"#E57373",operator:"#0070C0",special:"#FFB74D",number:"#4DB6AC",string:"#81C784",function:"#0070C0",comment:{dark:"#505060",light:"#909098"},invalid:"#BA68C8",variable:{dark:"#e0e0e0",light:"#383a42"},punctuation:{dark:"#abb2bf",light:"#505050"}};let zl=null;async function td(){if(zl)return zl;const[e,t,n,i,s,o,a]=await Promise.all([oi(()=>import("../chunks/BaLj8HaF.js").then(l=>l.t),__vite__mapDeps([0,1]),import.meta.url),oi(()=>import("../chunks/BJrbMhgq.js"),[],import.meta.url),oi(()=>import("../chunks/zngUhAbX.js"),__vite__mapDeps([2,0,1,3,4,5]),import.meta.url),oi(()=>import("../chunks/AwXmWqiV.js"),__vite__mapDeps([6,4,3,1,0,5]),import.meta.url),oi(()=>import("../chunks/-suHlTGB.js"),__vite__mapDeps([7,0,1,3,4]),import.meta.url),oi(()=>import("../chunks/bH9uCY5d.js"),__vite__mapDeps([3,4,1,0]),import.meta.url),oi(()=>import("../chunks/DSDy7V6L.js").then(l=>l.i),[],import.meta.url)]);return zl={EditorView:e.EditorView,EditorState:t.EditorState,keymap:e.keymap,basicSetup:n.basicSetup,python:i.python,oneDark:s.oneDark,HighlightStyle:o.HighlightStyle,syntaxHighlighting:o.syntaxHighlighting,indentUnit:o.indentUnit,tags:a.tags},zl}function v3(e,t){const{HighlightStyle:n,tags:i}=e,s=t?Ft.variable.dark:Ft.variable.light,o=t?Ft.punctuation.dark:Ft.punctuation.light,a=t?Ft.comment.dark:Ft.comment.light;return n.define([{tag:i.keyword,color:Ft.keyword},{tag:i.operator,color:Ft.operator},{tag:i.special(i.variableName),color:Ft.special},{tag:i.typeName,color:Ft.special},{tag:i.atom,color:Ft.number},{tag:i.number,color:Ft.number},{tag:i.bool,color:Ft.number},{tag:i.string,color:Ft.string},{tag:i.character,color:Ft.string},{tag:i.regexp,color:Ft.string},{tag:i.escape,color:Ft.operator},{tag:i.variableName,color:s},{tag:i.definition(i.variableName),color:s},{tag:i.propertyName,color:s},{tag:i.function(i.variableName),color:Ft.function},{tag:i.function(i.propertyName),color:Ft.function},{tag:i.definition(i.function(i.variableName)),color:Ft.function},{tag:i.labelName,color:s},{tag:i.comment,color:a,fontStyle:"italic"},{tag:i.blockComment,color:a,fontStyle:"italic"},{tag:i.docComment,color:a,fontStyle:"italic"},{tag:i.invalid,color:"#ffffff",backgroundColor:Ft.invalid},{tag:i.punctuation,color:o},{tag:i.bracket,color:o},{tag:i.className,color:Ft.special},{tag:i.attributeName,color:s},{tag:i.attributeValue,color:Ft.string},{tag:i.self,color:Ft.special}])}function nl(e,t,n={}){const{EditorView:i,EditorState:s,keymap:o,basicSetup:a,python:l,oneDark:d,syntaxHighlighting:c,indentUnit:u}=e,p=[];if(n.keymaps&&n.keymaps.length>0&&p.push(o.of(n.keymaps)),p.push(a,l(),u.of("    "),c(v3(e,t))),n.readOnly&&p.push(s.readOnly.of(!0)),n.onDocChange){const f=n.onDocChange;p.push(i.updateListener.of(h=>{h.docChanged&&f(h.state.doc.toString())}))}return t&&p.push(d),p}let Wa=[],Tc=[],Ka=null;async function y3(e){if(!e?.trim())return'<p class="no-docs">No documentation available.</p>';const t=await mf(),n=document.createElement("div");n.innerHTML=e;const i=n.querySelectorAll(".math");for(const s of i){const o=s.textContent||"";if(o.trim())try{let a=o.replace(/^\\\(|\\\)$/g,"").replace(/^\\\[|\\\]$/g,"").trim();a=a.replace(/\\begin\{eqnarray\*?\}/g,"\\begin{aligned}").replace(/\\end\{eqnarray\*?\}/g,"\\end{aligned}"),a.includes("\\\\")&&!a.includes("\\begin{")&&(a=`\\begin{aligned}${a}\\end{aligned}`);const l=s.tagName==="DIV"||o.includes("\\["),d=t.default.renderToString(a,{displayMode:l,throwOnError:!1,strict:!1});s.innerHTML=d,s.classList.add("katex-rendered")}catch(a){console.warn("KaTeX error for:",o,a)}}return n.innerHTML}function b3(e){const t=e.querySelectorAll("dl.docutils");for(const n of t){if(n.classList.contains("table-transformed"))continue;const i=document.createElement("div");i.className="param-table-wrapper";const s=document.createElement("table");s.className="param-table";const o=document.createElement("thead"),a=document.createElement("tr");["Name","Type","Description"].forEach(c=>{const u=document.createElement("th");u.textContent=c,a.appendChild(u)}),o.appendChild(a),s.appendChild(o);const l=document.createElement("tbody"),d=n.querySelectorAll(":scope > dt");for(const c of d){const u=document.createElement("tr"),p=document.createElement("td");p.className="param-name";const f=document.createElement("code");let h="";for(const x of c.childNodes)if(x.nodeType===Node.TEXT_NODE){if(h=x.textContent?.trim()||"",h)break}else if(x.nodeType===Node.ELEMENT_NODE){const S=x;if(S.classList.contains("classifier-delimiter")||(h=S.textContent?.trim()||"",h))break}f.textContent=h,p.appendChild(f),u.appendChild(p);const g=document.createElement("td");g.className="param-type";const y=c.querySelector(".classifier");if(y){const x=document.createElement("code");x.textContent=y.textContent||"",g.appendChild(x)}u.appendChild(g);const b=document.createElement("td");b.className="param-desc";const m=c.nextElementSibling;m&&m.tagName==="DD"&&(b.innerHTML=m.innerHTML),u.appendChild(b),l.appendChild(u)}s.appendChild(l),i.appendChild(s),n.parentNode?.replaceChild(i,n)}}function w3(e){return e.includes(">>>")||e.includes("...")?"console":"python"}function _3(e){const t=document.createElement("button");return t.className="copy-btn",t.innerHTML='<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>',t.title="Copy code",t.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(e),t.innerHTML='<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>',setTimeout(()=>{t.innerHTML='<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>'},2e3)}catch(n){console.error("Failed to copy:",n)}}),t}async function x3(e){_u(),Ka=await td();const t=document.documentElement.getAttribute("data-theme")!=="light",n=e.querySelectorAll("pre");for(const i of n){if(i.classList.contains("cm-processed"))continue;const s=i.querySelector("code"),o=s?s.textContent:i.textContent;if(!o?.trim())continue;i.classList.add("cm-processed");const a=o.trim(),l=w3(a),d=document.createElement("div");d.className="code-block-wrapper";const c=document.createElement("div");c.className="code-block-header";const u=document.createElement("span");u.className="code-label",u.textContent=l==="console"?"CONSOLE":"PYTHON",c.appendChild(u),c.appendChild(_3(a)),d.appendChild(c);const p=document.createElement("div");p.className="cm-container",d.appendChild(p),i.parentNode?.replaceChild(d,i),Tc.push({wrapper:d,code:a});const f=new Ka.EditorView({doc:a,extensions:nl(Ka,t,{readOnly:!0}),parent:p});Wa.push(f)}}async function k3(){if(!Ka||Tc.length===0)return;const e=document.documentElement.getAttribute("data-theme")!=="light";for(const t of Wa)t.destroy();Wa=[];for(const{wrapper:t,code:n}of Tc){const i=t.querySelector(".cm-container");if(!i)continue;i.innerHTML="";const s=new Ka.EditorView({doc:n,extensions:nl(Ka,e,{readOnly:!0}),parent:i});Wa.push(s)}}function _u(){for(const e of Wa)e.destroy();Wa=[],Tc=[]}var S3=Z('<link rel="stylesheet"/>'),C3=Z('<div class="docs-loading svelte-1tqxd15">Loading documentation...</div>'),E3=Z('<div class="docs-content svelte-1tqxd15"><!></div>'),T3=Z('<div class="docs-section svelte-1tqxd15"><button class="docs-toggle svelte-1tqxd15"><span><!></span> Documentation</button> <!></div>');function Cv(e,t){Oe(t,!0);let n=$(!1),i=$(""),s=$(!1),o=$(void 0);const a=D(()=>!!t.docstring||!!t.docstringHtml);async function l(){if(E(n,!r(n)),r(n)&&!r(i)){const p=t.docstringHtml||t.docstring;if(!p)return;E(s,!0);try{E(i,await y3(p),!0)}catch(f){console.error("Failed to render docstring:",f),E(i,'<p class="docs-error">Failed to render documentation.</p>')}E(s,!1)}}ut(()=>{r(i)&&r(o)&&!r(s)&&requestAnimationFrame(async()=>{r(o)&&(b3(r(o)),await x3(r(o)))})}),es.subscribe(()=>{r(n)&&r(o)&&k3()}),ut(()=>{(t.docstring||t.docstringHtml)&&(_u(),E(i,""),E(n,!1))}),jt(()=>{_u()});var d=pe();Ac("1tqxd15",p=>{var f=S3();G(h=>z(f,"href",h),[vf]),_(p,f)});var c=ae(d);{var u=p=>{var f=T3(),h=M(f);h.__click=l;var g=M(h);let y;var b=M(g);He(b,{name:"chevron-right",size:12}),C(g),Kt(),C(h);var m=q(h,2);{var x=S=>{var v=E3(),A=M(v);{var w=N=>{var L=C3();_(N,L)},k=N=>{var L=pe(),X=ae(L);Ru(X,()=>r(i)),_(N,L)};j(A,N=>{r(s)?N(w):N(k,!1)})}C(v),Jt(v,N=>E(o,N),()=>r(o)),St(3,v,()=>_1,()=>({duration:200})),_(S,v)};j(m,S=>{r(n)&&S(x)})}C(f),G(()=>y=qe(g,1,"toggle-icon svelte-1tqxd15",null,y,{expanded:r(n)})),_(p,f)};j(c,p=>{r(a)&&p(u)})}_(e,d),ze()}Mt(["click"]);var I3=Z('<div class="loading svelte-70gj2h">Loading...</div>'),N3=Z('<div class="dialog-backdrop nested" role="presentation"><div class="dialog glass-panel svelte-70gj2h" role="dialog" tabindex="-1" aria-labelledby="dialog-title"><div class="dialog-header"><span id="dialog-title"> </span> <div class="header-actions svelte-70gj2h"><button aria-label="Copy to Clipboard"><!></button> <button class="icon-btn" aria-label="Close"><!></button></div></div> <div class="dialog-body svelte-70gj2h"><div class="code-preview svelte-70gj2h"><!></div></div></div></div>');function Nf(e,t){Oe(t,!0);let n=_e(t,"open",3,!1),i=_e(t,"code",3,""),s=_e(t,"title",3,"Python Code"),o=$(void 0),a=null,l=null,d=$(!0),c=$("dark"),u=$(!1);const p=es.subscribe(w=>{E(c,w,!0),a&&l&&r(o)&&g()});ut(()=>{n()?(E(u,!1),E(d,!0),setTimeout(()=>y(),0)):h()}),ut(()=>{n()&&a&&i()!==a.state.doc.toString()&&a.dispatch({changes:{from:0,to:a.state.doc.length,insert:i()}})});function f(){return l?nl(l,r(c)==="dark",{readOnly:!0}):[]}function h(){a&&(a.destroy(),a=null)}function g(){if(!a||!r(o)||!l)return;const w=a.state.doc.toString();a.destroy(),a=new l.EditorView({doc:w,extensions:f(),parent:r(o)})}async function y(){r(o)&&(h(),l=await td(),a=new l.EditorView({doc:i(),extensions:f(),parent:r(o)}),E(d,!1))}function b(){navigator.clipboard.writeText(i()),E(u,!0),setTimeout(()=>E(u,!1),2e3)}function m(w){w.target===w.currentTarget&&t.onClose()}function x(w){w.key==="Escape"&&t.onClose()}jt(()=>{p(),h()});var S=pe();ht("keydown",Ot,x);var v=ae(S);{var A=w=>{var k=N3();k.__click=m;var N=M(k),L=M(N),X=M(L),O=M(X,!0);C(X);var I=q(X,2),H=M(I);let P;H.__click=b;var T=M(H);{var R=re=>{He(re,{name:"check",size:16})},B=re=>{He(re,{name:"copy",size:16})};j(T,re=>{r(u)?re(R):re(B,!1)})}C(H),Ee(H,(re,me)=>Ue?.(re,me),()=>r(u)?"Copied!":"Copy to Clipboard");var V=q(H,2);V.__click=function(...re){t.onClose?.apply(this,re)};var F=M(V);He(F,{name:"x",size:16}),C(V),Ee(V,(re,me)=>Ue?.(re,me),()=>({text:"Close",shortcut:"Esc"})),C(I),C(L);var Y=q(L,2),J=M(Y),ie=M(J);{var ve=re=>{var me=I3();_(re,me)};j(ie,re=>{r(d)&&re(ve)})}C(J),Jt(J,re=>E(o,re),()=>r(o)),C(Y),C(N),C(k),G(()=>{Fe(O,s()),P=qe(H,1,"icon-btn",null,P,{success:r(u)})}),St(3,N,()=>Ei,()=>({start:.95,duration:150,easing:di})),St(3,k,()=>mn,()=>({duration:150})),_(w,k)};j(v,w=>{n()&&w(A)})}_(e,S),ze()}Mt(["click"]);function P3(e){const t=JSON.parse(JSON.stringify(e)),n=Uc(t);return delete n.graph,{version:xf,type:"block",metadata:{name:e.name,created:new Date().toISOString(),modified:new Date().toISOString()},content:{node:n}}}function M3(e){if(e.type!==yt.SUBSYSTEM)throw new Error("Node is not a subsystem");const t=JSON.parse(JSON.stringify(e)),n=Uc(t);return{version:xf,type:"subsystem",metadata:{name:e.name,created:new Date().toISOString(),modified:new Date().toISOString()},content:{node:n}}}function A3(e){return{block:".blk",subsystem:".sub",model:".pvm"}[e]}function D3(e){return{block:"PathView Block",subsystem:"PathView Subsystem",model:"PathView Model"}[e]}function R3(e,t){sv(e,t)}async function xu(e,t){const n=ee.getNode(t);if(!n)return console.error("Node not found:",t),!1;if(e==="subsystem"&&n.type!==yt.SUBSYSTEM)return console.error("Cannot export non-subsystem as subsystem"),!1;const i=e==="subsystem"?M3(n):P3(n),s=A3(e),o=`${n.name}${s}`;if(Qc())try{const a=await window.showSaveFilePicker({suggestedName:o,types:[{description:D3(e),accept:{"application/json":[s]}}]}),l=JSON.stringify(i,null,2),d=await a.createWritable();return await d.write(l),await d.close(),!0}catch(a){if(a.name==="AbortError")return!1;console.error("Failed to save component:",a)}return R3(i,o),!0}const O3=/[/\\:*?"<>|]/g;function Ev(e){return e.replace(O3,"").trim()||"export"}function z3(e,t,n){const i=["time"];for(let o=0;o<t.length;o++)i.push(n?.[o]??`port_${o}`);const s=[i.join(",")];for(let o=0;o<e.length;o++){const a=[e[o].toString()];for(let l=0;l<t.length;l++)a.push((t[l][o]??"").toString());s.push(a.join(","))}return s.join(`
`)}function L3(e,t,n){const i=["frequency"];for(let o=0;o<t.length;o++)i.push(n?.[o]??`port_${o}`);const s=[i.join(",")];for(let o=0;o<e.length;o++){const a=[e[o].toString()];for(let l=0;l<t.length;l++)a.push((t[l][o]??"").toString());s.push(a.join(","))}return s.join(`
`)}function Tv(e,t){const n=de(nn);if(!n.result)return!1;if(t==="scope"){const i=n.result.scopeData[e];return!!(i&&i.time.length>0)}else{const i=n.result.spectrumData[e];return!!(i&&i.frequency.length>0)}}function H3(e,t){const i=de(nn).result?.scopeData[e];if(!i||i.time.length===0)return!1;const s=z3(i.time,i.signals,i.labels),o=`${Ev(t||"Scope")}.csv`;return ov(s,o),!0}function F3(e,t){const i=de(nn).result?.spectrumData[e];if(!i||i.frequency.length===0)return!1;const s=L3(i.frequency,i.magnitude,i.labels),o=`${Ev(t||"Spectrum")}.csv`;return ov(s,o),!0}function Pf(e,t,n){return n==="Scope"?H3(e,t):n==="Spectrum"?F3(e,t):!1}function B3(){let e=$(null),t=$(Et([])),n=$("idle"),i=$(0);const s=nn.subscribe(h=>{E(e,h.result,!0),E(t,h.resultHistory,!0),E(n,h.phase,!0)}),o=Pn.subscribe(h=>{E(i,h.ghostTraces??0,!0)});function a(h){return h==="Scope"?"scope":"spectrum"}function l(h,g){if(!r(e))return!1;if(a(g)==="scope"){const b=r(e).scopeData?.[h];return!!(b&&b.time.length>0)}else{const b=r(e).spectrumData?.[h];return!!(b&&b.frequency.length>0)}}function d(h){return r(e)?.scopeData?.[h]||null}function c(h){return r(e)?.spectrumData?.[h]||null}function u(h,g){if(a(g)==="scope"){const b=d(h);if(b)return{type:"scope",data:b}}else{const b=c(h);if(b)return{type:"spectrum",data:b}}return null}function p(h,g){if(r(i)===0||r(t).length===0)return[];const y=a(g);return r(t).slice(0,r(i)).map(m=>y==="scope"?m.scopeData?.[h]:m.spectrumData?.[h]).filter(m=>m!=null)}function f(){s(),o()}return{get simResult(){return r(e)},get resultHistory(){return r(t)},get simPhase(){return r(n)},get ghostTraces(){return r(i)},hasData:l,getScopeData:d,getSpectrumData:c,getPlotData:u,getGhostData:p,destroy:f}}var q3=Z('<button class="icon-btn" aria-label="Export CSV"><!></button>'),V3=Z('<button class="icon-btn" aria-label="Export"><!></button>'),W3=Z('<span class="help-icon">?</span>'),K3=Z("<option> </option>"),j3=Z('<select class="svelte-kkoyc2"></select>'),X3=Z('<input type="text" class="svelte-kkoyc2"/>'),G3=Z('<div class="param-item"><label><span> </span> <!></label> <div class="param-input-row svelte-kkoyc2"><!> <button><!></button></div></div>'),U3=Z('<div class="section"><div class="section-title">Parameters</div> <div class="params-grid"></div></div>'),Y3=Z('<div class="no-params">No configurable parameters</div>'),Z3=Z('<div class="dialog-backdrop" role="presentation"><div class="properties-dialog glass-panel" role="dialog" tabindex="-1" aria-labelledby="dialog-title"><div class="dialog-header"><div class="node-info"><input id="dialog-title" class="node-name-input" type="text"/> <span class="node-type"> </span></div> <div class="header-actions"><!> <!> <!> <button class="icon-btn" aria-label="View Python Code"><!></button> <button class="icon-btn" aria-label="Close"><!></button></div></div> <div class="dialog-body"><!> <!></div> <div class="dialog-footer"><span class="hint">R rotate Â· X flip horizontal Â· Y flip vertical</span></div></div></div>'),J3=Z("<!> <!>",1);function Q3(e,t){Oe(t,!0);let n=$(null),i=$(null);const s=nf.subscribe(T=>{E(n,T,!0),T?E(i,ee.getNode(T)||null,!0):E(i,null)}),o=ee.nodesArray.subscribe(T=>{r(n)&&E(i,T.find(R=>R.id===r(n))||null,!0)});jt(()=>{s(),o()});const a=D(()=>r(i)?Qt.get(r(i).type):null),l=D(()=>r(a)?.blockClass?m3(r(a).blockClass):void 0),d=D(()=>r(i)?.color||Ji);function c(T){if(!r(i))return;const R=r(i).id;De.mutate(()=>ee.updateNodeColor(R,T))}let u=$(!1),p=$("");function f(){if(!r(i))return;const T=ee.getAllNodes(),R=ee.getAllConnections().map(Y=>Y.connection),B=Fn.getCode(),V=kv(r(i),B),F=If(r(i),T,R);E(p,V+F),E(u,!0)}function h(){if(!r(i))return;const T=r(i).type===yt.SUBSYSTEM?"subsystem":"block";xu(T,r(i).id)}const g=D(()=>r(i)?.type!==yt.INTERFACE),y=D(()=>r(i)?.type==="Scope"||r(i)?.type==="Spectrum"),b=B3(),m=D(()=>r(n)&&r(i)&&r(y)?b.hasData(r(n),r(i).type):!1);function x(){!r(i)||!r(n)||Pf(r(n),r(i).name,r(i).type)}function S(T,R){if(!r(i))return;const B=r(i).id;De.mutate(()=>ee.updateNodeParams(B,{[T]:R}))}function v(T){return r(i)?.pinnedParams?.includes(T)??!1}function A(T){if(!r(i))return;const R=r(i).id,B=r(i).pinnedParams??[],V=B.includes(T)?B.filter(F=>F!==T):[...B,T];De.mutate(()=>ee.updateNode(R,{pinnedParams:V}))}function w(T){if(!r(i))return;const R=r(i).id;De.mutate(()=>ee.updateNodeName(R,T))}function k(T){return T==null?"":typeof T=="object"?JSON.stringify(T):String(T)}function N(T){return T==null?"None":typeof T=="object"?JSON.stringify(T):String(T)}function L(T){T.target===T.currentTarget&&Ad()}function X(T){T.key==="Escape"&&Ad()}var O=J3();ht("keydown",Ot,X);var I=ae(O);{var H=T=>{var R=Z3();R.__click=L;var B=M(R),V=M(B),F=M(V),Y=M(F);xn(Y),Y.__input=ke=>w(ke.currentTarget.value),Ee(Y,ke=>Un?.(ke));var J=q(Y,2),ie=M(J,!0);C(J),C(F);var ve=q(F,2),re=M(ve);bf(re,{get currentColor(){return r(d)},get defaultColor(){return Ji},onSelect:c});var me=q(re,2);{var ge=ke=>{var Ne=q3();Ne.__click=x;var $e=M(Ne);He($e,{name:"table",size:16}),C(Ne),Ee(Ne,(Me,Ae)=>Ue?.(Me,Ae),()=>r(m)?"Export CSV":"Run simulation to export data"),G(()=>Ne.disabled=!r(m)),_(ke,Ne)};j(me,ke=>{r(y)&&ke(ge)})}var Q=q(me,2);{var oe=ke=>{var Ne=V3();Ne.__click=h;var $e=M(Ne);He($e,{name:"upload",size:16}),C(Ne),Ee(Ne,(Me,Ae)=>Ue?.(Me,Ae),()=>"Export"),_(ke,Ne)};j(Q,ke=>{r(g)&&ke(oe)})}var ue=q(Q,2);ue.__click=f;var le=M(ue);He(le,{name:"braces",size:16}),C(ue),Ee(ue,(ke,Ne)=>Ue?.(ke,Ne),()=>"View Python Code");var te=q(ue,2);te.__click=function(...ke){Ad?.apply(this,ke)};var be=M(te);He(be,{name:"x",size:16}),C(te),C(ve),C(V);var fe=q(V,2),Pe=M(fe);{var Re=ke=>{var Ne=U3(),$e=q(M(Ne),2);it($e,21,()=>r(a).params,_t,(Me,Ae)=>{const xt=D(()=>r(i).params[r(Ae).name]),It=D(()=>v(r(Ae).name));var U=G3(),we=M(U),W=M(we),se=M(W,!0);C(W);var he=q(W,2);{var Be=Je=>{var Ze=W3();Ee(Ze,(bt,vt)=>Ue?.(bt,vt),()=>r(Ae).description),_(Je,Ze)};j(he,Je=>{r(Ae).description&&Je(Be)})}C(we);var Ye=q(we,2),je=M(Ye);{var rt=Je=>{var Ze=j3();Ze.__change=vt=>S(r(Ae).name,vt.currentTarget.value),it(Ze,21,()=>r(Ae).options,_t,(vt,kt)=>{var gt=K3(),At=M(gt,!0);C(gt);var gn={};G(()=>{Fe(At,r(kt)),gn!==(gn=r(kt))&&(gt.value=(gt.__value=r(kt))??"")}),_(vt,gt)}),C(Ze);var bt;Kh(Ze),G(vt=>{z(Ze,"id",`param-${r(Ae).name??""}`),bt!==(bt=vt)&&(Ze.value=(Ze.__value=vt)??"",oc(Ze,vt))},[()=>k(r(xt))]),_(Je,Ze)},Lt=Je=>{var Ze=X3();xn(Ze),Ze.__input=bt=>S(r(Ae).name,bt.currentTarget.value),Ee(Ze,bt=>Un?.(bt)),G((bt,vt)=>{z(Ze,"id",`param-${r(Ae).name??""}`),An(Ze,bt),z(Ze,"placeholder",vt)},[()=>k(r(xt)),()=>N(r(Ae).default)]),_(Je,Ze)};j(je,Je=>{r(Ae).options&&r(Ae).options.length>0?Je(rt):Je(Lt,!1)})}var Le=q(je,2);let st;Le.__click=()=>A(r(Ae).name);var at=M(Le);{let Je=D(()=>r(It)?"pin-filled":"pin");He(at,{get name(){return r(Je)},size:14})}C(Le),Ee(Le,(Je,Ze)=>Ue?.(Je,Ze),()=>r(It)?"Unpin from node":"Pin to node"),C(Ye),C(U),G(()=>{z(we,"for",`param-${r(Ae).name??""}`),Fe(se,r(Ae).name),st=qe(Le,1,"pin-btn svelte-kkoyc2",null,st,{pinned:r(It)}),z(Le,"aria-label",r(It)?"Unpin from node":"Pin to node")}),_(Me,U)}),C($e),C(Ne),_(ke,Ne)},Se=ke=>{var Ne=Y3();_(ke,Ne)};j(Pe,ke=>{r(a).params.length>0?ke(Re):ke(Se,!1)})}var Ce=q(Pe,2);Cv(Ce,{get docstringHtml(){return r(l)}}),C(fe),Kt(2),C(B),C(R),G(()=>{wt(B,`--node-color: ${r(d)??""}`),An(Y,r(i).name),Fe(ie,r(a).name)}),St(3,B,()=>Ei,()=>({start:.95,duration:150,easing:di})),St(3,R,()=>mn,()=>({duration:150})),_(T,R)};j(I,T=>{r(n)&&r(i)&&r(a)&&T(H)})}var P=q(I,2);Nf(P,{get open(){return r(u)},get code(){return r(p)},title:"Block Python Code",onClose:()=>E(u,!1)}),_(e,O),ze()}Mt(["click","input","change"]);var $3=Z('<span class="block-pill svelte-n1vk93"> </span>'),eM=Z('<div class="section"><div class="section-title">Block References</div> <div class="block-pills svelte-n1vk93"></div></div>'),tM=Z('<span class="help-icon">?</span>'),nM=Z('<div class="param-item"><label><span> </span> <!></label> <input type="text"/></div>'),iM=Z('<div><div class="section-title">Parameters</div> <div class="params-grid"></div></div>'),sM=Z('<div class="no-params">No configurable parameters</div>'),oM=Z('<div class="dialog-backdrop" role="presentation"><div class="properties-dialog glass-panel" role="dialog" tabindex="-1" aria-labelledby="dialog-title"><div class="dialog-header"><div class="node-info"><input id="dialog-title" class="node-name-input" type="text"/> <span class="node-type"> </span></div> <div class="header-actions"><!> <button class="icon-btn" aria-label="View Python Code"><!></button> <button class="icon-btn" aria-label="Close"><!></button></div></div> <div class="dialog-body"><!> <!> <!></div> <div class="dialog-footer"><span class="hint">Events trigger actions during simulation</span></div></div></div>'),aM=Z("<!> <!>",1);function rM(e,t){Oe(t,!0);let n=$(null),i=$(null);const s=yf.subscribe(k=>{E(n,k,!0),k?E(i,pt.getEvent(k)||null,!0):E(i,null)}),o=pt.eventsArray.subscribe(k=>{r(n)&&E(i,k.find(N=>N.id===r(n))||null,!0)});jt(()=>{s(),o()});const a=D(()=>r(i)?ti.get(r(i).type):null),l=D(()=>r(i)?.color||Ji);function d(k){if(!r(i))return;const N=r(i).id;De.mutate(()=>pt.updateEventColor(N,k))}let c=$(!1),u=$("");function p(){if(!r(i))return;const k=Fn.getCode(),N=Sv(r(i),k),L=yv(r(i));E(u,N+L),E(c,!0)}const f=D(()=>()=>{const k=de(ee.nodesArray),N=[],L=new Set;for(const X of k){let O=ki(X.name);(!O||L.has(O))&&(O=`block_${N.length}`),L.add(O),N.push(O)}return N.sort()});function h(k,N){if(!r(i))return;const L=r(i).id;De.mutate(()=>pt.updateEventParams(L,{[k]:N}))}function g(k){if(!r(i))return;const N=r(i).id;De.mutate(()=>pt.updateEventName(N,k))}function y(k){return k==null?"":typeof k=="object"?JSON.stringify(k):String(k)}function b(k){return k==null?"None":typeof k=="object"?JSON.stringify(k):String(k)}function m(k){k.target===k.currentTarget&&zd()}function x(k){k.key==="Escape"&&zd()}var S=aM();ht("keydown",Ot,x);var v=ae(S);{var A=k=>{var N=oM();N.__click=m;var L=M(N),X=M(L),O=M(X),I=M(O);xn(I),I.__input=oe=>g(oe.currentTarget.value),Ee(I,oe=>Un?.(oe));var H=q(I,2),P=M(H,!0);C(H),C(O);var T=q(O,2),R=M(T);bf(R,{get currentColor(){return r(l)},get defaultColor(){return Ji},onSelect:d});var B=q(R,2);B.__click=p;var V=M(B);He(V,{name:"braces",size:16}),C(B),Ee(B,(oe,ue)=>Ue?.(oe,ue),()=>"View Python Code");var F=q(B,2);F.__click=function(...oe){zd?.apply(this,oe)};var Y=M(F);He(Y,{name:"x",size:16}),C(F),C(T),C(X);var J=q(X,2),ie=M(J);{var ve=oe=>{var ue=eM(),le=q(M(ue),2);it(le,21,()=>r(f)(),_t,(te,be)=>{var fe=$3(),Pe=M(fe,!0);C(fe),G(()=>Fe(Pe,r(be))),_(te,fe)}),C(le),C(ue),_(oe,ue)};j(ie,oe=>{r(f)().length>0&&oe(ve)})}var re=q(ie,2);{var me=oe=>{var ue=iM();let le;var te=q(M(ue),2);it(te,21,()=>r(a).params,_t,(be,fe)=>{const Pe=D(()=>r(i).params[r(fe).name]),Re=D(()=>r(fe).type==="callable"?r(fe).description?r(fe).description+". Define functions in Code Editor (E)":"Define functions in Code Editor (E)":r(fe).description);var Se=nM(),Ce=M(Se),ke=M(Ce),Ne=M(ke,!0);C(ke);var $e=q(ke,2);{var Me=xt=>{var It=tM();Ee(It,(U,we)=>Ue?.(U,we),()=>r(Re)),_(xt,It)};j($e,xt=>{r(Re)&&xt(Me)})}C(Ce);var Ae=q(Ce,2);xn(Ae),Ae.__input=xt=>h(r(fe).name,xt.currentTarget.value),Ee(Ae,xt=>Un?.(xt)),C(Se),G((xt,It)=>{z(Ce,"for",`param-${r(fe).name??""}`),Fe(Ne,r(fe).name),z(Ae,"id",`param-${r(fe).name??""}`),An(Ae,xt),z(Ae,"placeholder",It)},[()=>y(r(Pe)),()=>b(r(fe).default)]),_(be,Se)}),C(te),C(ue),G(be=>le=qe(ue,1,"section svelte-n1vk93",null,le,be),[()=>({"with-separator":r(f)().length>0})]),_(oe,ue)},ge=oe=>{var ue=sM();_(oe,ue)};j(re,oe=>{r(a).params.length>0?oe(me):oe(ge,!1)})}var Q=q(re,2);Cv(Q,{get docstringHtml(){return r(a).docstringHtml}}),C(J),Kt(2),C(L),C(N),G(()=>{wt(L,`--node-color: ${r(l)??""}`),An(I,r(i).name),Fe(P,r(a).name)}),St(3,L,()=>Ei,()=>({start:.95,duration:150,easing:di})),St(3,N,()=>mn,()=>({duration:150})),_(k,N)};j(v,k=>{r(n)&&r(i)&&r(a)&&k(A)})}var w=q(v,2);Nf(w,{get open(){return r(c)},get code(){return r(u)},title:"Event Python Code",onClose:()=>E(c,!1)}),_(e,S),ze()}Mt(["click","input"]);const{subscribe:lM,set:mh}=nt(null),Ic={subscribe:lM,open(e,t){mh({code:e,title:t})},close(){mh(null)}},Bd={responsive:!0,displaylogo:!1,displayModeBar:"hover",modeBarButtonsToRemove:["lasso2d","select2d","toImage"],modeBarButtonsToAdd:[],scrollZoom:!0,doubleClick:"reset"};function Iv(e,t=!1){const{style:n,ghost:i,signalIndex:s,label:o}=e,a=t?e.xDecimated:e.x,l=t?e.yDecimated:e.y,d=n.lineStyle!==null,c=n.markerStyle!==null;let u="lines";d&&c?u="lines+markers":c&&(u="markers");const p={x:a,y:l,type:"scatter",mode:u,name:o,legendgroup:`signal-${s}`};return i?(p.opacity=i.opacity,p.showlegend=!1,p.hoverinfo="skip"):p.hovertemplate=`<b style="color:${n.color}">${o}</b><br>x = %{x:.4g}<br>y = %{y:.4g}<extra></extra>`,d&&n.lineStyle&&(p.line={color:n.color,width:i?1:1.5,dash:gT[n.lineStyle]}),c&&n.markerStyle&&(p.marker={symbol:mT[n.markerStyle],size:i?5:6,color:n.color},p.cliponaxis=!1),p}function cM(e,t){const n=Iv(e,!1);return!e.ghost&&t&&(n.customdata=t,n.hovertemplate=`<b style="color:${e.style.color}">${e.label}</b><br>f = %{customdata:.2f} Hz<br>mag = %{y:.4g}<extra></extra>`),n}function Nv(){const e=Da("--text-muted"),t=Da("--text-disabled"),n=Da("--surface-raised"),i=Da("--border"),s=Da("--accent");return{paper_bgcolor:"transparent",plot_bgcolor:"transparent",font:{color:e,family:"Inter, system-ui, sans-serif",size:11},margin:{l:60,r:15,t:10,b:45},xaxis:{gridcolor:i,gridwidth:.5,zeroline:!1,linecolor:i,linewidth:1.5,tickfont:{size:10,color:t},title:{standoff:10}},yaxis:{gridcolor:i,gridwidth:.5,zeroline:!1,linecolor:i,linewidth:1.5,tickfont:{size:10,color:t},title:{standoff:5}},legend:{bgcolor:n,bordercolor:i,borderwidth:1,font:{size:10,color:e},x:.01,xanchor:"left",y:.99,yanchor:"top"},modebar:{bgcolor:"transparent",color:t,activecolor:s},hoverlabel:{bgcolor:n,bordercolor:i,font:{color:e,size:11}}}}function qd(e){const{type:t,title:n,layout:i,frequencies:s}=e,o=Nv(),a=t==="scope"?"Time (s)":"Frequency (Hz)",l=t==="scope"?n.toLowerCase().startsWith("scope")?n:`Scope: ${n}`:n.toLowerCase().startsWith("spectrum")?n:`Spectrum: ${n}`,d={...o,xaxis:{...o.xaxis,title:{text:a,font:{size:11},standoff:10},type:i.xAxisScale},yaxis:{...o.yaxis,title:{text:l,font:{size:11},standoff:5},type:i.yAxisScale},showlegend:i.showLegend,hovermode:"closest"};if(t==="spectrum"&&s&&s.length>0){const c=Math.min(6,s.length),u=Math.max(1,Math.floor((s.length-1)/(c-1))),p=[],f=[];for(let h=0;h<s.length;h+=u)p.push(h),f.push(Gp(s[h]));p[p.length-1]!==s.length-1&&(p.push(s.length-1),f.push(Gp(s[s.length-1]))),d.xaxis={...d.xaxis,tickvals:p,ticktext:f,tickangle:0}}return d}function dM(e){const t=Da("--text-disabled");return{...e,annotations:[{text:"No data",xref:"paper",yref:"paper",x:.5,y:.5,showarrow:!1,font:{size:14,color:t}}]}}var uM=Z('<div class="plot-container svelte-oa38j7"><div class="plot svelte-oa38j7"></div></div>');function vh(e,t){Oe(t,!0);let n,i=null,s=null,o=$(null),a=$(!1),l=!1,d=0,c=0,u=!1;const p=es.subscribe(()=>{if(i&&n){const w=Nv();i.relayout(n,{"font.color":w.font?.color,"xaxis.gridcolor":w.xaxis?.gridcolor,"xaxis.linecolor":w.xaxis?.linecolor,"xaxis.tickfont.color":w.xaxis?.tickfont?.color,"yaxis.gridcolor":w.yaxis?.gridcolor,"yaxis.linecolor":w.yaxis?.linecolor,"yaxis.tickfont.color":w.yaxis?.tickfont?.color,"legend.bgcolor":w.legend?.bgcolor,"legend.bordercolor":w.legend?.bordercolor,"legend.font.color":w.legend?.font?.color,"modebar.color":w.modebar?.color,"modebar.activecolor":w.modebar?.activecolor,"hoverlabel.bgcolor":w.hoverlabel?.bgcolor,"hoverlabel.bordercolor":w.hoverlabel?.bordercolor,"hoverlabel.font.color":w.hoverlabel?.font?.color})}}),f=Gc.subscribe(w=>{E(o,w.plots.get(t.nodeId)??null,!0);const k=w.isStreaming;(k&&!u||!k&&u)&&(l=!1,d=0,c=0),u=k,E(a,k,!0),i&&n&&h()});tr(async()=>{i=await oi(()=>import("../chunks/Dg9q6Q-0.js").then(w=>w.p),[],import.meta.url),r(o)&&h(),s=new ResizeObserver(()=>{i&&n&&i.Plots.resize(n)}),s.observe(n)}),jt(()=>{f(),p(),s?.disconnect(),i&&n&&i.purge(n)});function h(){if(!(!i||!n)){if(r(o)?.type==="spectrum"){g();return}y()}}function g(){if(!i||!n||!r(o)){x();return}const w=r(o).traces.map(k=>cM(k,r(o).frequencies));if(w.length===0)x();else{const k=qd(r(o));i.react(n,w,k,Bd)}}function y(){if(!i||!n)return;if(!r(o)||r(o).traces.length===0){x(),l=!1,d=0;return}const k=r(o).traces.find(N=>!N.ghost)?.x.length??0;if(r(a)&&l&&k>d){m(k);return}b()}function b(){if(!i||!n||!r(o))return;c=r(o).traces.filter(L=>L.ghost).length;const w=r(o).traces.map(L=>Iv(L)),k=qd(r(o));i.react(n,w,k,Bd);const N=r(o).traces.find(L=>!L.ghost);r(a)&&N&&N.x.length>0&&(l=!0,d=N.x.length)}function m(w){if(!i||!n||!r(o))return;const k=d,N=r(o).traces.filter(I=>!I.ghost),L=[],X=[],O=[];N.forEach((I,H)=>{L.push(I.x.slice(k)),X.push(I.y.slice(k)),O.push(c+H)}),L.length>0&&L[0].length>0&&i.extendTraces(n,{x:L,y:X},O),d=w}function x(){if(!i||!n)return;const w=r(o)?qd(r(o)):{paper_bgcolor:"transparent",plot_bgcolor:"transparent",margin:{l:60,r:15,t:10,b:45}},k=dM(w);i.newPlot(n,[],k,Bd)}function S(w){w.preventDefault(),yi.openForPlot(t.nodeId,n,{x:w.clientX,y:w.clientY})}var v=uM(),A=M(v);A.__contextmenu=S,Jt(A,w=>n=w,()=>n),C(v),_(e,v),ze()}Mt(["contextmenu"]);var fM=Z('<div class="plot-tile svelte-qkhkod"><!></div>'),pM=Z("<div></div>"),hM=Z('<div class="plot-area svelte-qkhkod"></div>'),gM=Z('<div class="placeholder svelte-qkhkod"><p>Run simulation to see plots</p> <p class="hint svelte-qkhkod">Add Scope or Spectrum nodes to record signals</p></div>'),mM=Z('<div class="plot-content svelte-qkhkod"><!></div>'),vM=Z("<div><!></div>");function yM(e,t){Oe(t,!0);let n=_e(t,"collapsed",3,!1),i=_e(t,"activeTab",15,0),s=_e(t,"viewMode",3,"tabs"),o=$(void 0),a=$(0),l=$(0),d=null;const c=320,u=220;function p(k,N){if(k<=1)return{cols:1,rows:1,needsScroll:!1};if(N===0)return{cols:1,rows:k,needsScroll:!1};const L=Math.min(Math.max(1,Math.floor(N/c)),k),X=Math.ceil(k/L),O=X*u>r(l);return{cols:L,rows:X,needsScroll:O}}ut(()=>(r(o)&&(d?.disconnect(),d=new ResizeObserver(k=>{for(const N of k)E(a,N.contentRect.width,!0),E(l,N.contentRect.height,!0)}),d.observe(r(o))),()=>{d?.disconnect()}));let f=$(Et([]));const h=Gc.subscribe(k=>{E(f,Array.from(k.plots.values()),!0)});jt(()=>{h()});const g=D(()=>()=>r(f));ut(()=>{const k=r(g)();i()>=k.length&&k.length>0&&i(0)});const y=D(()=>r(g)().length>0),b=D(()=>p(r(g)().length,r(a)));function m(){return r(g)()}var x={getPlots:m},S=vM();let v;var A=M(S);{var w=k=>{var N=mM(),L=M(N);{var X=I=>{var H=pe(),P=ae(H);{var T=B=>{var V=pM();let F;it(V,21,()=>r(g)(),Y=>Y.nodeId,(Y,J)=>{var ie=fM(),ve=M(ie);vh(ve,{get nodeId(){return r(J).nodeId}}),C(ie),_(Y,ie)}),C(V),G(()=>{F=qe(V,1,"plot-grid svelte-qkhkod",null,F,{scrollable:r(b).needsScroll}),wt(V,`grid-template-columns: repeat(${r(b).cols??""}, 1fr); --min-tile-height: 220px;`)}),_(B,V)},R=B=>{var V=hM();it(V,23,()=>r(g)(),F=>F.nodeId,(F,Y,J)=>{var ie=pe(),ve=ae(ie);{var re=me=>{vh(me,{get nodeId(){return r(Y).nodeId}})};j(ve,me=>{i()===r(J)&&me(re)})}_(F,ie)}),C(V),_(B,V)};j(P,B=>{s()==="tiles"?B(T):B(R,!1)})}_(I,H)},O=I=>{var H=gM();_(I,H)};j(L,I=>{r(y)?I(X):I(O,!1)})}C(N),Jt(N,I=>E(o,I),()=>r(o)),_(k,N)};j(A,k=>{n()||k(w)})}return C(S),G(()=>v=qe(S,1,"plot-panel svelte-qkhkod",null,v,{collapsed:n()})),_(e,S),ze(x)}var bM=Z('<div class="placeholder svelte-gwrzq5"><p>Run simulation to see output</p> <p class="shortcut svelte-gwrzq5">Ctrl+Enter</p></div>'),wM=Z('<div><span class="log-message svelte-gwrzq5"> </span></div>'),_M=Z('<button class="scroll-to-bottom svelte-gwrzq5" aria-label="Scroll to bottom"><!></button>'),xM=Z('<div class="console-panel svelte-gwrzq5"><div class="console-content svelte-gwrzq5"><!></div> <!></div>');function kM(e,t){Oe(t,!0);let n=$(Et([])),i=$(void 0),s=$(!0),o=-1,a=null;const l=Bt.subscribe(m=>{E(n,m,!0)});ut(()=>{const m=r(n).length>0?r(n)[r(n).length-1].id:-1;m>o&&r(s)&&r(i)&&(a!==null&&clearTimeout(a),a=setTimeout(()=>{a=null,r(i)&&(r(i).scrollTop=r(i).scrollHeight)},0)),o=m}),jt(()=>{l(),a!==null&&clearTimeout(a)});function d(){if(!r(i))return;const{scrollTop:m,scrollHeight:x,clientHeight:S}=r(i);E(s,m+S>=x-20)}function c(){r(i)&&(r(i).scrollTop=r(i).scrollHeight,E(s,!0))}var u=xM(),p=M(u),f=M(p);{var h=m=>{var x=bM();_(m,x)},g=m=>{var x=pe(),S=ae(x);it(S,17,()=>r(n),v=>v.id,(v,A)=>{var w=wM(),k=M(w),N=M(k,!0);C(k),C(w),G(()=>{qe(w,1,`log-entry ${r(A).level??""}`,"svelte-gwrzq5"),Fe(N,r(A).message)}),_(v,w)}),_(m,x)};j(f,m=>{r(n).length===0?m(h):m(g,!1)})}C(p),Jt(p,m=>E(i,m),()=>r(i));var y=q(p,2);{var b=m=>{var x=_M();x.__click=c;var S=M(x);He(S,{name:"chevron-down",size:16}),C(x),_(m,x)};j(y,m=>{!r(s)&&r(n).length>0&&m(b)})}C(u),ht("scroll",p,d),_(e,u),ze()}Mt(["click"]);var SM=Z('<div class="loading svelte-1q7n0z0">Loading editor...</div>'),CM=Z('<div class="error-bar svelte-1q7n0z0"> </div>'),EM=Z('<div class="code-editor svelte-1q7n0z0"><div class="editor-container svelte-1q7n0z0"><!></div> <!> <div class="footer svelte-1q7n0z0">Define Python variables and functions to use in node parameters.</div></div>');function TM(e,t){Oe(t,!0);let n,i=null,s=null,o=$(!0),a=$("dark"),l=$(""),d=$(null),c=[];function u(){return s?nl(s,r(a)==="dark",{keymaps:[{key:"Mod-Enter",run:()=>(window.dispatchEvent(new CustomEvent("run-simulation")),!0)},{key:"Shift-Enter",run:()=>(window.dispatchEvent(new CustomEvent("continue-simulation")),!0)},{key:"Escape",run:v=>(v.contentDOM.blur(),!0)}],onDocChange:v=>{Fn.setCode(v)}}):[]}function p(){if(!i||!n||!s)return;const v=i.state.doc.toString();i.destroy(),i=new s.EditorView({doc:v,extensions:u(),parent:n})}function f(){i?.focus()}tr(async()=>{c.push(Fn.code.subscribe(v=>{E(l,v,!0),i&&i.state.doc.toString()!==v&&i.dispatch({changes:{from:0,to:i.state.doc.length,insert:v}})})),c.push(Fn.lastError.subscribe(v=>{E(d,v,!0)})),c.push(es.subscribe(v=>{E(a,v,!0),i&&s&&p()})),s=await td(),i=new s.EditorView({doc:r(l),extensions:u(),parent:n}),E(o,!1)}),jt(()=>{c.forEach(v=>v()),i&&i.destroy()});var h={focus:f},g=EM(),y=M(g),b=M(y);{var m=v=>{var A=SM();_(v,A)};j(b,v=>{r(o)&&v(m)})}C(y),Jt(y,v=>n=v,()=>n);var x=q(y,2);{var S=v=>{var A=CM(),w=M(A,!0);C(A),G(()=>Fe(w,r(d))),_(v,A)};j(x,v=>{r(d)&&v(S)})}return Kt(2),C(g),_(e,g),ze(h)}var IM=Z('<div><span class="node-name svelte-1yeydg2"> </span></div>');function yh(e,t){Oe(t,!0);const n=D(()=>t.node.category==="Subsystem"),i=D(()=>()=>om(t.node));var s=IM();let o;var a=M(s),l=M(a,!0);C(a),C(s),G(d=>{o=qe(s,1,`node-preview ${d??""}`,"svelte-1yeydg2",o,{"subsystem-type":r(n)}),Fe(l,t.node.name)},[()=>r(i)()]),_(e,s),ze()}var NM=Z('<button class="clear-btn svelte-xht9mx"><!></button>'),PM=Z('<button draggable="true"><!></button>'),MM=Z('<div class="tile-grid svelte-xht9mx"></div>'),AM=Z('<div class="category svelte-xht9mx"><button class="category-header svelte-xht9mx"><span><!></span> <span class="category-name svelte-xht9mx"> </span></button> <!></div>'),DM=Z('<div class="empty svelte-xht9mx"><span>No nodes found</span> <span class="hint svelte-xht9mx">Try "gain", "source", or "plot"</span></div>'),RM=Z('<div class="drag-preview-wrapper svelte-xht9mx"><!></div>'),OM=Z('<div class="node-library svelte-xht9mx"><div class="search-container svelte-xht9mx"><span class="search-icon svelte-xht9mx"><!></span> <input type="text" placeholder="Search nodes..." class="search-input svelte-xht9mx"/> <!></div> <div class="node-grid-container svelte-xht9mx"></div> <div class="footer svelte-xht9mx"><span>Click or drag to add</span> <span>ââ Enter</span></div> <div class="drag-preview-container svelte-xht9mx" aria-hidden="true"><!></div></div>');function zM(e,t){Oe(t,!0);let n=_e(t,"focusSearch",3,!1),i=$(""),s,o=$(-1),a=$(!1),l=$(null),d,c=$(Et(new Set));function u(F){E(c,new Set(r(c)),!0),r(c).has(F)?r(c).delete(F):r(c).add(F)}const p=[...Object.keys(im),"Subsystem"],f=Qt.getAll(),h=D(()=>()=>{let F=f.filter(J=>J.type!==yt.INTERFACE);if(!r(i).trim())return F;const Y=r(i).toLowerCase();return F.filter(J=>J.name.toLowerCase().includes(Y)||J.category.toLowerCase().includes(Y)||J.description.toLowerCase().includes(Y))}),g=D(()=>()=>{const F=new Map;for(const J of r(h)())F.has(J.category)||F.set(J.category,[]),F.get(J.category).push(J);const Y=new Map;for(const J of p)F.has(J)&&Y.set(J,F.get(J));return Y}),y=D(()=>()=>{const F=[];for(const[,Y]of r(g)())F.push(...Y);return F});function b(F){E(l,F,!0)}function m(F,Y){if(E(a,!0),F.dataTransfer&&(F.dataTransfer.setData("application/pathview-node",Y.type),F.dataTransfer.effectAllowed="copy",d)){const J=d.getBoundingClientRect();F.dataTransfer.setDragImage(d,J.width/2,J.height/2)}}function x(){setTimeout(()=>{E(a,!1),E(l,null)},100)}function S(F){r(a)||t.onAddNode&&t.onAddNode(F.type)}function v(F){const Y=r(y)();if(F.key==="ArrowDown")F.preventDefault(),E(o,Math.min(r(o)+1,Y.length-1),!0);else if(F.key==="ArrowUp")F.preventDefault(),E(o,Math.max(r(o)-1,-1),!0);else if(F.key==="Enter"&&r(o)>=0){F.preventDefault();const J=Y[r(o)];J&&t.onAddNode&&t.onAddNode(J.type)}else F.key==="Escape"&&(r(i)?(E(i,""),E(o,-1),F.stopPropagation()):s?.blur())}ut(()=>{r(i),E(o,r(i)?0:-1,!0)}),ut(()=>{n()&&s&&s.focus()});function A(F){return r(y)()[r(o)]?.type===F.type}function w(){s?.focus()}var k={focus:w},N=OM();N.__keydown=v;var L=M(N),X=M(L),O=M(X);He(O,{name:"search",size:14}),C(X);var I=q(X,2);xn(I),Jt(I,F=>s=F,()=>s);var H=q(I,2);{var P=F=>{var Y=NM();Y.__click=()=>E(i,"");var J=M(Y);He(J,{name:"x",size:12}),C(Y),_(F,Y)};j(H,F=>{r(i)&&F(P)})}C(L);var T=q(L,2);it(T,21,()=>Array.from(r(g)().entries()),_t,(F,Y)=>{var J=D(()=>Zs(r(Y),2));let ie=()=>r(J)[0],ve=()=>r(J)[1];var re=AM(),me=M(re);me.__click=()=>u(ie());var ge=M(me);let Q;var oe=M(ge);He(oe,{name:"chevron-right",size:12}),C(ge);var ue=q(ge,2),le=M(ue,!0);C(ue),C(me);var te=q(me,2);{var be=fe=>{var Pe=MM();it(Pe,21,ve,_t,(Re,Se)=>{var Ce=PM();let ke;Ce.__click=()=>S(r(Se));var Ne=M(Ce);yh(Ne,{get node(){return r(Se)}}),C(Ce),Ee(Ce,($e,Me)=>Ue?.($e,Me),()=>r(Se).description),G($e=>ke=qe(Ce,1,"node-tile svelte-xht9mx",null,ke,$e),[()=>({selected:A(r(Se))})]),ht("mouseenter",Ce,()=>b(r(Se))),ht("dragstart",Ce,$e=>m($e,r(Se))),ht("dragend",Ce,x),_(Re,Ce)}),C(Pe),_(fe,Pe)};j(te,fe=>{r(c).has(ie())||fe(be)})}C(re),G(fe=>{Q=qe(ge,1,"chevron svelte-xht9mx",null,Q,fe),Fe(le,ie())},[()=>({expanded:!r(c).has(ie())})]),_(F,re)},F=>{var Y=DM();_(F,Y)}),C(T);var R=q(T,4),B=M(R);{var V=F=>{var Y=RM(),J=M(Y);yh(J,{get node(){return r(l)}}),C(Y),Jt(Y,ie=>d=ie,()=>d),_(F,Y)};j(B,F=>{r(l)&&F(V)})}return C(R),C(N),Uh(I,()=>r(i),F=>E(i,F)),_(e,N),ze(k)}Mt(["keydown","click"]);var LM=Z('<div class="event-preview-wrapper svelte-1s8vqme"><div class="event-preview svelte-1s8vqme"><span class="event-name svelte-1s8vqme"> </span></div></div>');function HM(e,t){Oe(t,!0);var n=LM(),i=M(n),s=M(i),o=M(s,!0);C(s),C(i),C(n),G(()=>Fe(o,t.event.name)),_(e,n),ze()}var FM=Z('<button class="event-tile svelte-d3r2aj"><!></button>'),BM=Z('<div class="events-panel svelte-d3r2aj"><div class="event-grid-container svelte-d3r2aj"><div class="tile-grid svelte-d3r2aj"></div></div> <div class="footer svelte-d3r2aj">Click or drag to add</div></div>');function qM(e,t){Oe(t,!0);const n=ti.getAll();let i=$(!0);ee.currentPath.subscribe(f=>{E(i,f.length===0)});let s=$(!1);function o(f,h){const g=ti.get(f);g&&De.mutate(()=>{if(r(i))pt.addEvent(f,h);else{const y={id:crypto.randomUUID(),type:f,name:g.name,position:h,params:{}};ee.addSubsystemEvent(y)}})}function a(f,h){E(s,!0),f.dataTransfer&&(f.dataTransfer.setData("application/pathview-event",h.type),f.dataTransfer.effectAllowed="copy")}function l(){setTimeout(()=>{E(s,!1)},100)}function d(f){if(!r(s))if(t.onAddEvent)t.onAddEvent(f.type);else{const h=xi({x:window.innerWidth/2,y:window.innerHeight/2});o(f.type,h)}}var c=BM(),u=M(c),p=M(u);it(p,21,()=>n,_t,(f,h)=>{var g=FM();z(g,"draggable",!0),g.__click=()=>d(r(h));var y=M(g);HM(y,{get event(){return r(h)}}),C(g),Ee(g,(b,m)=>Ue?.(b,m),()=>r(h).description),ht("dragstart",g,b=>a(b,r(h))),ht("dragend",g,l),_(f,g)}),C(p),C(u),Kt(2),C(c),_(e,c),ze()}Mt(["click"]);var VM=Z('<div class="divider svelte-192vamk"></div>'),WM=Z('<span class="icon svelte-192vamk"><!></span>'),KM=Z('<kbd class="shortcut svelte-192vamk"> </kbd>'),jM=Z('<button role="menuitem"><!> <span class="label svelte-192vamk"> </span> <!></button>'),XM=Z('<div class="backdrop svelte-192vamk" role="presentation"><div class="context-menu glass-panel svelte-192vamk" role="menu" tabindex="-1"></div></div>');function GM(e,t){Oe(t,!0);let n,i=$(null);ut(()=>{n&&E(i,n.getBoundingClientRect(),!0)});const s=D(()=>()=>{if(!r(i))return t.x;const u=window.innerWidth;return t.x+r(i).width>u-10?t.x-r(i).width:t.x}),o=D(()=>()=>{if(!r(i))return t.y;const u=window.innerHeight;return t.y+r(i).height>u-10?t.y-r(i).height:t.y});function a(u){u.disabled||(u.action(),t.onClose())}function l(u){u.key==="Escape"&&t.onClose()}var d=XM();ht("keydown",Ot,l),d.__click=function(...u){t.onClose?.apply(this,u)},d.__contextmenu=u=>{u.preventDefault(),t.onClose()},d.__keydown=u=>u.key==="Escape"&&t.onClose();var c=M(d);c.__click=u=>u.stopPropagation(),it(c,21,()=>t.items,_t,(u,p)=>{var f=pe(),h=ae(f);{var g=b=>{var m=VM();_(b,m)},y=b=>{var m=jM();let x;m.__click=()=>a(r(p));var S=M(m);{var v=L=>{var X=WM(),O=M(X);He(O,{get name(){return r(p).icon}}),C(X),_(L,X)};j(S,L=>{r(p).icon&&L(v)})}var A=q(S,2),w=M(A,!0);C(A);var k=q(A,2);{var N=L=>{var X=KM(),O=M(X,!0);C(X),G(()=>Fe(O,r(p).shortcut)),_(L,X)};j(k,L=>{r(p).shortcut&&L(N)})}C(m),G(()=>{x=qe(m,1,"menu-item svelte-192vamk",null,x,{disabled:r(p).disabled}),m.disabled=r(p).disabled,Fe(w,r(p).label)}),_(b,m)};j(h,b=>{r(p).divider?b(g):b(y,!1)})}_(u,f)}),C(c),Jt(c,u=>n=u,()=>n),C(d),G((u,p)=>wt(c,`left: ${u??""}px; top: ${p??""}px;`),[()=>r(s)(),()=>r(o)()]),St(3,c,()=>Ei,()=>({start:.95,duration:100,easing:di})),_(e,d),ze()}Mt(["click","contextmenu","keydown"]);function UM(){const e=de(ee.selectedNodeIds),t=de(pt.selectedEventIds);return e.size===0&&t.size===0?!1:De.mutate(()=>{for(const n of e)ee.getAnnotation(n)?ee.removeAnnotation(n):ee.removeNode(n);if(ee.isAtRoot())for(const n of t)pt.removeEvent(n);else for(const n of t)ee.removeSubsystemEvent(n);return!0})}const Pv="pathview-clipboard",ku="1.0",rr=nt(null);function Ll(e){return{x:Math.round(e.x/Ct)*Ct,y:Math.round(e.y/Ct)*Ct}}function YM(e){if(e.length===0)return{x:0,y:0};let t=1/0,n=1/0,i=-1/0,s=-1/0;for(const o of e)t=Math.min(t,o.position.x),n=Math.min(n,o.position.y),i=Math.max(i,o.position.x),s=Math.max(s,o.position.y);return{x:(t+i)/2,y:(n+s)/2}}function ZM(e){if(typeof e!="object"||e===null)return!1;const t=e;if(t.type!==Pv||typeof t.version!="string")return!1;const n=t.content;return!n||typeof n!="object"?!1:Array.isArray(n.nodes)&&Array.isArray(n.connections)&&Array.isArray(n.events)&&typeof n.center=="object"&&n.center!==null}async function JM(e){try{const t={type:Pv,version:ku,content:e};return await navigator.clipboard.writeText(JSON.stringify(t)),!0}catch(t){return console.debug("System clipboard write failed:",t),!1}}async function QM(){try{const e=await navigator.clipboard.readText();if(!e)return null;const t=JSON.parse(e);return ZM(t)?(t.version!==ku&&console.warn(`Clipboard version mismatch: ${t.version} vs ${ku}`),t.content):null}catch{return null}}async function Mv(){const e=de(ee.selectedNodeIds),t=de(pt.selectedEventIds),n=[];for(const f of e){const h=ee.getAnnotation(f);h&&n.push(JSON.parse(JSON.stringify(h)))}const i=new Set;for(const f of e)ee.getAnnotation(f)||i.add(f);if(i.size===0&&t.size===0&&n.length===0)return!1;const s=de(ee.nodes),o=de(ee.connections),a=[];for(const f of i){const h=s.get(f);h&&h.type!==yt.INTERFACE&&a.push(JSON.parse(JSON.stringify(h)))}const l=[];for(const f of o)i.has(f.sourceNodeId)&&i.has(f.targetNodeId)&&l.push(JSON.parse(JSON.stringify(f)));const d=[];if(ee.isAtRoot())for(const f of t){const h=pt.getEvent(f);h&&d.push(JSON.parse(JSON.stringify(h)))}else for(const f of t){const h=ee.getSubsystemEvent(f);h&&d.push(JSON.parse(JSON.stringify(h)))}const c=[...a.map(f=>({position:f.position})),...d.map(f=>({position:f.position})),...n.map(f=>({position:f.position}))],u=YM(c),p={nodes:a,connections:l,events:d,annotations:n,center:u};return rr.set(p),await JM(p),!0}async function $M(e){let t=await QM();if(t||(t=de(rr)),t?.annotations||(t=t?{...t,annotations:[]}:null),!t||t.nodes.length===0&&t.events.length===0&&t.annotations.length===0)return{nodeIds:[],eventIds:[],annotationIds:[]};const n=Cc(t.nodes);if(n.length>0){console.warn(`Clipboard paste: skipping unknown block types: ${n.join(", ")}`);const i=t.nodes.filter(a=>a.type===yt.SUBSYSTEM||a.type===yt.INTERFACE||Qt.has(a.type)),s=new Set(i.map(a=>a.id)),o=t.connections.filter(a=>s.has(a.sourceNodeId)&&s.has(a.targetNodeId));if(t={...t,nodes:i,connections:o},t.nodes.length===0&&t.events.length===0&&t.annotations.length===0)return{nodeIds:[],eventIds:[],annotationIds:[]}}return De.mutate(()=>{const i=Ll(e),s={x:i.x-t.center.x,y:i.y-t.center.y},o=new Map,a=[];for(const p of t.nodes){const f=rn();o.set(p.id,f);const h=Ll({x:p.position.x+s.x,y:p.position.y+s.y}),g=ym(p,h,f);a.push(g)}const l=[];for(const p of t.connections){const f=o.get(p.sourceNodeId),h=o.get(p.targetNodeId);f&&h&&l.push({id:rn(),sourceNodeId:f,sourcePortIndex:p.sourcePortIndex,targetNodeId:h,targetPortIndex:p.targetPortIndex})}ee.clearSelection(),pt.clearSelection();const d=ee.pasteNodes(a,l),c=[];for(const p of t.events){const f=Ll({x:p.position.x+s.x,y:p.position.y+s.y});if(ee.isAtRoot()){const h=pt.addEvent(p.type,f,p.name);h&&(Object.keys(p.params).length>0&&pt.updateEventParams(h.id,p.params),p.color&&pt.updateEventColor(h.id,p.color),c.push(h.id),pt.selectEvent(h.id,!0))}else{const h=rn(),g={...p,id:h,position:f};ee.addSubsystemEvent(g),c.push(h)}}const u=[];for(const p of t.annotations){const f=Ll({x:p.position.x+s.x,y:p.position.y+s.y}),h=ee.addAnnotation(f);ee.updateAnnotation(h,{content:p.content,width:p.width,height:p.height,color:p.color,fontSize:p.fontSize}),u.push(h)}return{nodeIds:d,eventIds:c,annotationIds:u}})}async function eA(){return await Mv()?(UM(),!0):!1}function tA(){const e=de(rr);return e!==null&&(e.nodes.length>0||e.events.length>0||e.annotations.length>0)}function nA(){rr.set(null)}function iA(){const e=de(rr);return e?{nodes:e.nodes.length,connections:e.connections.length,events:e.events.length,annotations:e.annotations.length}:null}const Si={subscribe:rr.subscribe,copy:Mv,cut:eA,paste:$M,hasContent:tA,clear:nA,getSummary:iA};var Us="http://www.w3.org/2000/svg",Ys="http://www.w3.org/1999/xlink",sA="http://www.w3.org/2000/xmlns/";function Su(e){return e.nodeType===Node.ELEMENT_NODE}function Av(e){return e.nodeType===Node.TEXT_NODE}function oA(e){return e.namespaceURI===Us}function aA(e){return e instanceof HTMLImageElement}function rA(e){return e instanceof HTMLCanvasElement}function lA(e){return e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement}function Ie(e,t){return e.createElementNS(Us,t)}function Xe(e,t){for(const[n,i]of Object.entries(t))e.setAttribute(n,String(i)),n==="href"&&e.setAttributeNS(Ys,"xlink:href",String(i))}function cA(e,t){return window.getComputedStyle(e,t)}var dA=0;function uA(){return{next(e="d2s"){return`${e}-${dA++}`}}}function fA(e){return e.display==="none"}function pA(e){return e.visibility==="hidden"}function Hl(e,t,n){return{width:parseFloat(e)||0,style:t,color:n}}function hA(e){return{top:Hl(e.borderTopWidth,e.borderTopStyle,e.borderTopColor),right:Hl(e.borderRightWidth,e.borderRightStyle,e.borderRightColor),bottom:Hl(e.borderBottomWidth,e.borderBottomStyle,e.borderBottomColor),left:Hl(e.borderLeftWidth,e.borderLeftStyle,e.borderLeftColor)}}function Dv(e){return{topLeft:Fl(e.borderTopLeftRadius),topRight:Fl(e.borderTopRightRadius),bottomRight:Fl(e.borderBottomRightRadius),bottomLeft:Fl(e.borderBottomLeftRadius)}}function Fl(e){const t=e.split(/\s+/).map(n=>parseFloat(n)||0);return[t[0]??0,t[1]??t[0]??0]}function gA(e){return e.top.width>0&&e.top.style!=="none"||e.right.width>0&&e.right.style!=="none"||e.bottom.width>0&&e.bottom.style!=="none"||e.left.width>0&&e.left.style!=="none"}function Is(e){return e.topLeft[0]>0||e.topLeft[1]>0||e.topRight[0]>0||e.topRight[1]>0||e.bottomRight[0]>0||e.bottomRight[1]>0||e.bottomLeft[0]>0||e.bottomLeft[1]>0}function Gr(e){const[t,n]=e.topLeft;return e.topRight[0]===t&&e.topRight[1]===n&&e.bottomRight[0]===t&&e.bottomRight[1]===n&&e.bottomLeft[0]===t&&e.bottomLeft[1]===n}function Rv(e){const t=new Set(["hidden","clip","scroll","auto"]);return t.has(e.overflow)||t.has(e.overflowX)||t.has(e.overflowY)}function Nc(e){const t=e.backgroundColor;return!t||t==="transparent"||t==="rgba(0, 0, 0, 0)"?null:t}function Ov(e){return!!e.backgroundImage&&e.backgroundImage!=="none"}function mA(e){return!!(e.position!=="static"&&e.position!==""&&e.zIndex!=="auto"||parseFloat(e.opacity)<1||e.transform&&e.transform!=="none"||e.filter&&e.filter!=="none"||e.isolation==="isolate"||e.mixBlendMode&&e.mixBlendMode!=="normal")}function vA(e){return e.zIndex==="auto"||!e.zIndex?0:parseInt(e.zIndex,10)||0}function yA(e){return e.position!=="static"&&e.position!==""}function bA(e){return e.cssFloat!=="none"&&e.cssFloat!==""}function zv(e,t,n){const i=e.topLeft[0]+e.topRight[0],s=e.bottomLeft[0]+e.bottomRight[0],o=e.topLeft[1]+e.bottomLeft[1],a=e.topRight[1]+e.bottomRight[1];let l=1;return i>0&&(l=Math.min(l,t/i)),s>0&&(l=Math.min(l,t/s)),o>0&&(l=Math.min(l,n/o)),a>0&&(l=Math.min(l,n/a)),l>=1?e:{topLeft:[e.topLeft[0]*l,e.topLeft[1]*l],topRight:[e.topRight[0]*l,e.topRight[1]*l],bottomRight:[e.bottomRight[0]*l,e.bottomRight[1]*l],bottomLeft:[e.bottomLeft[0]*l,e.bottomLeft[1]*l]}}function wA(e){const t=e.display;return t==="inline"||t==="inline-block"||t==="inline-flex"||t==="inline-grid"||t==="inline-table"}function Lv(e,t){const n=e.getBoundingClientRect(),i=t.getBoundingClientRect();return{x:n.left-i.left,y:n.top-i.top,width:n.width,height:n.height}}function il(e,t,n,i,s){const[o,a]=s.topLeft,[l,d]=s.topRight,[c,u]=s.bottomRight,[p,f]=s.bottomLeft;return[`M ${e+o} ${t}`,`L ${e+n-l} ${t}`,l||d?`A ${l} ${d} 0 0 1 ${e+n} ${t+d}`:"",`L ${e+n} ${t+i-u}`,c||u?`A ${c} ${u} 0 0 1 ${e+n-c} ${t+i}`:"",`L ${e+p} ${t+i}`,p||f?`A ${p} ${f} 0 0 1 ${e} ${t+i-f}`:"",`L ${e} ${t+a}`,o||a?`A ${o} ${a} 0 0 1 ${e+o} ${t}`:"","Z"].filter(Boolean).join(" ")}function _A(e){const t=e.match(/linear-gradient\((.+)\)/);if(!t)return null;const n=t[1],i=Af(n);if(i.length<2)return null;let s=180,o=0;const a=i[0].trim();a.startsWith("to ")?(s=EA(a),o=1):a.match(/^-?[\d.]+(?:deg|rad|turn|grad)/)&&(s=Hv(a),o=1);const l=[],d=i.slice(o);for(let c=0;c<d.length;c++){const{color:u,position:p}=Mf(d[c].trim(),c,d.length);l.push({color:u,position:p})}return{angle:s,stops:l}}function xA(e,t,n){const i=n.idGenerator.next("grad"),s=Ie(n.svgDocument,"linearGradient"),o=t.x+t.width/2,a=t.y+t.height/2,l=e.angle*Math.PI/180,d=Math.sin(l),c=-Math.cos(l),u=Math.abs(t.width/2*d)+Math.abs(t.height/2*c),p=o-d*u,f=a-c*u,h=o+d*u,g=a+c*u;Xe(s,{id:i,gradientUnits:"userSpaceOnUse",x1:p.toFixed(2),y1:f.toFixed(2),x2:h.toFixed(2),y2:g.toFixed(2)});for(const y of e.stops){const b=Ie(n.svgDocument,"stop");Xe(b,{offset:`${(y.position*100).toFixed(1)}%`,"stop-color":y.color}),s.appendChild(b)}return n.defs.appendChild(s),s}function kA(e,t,n){return e.includes("conic-gradient")?SA(e,t,n):e.includes("radial-gradient")?CA(e,t,n):null}function SA(e,t,n){const i=e.match(/conic-gradient\((.+)\)/);if(!i)return null;const s=2,o=document.createElement("canvas");o.width=Math.ceil(t*s),o.height=Math.ceil(n*s);const a=o.getContext("2d");if(!a||!("createConicGradient"in a))return null;a.scale(s,s);const l=i[1],d=Af(l);let c=0,u=0;const f=d[0].trim().match(/^from\s+(-?[\d.]+)(deg|rad|turn|grad)/);f&&(c=Hv(f[1]+f[2]),u=1);const h=t/2,g=n/2,y=(c-90)*Math.PI/180,b=a.createConicGradient(y,h,g),m=d.slice(u);for(let x=0;x<m.length;x++){const S=m[x].trim(),{color:v,position:A}=Mf(S,x,m.length);try{b.addColorStop(A,v)}catch{}}return a.fillStyle=b,a.fillRect(0,0,t,n),o.toDataURL("image/png")}function CA(e,t,n){const i=e.match(/radial-gradient\((.+)\)/);if(!i)return null;const s=2,o=document.createElement("canvas");o.width=Math.ceil(t*s),o.height=Math.ceil(n*s);const a=o.getContext("2d");if(!a)return null;a.scale(s,s);const l=i[1],d=Af(l);let c=!1,u=0,p=null,f=null;const h=d[0].trim();if(h==="circle"||h.startsWith("circle ")?(c=!0,u=1):(h==="ellipse"||h.startsWith("ellipse ")||h.includes("at ")&&!h.includes("#")&&!h.match(/^(rgb|hsl)/))&&(u=1),u===1){const A=h.match(/at\s+(.+)/);if(A){const w=A[1].trim().split(/\s+/);p=bh(w[0],t),f=bh(w[1]??w[0],n)}}const g=p??t/2,y=f??n/2,b=t/2,m=n/2,x=c?Math.sqrt(b*b+m*m):Math.max(b,m);a.save(),!c&&b!==m&&(a.translate(g,y),a.scale(b/x,m/x),a.translate(-g,-y));const S=a.createRadialGradient(g,y,0,g,y,x),v=d.slice(u);for(let A=0;A<v.length;A++){const w=v[A].trim(),{color:k,position:N}=Mf(w,A,v.length);try{S.addColorStop(N,k)}catch{}}if(a.fillStyle=S,!c&&b!==m){const A=x/b,w=x/m;a.fillRect(g*(1-A),y*(1-w),t*A,n*w)}else a.fillRect(0,0,t,n);return a.restore(),o.toDataURL("image/png")}function Mf(e,t,n){const i=e.lastIndexOf(")"),o=(i>=0?e.slice(i+1):e).match(/\s+([\d.]+%)\s*$/);if(o){const a=o[1],l=e.length-o[0].length;return{color:e.slice(0,l).trim(),position:parseFloat(a)/100}}if(i<0){const a=e.lastIndexOf(" ");if(a>0&&e.slice(a).match(/[\d.]+%/))return{color:e.slice(0,a).trim(),position:parseFloat(e.slice(a))/100}}return{color:e,position:n>1?t/(n-1):0}}function Af(e){const t=[];let n=0,i="";for(const s of e)s==="("?n++:s===")"&&n--,s===","&&n===0?(t.push(i),i=""):i+=s;return i&&t.push(i),t}function EA(e){return{"to top":0,"to right":90,"to bottom":180,"to left":270,"to top right":45,"to top left":315,"to bottom right":135,"to bottom left":225}[e]??180}function Hv(e){return e.endsWith("deg")?parseFloat(e):e.endsWith("rad")?parseFloat(e)*180/Math.PI:e.endsWith("turn")?parseFloat(e)*360:e.endsWith("grad")?parseFloat(e)*.9:parseFloat(e)}function bh(e,t){if(e==="center")return t/2;if(e==="left"||e==="top")return 0;if(e==="right"||e==="bottom")return t;if(e.endsWith("%"))return parseFloat(e)/100*t;const n=parseFloat(e);return isNaN(n)?null:n}var wh=1e4,Vd=4096;async function Df(e){return e.startsWith("data:")?e:new Promise(t=>{const n=new Image;n.crossOrigin="anonymous";const i=setTimeout(()=>{console.warn(`dom2svg: Image load timed out after ${wh}ms, using original URL: ${e}`),n.onload=null,n.onerror=null,t(e)},wh);n.onload=()=>{clearTimeout(i);try{const s=document.createElement("canvas");let o=n.naturalWidth,a=n.naturalHeight;if(o>Vd||a>Vd){const d=Vd/Math.max(o,a);o=Math.round(o*d),a=Math.round(a*d)}s.width=o,s.height=a;const l=s.getContext("2d");l?(l.drawImage(n,0,0,o,a),t(s.toDataURL("image/png"))):t(e)}catch{console.warn(`dom2svg: CORS prevented inlining image, external URL will remain in SVG: ${e}`),t(e)}},n.onerror=()=>{clearTimeout(i),console.warn(`dom2svg: Failed to load image, external URL will remain in SVG: ${e}`),t(e)},n.src=e})}function Fv(e){return e.match(/url\(["']?([^"')]+)["']?\)/)?.[1]??null}function TA(e){try{return e.toDataURL("image/png")}catch{return""}}function IA(e){if(!e||e==="none")return[];const t=[],n=/(\w+)\(([^)]+)\)/g;let i;for(;(i=n.exec(e))!==null;){const s=i[1],o=i[2].split(",").map(a=>a.trim());switch(s){case"matrix":{const a=o.map(parseFloat);a.length===6&&t.push({type:"matrix",values:a});break}case"translate":{const a=Bl(o[0]),l=o[1]?Bl(o[1]):0;t.push({type:"translate",x:a,y:l});break}case"translateX":{t.push({type:"translate",x:Bl(o[0]),y:0});break}case"translateY":{t.push({type:"translate",x:0,y:Bl(o[0])});break}case"scale":{const a=parseFloat(o[0]),l=o[1]?parseFloat(o[1]):a;t.push({type:"scale",x:a,y:l});break}case"scaleX":{t.push({type:"scale",x:parseFloat(o[0]),y:1});break}case"scaleY":{t.push({type:"scale",x:1,y:parseFloat(o[0])});break}case"rotate":{t.push({type:"rotate",angle:Wd(o[0])});break}case"skewX":{t.push({type:"skewX",angle:Wd(o[0])});break}case"skewY":{t.push({type:"skewY",angle:Wd(o[0])});break}}}return t}function Bl(e){return parseFloat(e)||0}function Wd(e){return e=e.trim(),e.endsWith("rad")?parseFloat(e)*180/Math.PI:e.endsWith("turn")?parseFloat(e)*360:e.endsWith("grad")?parseFloat(e)*.9:parseFloat(e)||0}function NA(){return[1,0,0,1,0,0]}function Kd(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}function Cu(e,t){return[1,0,0,1,e,t]}function PA(e,t){return[e,0,0,t,0,0]}function MA(e){const t=e*Math.PI/180,n=Math.cos(t),i=Math.sin(t);return[n,i,-i,n,0,0]}function AA(e){const t=e*Math.PI/180;return[1,0,Math.tan(t),1,0,0]}function DA(e){const t=e*Math.PI/180;return[1,Math.tan(t),0,1,0,0]}function RA(e){return Math.abs(e[0]-1)<1e-10&&Math.abs(e[1])<1e-10&&Math.abs(e[2])<1e-10&&Math.abs(e[3]-1)<1e-10&&Math.abs(e[4])<1e-10&&Math.abs(e[5])<1e-10}function OA(e){return`matrix(${e.map(t=>t.toFixed(6)).join(",")})`}function zA(e,t,n){const i=IA(e);if(i.length===0)return null;const[s,o]=HA(t,n);let a=NA();a=Kd(a,Cu(s,o));for(const l of i)a=Kd(a,LA(l));return a=Kd(a,Cu(-s,-o)),RA(a)?null:OA(a)}function LA(e){switch(e.type){case"matrix":return e.values;case"translate":return Cu(e.x,e.y);case"scale":return PA(e.x,e.y);case"rotate":return MA(e.angle);case"skewX":return AA(e.angle);case"skewY":return DA(e.angle)}}function HA(e,t){const n=e.split(/\s+/),i=_h(n[0]??"50%",t.width,t.x),s=_h(n[1]??"50%",t.height,t.y);return[i,s]}function _h(e,t,n){return e==="left"||e==="top"?n:e==="right"||e==="bottom"?n+t:e==="center"?n+t/2:e.endsWith("%")?n+parseFloat(e)/100*t:n+parseFloat(e)}function FA(e,t){const n=VA(e);if(n.length===0)return null;const i=t.idGenerator.next("filter"),s=Ie(t.svgDocument,"filter");Xe(s,{id:i,x:"-50%",y:"-50%",width:"200%",height:"200%"});let o=!1;for(const a of n){const l=qA(a,t);for(const d of l)s.appendChild(d),o=!0}return o?(t.defs.appendChild(s),i):null}function zs(e){const t=e.trim();return t.endsWith("%")?(parseFloat(t)||0)/100:parseFloat(t)||0}function BA(e){const t=e.trim();return t.endsWith("rad")?(parseFloat(t)||0)*(180/Math.PI):t.endsWith("grad")?(parseFloat(t)||0)*.9:t.endsWith("turn")?(parseFloat(t)||0)*360:parseFloat(t)||0}function qA(e,t){switch(e.name){case"blur":{const n=parseFloat(e.args)||0,i=Ie(t.svgDocument,"feGaussianBlur");return Xe(i,{stdDeviation:n}),[i]}case"brightness":{const n=zs(e.args);return[jd(t,{slope:n})]}case"contrast":{const n=zs(e.args),i=.5-.5*n;return[jd(t,{slope:n,intercept:i})]}case"drop-shadow":{const n=WA(`drop-shadow(${e.args})`);if(!n)return[];const i=Ie(t.svgDocument,"feDropShadow");return Xe(i,{dx:n.offsetX,dy:n.offsetY,stdDeviation:n.blur/2,"flood-color":n.color,"flood-opacity":1}),[i]}case"grayscale":{const n=zs(e.args),i=Math.max(0,Math.min(1,1-n)),s=Ie(t.svgDocument,"feColorMatrix");return Xe(s,{type:"saturate",values:i}),[s]}case"hue-rotate":{const n=BA(e.args),i=Ie(t.svgDocument,"feColorMatrix");return Xe(i,{type:"hueRotate",values:n}),[i]}case"invert":{const n=zs(e.args),i=n,s=1-n;return[jd(t,{type:"table",tableValues:`${i} ${s}`})]}case"opacity":{const n=zs(e.args),i=Ie(t.svgDocument,"feComponentTransfer"),s=Ie(t.svgDocument,"feFuncA");return Xe(s,{type:"linear",slope:n,intercept:0}),i.appendChild(s),[i]}case"saturate":{const n=zs(e.args),i=Ie(t.svgDocument,"feColorMatrix");return Xe(i,{type:"saturate",values:n}),[i]}case"sepia":{const n=Math.max(0,Math.min(1,zs(e.args))),i=n,s=1-n,o=[s+i*.393,i*.769,i*.189,0,0,i*.349,s+i*.686,i*.168,0,0,i*.272,i*.534,s+i*.131,0,0,0,0,0,1,0].map(l=>l.toFixed(4)).join(" "),a=Ie(t.svgDocument,"feColorMatrix");return Xe(a,{type:"matrix",values:o}),[a]}default:return[]}}function jd(e,t){const n=Ie(e.svgDocument,"feComponentTransfer");for(const i of["feFuncR","feFuncG","feFuncB"]){const s=Ie(e.svgDocument,i);if(t.type==="table"&&t.tableValues)Xe(s,{type:"table",tableValues:t.tableValues});else{const o={type:"linear",slope:t.slope??1};t.intercept!==void 0&&(o.intercept=t.intercept),Xe(s,o)}n.appendChild(s)}return n}function VA(e){const t=[],n=/([a-z-]+)\(/gi;let i;for(;(i=n.exec(e))!==null;){const s=i[1],o=i.index+i[0].length;let a=1,l=o;for(;l<e.length&&a>0;l++)e[l]==="("?a++:e[l]===")"&&a--;const d=e.slice(o,l-1).trim();t.push({name:s.toLowerCase(),args:d}),n.lastIndex=l}return t}function WA(e){const t=e.indexOf("drop-shadow(");if(t===-1)return null;const n=t+12;let i=1,s=n;for(let p=n;p<e.length&&i>0;p++)e[p]==="("?i++:e[p]===")"&&i--,i>0&&(s=p+1);const o=e.slice(n,s).trim();if(!o)return null;const a=[];let l="",d=0;for(const p of o)p==="("?d++:p===")"&&d--,p===" "&&d===0&&l?(a.push(l),l=""):l+=p;if(l&&a.push(l),a.length<2)return null;const c=[];let u="rgba(0,0,0,0.3)";for(const p of a){const f=parseFloat(p);!isNaN(f)&&(p.endsWith("px")||p.match(/^-?[\d.]+$/))?c.push(f):u=p}return{offsetX:c[0]??0,offsetY:c[1]??0,blur:c[2]??0,color:u}}function KA(e){if(!e||e==="none")return[];const t=[],n=jA(e);for(const i of n){const s=XA(i.trim());s&&t.push(s)}return t}function jA(e){const t=[];let n=0,i="";for(const s of e)s==="("?n++:s===")"&&n--,s===","&&n===0?(t.push(i),i=""):i+=s;return i&&t.push(i),t}function XA(e){let t=!1,n=e;n.startsWith("inset ")?(t=!0,n=n.slice(6).trim()):n.endsWith(" inset")&&(t=!0,n=n.slice(0,-6).trim());const i=[];let s="",o=0;for(const d of n)d==="("?o++:d===")"&&o--,d===" "&&o===0&&s?(i.push(s),s=""):s+=d;s&&i.push(s);const a=[],l=[];for(const d of i){const c=parseFloat(d);!isNaN(c)&&(d.endsWith("px")||d.match(/^-?[\d.]+$/))?a.push(c):l.push(d)}return a.length<2?null:{inset:t,offsetX:a[0],offsetY:a[1],blur:a[2]??0,spread:a[3]??0,color:l.join(" ")||"rgba(0, 0, 0, 0.3)"}}function GA(e,t,n,i,s){for(let o=e.length-1;o>=0;o--){const a=e[o];a.inset?YA(a,t,n,i,s):UA(a,t,n,i,s)}}function UA(e,t,n,i,s){const o={x:t.x+e.offsetX-e.spread,y:t.y+e.offsetY-e.spread,width:t.width+e.spread*2,height:t.height+e.spread*2},a=Bv(n,e.spread),l=ec(o,a,i);if(l.setAttribute("fill",e.color),e.blur>0){const d=i.idGenerator.next("shadow"),c=Ie(i.svgDocument,"filter"),u=e.blur*2+Math.abs(e.offsetX)+Math.abs(e.offsetY)+e.spread,p=Math.max(o.width,1),f=Math.max(o.height,1);Xe(c,{id:d,x:`-${(u/p*100+10).toFixed(0)}%`,y:`-${(u/f*100+10).toFixed(0)}%`,width:`${(200+u/p*200+20).toFixed(0)}%`,height:`${(200+u/f*200+20).toFixed(0)}%`});const h=Ie(i.svgDocument,"feGaussianBlur");Xe(h,{in:"SourceGraphic",stdDeviation:e.blur/2}),c.appendChild(h),i.defs.appendChild(c),l.setAttribute("filter",`url(#${d})`)}s.insertBefore(l,s.firstChild)}function YA(e,t,n,i,s){const o=i.idGenerator.next("inset-clip"),a=Ie(i.svgDocument,"clipPath");a.setAttribute("id",o);const l=ec(t,n,i);a.appendChild(l),i.defs.appendChild(a);const d={x:t.x+e.offsetX+e.spread,y:t.y+e.offsetY+e.spread,width:Math.max(0,t.width-e.spread*2),height:Math.max(0,t.height-e.spread*2)},c=Bv(n,-e.spread),u=Ie(i.svgDocument,"g");u.setAttribute("clip-path",`url(#${o})`);const p=Ie(i.svgDocument,"rect"),f=e.blur*3+Math.abs(e.offsetX)+Math.abs(e.offsetY)+100;Xe(p,{x:t.x-f,y:t.y-f,width:t.width+f*2,height:t.height+f*2,fill:e.color}),ec(d,c,i).setAttribute("fill",e.color);const g=i.idGenerator.next("inset-mask"),y=Ie(i.svgDocument,"mask");y.setAttribute("id",g);const b=Ie(i.svgDocument,"rect");Xe(b,{x:t.x-f,y:t.y-f,width:t.width+f*2,height:t.height+f*2,fill:"white"});const m=ec(d,c,i);if(m.setAttribute("fill","black"),y.appendChild(b),y.appendChild(m),i.defs.appendChild(y),p.setAttribute("mask",`url(#${g})`),e.blur>0){const x=i.idGenerator.next("inset-blur"),S=Ie(i.svgDocument,"filter");Xe(S,{id:x,x:"-50%",y:"-50%",width:"200%",height:"200%"});const v=Ie(i.svgDocument,"feGaussianBlur");Xe(v,{in:"SourceGraphic",stdDeviation:e.blur/2}),S.appendChild(v),i.defs.appendChild(S),p.setAttribute("filter",`url(#${x})`)}u.appendChild(p),s.insertBefore(u,s.firstChild)}function ec(e,t,n){if(Is(t)&&!Gr(t)){const s=Ie(n.svgDocument,"path");return s.setAttribute("d",il(e.x,e.y,e.width,e.height,t)),s}const i=Ie(n.svgDocument,"rect");return Xe(i,{x:e.x,y:e.y,width:e.width,height:e.height}),Is(t)&&Gr(t)&&Xe(i,{rx:t.topLeft[0],ry:t.topLeft[1]}),i}function Bv(e,t){return{topLeft:[Math.max(0,e.topLeft[0]+t),Math.max(0,e.topLeft[1]+t)],topRight:[Math.max(0,e.topRight[0]+t),Math.max(0,e.topRight[1]+t)],bottomRight:[Math.max(0,e.bottomRight[0]+t),Math.max(0,e.bottomRight[1]+t)],bottomLeft:[Math.max(0,e.bottomLeft[0]+t),Math.max(0,e.bottomLeft[1]+t)]}}function Pc(e){const t=e.trim();return t.endsWith("%")?{value:parseFloat(t)||0,isPct:!0}:{value:parseFloat(t)||0,isPct:!1}}function qv(e){if(!e||e==="none")return null;const t=e.match(/^inset\((.+)\)$/);if(t)return ZA(t[1]);const n=e.match(/^circle\((.+)\)$/);if(n)return JA(n[1]);const i=e.match(/^ellipse\((.+)\)$/);if(i)return QA(i[1]);const s=e.match(/^polygon\((.+)\)$/);if(s)return $A(s[1]);const o=e.match(/^path\(["']?(.+?)["']?\)$/);return o?{type:"path",d:o[1]}:null}function ZA(e){const t=e.indexOf(" round ");let n=e,i;t>=0&&(n=e.slice(0,t),i=e.slice(t+7).trim());const s=n.trim().split(/\s+/).map(c=>parseFloat(c)||0),o=s[0]??0,a=s[1]??o,l=s[2]??o,d=s[3]??a;return{type:"inset",top:o,right:a,bottom:l,left:d,round:i}}function JA(e){const t=e.indexOf(" at ");let n=0,i=0,s=0,o=!1,a=!1;if(t>=0){n=parseFloat(e.slice(0,t))||0;const l=e.slice(t+4).trim().split(/\s+/),d=Pc(l[0]),c=Pc(l[1]);i=d.value,o=d.isPct,s=c.value,a=c.isPct}else n=parseFloat(e)||0,i=50,s=50,o=!0,a=!0;return{type:"circle",radius:n,cx:i,cy:s,cxPct:o,cyPct:a}}function QA(e){const t=e.indexOf(" at ");let n=0,i=0,s=0,o=0,a=!1,l=!1;if(t>=0){const d=e.slice(0,t).trim().split(/\s+/);n=parseFloat(d[0])||0,i=parseFloat(d[1])||0;const c=e.slice(t+4).trim().split(/\s+/),u=Pc(c[0]),p=Pc(c[1]);s=u.value,a=u.isPct,o=p.value,l=p.isPct}else{const d=e.trim().split(/\s+/);n=parseFloat(d[0])||0,i=parseFloat(d[1])||0,s=50,o=50,a=!0,l=!0}return{type:"ellipse",rx:n,ry:i,cx:s,cy:o,cxPct:a,cyPct:l}}function $A(e){let t=e.trim();(t.startsWith("nonzero,")||t.startsWith("evenodd,"))&&(t=t.slice(t.indexOf(",")+1).trim());const n=[],i=t.split(",");for(const s of i){const o=s.trim().split(/\s+/);o.length>=2&&n.push([parseFloat(o[0])||0,parseFloat(o[1])||0])}return n.length<3?null:{type:"polygon",points:n}}function Vv(e,t,n){const i=n.idGenerator.next("clip"),s=Ie(n.svgDocument,"clipPath");s.setAttribute("id",i);const o=eD(e,t,n);return o?(s.appendChild(o),n.defs.appendChild(s),i):null}function eD(e,t,n){switch(e.type){case"inset":{const i=t.x+e.left,s=t.y+e.top,o=Math.max(0,t.width-e.left-e.right),a=Math.max(0,t.height-e.top-e.bottom);if(e.round){const d=e.round.split("/").map(h=>h.trim().split(/\s+/).map(g=>parseFloat(g)||0)),c=d[0]??[0],u=d[1]??c,p={topLeft:[c[0]??0,u[0]??0],topRight:[c[1]??c[0]??0,u[1]??u[0]??0],bottomRight:[c[2]??c[0]??0,u[2]??u[0]??0],bottomLeft:[c[3]??c[1]??c[0]??0,u[3]??u[1]??u[0]??0]},f=Ie(n.svgDocument,"path");return f.setAttribute("d",il(i,s,o,a,p)),f}const l=Ie(n.svgDocument,"rect");return Xe(l,{x:i,y:s,width:o,height:a}),l}case"circle":{const i=e.cxPct?e.cx/100*t.width:e.cx,s=e.cyPct?e.cy/100*t.height:e.cy,o=Ie(n.svgDocument,"circle");return Xe(o,{cx:t.x+i,cy:t.y+s,r:e.radius}),o}case"ellipse":{const i=e.cxPct?e.cx/100*t.width:e.cx,s=e.cyPct?e.cy/100*t.height:e.cy,o=Ie(n.svgDocument,"ellipse");return Xe(o,{cx:t.x+i,cy:t.y+s,rx:e.rx,ry:e.ry}),o}case"polygon":{const i=Ie(n.svgDocument,"polygon"),s=e.points.map(([o,a])=>`${t.x+o},${t.y+a}`).join(" ");return i.setAttribute("points",s),i}case"path":{const i=Ie(n.svgDocument,"path");return i.setAttribute("d",e.d),i.setAttribute("transform",`translate(${t.x}, ${t.y})`),i}default:return null}}async function tD(e,t,n){const i=Ie(n.svgDocument,"g"),s=window.getComputedStyle(e),o=Lv(e,t),a=zv(Dv(s),o.width,o.height);if(!n.options.flattenTransforms&&s.transform&&s.transform!=="none"){const c=zA(s.transform,s.transformOrigin,o);c&&i.setAttribute("transform",c)}const l=s.clipPath;if(l&&l!=="none"){const c=qv(l);if(c){const u=Vv(c,o,n);u&&i.setAttribute("clip-path",`url(#${u})`)}}if(!pA(s)){if(s.filter&&s.filter!=="none"){const h=FA(s.filter,n);h&&i.setAttribute("filter",`url(#${h})`)}const c=s.boxShadow;if(c&&c!=="none"){const h=KA(c);h.length>0&&GA(h,o,a,n,i)}const u=Nc(s);if(u){const h=lr(o,a,n);h.setAttribute("fill",u),i.appendChild(h)}Ov(s)&&await fD(s,o,a,n,i);const p=hA(s);if(gA(p)&&oD(i,o,p,a,n),dD(s,o,a,n,i),aA(e)&&e.src){const h=await Df(e.src),g=Ie(n.svgDocument,"image");Xe(g,{x:o.x,y:o.y,width:o.width,height:o.height,href:h});const y=s.objectFit||e.style.objectFit;if(y==="fill"||y===""?g.setAttribute("preserveAspectRatio","none"):y==="contain"||y==="scale-down"?g.setAttribute("preserveAspectRatio","xMidYMid meet"):y==="cover"&&g.setAttribute("preserveAspectRatio","xMidYMid slice"),Is(a)){const b=n.idGenerator.next("clip"),m=Ie(n.svgDocument,"clipPath");m.setAttribute("id",b);const x=Ie(n.svgDocument,"path");x.setAttribute("d",il(o.x,o.y,o.width,o.height,a)),m.appendChild(x),n.defs.appendChild(m),g.setAttribute("clip-path",`url(#${b})`)}i.appendChild(g)}if(rA(e)){const h=TA(e);if(h){const g=Ie(n.svgDocument,"image");Xe(g,{x:o.x,y:o.y,width:o.width,height:o.height,href:h}),i.appendChild(g)}}lA(e)&&cD(e,s,o,n,i),s.display==="list-item"&&lD(e,s,o,n,i);const f=s.webkitMaskImage||s.maskImage||s.webkitMask||s.mask;f&&f!=="none"&&await rD(f,s,o,n,i),await Wv(e,"::before",t,n,i)}if(Rv(s)&&e!==t){const c=aD(o,a,n);i.appendChild(c),i.__childTarget=c}return i}async function nD(e,t,n,i){await Wv(e,"::after",t,n,i)}function iD(e){return e.__childTarget??e}function lr(e,t,n){if(Is(t)&&!Gr(t))return sD(e,t,n);const i=Ie(n.svgDocument,"rect");return Xe(i,{x:e.x,y:e.y,width:e.width,height:e.height}),Is(t)&&Gr(t)&&Xe(i,{rx:t.topLeft[0],ry:t.topLeft[1]}),i}function sD(e,t,n){const i=Ie(n.svgDocument,"path");return i.setAttribute("d",il(e.x,e.y,e.width,e.height,t)),i}function Eu(e,t){return e==="dashed"?`${t*3} ${t*2}`:e==="dotted"?`${t} ${t}`:null}function oD(e,t,n,i,s){if(n.top.width===n.right.width&&n.right.width===n.bottom.width&&n.bottom.width===n.left.width&&n.top.color===n.right.color&&n.right.color===n.bottom.color&&n.bottom.color===n.left.color&&n.top.style===n.right.style&&n.right.style===n.bottom.style&&n.bottom.style===n.left.style&&n.top.width>0&&n.top.style!=="none"){const w=n.top.width/2,k={x:t.x+w,y:t.y+w,width:Math.max(0,t.width-n.top.width),height:Math.max(0,t.height-n.top.width)},N={topLeft:[Math.max(0,i.topLeft[0]-w),Math.max(0,i.topLeft[1]-w)],topRight:[Math.max(0,i.topRight[0]-w),Math.max(0,i.topRight[1]-w)],bottomRight:[Math.max(0,i.bottomRight[0]-w),Math.max(0,i.bottomRight[1]-w)],bottomLeft:[Math.max(0,i.bottomLeft[0]-w),Math.max(0,i.bottomLeft[1]-w)]},L=lr(k,N,s);Xe(L,{fill:"none",stroke:n.top.color,"stroke-width":n.top.width});const X=Eu(n.top.style,n.top.width);X&&L.setAttribute("stroke-dasharray",X),e.appendChild(L);return}const{x:o,y:a,width:l,height:d}=t,c=n.top.width,u=n.right.width,p=n.bottom.width,f=n.left.width,h=o,g=a,y=o+l,b=a+d,m=o+f,x=a+c,S=o+l-u,v=a+d-p,A=[{w:c,side:n.top,trapD:`M ${h} ${g} L ${y} ${g} L ${S} ${x} L ${m} ${x} Z`,lineD:`M ${m} ${g+c/2} L ${S} ${g+c/2}`},{w:u,side:n.right,trapD:`M ${y} ${g} L ${y} ${b} L ${S} ${v} L ${S} ${x} Z`,lineD:`M ${y-u/2} ${x} L ${y-u/2} ${v}`},{w:p,side:n.bottom,trapD:`M ${y} ${b} L ${h} ${b} L ${m} ${v} L ${S} ${v} Z`,lineD:`M ${S} ${b-p/2} L ${m} ${b-p/2}`},{w:f,side:n.left,trapD:`M ${h} ${b} L ${h} ${g} L ${m} ${x} L ${m} ${v} Z`,lineD:`M ${h+f/2} ${v} L ${h+f/2} ${x}`}];for(const{w,side:k,trapD:N,lineD:L}of A){if(w<=0||k.style==="none")continue;const X=Eu(k.style,w);if(X){const O=Ie(s.svgDocument,"path");Xe(O,{d:L,fill:"none",stroke:k.color,"stroke-width":w}),O.setAttribute("stroke-dasharray",X),e.appendChild(O)}else{const O=Ie(s.svgDocument,"path");O.setAttribute("d",N),O.setAttribute("fill",k.color),e.appendChild(O)}}}function aD(e,t,n){const i=n.idGenerator.next("mask"),s=Ie(n.svgDocument,"mask");s.setAttribute("id",i);const o=lr(e,t,n);o.setAttribute("fill","white"),s.appendChild(o),n.defs.appendChild(s);const a=Ie(n.svgDocument,"g");return a.setAttribute("mask",`url(#${i})`),a}function xh(e,t,n,i,s){const o=i.idGenerator.next("mask"),a=Ie(i.svgDocument,"mask");a.setAttribute("id",o);const l=lr(t,n,i);l.setAttribute("fill","white"),a.appendChild(l),i.defs.appendChild(a);const d=Ie(i.svgDocument,"g");d.setAttribute("mask",`url(#${o})`),d.appendChild(e),s.appendChild(d)}async function rD(e,t,n,i,s){const o=Fv(e);if(!o)return;let a=o;if(!o.startsWith("data:"))try{a=await Df(o)}catch{return}const l=t.webkitMaskSize||t.maskSize||"auto";let d=n.width,c=n.height;if(l!=="auto"&&l!=="contain"&&l!=="cover"){const h=l.split(/\s+/),g=parseFloat(h[0]),y=parseFloat(h[1]||h[0]);isNaN(g)||(d=g),isNaN(y)||(c=y)}const u=i.idGenerator.next("mask"),p=Ie(i.svgDocument,"mask");p.setAttribute("id",u),p.setAttribute("style","mask-type: alpha");const f=Ie(i.svgDocument,"image");Xe(f,{x:n.x,y:n.y,width:d,height:c,href:a}),p.appendChild(f),i.defs.appendChild(p),s.setAttribute("mask",`url(#${u})`)}function lD(e,t,n,i,s){let o="";try{const g=window.getComputedStyle(e,"::marker").content;g&&g!=="none"&&g!=="normal"&&(o=g.replace(/^["']|["']$/g,""))}catch{}if(!o){const h=t.listStyleType;if(h==="none")return;if(h==="disc")o="â¢";else if(h==="circle")o="â";else if(h==="square")o="â ";else if(h==="decimal"||h===""||!h){let g=1,y=e.previousElementSibling;for(;y;)window.getComputedStyle(y).display==="list-item"&&g++,y=y.previousElementSibling;o=`${g}.`}else o="â¢"}if(!o)return;const a=parseFloat(t.fontSize)||16,l=parseFloat(t.paddingLeft)||0,d=parseFloat(t.paddingTop)||0,c=parseFloat(t.lineHeight)||a*1.2,u=n.x+l-6,p=n.y+d+(c-a)/2+a*.8,f=Ie(i.svgDocument,"text");Xe(f,{x:u.toFixed(2),y:p.toFixed(2),"font-family":t.fontFamily,"font-size":t.fontSize,fill:t.color,"text-anchor":"end"}),f.textContent=o,s.appendChild(f)}function cD(e,t,n,i,s){let o="",a=!1;if(e instanceof HTMLSelectElement?o=e.selectedOptions[0]?.text??"":(o=e.value,!o&&e.placeholder&&(o=e.placeholder,a=!0)),!o)return;const l=parseFloat(t.fontSize)||16,d=parseFloat(t.paddingLeft)||0,c=parseFloat(t.paddingTop)||0,u=parseFloat(t.borderTopWidth)||0,p=parseFloat(t.lineHeight)||l*1.2,f=a?"gray":t.color,h=n.x+d;if(e instanceof HTMLTextAreaElement){const x=o.split(`
`);for(let S=0;S<x.length;S++){const v=x[S];if(!v)continue;const A=(p-l)/2,w=n.y+u+c+S*p+A+l*.8,k=Ie(i.svgDocument,"text");Xe(k,{x:h.toFixed(2),y:w.toFixed(2),"font-family":t.fontFamily,"font-size":t.fontSize,"font-weight":t.fontWeight,"font-style":t.fontStyle,fill:f}),a&&k.setAttribute("opacity","0.54"),k.textContent=v,s.appendChild(k)}return}const g=parseFloat(t.borderBottomWidth)||0,y=n.height-u-g,b=n.y+u+y/2+l*.35,m=Ie(i.svgDocument,"text");Xe(m,{x:h.toFixed(2),y:b.toFixed(2),"font-family":t.fontFamily,"font-size":t.fontSize,"font-weight":t.fontWeight,"font-style":t.fontStyle,fill:f}),a&&m.setAttribute("opacity","0.54"),m.textContent=o,s.appendChild(m)}function dD(e,t,n,i,s){const o=e.outlineStyle;if(!o||o==="none")return;const a=parseFloat(e.outlineWidth)||0;if(a<=0)return;const l=e.outlineColor||e.color,c=(parseFloat(e.outlineOffset)||0)+a/2,u={x:t.x-c,y:t.y-c,width:t.width+c*2,height:t.height+c*2},p={topLeft:[Math.max(0,n.topLeft[0]+c),Math.max(0,n.topLeft[1]+c)],topRight:[Math.max(0,n.topRight[0]+c),Math.max(0,n.topRight[1]+c)],bottomRight:[Math.max(0,n.bottomRight[0]+c),Math.max(0,n.bottomRight[1]+c)],bottomLeft:[Math.max(0,n.bottomLeft[0]+c),Math.max(0,n.bottomLeft[1]+c)]},f=lr(u,p,i);Xe(f,{fill:"none",stroke:l,"stroke-width":a});const h=Eu(o,a);h&&f.setAttribute("stroke-dasharray",h),s.appendChild(f)}function Xd(e){const t=[];let n=0,i="";for(const s of e)s==="("?n++:s===")"&&n--,s===","&&n===0?(t.push(i.trim()),i=""):i+=s;return i.trim()&&t.push(i.trim()),t}function uD(e,t,n){let i=n.width,s=n.height,o="none";if(e==="contain")o="xMidYMid meet";else if(e==="cover")o="xMidYMid slice";else if(e&&e!=="auto"){const d=e.split(/\s+/),c=kh(d[0],n.width),u=kh(d[1]??"auto",n.height);c!==null&&(i=c),u!==null&&(s=u)}let a=n.x,l=n.y;if(t&&t!=="0% 0%"){const d=t.split(/\s+/);a=n.x+Sh(d[0]??"0px",n.width,i),l=n.y+Sh(d[1]??"0px",n.height,s)}return{x:a,y:l,width:i,height:s,preserveAspectRatio:o}}function kh(e,t){return e==="auto"?null:e.endsWith("%")?parseFloat(e)/100*t:parseFloat(e)||null}function Sh(e,t,n){return e.endsWith("%")?parseFloat(e)/100*(t-n):parseFloat(e)||0}async function fD(e,t,n,i,s){const o=Xd(e.backgroundImage),a=Xd(e.backgroundSize),l=Xd(e.backgroundPosition);for(let d=o.length-1;d>=0;d--){const c=o[d];if(c==="none")continue;const u=a[d]??a[a.length-1]??"auto",p=l[d]??l[l.length-1]??"0% 0%",f=uD(u,p,t);await pD(c,f,t,n,i,s)}}async function pD(e,t,n,i,s,o){const a=_A(e);if(a){const c=xA(a,n,s),u=lr(n,i,s);u.setAttribute("fill",`url(#${c.getAttribute("id")})`),o.appendChild(u);return}const l=kA(e,t.width,t.height);if(l){const c=Ie(s.svgDocument,"image");Xe(c,{x:t.x,y:t.y,width:t.width,height:t.height,href:l,preserveAspectRatio:t.preserveAspectRatio}),Is(i)?xh(c,n,i,s,o):o.appendChild(c);return}const d=Fv(e);if(d){const c=await Df(d),u=Ie(s.svgDocument,"image");Xe(u,{x:t.x,y:t.y,width:t.width,height:t.height,href:c,preserveAspectRatio:t.preserveAspectRatio}),Is(i)?xh(u,n,i,s,o):o.appendChild(u)}}function hD(e){if(Nc(e)||Ov(e))return!0;const t=e.clipPath||e.webkitClipPath;return!!(t&&t!=="none")}function gD(e,t,n,i){const s=document.createElement("span");s.style.cssText=`
    position: ${n.position};
    display: ${n.display==="none"?"none":n.display};
    top: ${n.top}; right: ${n.right};
    bottom: ${n.bottom}; left: ${n.left};
    width: ${n.width}; height: ${n.height};
    margin: ${n.margin}; padding: ${n.padding};
    box-sizing: ${n.boxSizing};
    visibility: hidden;
    pointer-events: none;
  `,t==="::before"?e.insertBefore(s,e.firstChild):e.appendChild(s);const o=s.getBoundingClientRect();if(e.removeChild(s),o.width===0&&o.height===0)return null;const a=i.getBoundingClientRect();return{x:o.left-a.left,y:o.top-a.top,width:o.width,height:o.height}}async function Wv(e,t,n,i,s){const o=cA(e,t),a=o.content;if(!a||a==="none"||a==="normal")return;const l=a.replace(/^["']|["']$/g,""),d=hD(o);if(!l&&!d)return;if(d){const S=gD(e,t,o,n);if(S){const v=Nc(o);if(v){const A=Ie(i.svgDocument,"rect");Xe(A,{x:S.x,y:S.y,width:S.width,height:S.height,fill:v});const w=o.clipPath||o.webkitClipPath;if(w&&w!=="none"){const k=qv(w);if(k){const N=Vv(k,S,i);N&&A.setAttribute("clip-path",`url(#${N})`)}}s.appendChild(A)}}}if(!l)return;const c=n.getBoundingClientRect(),u=parseFloat(o.fontSize)||16,p=document.createElement("span");p.style.cssText=`
    font-family: ${o.fontFamily};
    font-size: ${o.fontSize};
    font-weight: ${o.fontWeight};
    font-style: ${o.fontStyle};
    letter-spacing: ${o.letterSpacing};
    visibility: hidden;
    pointer-events: none;
  `,p.textContent=l,t==="::before"?e.insertBefore(p,e.firstChild):e.appendChild(p);const f=p.getBoundingClientRect(),h=f.left-c.left,g=f.width,y=f.height,b=(y-u)/2,m=f.top-c.top+b+u*.8;if(e.removeChild(p),!d){const S=Nc(o);if(S){const v=Ie(i.svgDocument,"rect");Xe(v,{x:h,y:f.top-c.top,width:g,height:y,fill:S}),s.appendChild(v)}}const x=Ie(i.svgDocument,"text");Xe(x,{"font-family":o.fontFamily,"font-size":o.fontSize,"font-weight":o.fontWeight,"font-style":o.fontStyle,fill:o.color,x:h.toFixed(2),y:m.toFixed(2)}),o.letterSpacing&&o.letterSpacing!=="normal"&&x.setAttribute("letter-spacing",o.letterSpacing),x.textContent=l,s.appendChild(x)}function mD(e,t){const n=window.getComputedStyle(e).color||"rgb(0, 0, 0)",i=Mc(e,t);return Xv(i,n),yD(i,t),i}function Mc(e,t,n=0){if(e.localName==="use"&&n<5){const s=vD(e,t,n);if(s)return s}const i=t.svgDocument.createElementNS(e.namespaceURI||Us,e.localName);for(const s of Array.from(e.attributes))s.namespaceURI===Ys?i.setAttributeNS(Ys,s.localName,s.value):s.namespaceURI?i.setAttributeNS(s.namespaceURI,s.localName,s.value):i.setAttribute(s.localName,s.value);Kv(e,i);for(const s of Array.from(e.childNodes))s.nodeType===Node.ELEMENT_NODE?i.appendChild(Mc(s,t,n)):s.nodeType===Node.TEXT_NODE&&i.appendChild(t.svgDocument.createTextNode(s.textContent||""));return i}function vD(e,t,n){const i=e.getAttribute("href")||e.getAttributeNS(Ys,"href");if(!i||!i.startsWith("#"))return null;const s=i.slice(1),o=document.getElementById(s);if(!o)return null;const a=t.svgDocument.createElementNS(Us,"g"),l=new Set(["href","xlink:href","x","y","width","height"]);for(const u of Array.from(e.attributes))l.has(u.localName)||u.namespaceURI!==Ys&&(u.namespaceURI?a.setAttributeNS(u.namespaceURI,u.localName,u.value):a.setAttribute(u.localName,u.value));const d=parseFloat(e.getAttribute("x")||"0")||0,c=parseFloat(e.getAttribute("y")||"0")||0;if(d!==0||c!==0){const u=a.getAttribute("transform")||"";a.setAttribute("transform",`translate(${d},${c}) ${u}`.trim())}if(Kv(e,a),o.localName==="symbol"){const u=o.getAttribute("viewBox"),p=e.getAttribute("width")||o.getAttribute("width"),f=e.getAttribute("height")||o.getAttribute("height"),h=t.svgDocument.createElementNS(Us,"svg");u&&h.setAttribute("viewBox",u),p&&h.setAttribute("width",p),f&&h.setAttribute("height",f),h.setAttribute("overflow","hidden");for(const g of Array.from(o.childNodes))g.nodeType===Node.ELEMENT_NODE&&h.appendChild(Mc(g,t,n+1));a.appendChild(h)}else a.appendChild(Mc(o,t,n+1));return a}function Kv(e,t){const n=window.getComputedStyle(e);if(!t.hasAttribute("fill")){const i=n.fill;i&&i!=="rgb(0, 0, 0)"&&t.setAttribute("fill",i)}if(!t.hasAttribute("stroke")){const i=n.stroke;i&&i!=="none"&&t.setAttribute("stroke",i)}if(!t.hasAttribute("opacity")){const i=n.opacity;i&&i!=="1"&&t.setAttribute("opacity",i)}}function yD(e,t){const n=new Map,i=e.querySelectorAll("[id]");for(const s of Array.from(i)){const o=s.getAttribute("id"),a=t.idGenerator.next("svg");n.set(o,a),s.setAttribute("id",a)}if(e.hasAttribute("id")){const s=e.getAttribute("id");if(!n.has(s)){const o=t.idGenerator.next("svg");n.set(s,o),e.setAttribute("id",o)}}n.size!==0&&jv(e,n)}function jv(e,t){for(const n of Array.from(e.attributes)){if(n.value.includes("url(#")){let i=n.value;for(const[s,o]of t)i=i.replace(new RegExp(`url\\(#${bD(s)}\\)`,"g"),`url(#${o})`);i!==n.value&&e.setAttribute(n.localName,i)}if((n.localName==="href"||n.localName==="xlink:href")&&n.value.startsWith("#")){const i=n.value.slice(1);t.has(i)&&(n.namespaceURI===Ys?e.setAttributeNS(Ys,"href",`#${t.get(i)}`):e.setAttribute(n.localName,`#${t.get(i)}`))}}for(const n of Array.from(e.children))n instanceof SVGElement&&jv(n,t)}function Xv(e,t){for(const n of Array.from(e.attributes))n.value==="currentColor"&&e.setAttribute(n.localName,t);for(const n of Array.from(e.children))n instanceof SVGElement&&Xv(n,t)}function bD(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var wD=1e4;function _D(e){const t=new Map;let n=null;async function i(){return n||(n=await oi(()=>import("../chunks/BSMA75Qi.js"),[],import.meta.url),n)}function s(d,c,u){return`${d}|${c??"normal"}|${u??"normal"}`}function o(d){return d===void 0||d==="normal"?400:d==="bold"?700:typeof d=="string"?parseInt(d,10)||400:d}function a(d){return d==="italic"||d==="oblique"?"italic":"normal"}function l(d,c,u){const p=e[d];if(!p)return null;if(typeof p=="string")return{url:p};if(!Array.isArray(p))return p;const f=o(c),h=a(u);let g=null,y=-1;for(const b of p){let m=0;a(b.style)===h&&(m+=2),o(b.weight)===f&&(m+=1),m>y&&(y=m,g=b)}return g??p[0]??null}return{async getFont(d,c,u){const p=s(d,c,u);if(t.has(p))return t.get(p);const f=l(d,c,u);if(!f)return null;const h=await i();try{const g=new AbortController,y=setTimeout(()=>g.abort(),wD),b=await fetch(f.url,{signal:g.signal});clearTimeout(y);const m=await b.arrayBuffer(),x=h.parse(m);return t.set(p,x),x}catch(g){return console.warn(`dom2svg: Failed to load font "${d}" from ${f.url}:`,g),null}},has(d){return d in e}}}function xD(e,t,n,i,s){try{return e.getPath(t,n,i,s).toPathData(2)}catch{return null}}function kD(e){return(e.split(",")[0]?.trim()??e).replace(/^["']|["']$/g,"")}function SD(e){if(!e||e==="none")return[];const t=[],n=CD(e);for(const i of n){const s=ED(i.trim());s&&t.push(s)}return t}function CD(e){const t=[];let n=0,i="";for(const s of e)s==="("?n++:s===")"&&n--,s===","&&n===0?(t.push(i),i=""):i+=s;return i&&t.push(i),t}function ED(e){const t=[];let n="",i=0;for(const a of e)a==="("?i++:a===")"&&i--,a===" "&&i===0&&n?(t.push(n),n=""):n+=a;n&&t.push(n);const s=[],o=[];for(const a of t){const l=parseFloat(a);!isNaN(l)&&(a.endsWith("px")||a.match(/^-?[\d.]+$/))?s.push(l):o.push(a)}return s.length<2?null:{offsetX:s[0],offsetY:s[1],blur:s[2]??0,color:o.join(" ")||"rgba(0, 0, 0, 0.5)"}}function TD(e,t){if(e.length===0)return null;const n=t.idGenerator.next("tshadow"),i=Ie(t.svgDocument,"filter");if(Xe(i,{id:n,x:"-50%",y:"-50%",width:"200%",height:"200%"}),e.length===1){const s=e[0],o=Ie(t.svgDocument,"feDropShadow");Xe(o,{dx:s.offsetX,dy:s.offsetY,stdDeviation:s.blur/2,"flood-color":s.color,"flood-opacity":1}),i.appendChild(o)}else{const s=[];for(let l=0;l<e.length;l++){const d=e[l],c=String(l),u=Ie(t.svgDocument,"feOffset");Xe(u,{in:"SourceAlpha",dx:d.offsetX,dy:d.offsetY,result:`off${c}`}),i.appendChild(u);const p=Ie(t.svgDocument,"feGaussianBlur");Xe(p,{in:`off${c}`,stdDeviation:d.blur/2,result:`blur${c}`}),i.appendChild(p);const f=Ie(t.svgDocument,"feFlood");Xe(f,{"flood-color":d.color,"flood-opacity":1,result:`color${c}`}),i.appendChild(f);const h=Ie(t.svgDocument,"feComposite");Xe(h,{in:`color${c}`,in2:`blur${c}`,operator:"in",result:`shadow${c}`}),i.appendChild(h),s.push(`shadow${c}`)}const o=Ie(t.svgDocument,"feMerge");for(const l of s){const d=Ie(t.svgDocument,"feMergeNode");d.setAttribute("in",l),o.appendChild(d)}const a=Ie(t.svgDocument,"feMergeNode");a.setAttribute("in","SourceGraphic"),o.appendChild(a),i.appendChild(o)}return t.defs.appendChild(i),n}async function ID(e,t,n){const i=e.textContent;if(!i||!i.trim())return null;const s=e.parentElement;if(!s)return null;const o=window.getComputedStyle(s);if(o.visibility==="hidden")return null;const a=o.whiteSpace,l=t.getBoundingClientRect();let d;try{const A=document.createRange();A.selectNodeContents(e),d=A.getClientRects()}catch{return null}if(d.length===0)return null;const c=Ie(n.svgDocument,"g"),u=n.options.textToPath&&n.fontCache,p=kD(o.fontFamily),f=parseFloat(o.fontSize)||16,h=o.fontWeight,g=o.fontStyle;let y=null;u&&n.fontCache?.has(p)&&(y=await n.fontCache.getFont(p,h,g));let b=.8;y&&y.ascender&&y.unitsPerEm&&(b=y.ascender/y.unitsPerEm);const m=ND(e,l,b,a),x=o.textTransform,S=o.textOverflow==="ellipsis"&&o.overflow!=="visible"&&o.whiteSpace==="nowrap"&&s.scrollWidth>s.clientWidth;for(const A of m){let w=DD(A.text,x);if(S&&A===m[m.length-1]&&(w=w.trimEnd()+"â¦"),y){const k=xD(y,w,A.x,A.y,f);if(k){const N=Ie(n.svgDocument,"path");Xe(N,{d:k,fill:o.color}),c.appendChild(N)}}else{const k=Ie(n.svgDocument,"text");Xe(k,{x:A.x.toFixed(2),y:A.y.toFixed(2)}),RD(k,o),k.textContent=w,c.appendChild(k)}}if(c.childNodes.length===0)return null;const v=o.textShadow;if(v&&v!=="none"){const A=SD(v),w=TD(A,n);w&&c.setAttribute("filter",`url(#${w})`)}return c}function Ch(e,t,n,i,s=.8,o){let a=e,l=t;o&&t>n*2&&o.height<t*.8&&(a=o.top,l=o.height);const d=(l-n)/2;return a-i+d+n*s}function ND(e,t,n=.8,i="normal"){const s=[],o=e.textContent||"";if(!o)return s;const a=e.parentElement;if(!a)return s;const l=window.getComputedStyle(a),d=parseFloat(l.fontSize)||16,c=a.getBoundingClientRect(),u={top:c.top,height:c.height},p=document.createRange();p.selectNodeContents(e);const f=p.getClientRects();if(f.length===0)return s;let h;if(f.length===1){const y=f[0];if(o.length>1&&MD(e,p,o.length,d))h=AD(e,p,o.length,d);else return s.push({text:Eh(o,i),x:y.left-t.left,y:Ch(y.top,y.height,d,t.top,n,u)}),s}else h=Array.from(f);let g=0;for(let y=0;y<h.length;y++){const b=h[y],m=y===h.length-1;let x;if(m)x=o.length;else{const v=b.top;x=PD(e,p,g,o.length,v,d)}const S=Eh(o.slice(g,x),i);S&&s.push({text:S,x:b.left-t.left,y:Ch(b.top,b.height,d,t.top,n,u)}),g=x}return s}function PD(e,t,n,i,s,o){for(;n<i;){const a=Math.floor((n+i)/2);try{t.setStart(e,a),t.setEnd(e,a+1)}catch{n=a+1;continue}const l=t.getClientRects();if(l.length===0){n=a+1;continue}Math.abs(l[0].top-s)>o*.5?i=a:n=a+1}return n}function MD(e,t,n,i){if(n<=1)return!1;try{t.setStart(e,0),t.setEnd(e,1);const s=t.getClientRects();t.setStart(e,n-1),t.setEnd(e,n);const o=t.getClientRects();if(s.length>0&&o.length>0)return Math.abs(o[0].top-s[0].top)>i*.5}catch{}return!1}function AD(e,t,n,i){const s=[];let o=-1/0;for(let a=0;a<n;a++)try{t.setStart(e,a),t.setEnd(e,a+1);const l=t.getClientRects();if(l.length===0)continue;const d=l[0];Math.abs(d.top-o)>i*.5&&(s.push(d),o=d.top)}catch{continue}return s}function Eh(e,t){return t==="pre"||t==="pre-wrap"||t==="break-spaces"?e:t==="pre-line"?e.replace(/[^\S\n]+/g," "):e.replace(/\s+/g," ")}function DD(e,t){switch(t){case"uppercase":return e.toUpperCase();case"lowercase":return e.toLowerCase();case"capitalize":return e.replace(/\b\w/g,n=>n.toUpperCase());default:return e}}function RD(e,t){if(Xe(e,{"font-family":t.fontFamily,"font-size":t.fontSize,"font-weight":t.fontWeight,"font-style":t.fontStyle,fill:t.color}),e.setAttribute("xml:space","preserve"),t.letterSpacing&&t.letterSpacing!=="normal"&&e.setAttribute("letter-spacing",t.letterSpacing),t.wordSpacing&&t.wordSpacing!=="normal"&&e.setAttribute("word-spacing",t.wordSpacing),t.textDecoration&&t.textDecoration!=="none"){const n=[];t.textDecoration.includes("underline")&&n.push("underline"),t.textDecoration.includes("line-through")&&n.push("line-through"),n.length>0&&e.setAttribute("text-decoration",n.join(" "))}}async function Gv(e,t,n){const i=window.getComputedStyle(e);if(fA(i)||zD(e,n))return null;if(n.options.handler)try{const d=n.options.handler(e,n);if(d!==null)return d}catch(d){console.warn("dom2svg: Custom handler threw for element:",e,d)}if(oA(e)&&e!==t){const d=Lv(e,t),c=mD(e,n);return e.tagName.toLowerCase()==="svg"&&(c.setAttribute("x",String(d.x)),c.setAttribute("y",String(d.y)),c.setAttribute("width",String(d.width)),c.setAttribute("height",String(d.height)),i.overflow==="visible"&&c.setAttribute("overflow","visible")),c}const s=await tD(e,t,n),o=iD(s),a=parseFloat(i.opacity);a<1&&s.setAttribute("opacity",String(a));const l=OD(e);for(const d of l)if(Av(d)){const c=await ID(d,t,n);c&&o.appendChild(c)}else if(Su(d)){const c=await Gv(d,t,n);c&&o.appendChild(c)}return await nD(e,t,n,s),s}function OD(e){const t=Array.from(e.childNodes);if(!t.some(c=>Su(c)))return t;const n=[],i=[],s=[],o=[],a=[],l=[];for(const c of t){if(Av(c)){o.push(c);continue}if(!Su(c))continue;const u=window.getComputedStyle(c),p=vA(u),f=mA(u),h=yA(u);f&&p<0?n.push({node:c,z:p}):f&&p>0?l.push({node:c,z:p}):h||f?a.push(c):bA(u)?s.push(c):wA(u)?o.push(c):i.push(c)}n.sort((c,u)=>c.z-u.z),l.sort((c,u)=>c.z-u.z);const d=[];for(const{node:c}of n)d.push(c);for(const c of i)d.push(c);for(const c of s)d.push(c);for(const c of o)d.push(c);for(const c of a)d.push(c);for(const{node:c}of l)d.push(c);return d}function zD(e,t){const n=t.options.exclude;return n?typeof n=="string"?e.matches(n):n(e):!1}async function LD(e,t={}){const n=t.padding??0,i=e.getBoundingClientRect(),s=i.width+n*2,o=i.height+n*2,a=document.implementation.createDocument(Us,"svg",null),l=a.documentElement;l.setAttribute("xmlns",Us),l.setAttributeNS(sA,"xmlns:xlink","http://www.w3.org/1999/xlink"),Xe(l,{width:s,height:o,viewBox:`${-n} ${-n} ${s} ${o}`});const d=Ie(a,"defs");if(l.appendChild(d),t.background){const p=Ie(a,"rect");Xe(p,{x:-n,y:-n,width:s,height:o,fill:t.background}),l.appendChild(p)}const c={svgDocument:a,defs:d,idGenerator:uA(),options:t,opacity:1};t.textToPath&&t.fonts&&(c.fontCache=_D(t.fonts));const u=await Gv(e,e,c);if(u){const p=window.getComputedStyle(e),f=zv(Dv(p),i.width,i.height);if(Rv(p)&&Is(f)){const h=c.idGenerator.next("clip"),g=Ie(a,"clipPath");g.setAttribute("id",h);const y=HD(a,i.width,i.height,f);g.appendChild(y),d.appendChild(g),u.setAttribute("clip-path",`url(#${h})`)}l.appendChild(u)}return d.childNodes.length===0&&l.removeChild(d),FD(l)}function HD(e,t,n,i){if(Gr(i)){const o=Ie(e,"rect");return Xe(o,{x:0,y:0,width:t,height:n,rx:i.topLeft[0],ry:i.topLeft[1]}),o}const s=Ie(e,"path");return s.setAttribute("d",il(0,0,t,n,i)),s}function FD(e){return{svg:e,toString(){return`<?xml version="1.0" encoding="UTF-8"?>
${new XMLSerializer().serializeToString(e)}`},toBlob(){const t=this.toString();return new Blob([t],{type:"image/svg+xml;charset=utf-8"})},download(t="export.svg"){const n=this.toBlob(),i=URL.createObjectURL(n),s=document.createElement("a");s.href=i,s.download=t,s.click(),setTimeout(()=>URL.revokeObjectURL(i),6e4)}}}const BD={background:"transparent",padding:CT},qD=[".svelte-flow__background",".svelte-flow__controls",".svelte-flow__minimap",".svelte-flow__panel",".svelte-flow__edge-interaction",".svelte-flow__attribution",".drop-zone-overlay"].join(", "),$t="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/fonts",VD={KaTeX_Main:[{url:`${$t}/KaTeX_Main-Regular.woff2`,weight:"normal",style:"normal"},{url:`${$t}/KaTeX_Main-Bold.woff2`,weight:"bold",style:"normal"},{url:`${$t}/KaTeX_Main-Italic.woff2`,weight:"normal",style:"italic"},{url:`${$t}/KaTeX_Main-BoldItalic.woff2`,weight:"bold",style:"italic"}],KaTeX_Math:[{url:`${$t}/KaTeX_Math-Italic.woff2`,weight:"normal",style:"italic"},{url:`${$t}/KaTeX_Math-BoldItalic.woff2`,weight:"bold",style:"italic"}],KaTeX_Size1:[{url:`${$t}/KaTeX_Size1-Regular.woff2`,weight:"normal",style:"normal"}],KaTeX_Size2:[{url:`${$t}/KaTeX_Size2-Regular.woff2`,weight:"normal",style:"normal"}],KaTeX_Size3:[{url:`${$t}/KaTeX_Size3-Regular.woff2`,weight:"normal",style:"normal"}],KaTeX_Size4:[{url:`${$t}/KaTeX_Size4-Regular.woff2`,weight:"normal",style:"normal"}],KaTeX_AMS:[{url:`${$t}/KaTeX_AMS-Regular.woff2`,weight:"normal",style:"normal"}],KaTeX_Caligraphic:[{url:`${$t}/KaTeX_Caligraphic-Regular.woff2`,weight:"normal",style:"normal"},{url:`${$t}/KaTeX_Caligraphic-Bold.woff2`,weight:"bold",style:"normal"}],KaTeX_Fraktur:[{url:`${$t}/KaTeX_Fraktur-Regular.woff2`,weight:"normal",style:"normal"},{url:`${$t}/KaTeX_Fraktur-Bold.woff2`,weight:"bold",style:"normal"}],KaTeX_SansSerif:[{url:`${$t}/KaTeX_SansSerif-Regular.woff2`,weight:"normal",style:"normal"},{url:`${$t}/KaTeX_SansSerif-Bold.woff2`,weight:"bold",style:"normal"},{url:`${$t}/KaTeX_SansSerif-Italic.woff2`,weight:"normal",style:"italic"}],KaTeX_Script:[{url:`${$t}/KaTeX_Script-Regular.woff2`,weight:"normal",style:"normal"}],KaTeX_Typewriter:[{url:`${$t}/KaTeX_Typewriter-Regular.woff2`,weight:"normal",style:"normal"}]};function WD(e){const t=e.style.transform,n=t.match(/translate\(([^,]+)px,\s*([^)]+)px\)/),i=t.match(/scale\(([^)]+)\)/);return{panX:n?parseFloat(n[1]):0,panY:n?parseFloat(n[2]):0,zoom:i?parseFloat(i[1]):1}}function KD(e,t){const{panX:n,panY:i,zoom:s}=WD(t),o=e.getBoundingClientRect(),a={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};function l(d){if(d.width===0&&d.height===0)return;const c=(d.left-o.left-n)/s,u=(d.top-o.top-i)/s,p=d.width/s,f=d.height/s;a.minX=Math.min(a.minX,c),a.minY=Math.min(a.minY,u),a.maxX=Math.max(a.maxX,c+p),a.maxY=Math.max(a.maxY,u+f)}for(const d of e.querySelectorAll(".svelte-flow__node"))l(d.getBoundingClientRect());for(const d of e.querySelectorAll(".svelte-flow__edge"))l(d.getBoundingClientRect());return isFinite(a.minX)?a:{minX:0,minY:0,maxX:200,maxY:200}}async function jD(e={}){const t={...BD,...e},n=t.padding,i=document.querySelector(".svelte-flow");if(!i)throw new Error("SvelteFlow element not found");const s=i.querySelector(".svelte-flow__viewport");if(!s)throw new Error("SvelteFlow viewport not found");const o=getComputedStyle(i).getPropertyValue("--surface").trim(),a=KD(i,s),l=a.maxX-a.minX,d=a.maxY-a.minY,c=l+2*n,u=d+2*n,p=i.style.backgroundColor,f=i.style.width,h=i.style.height,g=i.style.minWidth,y=i.style.minHeight,b=i.style.overflow,m=document.createElement("style");m.textContent=`.svelte-flow__viewport { transform: translate(${-a.minX+n}px, ${-a.minY+n}px) scale(1) !important; }`,document.head.appendChild(m),i.style.backgroundColor="transparent",i.style.width=`${c}px`,i.style.height=`${u}px`,i.style.minWidth=`${c}px`,i.style.minHeight=`${u}px`,i.style.overflow="visible",await new Promise(x=>requestAnimationFrame(()=>requestAnimationFrame(x)));try{const x=await LD(i,{background:t.background==="solid"?o:void 0,padding:0,exclude:qD,flattenTransforms:!0,textToPath:!0,fonts:VD});return x.svg.setAttribute("width",String(c)),x.svg.setAttribute("height",String(u)),x.svg.setAttribute("viewBox",`0 0 ${c} ${u}`),x.toString()}finally{m.remove(),i.style.backgroundColor=p,i.style.width=f,i.style.height=h,i.style.minWidth=g,i.style.minHeight=y,i.style.overflow=b}}const tn={label:"",action:()=>{},divider:!0};function Gd(e,t){const n=de(ff),{inputs:i,outputs:s}=NT(t,n),o=t.inputs&&t.inputs.length>0,a=t.outputs&&t.outputs.length>0;if(!o&&!a)return[];const l=[tn];return o&&l.push({label:i?"Hide Input Labels":"Show Input Labels",icon:"tag",action:()=>De.mutate(()=>ee.updateNodeParams(e,{_showInputLabels:!i}))}),a&&l.push({label:s?"Hide Output Labels":"Show Output Labels",icon:"tag",action:()=>De.mutate(()=>ee.updateNodeParams(e,{_showOutputLabels:!s}))}),l}function Ud(e){const t=ee.getNode(e);if(!t)return;const n=ee.getAllNodes(),i=ee.getAllConnections().map(l=>l.connection),s=Fn.getCode(),o=kv(t,s),a=If(t,n,i);Ic.open(o+a,"Block Python Code")}function XD(e){const t=pt.getEvent(e);if(!t)return;const n=Fn.getCode(),i=Sv(t,n),s=yv(t);Ic.open(i+s,"Event Python Code")}function GD(e){const t=ee.getNode(e);if(!t)return[];const n=t.type===yt.SUBSYSTEM;if(t.type===yt.INTERFACE){const l=[{label:"Properties",icon:"settings",shortcut:"Dbl-click",action:()=>Ul(e)},{label:"Exit Subsystem",icon:"exit",action:()=>ee.drillUp()}];return l.push(...Gd(e,t)),l.push(tn,{label:"View Code",icon:"braces",action:()=>Ud(e)}),l}if(n){const l=[{label:"Properties",icon:"settings",action:()=>Ul(e)},{label:"Enter Subsystem",icon:"enter",shortcut:"Dbl-click",action:()=>ee.drillDown(e)}];return l.push(...Gd(e,t)),l.push(tn,{label:"View Code",icon:"braces",action:()=>Ud(e)},{label:"Export",icon:"upload",action:()=>xu("subsystem",e)},tn,{label:"Duplicate",icon:"copy",shortcut:"Ctrl+D",action:()=>{ee.selectNode(e,!1),ee.duplicateSelected()}},{label:"Copy",icon:"clipboard",shortcut:"Ctrl+C",action:()=>{ee.selectNode(e,!1),Si.copy()}},tn,{label:"Delete",icon:"trash",shortcut:"Del",action:()=>De.mutate(()=>ee.removeNode(e))}),l}const s=t.type==="Scope"||t.type==="Spectrum",o=t.type==="Scope"?"scope":"spectrum",a=[{label:"Properties",icon:"settings",shortcut:"Dbl-click",action:()=>Ul(e)}];if(a.push(...Gd(e,t)),a.push(tn,{label:"View Code",icon:"braces",action:()=>Ud(e)}),s){const l=Tv(e,o);a.push({label:"Export CSV",icon:"table",action:()=>Pf(e,t.name,t.type),disabled:!l})}return a.push({label:"Export",icon:"upload",action:()=>xu("block",e)},tn,{label:"Duplicate",icon:"copy",shortcut:"Ctrl+D",action:()=>{ee.selectNode(e,!1),De.mutate(()=>ee.duplicateSelected())}},{label:"Copy",icon:"clipboard",shortcut:"Ctrl+C",action:()=>{ee.selectNode(e,!1),Si.copy()}},tn,{label:"Delete",icon:"trash",shortcut:"Del",action:()=>De.mutate(()=>ee.removeNode(e))}),a}function UD(e,t){const n=e.length;return[{label:`Duplicate ${n} nodes`,icon:"copy",shortcut:"Ctrl+D",action:()=>De.mutate(()=>ee.duplicateSelected())},{label:`Copy ${n} nodes`,icon:"clipboard",shortcut:"Ctrl+C",action:()=>Si.copy()},tn,{label:`Delete ${n} nodes`,icon:"trash",shortcut:"Del",action:()=>t(e)}]}function YD(e){return[{label:"Properties",icon:"settings",shortcut:"Dbl-click",action:()=>Xm(e)},tn,{label:"View Code",icon:"braces",action:()=>XD(e)},tn,{label:"Duplicate",icon:"copy",shortcut:"Ctrl+D",action:()=>{pt.selectEvent(e,!1),De.mutate(()=>pt.duplicateSelected())}},{label:"Copy",icon:"clipboard",shortcut:"Ctrl+C",action:()=>{pt.selectEvent(e,!1),Si.copy()}},tn,{label:"Delete",icon:"trash",shortcut:"Del",action:()=>De.mutate(()=>pt.removeEvent(e))}]}function ZD(e){return[{label:"Reset Route",icon:"rotate",action:()=>Wt.resetRoute(e)},tn,{label:"Delete",icon:"trash",shortcut:"Del",action:()=>De.mutate(()=>ee.removeConnection(e))}]}function JD(e,t){const n=Si.hasContent(),i=[{label:"Add Block",icon:"grid",shortcut:"B",action:()=>t.toggleNodeLibrary()},{label:"Add Event",icon:"zap",shortcut:"N",action:()=>t.toggleEventsPanel()},{label:"Add Annotation",icon:"type",action:()=>{const s=xi(e);De.mutate(()=>ee.addAnnotation(s))}},tn,{label:"Open/Import",icon:"download",action:()=>{const s=xi(e);pv(s)}},{label:"Export SVG",icon:"image",action:async()=>{try{const s=await jD();wP(s,"pathview-graph.svg")}catch(s){console.error("SVG export failed:",s)}}}];return n&&i.push(tn,{label:"Paste",icon:"clipboard",shortcut:"Ctrl+V",action:()=>{const s=xi(e);Si.paste(s)}}),i.push(tn,{label:"Fit View",icon:"maximize",shortcut:"F",action:()=>Qi()}),i}function QD(e){const n=ee.getAnnotation(e)?.fontSize||_n.DEFAULT;return[{label:"Edit",icon:"type",shortcut:"Dbl-click",action:()=>bC(e)},tn,{label:"Increase Font Size",icon:"font-size-increase",action:()=>{n<_n.MAX&&De.mutate(()=>ee.updateAnnotation(e,{fontSize:n+_n.STEP}))},disabled:n>=_n.MAX},{label:"Decrease Font Size",icon:"font-size-decrease",action:()=>{n>_n.MIN&&De.mutate(()=>ee.updateAnnotation(e,{fontSize:n-_n.STEP}))},disabled:n<=_n.MIN},tn,{label:"Duplicate",icon:"copy",shortcut:"Ctrl+D",action:()=>{ee.selectNode(e,!1),De.mutate(()=>ee.duplicateSelected())}},{label:"Copy",icon:"clipboard",shortcut:"Ctrl+C",action:()=>{ee.selectNode(e,!1),Si.copy()}},tn,{label:"Delete",icon:"trash",shortcut:"Del",action:()=>De.mutate(()=>ee.removeAnnotation(e))}]}function $D(e,t){const n=ee.getNode(e),i=n?.name||"Plot",s=n?.type||"Scope",a=Tv(e,s==="Spectrum"?"spectrum":"scope"),c=(de(vn).blocks[e]??xc).showLegend;return[{label:"Export CSV",icon:"table",action:()=>Pf(e,i,s),disabled:!a},tn,{label:c?"Hide Legend":"Show Legend",icon:"list",action:()=>vn.setBlockShowLegend(e,!c)},{label:"Reset View",icon:"maximize",shortcut:"Dbl-click",action:async()=>{(await oi(()=>import("../chunks/Dg9q6Q-0.js").then(p=>p.p),[],import.meta.url)).relayout(t,{"xaxis.autorange":!0,"yaxis.autorange":!0})}}]}function eR(e,t,n){if(!e)return[];switch(e.type){case"node":return GD(e.nodeId);case"selection":return UD([...e.nodeIds],n.deleteNodes);case"event":return YD(e.eventId);case"edge":return ZD(e.edgeId);case"canvas":return JD(t,n);case"annotation":return QD(e.annotationId);case"plot":return $D(e.nodeId,e.plotEl);default:return[]}}var tR=Z('<div class="loading svelte-u0xts8">Loading syntax highlighting...</div>'),nR=Z('<div class="dialog-backdrop" role="presentation"><div class="dialog glass-panel svelte-u0xts8" role="dialog" tabindex="-1" aria-labelledby="dialog-title"><div class="dialog-header"><span id="dialog-title">Export Python Code</span> <div class="header-actions svelte-u0xts8"><button aria-label="Copy to Clipboard"><!></button> <button class="icon-btn" aria-label="Download Python file"><!></button> <button class="icon-btn" aria-label="Close"><!></button></div></div> <div class="dialog-body svelte-u0xts8"><div class="code-preview svelte-u0xts8"><!></div></div></div></div>');function iR(e,t){Oe(t,!0);let n=_e(t,"open",3,!1),i=$(void 0),s=null,o=null,a=$(!0),l=$("dark");const d=es.subscribe(k=>{E(l,k,!0),s&&o&&r(i)&&h()});let c=$(""),u=$(!1);ut(()=>{n()?(E(c,y(),!0),E(u,!1),E(a,!0),setTimeout(()=>g(),0)):f()});function p(){return o?nl(o,r(l)==="dark",{readOnly:!0}):[]}function f(){s&&(s.destroy(),s=null)}function h(){if(!s||!r(i)||!o)return;const k=s.state.doc.toString();s.destroy(),s=new o.EditorView({doc:k,extensions:p(),parent:r(i)})}async function g(){r(i)&&(f(),o=await td(),s=new o.EditorView({doc:r(c),extensions:p(),parent:r(i)}),E(a,!1))}function y(){const{nodes:k,connections:N}=ee.toJSON(),L=Pn.get(),X=Fn.getCode(),O=pt.toJSON();return f3(k,N,L,X,O)}function b(){navigator.clipboard.writeText(r(c)),E(u,!0),setTimeout(()=>E(u,!1),2e3)}function m(){_P(r(c),"pathview_simulation.py")}function x(k){k.target===k.currentTarget&&t.onClose()}function S(k){k.key==="Escape"&&t.onClose()}jt(()=>{d(),f()});var v=pe();ht("keydown",Ot,S);var A=ae(v);{var w=k=>{var N=nR();N.__click=x;var L=M(N),X=M(L),O=q(M(X),2),I=M(O);let H;I.__click=b;var P=M(I);{var T=me=>{He(me,{name:"check",size:16})},R=me=>{He(me,{name:"copy",size:16})};j(P,me=>{r(u)?me(T):me(R,!1)})}C(I),Ee(I,(me,ge)=>Ue?.(me,ge),()=>r(u)?"Copied!":"Copy to Clipboard");var B=q(I,2);B.__click=m;var V=M(B);He(V,{name:"download",size:16}),C(B),Ee(B,(me,ge)=>Ue?.(me,ge),()=>"Download .py");var F=q(B,2);F.__click=function(...me){t.onClose?.apply(this,me)};var Y=M(F);He(Y,{name:"x",size:16}),C(F),Ee(F,(me,ge)=>Ue?.(me,ge),()=>({text:"Close",shortcut:"Esc"})),C(O),C(X);var J=q(X,2),ie=M(J),ve=M(ie);{var re=me=>{var ge=tR();_(me,ge)};j(ve,me=>{r(a)&&me(re)})}C(ie),Jt(ie,me=>E(i,me),()=>r(i)),C(J),C(L),C(N),G(()=>H=qe(I,1,"icon-btn",null,H,{success:r(u)})),St(3,L,()=>Ei,()=>({start:.95,duration:150,easing:di})),St(3,N,()=>mn,()=>({duration:150})),_(k,N)};j(A,k=>{n()&&k(w)})}_(e,v),ze()}Mt(["click"]);var sR=Z('<span class="separator svelte-idx2ha">+</span>'),oR=Z('<kbd class="svelte-idx2ha"> </kbd><!>',1),aR=Z('<div class="shortcut-row svelte-idx2ha"><span class="keys svelte-idx2ha"></span> <span class="label svelte-idx2ha"> </span></div>'),rR=Z('<div class="section svelte-idx2ha"><div class="section-header svelte-idx2ha"> </div> <div class="section-items svelte-idx2ha"></div></div>'),lR=Z('<div class="dialog-backdrop" role="presentation"><div class="dialog glass-panel svelte-idx2ha" role="dialog" tabindex="-1" aria-modal="true" aria-labelledby="shortcuts-title"><div class="dialog-header"><span id="shortcuts-title">Keyboard Shortcuts</span> <button class="icon-btn ghost" aria-label="Close"><!></button></div> <div class="dialog-body svelte-idx2ha"></div> <div class="dialog-footer svelte-idx2ha">Press <kbd class="svelte-idx2ha">?</kbd> to toggle</div></div></div>');function cR(e,t){Oe(t,!0);function n(l){l.key==="Escape"&&t.onClose()}const i=[{category:"File",items:[{keys:["Ctrl","O"],description:"Open"},{keys:["Ctrl","S"],description:"Save"},{keys:["Ctrl","Shift","S"],description:"Save as"},{keys:["Ctrl","E"],description:"Export Python"}]},{category:"Edit",items:[{keys:["Ctrl","Z"],description:"Undo"},{keys:["Ctrl","Y"],description:"Redo"},{keys:["Ctrl","A"],description:"Select all"},{keys:["Ctrl","X"],description:"Cut"},{keys:["Ctrl","C"],description:"Copy"},{keys:["Ctrl","V"],description:"Paste"},{keys:["Ctrl","D"],description:"Duplicate"},{keys:["Del"],description:"Delete"},{keys:["Ctrl","F"],description:"Find"},{keys:["Esc"],description:"Deselect"}]},{category:"Transform",items:[{keys:["R"],description:"Rotate 90Â°"},{keys:["X"],description:"Flip H"},{keys:["Y"],description:"Flip V"},{keys:["Arrows"],description:"Nudge"},{keys:["Shift","Arrows"],description:"Nudge 10px"}]},{category:"View",items:[{keys:["F"],description:"Fit view"},{keys:["H"],description:"Go to root"},{keys:["+"],description:"Zoom in"},{keys:["-"],description:"Zoom out"},{keys:["L"],description:"Port labels"},{keys:["T"],description:"Theme"}]},{category:"Panels",items:[{keys:["S"],description:"Simulation"},{keys:["B"],description:"Blocks"},{keys:["N"],description:"Events"},{keys:["E"],description:"Editor"},{keys:["V"],description:"Results"},{keys:["C"],description:"Console"},{keys:["P"],description:"Pin plots"}]},{category:"Run",items:[{keys:["Ctrl","Enter"],description:"Simulate"},{keys:["Shift","Enter"],description:"Continue"},{keys:["?"],description:"Shortcuts"}]}];var s=pe();ht("keydown",Ot,n);var o=ae(s);{var a=l=>{var d=lR();d.__click=function(...g){t.onClose?.apply(this,g)};var c=M(d);c.__click=g=>g.stopPropagation();var u=M(c),p=q(M(u),2);p.__click=function(...g){t.onClose?.apply(this,g)};var f=M(p);He(f,{name:"x",size:16}),C(p),C(u);var h=q(u,2);it(h,21,()=>i,_t,(g,y)=>{var b=rR(),m=M(b),x=M(m,!0);C(m);var S=q(m,2);it(S,21,()=>r(y).items,_t,(v,A)=>{var w=aR(),k=M(w);it(k,21,()=>r(A).keys,_t,(X,O,I)=>{var H=oR(),P=ae(H),T=M(P,!0);C(P);var R=q(P);{var B=V=>{var F=sR();_(V,F)};j(R,V=>{I<r(A).keys.length-1&&V(B)})}G(()=>Fe(T,r(O))),_(X,H)}),C(k);var N=q(k,2),L=M(N,!0);C(N),C(w),G(()=>Fe(L,r(A).description)),_(v,w)}),C(S),C(b),G(()=>Fe(x,r(y).category)),_(g,b)}),C(h),Kt(2),C(c),C(d),St(3,c,()=>Ei,()=>({start:.95,duration:150,easing:di})),St(3,d,()=>mn,()=>({duration:150})),_(l,d)};j(o,l=>{t.open&&l(a)})}_(e,s),ze()}Mt(["click"]);var dR=Z('<div class="empty-state svelte-1ijrao5"><p>Run simulation to see trace options</p></div>'),uR=ye('<line x1="2" y1="8" x2="30" y2="8" stroke-width="2"></line>'),fR=ye('<circle cx="16" cy="8" r="3"></circle>'),pR=ye('<rect x="13" y="5" width="6" height="6"></rect>'),hR=ye('<polygon points="16,3 20,11 12,11"></polygon>'),gR=ye('<line x1="2" y1="8" x2="30" y2="8" stroke="var(--text-disabled)" stroke-width="1" stroke-dasharray="2,2"></line>'),mR=Z('<button><svg width="20" height="10" viewBox="0 0 20 10"><line x1="2" y1="5" x2="18" y2="5" stroke="currentColor" stroke-width="2"></line></svg></button>'),vR=ye('<circle cx="7" cy="7" r="4" fill="currentColor"></circle>'),yR=ye('<rect x="3" y="3" width="8" height="8" fill="currentColor"></rect>'),bR=ye('<polygon points="7,2 12,11 2,11" fill="currentColor"></polygon>'),wR=Z('<button><svg width="10" height="10" viewBox="0 0 14 14"><!></svg></button>'),_R=Z('<div class="trace-row svelte-1ijrao5"><div class="col-preview svelte-1ijrao5"><svg width="32" height="16" viewBox="0 0 32 16"><!><!><!></svg></div> <div class="col-name svelte-1ijrao5"><span class="signal-label svelte-1ijrao5"> </span></div> <div class="col-line svelte-1ijrao5"></div> <div></div> <div class="col-marker svelte-1ijrao5"></div></div>'),xR=Z('<div class="block-card svelte-1ijrao5"><div class="block-header svelte-1ijrao5"><div class="block-title svelte-1ijrao5"><!> <span> </span></div> <div class="block-controls svelte-1ijrao5"><button title="Show legend">Legend</button> <button> </button> <button> </button></div></div> <div class="traces-table svelte-1ijrao5"><div class="table-header svelte-1ijrao5"><div class="col-preview svelte-1ijrao5">Preview</div> <div class="col-name svelte-1ijrao5"></div> <div class="col-line svelte-1ijrao5">Line</div> <div></div> <div class="col-marker svelte-1ijrao5">Marker</div></div> <!></div></div>'),kR=Z('<div class="dialog-backdrop" role="presentation"><div class="dialog glass-panel svelte-1ijrao5" role="dialog" tabindex="-1" aria-modal="true" aria-labelledby="plot-options-title"><div class="dialog-header"><span id="plot-options-title">Plot Options</span> <button class="icon-btn ghost" aria-label="Close"><!></button></div> <div class="dialog-body svelte-1ijrao5"><!></div></div></div>');function SR(e,t){Oe(t,!0);let n=_e(t,"traces",19,()=>[]),i=$(Et({traces:{},blocks:{}}));const s=vn.subscribe(v=>{E(i,v,!0)});jt(()=>{s()});function o(v){v.key==="Escape"&&t.onClose()}function a(v){return r(i).traces[v]??{...mu}}function l(v){return r(i).blocks[v]??{...xc}}const d=[{value:"solid",label:"Solid"},{value:"dash",label:"Dash"},{value:"dot",label:"Dot"}],c=[{value:"circle",label:"Circle"},{value:"square",label:"Square"},{value:"triangle-up",label:"Triangle"}];function u(v,A){a(v).lineStyle===A?vn.setTraceLineStyle(v,null):vn.setTraceLineStyle(v,A)}function p(v,A){a(v).markerStyle===A?vn.setTraceMarkerStyle(v,null):vn.setTraceMarkerStyle(v,A)}function f(v){const A=l(v);vn.setBlockXAxisScale(v,A.xAxisScale==="linear"?"log":"linear")}function h(v){const A=l(v);vn.setBlockYAxisScale(v,A.yAxisScale==="linear"?"log":"linear")}function g(v){const A=l(v);vn.setBlockShowLegend(v,!A.showLegend)}const y=D(()=>()=>{const v=new Map;for(const A of n()){const w=A.nodeId;v.has(w)||v.set(w,[]),v.get(w).push(A)}return v});function b(v){return v?qm[v]:""}var m=pe();ht("keydown",Ot,o);var x=ae(m);{var S=v=>{var A=kR();A.__click=function(...P){t.onClose?.apply(this,P)};var w=M(A);w.__click=P=>P.stopPropagation();var k=M(w),N=q(M(k),2);N.__click=function(...P){t.onClose?.apply(this,P)};var L=M(N);He(L,{name:"x",size:16}),C(N),C(k);var X=q(k,2),O=M(X);{var I=P=>{var T=dR();_(P,T)},H=P=>{var T=pe(),R=ae(T);it(R,17,()=>[...r(y)()],_t,(B,V)=>{var F=D(()=>Zs(r(V),2));let Y=()=>r(F)[0],J=()=>r(F)[1];const ie=D(()=>J()[0]),ve=D(()=>l(Y()));var re=xR(),me=M(re),ge=M(me),Q=M(ge);{let Me=D(()=>r(ie).nodeType==="scope"?"activity":"bar-chart-2");He(Q,{get name(){return r(Me)},size:14})}var oe=q(Q,2),ue=M(oe,!0);C(oe),C(ge);var le=q(ge,2),te=M(le);let be;te.__click=()=>g(Y());var fe=q(te,2);let Pe;fe.__click=()=>f(Y());var Re=M(fe);C(fe);var Se=q(fe,2);let Ce;Se.__click=()=>h(Y());var ke=M(Se);C(Se),C(le),C(me);var Ne=q(me,2),$e=q(M(Ne),2);it($e,17,J,_t,(Me,Ae,xt,It)=>{const U=D(()=>vu(r(Ae).nodeId,r(Ae).signalIndex)),we=D(()=>a(r(U))),W=D(()=>Fm(r(Ae).signalIndex,Bm()));var se=_R(),he=M(se),Be=M(he),Ye=M(Be);{var je=kt=>{var gt=uR();G(At=>{z(gt,"stroke",r(W)),z(gt,"stroke-dasharray",At)},[()=>b(r(we).lineStyle)]),_(kt,gt)};j(Ye,kt=>{r(we).lineStyle&&kt(je)})}var rt=q(Ye);{var Lt=kt=>{var gt=pe(),At=ae(gt);{var gn=Xt=>{var Cn=fR();G(()=>z(Cn,"fill",r(W))),_(Xt,Cn)},on=Xt=>{var Cn=pe(),zn=ae(Cn);{var En=Gt=>{var cn=pR();G(()=>z(cn,"fill",r(W))),_(Gt,cn)},ln=Gt=>{var cn=pe(),Ii=ae(cn);{var ce=xe=>{var Ve=hR();G(()=>z(Ve,"fill",r(W))),_(xe,Ve)};j(Ii,xe=>{r(we).markerStyle==="triangle-up"&&xe(ce)},!0)}_(Gt,cn)};j(zn,Gt=>{r(we).markerStyle==="square"?Gt(En):Gt(ln,!1)},!0)}_(Xt,Cn)};j(At,Xt=>{r(we).markerStyle==="circle"?Xt(gn):Xt(on,!1)})}_(kt,gt)};j(rt,kt=>{r(we).markerStyle&&kt(Lt)})}var Le=q(rt);{var st=kt=>{var gt=gR();_(kt,gt)};j(Le,kt=>{!r(we).lineStyle&&!r(we).markerStyle&&kt(st)})}C(Be),C(he);var at=q(he,2),Je=M(at),Ze=M(Je,!0);C(Je),C(at);var bt=q(at,2);it(bt,21,()=>d,_t,(kt,gt)=>{var At=mR();let gn;At.__click=()=>u(r(U),r(gt).value);var on=M(At),Xt=M(on);C(on),C(At),G(Cn=>{gn=qe(At,1,"style-pill svelte-1ijrao5",null,gn,{active:r(we).lineStyle===r(gt).value}),z(At,"title",r(gt).label),z(Xt,"stroke-dasharray",Cn)},[()=>b(r(gt).value)]),_(kt,At)}),C(bt);var vt=q(bt,4);it(vt,21,()=>c,_t,(kt,gt)=>{var At=wR();let gn;At.__click=()=>p(r(U),r(gt).value);var on=M(At),Xt=M(on);{var Cn=En=>{var ln=vR();_(En,ln)},zn=En=>{var ln=pe(),Gt=ae(ln);{var cn=ce=>{var xe=yR();_(ce,xe)},Ii=ce=>{var xe=pe(),Ve=ae(xe);{var lt=et=>{var tt=bR();_(et,tt)};j(Ve,et=>{r(gt).value==="triangle-up"&&et(lt)},!0)}_(ce,xe)};j(Gt,ce=>{r(gt).value==="square"?ce(cn):ce(Ii,!1)},!0)}_(En,ln)};j(Xt,En=>{r(gt).value==="circle"?En(Cn):En(zn,!1)})}C(on),C(At),G(()=>{gn=qe(At,1,"style-pill marker-pill svelte-1ijrao5",null,gn,{active:r(we).markerStyle===r(gt).value}),z(At,"title",r(gt).label)}),_(kt,At)}),C(vt),C(se),G(()=>Fe(Ze,r(Ae).signalLabel)),_(Me,se)}),C(Ne),C(re),G(()=>{Fe(ue,r(ie).nodeName),be=qe(te,1,"scale-btn svelte-1ijrao5",null,be,{active:r(ve).showLegend}),Pe=qe(fe,1,"scale-btn svelte-1ijrao5",null,Pe,{log:r(ve).xAxisScale==="log"}),z(fe,"title",`X-Axis: ${r(ve).xAxisScale??""}`),Fe(Re,`X:${r(ve).xAxisScale==="log"?"log":"lin"}`),Ce=qe(Se,1,"scale-btn svelte-1ijrao5",null,Ce,{log:r(ve).yAxisScale==="log"}),z(Se,"title",`Y-Axis: ${r(ve).yAxisScale??""}`),Fe(ke,`Y:${r(ve).yAxisScale==="log"?"log":"lin"}`)}),_(B,re)}),_(P,T)};j(O,P=>{n().length===0?P(I):P(H,!1)})}C(X),C(w),C(A),St(3,w,()=>Ei,()=>({start:.95,duration:150,easing:di})),St(3,A,()=>mn,()=>({duration:150})),_(v,A)};j(x,v=>{t.open&&v(S)})}_(e,m),ze()}Mt(["click"]);var CR=Z('<button class="clear-btn svelte-g23ysy"><!></button>'),ER=Z('<button><div class="result-main svelte-g23ysy"><span class="node-name svelte-g23ysy"> </span> <span class="node-type svelte-g23ysy"> </span></div> <div class="result-path svelte-g23ysy"> </div></button>'),TR=Z('<div class="results svelte-g23ysy"></div>'),IR=Z('<div class="no-results svelte-g23ysy">No blocks found</div>'),NR=Z('<div class="dialog-backdrop" role="presentation"><div class="search-dialog glass-panel svelte-g23ysy" role="dialog" tabindex="-1" aria-modal="true"><div class="search-container svelte-g23ysy"><span class="search-icon svelte-g23ysy"><!></span> <input type="text" placeholder="Find block..." class="search-input svelte-g23ysy"/> <!></div> <!> <div class="footer svelte-g23ysy"><span><kbd class="svelte-g23ysy">â</kbd><kbd class="svelte-g23ysy">â</kbd> navigate</span> <span><kbd class="svelte-g23ysy">âµ</kbd> select</span> <span><kbd class="svelte-g23ysy">esc</kbd> close</span></div></div></div>');function PR(e,t){Oe(t,!0);let n=$(""),i=$(void 0),s=$(0),o=$(Et([])),a=$(Et([]));const l=ee.currentPath.subscribe(b=>{E(a,b,!0)});jt(()=>{l()}),ut(()=>{t.open&&E(o,ee.getAllNodesWithPaths(),!0)});function d(b){return b.path.length!==r(a).length?!1:b.path.every((m,x)=>m===r(a)[x])}const c=D(()=>()=>{let b=r(o);if(r(n).trim()){const m=r(n).toLowerCase();b=b.filter(x=>x.node.name.toLowerCase().includes(m)||x.node.type.toLowerCase().includes(m))}return[...b].sort((m,x)=>{const S=d(m),v=d(x);return S&&!v?-1:!S&&v?1:m.depth-x.depth})});ut(()=>{t.open&&(E(n,""),E(s,0),setTimeout(()=>r(i)?.focus(),50))}),ut(()=>{const b=r(c)();r(s)>=b.length&&E(s,Math.max(0,b.length-1),!0)});function u(b){if(!t.open)return;const m=r(c)();if(b.key==="Escape")t.onClose();else if(b.key==="ArrowDown")b.preventDefault(),E(s,Math.min(r(s)+1,m.length-1),!0);else if(b.key==="ArrowUp")b.preventDefault(),E(s,Math.max(r(s)-1,0),!0);else if(b.key==="Enter"){b.preventDefault();const x=m[r(s)];x&&p(x)}}function p(b){const m=b.path,x=ee.getCurrentPath();m.length===x.length&&m.every((v,A)=>v===x[A])||ee.navigateToPath(m),ee.selectNode(b.node.id,!1),vC(b.node.id),t.onClose()}function f(b){return b.join(" > ")}var h=pe();ht("keydown",Ot,u);var g=ae(h);{var y=b=>{var m=NR();m.__click=function(...I){t.onClose?.apply(this,I)},m.__keydown=I=>I.key==="Escape"&&t.onClose();var x=M(m);x.__click=I=>I.stopPropagation();var S=M(x),v=M(S),A=M(v);He(A,{name:"search",size:14}),C(v);var w=q(v,2);xn(w),Jt(w,I=>E(i,I),()=>r(i));var k=q(w,2);{var N=I=>{var H=CR();H.__click=()=>E(n,"");var P=M(H);He(P,{name:"x",size:12}),C(H),_(I,H)};j(k,I=>{r(n)&&I(N)})}C(S);var L=q(S,2);{var X=I=>{var H=TR();it(H,21,()=>r(c)(),_t,(P,T,R)=>{var B=ER();let V;B.__click=()=>p(r(T));var F=M(B),Y=M(F),J=M(Y,!0);C(Y);var ie=q(Y,2),ve=M(ie,!0);C(ie),C(F);var re=q(F,2),me=M(re,!0);C(re),C(B),G(ge=>{V=qe(B,1,"result-item svelte-g23ysy",null,V,{selected:R===r(s)}),Fe(J,r(T).node.name),Fe(ve,r(T).node.type),Fe(me,ge)},[()=>f(r(T).pathNames)]),ht("mouseenter",B,()=>E(s,R,!0)),_(P,B)}),C(H),_(I,H)},O=I=>{var H=pe(),P=ae(H);{var T=R=>{var B=IR();_(R,B)};j(P,R=>{r(n)&&R(T)},!0)}_(I,H)};j(L,I=>{r(c)().length>0?I(X):I(O,!1)})}Kt(2),C(x),C(m),Uh(w,()=>r(n),I=>E(n,I)),St(3,x,()=>Ei,()=>({start:.95,duration:150,easing:di})),St(3,m,()=>mn,()=>({duration:100})),_(b,m)};j(g,b=>{t.open&&b(y)})}_(e,h),ze()}Mt(["click","keydown"]);const ks=12,Th=52,Vi=300,Uv=68;var MR=Z('<div class="resize-handle handle-left svelte-1xkowuz"></div>'),AR=Z('<div class="resize-handle handle-right svelte-1xkowuz"></div>'),DR=Z('<div class="resize-handle handle-top svelte-1xkowuz"></div>'),RR=Z('<div class="resize-handle handle-bottom svelte-1xkowuz"></div>'),OR=Z("<span> </span>"),zR=Z('<div class="panel-toolbar svelte-1xkowuz"><!></div>'),LR=Z('<div class="panel-footer svelte-1xkowuz"><!></div>'),HR=Z('<aside><!> <!> <!> <!> <div class="panel-header svelte-1xkowuz"><!> <div class="header-actions svelte-1xkowuz"><!> <button class="icon-btn ghost" aria-label="Close"><!></button></div></div> <!> <div class="panel-content svelte-1xkowuz"><!></div> <!></aside>');function Ma(e,t){Oe(t,!0);let n=_e(t,"initialWidth",3,320),i=_e(t,"initialHeight",3,280),s=_e(t,"minWidth",3,200),o=_e(t,"minHeight",3,150),a=_e(t,"maxWidth",3,800),l=_e(t,"bottomOffset",3,0),d=_e(t,"currentHeight",15,280);function c(){return t.maxHeight!==void 0?t.maxHeight:t.position.includes("bottom")?window.innerHeight-Uv-ks*2:600}let u=$(Et(Qn(()=>n()))),p=$(Et(Qn(()=>i())));function f(){return t.width??r(u)}function h(le){t.onWidthChange?t.onWidthChange(le):E(u,le,!0)}ut(()=>{d(r(p))});let g=$(!1),y=$(null);const b=D(()=>t.position==="left"||t.position==="right"?`max-height: calc(100vh - 80px${l()>0?` - ${l()}px`:""});`:""),m=D(()=>()=>{switch(t.position){case"left":return{right:!0,bottom:!0};case"right":return{left:!0,bottom:!0};case"bottom":return{top:!0};case"bottom-left":return{top:!0,right:!0};case"bottom-right":return{top:!0,left:!0};default:return{}}}),x=D(()=>()=>{switch(t.position){case"left":return{x:-20};case"right":return{x:20};case"bottom":case"bottom-left":case"bottom-right":return{y:20};default:return{x:0}}});let S=null;function v(le){return te=>{te.preventDefault(),E(g,!0),E(y,le,!0);const be=te.clientX,fe=te.clientY,Pe=f(),Re=r(p);function Se(Ne){if(!r(g))return;const $e=Ne.clientX-be,Me=Ne.clientY-fe;if(r(y)==="right"){const Ae=Math.max(s(),Pe+$e);h(t.onWidthChange?Ae:Math.min(a(),Ae))}else if(r(y)==="left"){const Ae=Math.max(s(),Pe-$e);h(t.onWidthChange?Ae:Math.min(a(),Ae))}else r(y)==="bottom"?E(p,Math.min(c(),Math.max(o(),Re+Me)),!0):r(y)==="top"&&E(p,Math.min(c(),Math.max(o(),Re-Me)),!0)}function Ce(){document.removeEventListener("mousemove",Se),document.removeEventListener("mouseup",ke),document.body.classList.remove("resizing-ew","resizing-ns"),S=null}function ke(){E(g,!1),E(y,null),Ce()}S=Ce,document.addEventListener("mousemove",Se),document.addEventListener("mouseup",ke),document.body.classList.add(le==="left"||le==="right"?"resizing-ew":"resizing-ns")}}jt(()=>{S?.()});var A=HR();let w;A.__mousedown=()=>ee.clearSelection();var k=M(A);{var N=le=>{var te=MR(),be=D(()=>v("left"));te.__mousedown=function(...fe){r(be)?.apply(this,fe)},_(le,te)};j(k,le=>{r(m)().left&&le(N)})}var L=q(k,2);{var X=le=>{var te=AR(),be=D(()=>v("right"));te.__mousedown=function(...fe){r(be)?.apply(this,fe)},_(le,te)};j(L,le=>{r(m)().right&&le(X)})}var O=q(L,2);{var I=le=>{var te=DR(),be=D(()=>v("top"));te.__mousedown=function(...fe){r(be)?.apply(this,fe)},_(le,te)};j(O,le=>{r(m)().top&&le(I)})}var H=q(O,2);{var P=le=>{var te=RR(),be=D(()=>v("bottom"));te.__mousedown=function(...fe){r(be)?.apply(this,fe)},_(le,te)};j(H,le=>{r(m)().bottom&&le(P)})}var T=q(H,2),R=M(T);{var B=le=>{var te=pe(),be=ae(te);Dn(be,()=>t.header),_(le,te)},V=le=>{var te=OR(),be=M(te,!0);C(te),G(()=>Fe(be,t.title)),_(le,te)};j(R,le=>{t.header?le(B):le(V,!1)})}var F=q(R,2),Y=M(F);{var J=le=>{var te=pe(),be=ae(te);Dn(be,()=>t.actions),_(le,te)};j(Y,le=>{t.actions&&le(J)})}var ie=q(Y,2);ie.__click=function(...le){t.onClose?.apply(this,le)};var ve=M(ie);He(ve,{name:"x",size:16}),C(ie),C(F),C(T);var re=q(T,2);{var me=le=>{var te=zR(),be=M(te);Dn(be,()=>t.toolbar),C(te),_(le,te)};j(re,le=>{t.toolbar&&le(me)})}var ge=q(re,2),Q=M(ge);Dn(Q,()=>t.children??Zn),C(ge);var oe=q(ge,2);{var ue=le=>{var te=LR(),be=M(te);Dn(be,()=>t.footer),C(te),_(le,te)};j(oe,le=>{t.footer&&le(ue)})}C(A),G((le,te,be)=>{w=qe(A,1,`resizable-panel glass-panel ${t.position??""}`,"svelte-1xkowuz",w,{resizing:r(g)}),wt(A,`
		${le??""}
		${te??""}
		${be??""}
		${r(b)??""}
	`)},[()=>t.position==="left"||t.position==="right"?`width: ${f()}px;`:"",()=>(t.position==="bottom-left"||t.position==="bottom-right")&&t.width!==void 0?`width: ${f()}px;`:"",()=>t.position.includes("bottom")?`height: ${r(p)}px;`:""]),St(3,A,()=>Hu,()=>({...r(x)(),duration:200,easing:di})),_(e,A),ze()}Mt(["mousedown","click"]);var FR=Z('<a class="example-card svelte-1tjvg83"><div class="example-info svelte-1tjvg83"><div class="example-name svelte-1tjvg83"> </div> <div class="example-description svelte-1tjvg83"> </div></div> <div class="example-preview svelte-1tjvg83"><img class="svelte-1tjvg83"/></div></a>'),BR=Z('<div class="dialog-backdrop" role="presentation"><div class="modal glass-panel svelte-1tjvg83" role="dialog" tabindex="-1"><div class="version-info svelte-1tjvg83"> </div> <div class="header svelte-1tjvg83"><img alt="PathView" class="logo svelte-1tjvg83"/></div> <div class="actions svelte-1tjvg83"><button class="action-card svelte-1tjvg83"><!> <span class="action-label svelte-1tjvg83">New</span></button> <a href="https://pathsim.org" target="_blank" class="action-card svelte-1tjvg83"><!> <span class="action-label svelte-1tjvg83">Home</span></a> <a href="https://docs.pathsim.org" target="_blank" class="action-card svelte-1tjvg83"><!> <span class="action-label svelte-1tjvg83">Docs</span></a> <a href="https://github.com/pathsim/pathview" target="_blank" class="action-card svelte-1tjvg83"><!> <span class="action-label svelte-1tjvg83">GitHub</span></a> <a href="https://github.com/pathsim/pathview/issues/new/choose" target="_blank" class="action-card svelte-1tjvg83"><!> <span class="action-label svelte-1tjvg83">Issue</span></a> <a href="https://milanrother.com/#services" target="_blank" class="action-card svelte-1tjvg83"><!> <span class="action-label svelte-1tjvg83">Consulting</span></a></div> <div class="separator svelte-1tjvg83"></div> <div class="examples-section svelte-1tjvg83"><div class="examples-grid svelte-1tjvg83"></div></div></div></div>');function qR(e,t){Oe(t,!0);const n=[{filename:"feedback-system.json",basename:"feedback-system",name:"Feedback System",description:"Linear feedback system with delayed step excitation"},{filename:"harmonic-oscillator.json",basename:"harmonic-oscillator",name:"Harmonic Oscillator",description:"Linear spring-mass-damper system"},{filename:"squarewave-lpf.json",basename:"squarewave-lpf",name:"Squarewave LPF",description:"Low pass filtering of a square wave"},{filename:"pid-subsystem.json",basename:"pid-subsystem",name:"PID Loop",description:"Classic PID control loop as subsystem"},{filename:"thermostat.json",basename:"thermostat",name:"Thermostat",description:"Relay based thermostat heating system"},{filename:"cascade-subsystem.json",basename:"cascade-subsystem",name:"Cascade PI",description:"Cascade PI controller with subsystems"},{filename:"bouncing-ball.json",basename:"bouncing-ball",name:"Bouncing Ball",description:"Bouncing ball with event-based collision"},{filename:"fmcw-radar.json",basename:"fmcw-radar",name:"FMCW Radar",description:"Frequency-modulated continuous wave radar"},{filename:"vanderpol.json",basename:"vanderpol",name:"Van der Pol",description:"Van der Pol oscillator system"}];let i=$(!0);tr(()=>{const O=()=>{E(i,document.documentElement.getAttribute("data-theme")!=="light")};O();const I=new MutationObserver(O);return I.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>I.disconnect()});function s(){t.onNew(),t.onClose()}function o(O){O.key==="Escape"&&t.onClose()}var a=BR();ht("keydown",Ot,o),a.__click=function(...O){t.onClose?.apply(this,O)},a.__keydown=O=>O.key==="Escape"&&t.onClose();var l=M(a);l.__click=O=>O.stopPropagation();var d=M(l),c=M(d);C(d);var u=q(d,2),p=M(u);C(u);var f=q(u,2),h=M(f);h.__click=s;var g=M(h);He(g,{name:"new-canvas",size:20}),Kt(2),C(h);var y=q(h,2),b=M(y);He(b,{name:"home",size:20}),Kt(2),C(y);var m=q(y,2),x=M(m);He(x,{name:"book",size:20}),Kt(2),C(m);var S=q(m,2),v=M(S);He(v,{name:"github",size:20}),Kt(2),C(S);var A=q(S,2),w=M(A);He(w,{name:"alert-triangle",size:20}),Kt(2),C(A);var k=q(A,2),N=M(k);He(N,{name:"activity",size:20}),Kt(2),C(k),C(f);var L=q(f,4),X=M(L);it(X,21,()=>n,_t,(O,I)=>{var H=FR(),P=M(H),T=M(P),R=M(T,!0);C(T);var B=q(T,2),V=M(B,!0);C(B),C(P);var F=q(P,2),Y=M(F);C(F),C(H),G(()=>{z(H,"href",`?model=${Ir??""}/examples/${r(I).filename??""}`),Fe(R,r(I).name),Fe(V,r(I).description),z(Y,"src",`${Ir??""}/examples/screenshots/${r(I).basename??""}-${r(i)?"dark":"light"}.png`),z(Y,"alt",`${r(I).name??""} preview`)}),ht("error",Y,J=>{J.currentTarget.style.display="none"}),t1(Y),_(O,H)}),C(X),C(L),C(l),C(a),G(O=>{Fe(c,`PathView ${VE} Â· ${O??""}`),z(p,"src",`${Ir??""}/pathview_logo.png`)},[()=>Object.entries(WE).map(([O,I])=>`${O.replace("_","-")} ${I}`).join(" Â· ")]),St(3,l,()=>Ei,()=>({start:.95,duration:200,easing:di})),St(3,a,()=>mn,()=>({duration:150})),_(e,a),ze()}Mt(["click","keydown"]);var VR=Z("<button><!></button>"),WR=Z('<nav class="breadcrumb glass-panel svelte-terbma"></nav>');function KR(e,t){Oe(t,!0);let n=$(Et([])),i=$(!0);const s=ee.breadcrumbs.subscribe(u=>{E(n,u,!0),E(i,u.length<=1)});jt(s);function o(u){ee.navigateTo(u)}function a(u,p){(u.key==="Enter"||u.key===" ")&&(u.preventDefault(),o(p))}var l=pe(),d=ae(l);{var c=u=>{var p=WR();it(p,21,()=>r(n),_t,(f,h,g)=>{var y=VR();let b;y.__click=()=>o(g),y.__keydown=v=>a(v,g);var m=M(y);{var x=v=>{He(v,{name:"home",size:14})},S=v=>{var A=Ih();G(()=>Fe(A,r(h).name)),_(v,A)};j(m,v=>{g===0?v(x):v(S,!1)})}C(y),G(()=>{b=qe(y,1,"crumb-pill svelte-terbma",null,b,{current:g===r(n).length-1}),y.disabled=g===r(n).length-1}),_(f,y)}),C(p),St(3,p,()=>Hu,()=>({y:-10,duration:150})),_(u,p)};j(d,u=>{r(i)||u(c)})}_(e,l),ze()}Mt(["click","keydown"]);var jR=Z('<div class="dialog-backdrop" role="presentation"><div class="confirmation-dialog glass-panel svelte-nz2mwq" role="alertdialog" aria-modal="true" aria-labelledby="confirmation-title" aria-describedby="confirmation-message"><div class="dialog-header"><span id="confirmation-title"> </span> <button class="icon-btn" aria-label="Close"><!></button></div> <div class="dialog-body svelte-nz2mwq"><p id="confirmation-message" class="svelte-nz2mwq"> </p></div> <div class="dialog-actions svelte-nz2mwq"><button class="ghost svelte-nz2mwq"> </button> <button class="svelte-nz2mwq"> </button></div></div></div>');function XR(e,t){Oe(t,!0);let n=$(Et({open:!1,options:null}));Rr.subscribe(u=>{E(n,{open:u.open,options:u.options},!0)});function i(){Rr.confirm()}function s(){Rr.cancel()}function o(u){u.target===u.currentTarget&&s()}function a(u){r(n).open&&(u.key==="Escape"?s():u.key==="Enter"&&i())}var l=pe();ht("keydown",Ot,a);var d=ae(l);{var c=u=>{var p=jR();p.__click=o;var f=M(p),h=M(f),g=M(h),y=M(g,!0);C(g);var b=q(g,2);b.__click=s;var m=M(b);He(m,{name:"x",size:16}),C(b),C(h);var x=q(h,2),S=M(x),v=M(S,!0);C(S),C(x);var A=q(x,2),w=M(A);w.__click=s;var k=M(w,!0);C(w);var N=q(w,2);N.__click=i;var L=M(N,!0);C(N),C(A),C(f),C(p),G(()=>{Fe(y,r(n).options.title),Fe(v,r(n).options.message),Fe(k,r(n).options.cancelText),Fe(L,r(n).options.confirmText)}),St(3,f,()=>Ei,()=>({start:.95,duration:150,easing:di})),St(3,p,()=>mn,()=>({duration:150})),_(u,p)};j(d,u=>{r(n).open&&r(n).options&&u(c)})}_(e,l),ze()}Mt(["click"]);var GR=Z('<link rel="icon" type="image/png"/> <link rel="preconnect" href="https://fonts.googleapis.com"/> <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/> <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&amp;family=JetBrains+Mono:wght@400;500&amp;display=swap" rel="stylesheet"/>',1),UR=Z('<button class="toolbar-btn stop svelte-1uha8ag" aria-label="Stop"><!></button>'),YR=Z('<span class="loading-status svelte-1uha8ag"> </span> <span class="spinner svelte-1uha8ag"><!></span>',1),ZR=Z('<div><button aria-label="Run"><!></button></div>'),JR=Z('<span class="icon-crossfade-item svelte-1uha8ag"><!></span>'),QR=Z('<span class="icon-crossfade-item svelte-1uha8ag"><!></span>'),$R=Z('<span class="icon-crossfade-item svelte-1uha8ag"><!></span>'),eO=Z('<span class="icon-crossfade-item svelte-1uha8ag"><!></span>'),tO=Z('<div class="panel-padding svelte-1uha8ag"><!></div>'),nO=Z('<button><!> <span class="header-tab-title svelte-1uha8ag"> </span></button>'),iO=Z('<div class="header-tabs svelte-1uha8ag"></div>'),sO=Z("<span>Results</span> <!>",1),oO=Z('<button class="icon-btn ghost"><!></button>'),aO=Z('<!> <button class="icon-btn ghost" aria-label="Plot options"><!></button>',1),rO=Z("<span>Console</span>"),lO=Z('<button class="icon-btn ghost" aria-label="Clear console"><!></button>'),cO=Z('<div class="app svelte-1uha8ag"><button class="logo-overlay svelte-1uha8ag" aria-label="Welcome"><img alt="PathView" class="svelte-1uha8ag"/></button> <div class="canvas-layer svelte-1uha8ag"><!></div> <div class="subsystem-breadcrumb svelte-1uha8ag"><!></div>  <div class="toolbar-container svelte-1uha8ag"><div class="toolbar-group svelte-1uha8ag"><!> <button aria-label="Continue"><!></button></div> <div class="toolbar-group svelte-1uha8ag"><button class="toolbar-btn svelte-1uha8ag" aria-label="New"><!></button> <button class="toolbar-btn svelte-1uha8ag" aria-label="Open/Import"><!></button> <button class="toolbar-btn svelte-1uha8ag" aria-label="Save"><span class="icon-crossfade svelte-1uha8ag"><!></span></button> <button class="toolbar-btn svelte-1uha8ag" aria-label="Save As"><span class="icon-crossfade svelte-1uha8ag"><!></span></button> <button class="toolbar-btn svelte-1uha8ag" aria-label="View Python Code"><!></button></div> <div class="toolbar-group svelte-1uha8ag"><button class="toolbar-btn svelte-1uha8ag" aria-label="Keyboard shortcuts"><!></button></div></div>  <div class="panel-toggles svelte-1uha8ag"><div class="toggle-group svelte-1uha8ag"><button aria-label="Blocks"><!></button> <button aria-label="Events"><!></button> <button aria-label="Editor"><!></button></div> <div class="toggle-group svelte-1uha8ag"><button aria-label="Results"><!></button> <button aria-label="Console"><!></button></div> <div class="toggle-group svelte-1uha8ag"><button aria-label="Simulation"><!></button></div> <div class="toggle-group svelte-1uha8ag"><button aria-label="Pin Previews"><!></button> <button class="toggle-btn svelte-1uha8ag" aria-label="Toggle theme"><!></button></div></div> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!></div>');function bO(e,t){Oe(t,!0);const n=()=>Hf(EP,"$currentFileName",s),i=()=>Hf(Ic,"$codePreviewStore",s),[s,o]=n1();let a=$(Et({x:0,y:0})),l=$(null),d;function c(K){clearTimeout(d),E(l,K,!0),d=setTimeout(()=>{E(l,null)},1500)}async function u(){await MP()&&c("save")}async function p(){await dv()&&c("save-as")}let f=$(!1),h=$(!1),g=$(!1),y=$(!1),b=$(!1),m=$(!1),x=$(280),S=$(280),v=$(.5),A=$(!1),w=$(!1),k=$(!1);function N(){if(typeof window>"u")return null;const K=new URLSearchParams(window.location.search),ne=K.get("model"),Te=K.get("modelgh");return ne?{url:ne,isGitHub:!1}:Te?{url:Te,isGitHub:!0}:null}const L=N();let X=$(!L),O=$(void 0),I=$(void 0),H=$(320),P=$(280),T=$(400);const R=310;let B=$(Et(typeof window<"u"?window.innerWidth:1920)),V=$(Et(typeof window<"u"?window.innerHeight:1080));function F(){return typeof window>"u"?800:window.innerWidth-Th-ks*3}const Y=D(()=>r(b)&&r(m)?F()-Vi:void 0);ut(()=>{if(r(b)&&r(m)){if(r(O)===void 0||r(I)===void 0){const K=F(),ne=Math.floor(K*r(v));E(O,ne,!0),E(I,K-ne)}}else E(O,void 0),E(I,void 0)});function J(K){if(!r(b)||!r(m))return;const ne=F(),Te=Math.max(Vi,Math.min(ne-Vi,K));E(O,Te,!0),E(I,ne-Te),E(v,Te/ne)}function ie(K){if(!r(b)||!r(m))return;const ne=F(),Te=Math.max(Vi,Math.min(ne-Vi,K));E(I,Te,!0),E(O,ne-Te),E(v,(ne-Te)/ne)}function ve(){if(E(B,window.innerWidth,!0),E(V,window.innerHeight,!0),r(b)&&r(m)&&r(O)!==void 0&&r(I)!==void 0){const K=F(),ne=Math.max(Vi,Math.min(K-Vi,Math.floor(K*r(v))));E(O,ne,!0),E(I,K-ne)}}const re=12,me=5,ge=40,Q=50,oe=D(()=>()=>!r(b)&&!r(m)?0:r(b)&&r(m)?r(S)+re:(r(b)?r(x):r(S))+re);function ue(){r(h)?E(h,!1):(E(g,!1),E(h,!0),setTimeout(()=>r(Pe)?.focus(),50))}function le(){r(g)?E(g,!1):(E(h,!1),E(g,!0))}function te(){r(f)?E(f,!1):(E(y,!1),E(f,!0))}function be(){r(y)?E(y,!1):(E(f,!1),E(y,!0),setTimeout(()=>r(Re)?.focus(),50))}const fe=D(()=>()=>!r(b)&&!r(m)?0:r(b)&&r(m)?r(x)+re:(r(b)?r(x):r(S))+re);ut(()=>{if(typeof window>"u")return;r(B),r(V),r(H),r(P),r(T);const K=r(h)?r(H):r(g)?r(P):0,ne=Th+ks+(K>0?K+ks:0),Te=r(y)?r(T):r(f)?R:0,ot=(Te>0?Te+ks:0)+20;let Ke=20;r(b)&&r(m)?Ke=Math.max(r(x),r(S))+ks+20:r(b)?Ke=r(x)+ks+20:r(m)&&(Ke=r(S)+ks+20);const dt=Uv+20;pC({top:dt,right:ot,bottom:Ke,left:ne})});let Pe=$(void 0),Re=$(void 0),Se=$(!1),Ce=$(!1),ke=$(!1),Ne=$(!1),$e=$(!1),Me=$(Et({x:0,y:0})),Ae=$(null);const xt={toggleNodeLibrary:ue,toggleEventsPanel:le,deleteNodes:U};function It(){return eR(r(Ae),r(Me),xt)}function U(K){K.length!==0&&De.mutate(()=>{for(const ne of K)ee.removeNode(ne)})}let we=$(0),W=$(!1),se=$(!1),he=$(!1),Be=!1,Ye=!1,je=$(!1),rt=$("Ready"),Lt=$("dark"),Le=$(0),st=$(0),at=$("tabs"),Je=$(Et([])),Ze=$(Et([]));const bt={text:"Continue",shortcut:"Shift+Enter"};tr(()=>{YE().then(()=>UE());const K=Zl.subscribe(Qe=>{E(A,Qe,!0)}),ne=yi.subscribe(Qe=>{E($e,Qe.open,!0),E(Me,Qe.position,!0),E(Ae,Qe.target,!0)}),Te=es.subscribe(Qe=>{E(Lt,Qe,!0)}),ot=ee.nodesArray.subscribe(Qe=>{E(we,Qe.length,!0)}),Ke=or.subscribe(Qe=>{E(W,Qe.initialized,!0),E(se,Qe.loading,!0),Qe.loading?E(rt,Qe.progress||"Loading...",!0):Qe.error?E(rt,`Error: ${Qe.error}`):Qe.initialized&&E(rt,"Ready")}),dt=nn.subscribe(Qe=>{E(he,Qe.phase==="running"),E(je,Qe.result!==null),Qe.phase==="running"?E(rt,Qe.progress||"Simulating...",!0):Qe.error?E(rt,`Error: ${Qe.error}`):r(W)&&E(rt,"Ready");const fn=[],fi=[];Qe.result?.scopeData&&Object.entries(Qe.result.scopeData).forEach(([Ut,wn],Xn)=>{const pi=Qe.result?.nodeNames?.[Ut]||`Scope ${Xn+1}`;fn.push({id:Ut,type:"scope",title:pi});for(let Tn=0;Tn<wn.signals.length;Tn++)fi.push({nodeId:Ut,nodeType:"scope",nodeName:pi,signalIndex:Tn,signalLabel:wn.labels?.[Tn]||`port ${Tn}`})}),Qe.result?.spectrumData&&Object.entries(Qe.result.spectrumData).forEach(([Ut,wn],Xn)=>{const pi=Qe.result?.nodeNames?.[Ut]||`Spectrum ${Xn+1}`;fn.push({id:Ut,type:"spectrum",title:pi});for(let Tn=0;Tn<wn.magnitude.length;Tn++)fi.push({nodeId:Ut,nodeType:"spectrum",nodeName:pi,signalIndex:Tn,signalLabel:wn.labels?.[Tn]||`port ${Tn}`})}),E(Je,fn,!0),E(Ze,fi,!0),r(st)>=fn.length&&fn.length>0&&E(st,0)}),qt=Bt.subscribe(Qe=>{E(Le,Qe.length,!0)});cv();const un=RP(3e4),Vt=ee.nodesArray.subscribe(()=>{ph()}),Mn=ee.connections.subscribe(()=>{ph()}),bn=()=>gt(),Ht=()=>{r(je)&&r(W)&&!r(he)&&!Ye&&At()};return window.addEventListener("run-simulation",bn),window.addEventListener("continue-simulation",Ht),Cn(),()=>{K(),ne(),Te(),ot(),Ke(),dt(),qt(),un(),Vt(),Mn(),window.removeEventListener("run-simulation",bn),window.removeEventListener("continue-simulation",Ht)}});function vt(K){const ne=nm(K);if(K.shiftKey&&K.key==="Enter"){K.preventDefault(),r(je)&&r(W)&&!r(he)&&!Ye&&At();return}if(K.metaKey||K.ctrlKey)switch(K.key.toLowerCase()){case"s":K.preventDefault(),K.shiftKey?p():u();return;case"o":K.preventDefault(),on();return;case"e":K.preventDefault(),E(Se,!0);return;case"f":K.preventDefault(),E(ke,!0);return;case"d":K.preventDefault(),De.mutate(()=>ee.duplicateSelected());return;case"c":ne||(K.preventDefault(),Si.copy());return;case"x":ne||(K.preventDefault(),Si.cut());return;case"v":if(!ne){K.preventDefault();const Te=xi(r(a));Si.paste(Te)}return;case"a":ne||(K.preventDefault(),ee.selectAll());return;case"z":K.preventDefault(),K.shiftKey?De.redo():De.undo();return;case"y":K.preventDefault(),De.redo();return;case"enter":K.preventDefault(),gt();return}if(!ne)switch(K.key){case"Escape":r($e)?yi.close():r(Se)?E(Se,!1):r(Ce)?E(Ce,!1):zp()?Mr():r(he)?jp():r(m)?E(m,!1):r(b)?E(b,!1):r(y)?E(y,!1):r(h)?E(h,!1):r(g)?E(g,!1):r(f)&&E(f,!1);return;case"f":K.preventDefault(),Qi();return;case"s":K.preventDefault(),te();return;case"e":K.preventDefault(),be();return;case"v":K.preventDefault(),E(b,!r(b));return;case"c":K.preventDefault(),E(m,!r(m));return;case"p":K.preventDefault(),Zl.toggle();return;case"l":K.preventDefault(),ff.toggle();return;case"b":K.preventDefault(),ue();return;case"n":K.preventDefault(),le();return;case"h":K.preventDefault(),ee.isAtRoot()||ee.navigateTo(0);return;case"t":K.preventDefault(),es.toggle();return;case"+":case"=":!K.ctrlKey&&!K.metaKey&&(K.preventDefault(),hC());return;case"-":!K.ctrlKey&&!K.metaKey&&(K.preventDefault(),gC());return;case"?":K.preventDefault(),E(Ce,!r(Ce));return;case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":K.preventDefault(),kt(K.key,K.shiftKey);return}}function kt(K,ne){const Te=zp(),ot=ne?Ct*5:Ct*2,Ke=ne?Ct*2:Ct,dt={x:0,y:0};switch(K){case"ArrowUp":dt.y=Te?-Ke:ot;break;case"ArrowDown":dt.y=Te?Ke:-ot;break;case"ArrowLeft":dt.x=Te?-Ke:ot;break;case"ArrowRight":dt.x=Te?Ke:-ot;break}Te?yC(dt):mC(dt)}async function gt(){if(!(r(he)||Be||r(se))){if(Be=!0,!r(W))try{await Rm()}catch(K){console.error("Failed to initialize Pyodide:",K),Be=!1;return}try{const{nodes:K,connections:ne}=ee.toJSON();if(K.length===0){E(rt,"Add nodes first");return}r(k)||(E(m,!0),E(k,!0));const Te=Fn.getCode();try{E(rt,"Validating...");const ot=await h3(K,Te);if(!ot.valid){E(m,!0),Bt.error("Validation failed:");for(const Ke of ot.errors)if(Ke.nodeId==="__code_context__")Bt.error(`  Code context: ${Ke.error}`);else{const qt=K.find(un=>un.id===Ke.nodeId)?.name||Ke.nodeId;Bt.error(`  ${qt}.${Ke.param}: ${Ke.error}`)}E(rt,"Validation failed");return}}catch(ot){E(m,!0),Bt.error(`Validation error: ${ot}`),E(rt,"Validation error");return}try{const ot=pt.toJSON();await u3(K,ne,Pn.get(),Te,ot),r(w)||(E(b,!0),E(w,!0))}catch(ot){E(m,!0),console.error("Simulation failed:",ot)}}finally{Be=!1}}}async function At(){if(!(!r(W)||!r(je)||r(he)||Ye)){Ye=!0;try{const K=Pn.get().duration,ne=K?.trim()?String(K):String(Wi.duration);await lT(ne)}catch(K){E(m,!0),console.error("Continue simulation failed:",K)}finally{Ye=!1}}}async function gn(){r(we)>0&&!await Rr.show({title:"Unsaved Changes",message:"Creating a new file will discard your current work. Continue?",confirmText:"Discard & Create New",cancelText:"Cancel"})||(DP(),window.location.search&&window.history.replaceState({},"",window.location.pathname))}async function on(){const K=await pv();K.success&&K.type==="model"&&setTimeout(()=>Qi(),100)}function Xt(K){const ne=K.split("/");if(ne.length<3)throw new Error("Invalid GitHub shorthand. Use: owner/repo/path/to/file.pvm");const Te=ne[0],ot=ne[1],Ke=ne.slice(2),dt="main",qt=Ke.join("/");return`https://raw.githubusercontent.com/${Te}/${ot}/${dt}/${qt}`}async function Cn(){if(!L)return;let K;try{K=L.isGitHub?Xt(L.url):L.url}catch{Bt.error(`Invalid GitHub shorthand: ${L.url}`),Bt.error("Expected format: owner/repo/path/to/file.pvm"),E(m,!0);return}const ne=await HP(K);ne.success?setTimeout(()=>Qi(),100):ne.error&&(Bt.error(`Failed to load model from URL: ${K}`),Bt.error(ne.error),E(m,!0))}let zn=0,En=0;function ln(K){let ne=kC();const Te=Date.now();Te-En>2e3&&(zn=0);const ot=zn%me*ge,Ke=Math.floor(zn/me)*Q;ne={x:ne.x+ot-ge*2,y:ne.y+Ke-Q},zn++,En=Te;const dt=De.mutate(()=>ee.addNode(K,ne));dt&&wC(dt.id,ne,r(a))}var Gt=cO();ht("keydown",Ot,vt),ht("resize",Ot,ve),ht("mousemove",Ot,K=>E(a,{x:K.clientX,y:K.clientY},!0)),Ac("1uha8ag",K=>{var ne=GR(),Te=ae(ne);Kt(6),G(()=>z(Te,"href",`${Ir??""}/favicon.png`)),nr(()=>{U0.title="PathView"}),_(K,ne)});var cn=M(Gt);cn.__click=()=>E(X,!0);var Ii=M(cn);C(cn),Ee(cn,(K,ne)=>Ue?.(K,ne),()=>"Welcome");var ce=q(cn,2),xe=M(ce);$P(xe,{}),C(ce);var Ve=q(ce,2),lt=M(Ve);KR(lt,{}),C(Ve);var et=q(Ve,2);et.__mousedown=()=>Mr();var tt=M(et),Ge=M(tt);{var ct=K=>{var ne=UR();ne.__click=function(...ot){jp?.apply(this,ot)};var Te=M(ne);He(Te,{name:"stop-filled",size:16}),C(ne),Ee(ne,(ot,Ke)=>Ue?.(ot,Ke),()=>({text:"Stop",shortcut:"Esc"})),_(K,ne)},mt=K=>{var ne=ZR();let Te;var ot=M(ne);let Ke;ot.__click=gt;var dt=M(ot);{var qt=Vt=>{var Mn=YR(),bn=ae(Mn),Ht=M(bn,!0);C(bn);var Qe=q(bn,2),fn=M(Qe);He(fn,{name:"loader",size:16}),C(Qe),G(()=>Fe(Ht,r(rt))),_(Vt,Mn)},un=Vt=>{He(Vt,{name:"play-filled",size:16})};j(dt,Vt=>{r(se)?Vt(qt):Vt(un,!1)})}C(ot),Ee(ot,(Vt,Mn)=>Ue?.(Vt,Mn),()=>({text:r(W)?"Run":"Initialize & Run",shortcut:"Ctrl+Enter"})),C(ne),G(()=>{Te=qe(ne,1,"run-btn-wrapper svelte-1uha8ag",null,Te,{loading:r(se)}),Ke=qe(ot,1,"toolbar-btn run-btn svelte-1uha8ag",null,Ke,{active:!r(se),loading:r(se)}),ot.disabled=r(se)}),_(K,ne)};j(Ge,K=>{r(he)?K(ct):K(mt,!1)})}var Nt=q(Ge,2);let ft;Nt.__click=At;var dn=M(Nt);He(dn,{name:"skip-forward-filled",size:16}),C(Nt),Ee(Nt,(K,ne)=>Ue?.(K,ne),()=>bt),C(tt);var Dt=q(tt,2),zt=M(Dt);zt.__click=gn;var cr=M(zt);He(cr,{name:"new-canvas",size:16}),C(zt),Ee(zt,(K,ne)=>Ue?.(K,ne),()=>"New");var As=q(zt,2);As.__click=on;var ns=M(As);He(ns,{name:"download",size:16}),C(As),Ee(As,(K,ne)=>Ue?.(K,ne),()=>({text:"Open/Import",shortcut:"Ctrl+O"}));var Vn=q(As,2);Vn.__click=()=>u();var sl=M(Vn),nd=M(sl);{var id=K=>{var ne=JR(),Te=M(ne);He(Te,{name:"check",size:16}),C(ne),St(1,ne,()=>mn,()=>({duration:200})),St(2,ne,()=>mn,()=>({duration:200})),_(K,ne)},is=K=>{var ne=QR(),Te=M(ne);He(Te,{name:"upload",size:16}),C(ne),St(1,ne,()=>mn,()=>({duration:200})),St(2,ne,()=>mn,()=>({duration:200})),_(K,ne)};j(nd,K=>{r(l)==="save"?K(id):K(is,!1)})}C(sl),C(Vn),Ee(Vn,(K,ne)=>Ue?.(K,ne),()=>({text:n()?`Save '${n()}'`:"Save",shortcut:"Ctrl+S"}));var Wn=q(Vn,2);Wn.__click=()=>p();var ol=M(Wn),sd=M(ol);{var od=K=>{var ne=$R(),Te=M(ne);He(Te,{name:"check",size:16}),C(ne),St(1,ne,()=>mn,()=>({duration:200})),St(2,ne,()=>mn,()=>({duration:200})),_(K,ne)},ss=K=>{var ne=eO(),Te=M(ne);He(Te,{name:"upload-plus",size:16}),C(ne),St(1,ne,()=>mn,()=>({duration:200})),St(2,ne,()=>mn,()=>({duration:200})),_(K,ne)};j(sd,K=>{r(l)==="save-as"?K(od):K(ss,!1)})}C(ol),C(Wn),Ee(Wn,(K,ne)=>Ue?.(K,ne),()=>({text:"Save As",shortcut:"Ctrl+Shift+S"}));var ii=q(Wn,2);ii.__click=()=>E(Se,!0);var ad=M(ii);He(ad,{name:"braces",size:16}),C(ii),Ee(ii,(K,ne)=>Ue?.(K,ne),()=>({text:"Python Code",shortcut:"Ctrl+E"})),C(Dt);var al=q(Dt,2),to=M(al);to.__click=()=>E(Ce,!0);var os=M(to);He(os,{name:"keyboard",size:16}),C(to),Ee(to,(K,ne)=>Ue?.(K,ne),()=>({text:"Shortcuts",shortcut:"?"})),C(al),C(et);var si=q(et,2);si.__mousedown=()=>Mr();var dr=M(si),as=M(dr);let rl;as.__click=ue;var rs=M(as);He(rs,{name:"grid",size:18}),C(as),Ee(as,(K,ne)=>Ue?.(K,ne),()=>({text:"Blocks",shortcut:"B",position:"right"}));var Ln=q(as,2);let ll;Ln.__click=le;var rd=M(Ln);He(rd,{name:"zap",size:18}),C(Ln),Ee(Ln,(K,ne)=>Ue?.(K,ne),()=>({text:"Events",shortcut:"N",position:"right"}));var Ds=q(Ln,2);let Ni;Ds.__click=be;var ls=M(Ds);He(ls,{name:"code",size:18}),C(Ds),Ee(Ds,(K,ne)=>Ue?.(K,ne),()=>({text:"Editor",shortcut:"E",position:"right"})),C(dr);var ur=q(dr,2),cs=M(ur);let cl;cs.__click=()=>E(b,!r(b));var ds=M(cs);He(ds,{name:"bar-chart",size:18}),C(cs),Ee(cs,(K,ne)=>Ue?.(K,ne),()=>({text:"Results",shortcut:"V",position:"right"}));var Kn=q(cs,2);let dl;Kn.__click=()=>E(m,!r(m));var ld=M(Kn);He(ld,{name:"terminal",size:18}),C(Kn),Ee(Kn,(K,ne)=>Ue?.(K,ne),()=>({text:"Console",shortcut:"C",position:"right"})),C(ur);var fr=q(ur,2),jn=M(fr);let Pi;jn.__click=te;var cd=M(jn);He(cd,{name:"settings",size:18}),C(jn),Ee(jn,(K,ne)=>Ue?.(K,ne),()=>({text:"Simulation",shortcut:"S",position:"right"})),C(fr);var ul=q(fr,2),us=M(ul);let Mi;us.__click=()=>Zl.toggle();var fs=M(us);{let K=D(()=>r(A)?"pin-filled":"pin");He(fs,{get name(){return r(K)},size:18})}C(us),Ee(us,(K,ne)=>Ue?.(K,ne),()=>({text:"Pin Previews",shortcut:"P",position:"right"}));var no=q(us,2);no.__click=()=>es.toggle();var dd=M(no);{let K=D(()=>r(Lt)==="dark"?"sun":"moon");He(dd,{get name(){return r(K)},size:18})}C(no),Ee(no,(K,ne)=>Ue?.(K,ne),()=>({text:r(Lt)==="dark"?"Light mode":"Dark mode",shortcut:"T",position:"right"})),C(ul),C(si);var fl=q(si,2);{var ps=K=>{{let ne=D(()=>r(fe)());Ma(K,{position:"right",title:"Simulation",initialWidth:310,minWidth:310,maxWidth:310,get bottomOffset(){return r(ne)},onClose:()=>E(f,!1),children:(Te,ot)=>{var Ke=tO(),dt=M(Ke);a3(dt,{}),C(Ke),_(Te,Ke)},$$slots:{default:!0}})}};j(fl,K=>{r(f)&&K(ps)})}var Ai=q(fl,2);{var ud=K=>{{let ne=D(()=>r(oe)());Ma(K,{position:"left",get width(){return r(H)},minWidth:280,maxWidth:500,get bottomOffset(){return r(ne)},title:"Blocks",onClose:()=>E(h,!1),onWidthChange:Te=>E(H,Math.min(500,Math.max(280,Te)),!0),children:(Te,ot)=>{Jt(zM(Te,{onAddNode:ln,focusSearch:!0}),Ke=>E(Pe,Ke,!0),()=>r(Pe))},$$slots:{default:!0}})}};j(Ai,K=>{r(h)&&K(ud)})}var pl=q(Ai,2);{var fd=K=>{{let ne=D(()=>r(oe)());Ma(K,{position:"left",get width(){return r(P)},minWidth:200,maxWidth:400,get bottomOffset(){return r(ne)},title:"Events",onClose:()=>E(g,!1),onWidthChange:Te=>E(P,Math.min(400,Math.max(200,Te)),!0),children:(Te,ot)=>{qM(Te,{})},$$slots:{default:!0}})}};j(pl,K=>{r(g)&&K(fd)})}var Di=q(pl,2);{var hs=K=>{{let ne=D(()=>r(fe)());Ma(K,{position:"right",get width(){return r(T)},minWidth:300,maxWidth:700,get bottomOffset(){return r(ne)},title:"Editor",onClose:()=>E(y,!1),onWidthChange:Te=>E(T,Math.min(700,Math.max(300,Te)),!0),children:(Te,ot)=>{Jt(TM(Te,{}),Ke=>E(Re,Ke,!0),()=>r(Re))},$$slots:{default:!0}})}};j(Di,K=>{r(y)&&K(hs)})}var hl=q(Di,2);{var pd=K=>{{const ne=Ke=>{var dt=sO(),qt=q(ae(dt),2);{var un=Vt=>{var Mn=iO();it(Mn,21,()=>r(Je),_t,(bn,Ht,Qe)=>{var fn=nO();let fi;fn.__click=()=>E(st,Qe,!0);var Ut=M(fn);{var wn=ms=>{He(ms,{name:"activity",size:12})},Xn=ms=>{He(ms,{name:"bar-chart-2",size:12})};j(Ut,ms=>{r(Ht).type==="scope"?ms(wn):ms(Xn,!1)})}var pi=q(Ut,2),Tn=M(pi,!0);C(pi),C(fn),G(()=>{fi=qe(fn,1,"header-tab svelte-1uha8ag",null,fi,{active:r(st)===Qe}),z(fn,"title",r(Ht).title),Fe(Tn,r(Ht).title)}),_(bn,fn)}),C(Mn),_(Vt,Mn)};j(qt,Vt=>{r(Je).length>0&&r(at)==="tabs"&&Vt(un)})}_(Ke,dt)},Te=Ke=>{var dt=aO(),qt=ae(dt);{var un=bn=>{var Ht=oO();Ht.__click=()=>E(at,r(at)==="tabs"?"tiles":"tabs",!0);var Qe=M(Ht);{var fn=Ut=>{He(Ut,{name:"grid",size:16})},fi=Ut=>{He(Ut,{name:"square",size:16})};j(Qe,Ut=>{r(at)==="tabs"?Ut(fn):Ut(fi,!1)})}C(Ht),Ee(Ht,(Ut,wn)=>Ue?.(Ut,wn),()=>({text:r(at)==="tabs"?"Show all plots":"Show single plot",position:"bottom"})),G(()=>z(Ht,"aria-label",r(at)==="tabs"?"Show all plots":"Show single plot")),_(bn,Ht)};j(qt,bn=>{r(Je).length>1&&bn(un)})}var Vt=q(qt,2);Vt.__click=()=>E(Ne,!0);var Mn=M(Vt);He(Mn,{name:"settings",size:16}),C(Vt),Ee(Vt,(bn,Ht)=>Ue?.(bn,Ht),()=>({text:"Plot options",position:"bottom"})),_(Ke,dt)};let ot=D(()=>r(m)?"bottom-right":"bottom");Ma(K,{get position(){return r(ot)},initialHeight:280,minHeight:150,get minWidth(){return Vi},get maxWidth(){return r(Y)},get width(){return r(I)},onWidthChange:ie,onClose:()=>E(b,!1),get currentHeight(){return r(x)},set currentHeight(Ke){E(x,Ke,!0)},header:ne,actions:Te,children:(Ke,dt)=>{yM(Ke,{collapsed:!1,get viewMode(){return r(at)},get activeTab(){return r(st)},set activeTab(qt){E(st,qt,!0)}})},$$slots:{header:!0,actions:!0,default:!0}})}};j(hl,K=>{r(b)&&K(pd)})}var gl=q(hl,2);{var gs=K=>{{const ne=Ke=>{var dt=rO();_(Ke,dt)},Te=Ke=>{var dt=lO();dt.__click=()=>Bt.clear();var qt=M(dt);He(qt,{name:"trash",size:16}),C(dt),Ee(dt,(un,Vt)=>Ue?.(un,Vt),()=>({text:"Clear console",position:"bottom"})),_(Ke,dt)};let ot=D(()=>r(b)?"bottom-left":"bottom");Ma(K,{get position(){return r(ot)},initialHeight:280,minHeight:150,get minWidth(){return Vi},get maxWidth(){return r(Y)},get width(){return r(O)},onWidthChange:J,onClose:()=>E(m,!1),get currentHeight(){return r(S)},set currentHeight(Ke){E(S,Ke,!0)},header:ne,actions:Te,children:(Ke,dt)=>{kM(Ke,{})},$$slots:{header:!0,actions:!0,default:!0}})}};j(gl,K=>{r(m)&&K(gs)})}var Ri=q(gl,2);{var hd=K=>{{let ne=D(It);GM(K,{get x(){return r(Me).x},get y(){return r(Me).y},get items(){return r(ne)},onClose:()=>yi.close()})}};j(Ri,K=>{r($e)&&K(hd)})}var ml=q(Ri,2);iR(ml,{get open(){return r(Se)},onClose:()=>E(Se,!1)});var vl=q(ml,2);cR(vl,{get open(){return r(Ce)},onClose:()=>E(Ce,!1)});var Oi=q(vl,2);PR(Oi,{get open(){return r(ke)},onClose:()=>E(ke,!1)});var zi=q(Oi,2);SR(zi,{get open(){return r(Ne)},onClose:()=>E(Ne,!1),get traces(){return r(Ze)}});var yl=q(zi,2);Q3(yl,{});var bl=q(yl,2);rM(bl,{});var wl=q(bl,2);{let K=D(()=>i()!==null),ne=D(()=>i()?.code??""),Te=D(()=>i()?.title??"");Nf(wl,{get open(){return r(K)},get code(){return r(ne)},get title(){return r(Te)},onClose:()=>Ic.close()})}var Li=q(wl,2);LE(Li,{});var Hi=q(Li,2);XR(Hi,{});var gd=q(Hi,2);{var md=K=>{qR(K,{onNew:gn,onClose:()=>E(X,!1)})};j(gd,K=>{r(X)&&K(md)})}C(Gt),G(()=>{z(Ii,"src",`${Ir??""}/pathview_logo.png`),ft=qe(Nt,1,"toolbar-btn svelte-1uha8ag",null,ft,{active:r(je)&&r(W)&&!r(he)}),Nt.disabled=!r(je)||!r(W)||r(he),rl=qe(as,1,"toggle-btn svelte-1uha8ag",null,rl,{active:r(h)}),ll=qe(Ln,1,"toggle-btn svelte-1uha8ag",null,ll,{active:r(g)}),Ni=qe(Ds,1,"toggle-btn svelte-1uha8ag",null,Ni,{active:r(y)}),cl=qe(cs,1,"toggle-btn svelte-1uha8ag",null,cl,{active:r(b)}),dl=qe(Kn,1,"toggle-btn svelte-1uha8ag",null,dl,{active:r(m)}),Pi=qe(jn,1,"toggle-btn svelte-1uha8ag",null,Pi,{active:r(f)}),Mi=qe(us,1,"toggle-btn svelte-1uha8ag",null,Mi,{active:r(A)})}),St(3,et,()=>Hu,()=>({y:-20,duration:200})),_(e,Gt),ze(),o()}Mt(["click","mousedown"]);export{bO as component};
