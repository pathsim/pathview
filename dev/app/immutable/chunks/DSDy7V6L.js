const et=1024;let De=0;class pe{constructor(e,t){this.from=e,this.to=t}}class N{constructor(e={}){this.id=De++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")}),this.combine=e.combine||null}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof e!="function"&&(e=K.match(e)),t=>{let i=e(t);return i===void 0?null:[this,i]}}}N.closedBy=new N({deserialize:l=>l.split(" ")});N.openedBy=new N({deserialize:l=>l.split(" ")});N.group=new N({deserialize:l=>l.split(" ")});N.isolate=new N({deserialize:l=>{if(l&&l!="rtl"&&l!="ltr"&&l!="auto")throw new RangeError("Invalid value for isolate: "+l);return l||"auto"}});N.contextHash=new N({perNode:!0});N.lookAhead=new N({perNode:!0});N.mounted=new N({perNode:!0});class ce{constructor(e,t,i){this.tree=e,this.overlay=t,this.parser=i}static get(e){return e&&e.props&&e.props[N.mounted.id]}}const He=Object.create(null);class K{constructor(e,t,i,r=0){this.name=e,this.props=t,this.id=i,this.flags=r}static define(e){let t=e.props&&e.props.length?Object.create(null):He,i=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(e.name==null?8:0),r=new K(e.name||"",t,e.id,i);if(e.props){for(let n of e.props)if(Array.isArray(n)||(n=n(r)),n){if(n[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");t[n[0].id]=n[1]}}return r}prop(e){return this.props[e.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(e){if(typeof e=="string"){if(this.name==e)return!0;let t=this.prop(N.group);return t?t.indexOf(e)>-1:!1}return this.id==e}static match(e){let t=Object.create(null);for(let i in e)for(let r of i.split(" "))t[r]=e[i];return i=>{for(let r=i.prop(N.group),n=-1;n<(r?r.length:0);n++){let s=t[n<0?i.name:r[n]];if(s)return s}}}}K.none=new K("",Object.create(null),0,8);class ze{constructor(e){this.types=e;for(let t=0;t<e.length;t++)if(e[t].id!=t)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...e){let t=[];for(let i of this.types){let r=null;for(let n of e){let s=n(i);if(s){r||(r=Object.assign({},i.props));let o=s[1],f=s[0];f.combine&&f.id in r&&(o=f.combine(r[f.id],o)),r[f.id]=o}}t.push(r?new K(i.name,r,i.id,i.flags):i)}return new ze(t)}}const oe=new WeakMap,Ce=new WeakMap;var z;(function(l){l[l.ExcludeBuffers=1]="ExcludeBuffers",l[l.IncludeAnonymous=2]="IncludeAnonymous",l[l.IgnoreMounts=4]="IgnoreMounts",l[l.IgnoreOverlays=8]="IgnoreOverlays"})(z||(z={}));class F{constructor(e,t,i,r,n){if(this.type=e,this.children=t,this.positions=i,this.length=r,this.props=null,n&&n.length){this.props=Object.create(null);for(let[s,o]of n)this.props[typeof s=="number"?s:s.id]=o}}toString(){let e=ce.get(this);if(e&&!e.overlay)return e.tree.toString();let t="";for(let i of this.children){let r=i.toString();r&&(t&&(t+=","),t+=r)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":""):t}cursor(e=0){return new xe(this.topNode,e)}cursorAt(e,t=0,i=0){let r=oe.get(this)||this.topNode,n=new xe(r);return n.moveTo(e,t),oe.set(this,n._tree),n}get topNode(){return new M(this,0,0,null)}resolve(e,t=0){let i=re(oe.get(this)||this.topNode,e,t,!1);return oe.set(this,i),i}resolveInner(e,t=0){let i=re(Ce.get(this)||this.topNode,e,t,!0);return Ce.set(this,i),i}resolveStack(e,t=0){return Ue(this,e,t)}iterate(e){let{enter:t,leave:i,from:r=0,to:n=this.length}=e,s=e.mode||0,o=(s&z.IncludeAnonymous)>0;for(let f=this.cursor(s|z.IncludeAnonymous);;){let c=!1;if(f.from<=n&&f.to>=r&&(!o&&f.type.isAnonymous||t(f)!==!1)){if(f.firstChild())continue;c=!0}for(;c&&i&&(o||!f.type.isAnonymous)&&i(f),!f.nextSibling();){if(!f.parent())return;c=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let t in this.props)e.push([+t,this.props[t]]);return e}balance(e={}){return this.children.length<=8?this:ve(K.none,this.children,this.positions,0,this.children.length,0,this.length,(t,i,r)=>new F(this.type,t,i,r,this.propValues),e.makeTree||((t,i,r)=>new F(K.none,t,i,r)))}static build(e){return qe(e)}}F.empty=new F(K.none,[],[],0);class ke{constructor(e,t){this.buffer=e,this.index=t}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new ke(this.buffer,this.index)}}class Q{constructor(e,t,i){this.buffer=e,this.length=t,this.set=i}get type(){return K.none}toString(){let e=[];for(let t=0;t<this.buffer.length;)e.push(this.childString(t)),t=this.buffer[t+3];return e.join(",")}childString(e){let t=this.buffer[e],i=this.buffer[e+3],r=this.set.types[t],n=r.name;if(/\W/.test(n)&&!r.isError&&(n=JSON.stringify(n)),e+=4,i==e)return n;let s=[];for(;e<i;)s.push(this.childString(e)),e=this.buffer[e+3];return n+"("+s.join(",")+")"}findChild(e,t,i,r,n){let{buffer:s}=this,o=-1;for(let f=e;f!=t&&!(Me(n,r,s[f+1],s[f+2])&&(o=f,i>0));f=s[f+3]);return o}slice(e,t,i){let r=this.buffer,n=new Uint16Array(t-e),s=0;for(let o=e,f=0;o<t;){n[f++]=r[o++],n[f++]=r[o++]-i;let c=n[f++]=r[o++]-i;n[f++]=r[o++]-e,s=Math.max(s,c)}return new Q(n,s,this.set)}}function Me(l,e,t,i){switch(l){case-2:return t<e;case-1:return i>=e&&t<e;case 0:return t<e&&i>e;case 1:return t<=e&&i>e;case 2:return i>e;case 4:return!0}}function re(l,e,t,i){for(var r;l.from==l.to||(t<1?l.from>=e:l.from>e)||(t>-1?l.to<=e:l.to<e);){let s=!i&&l instanceof M&&l.index<0?null:l.parent;if(!s)return l;l=s}let n=i?0:z.IgnoreOverlays;if(i)for(let s=l,o=s.parent;o;s=o,o=s.parent)s instanceof M&&s.index<0&&((r=o.enter(e,t,n))===null||r===void 0?void 0:r.from)!=s.from&&(l=o);for(;;){let s=l.enter(e,t,n);if(!s)return l;l=s}}class Oe{cursor(e=0){return new xe(this,e)}getChild(e,t=null,i=null){let r=Ae(this,e,t,i);return r.length?r[0]:null}getChildren(e,t=null,i=null){return Ae(this,e,t,i)}resolve(e,t=0){return re(this,e,t,!1)}resolveInner(e,t=0){return re(this,e,t,!0)}matchContext(e){return me(this.parent,e)}enterUnfinishedNodesBefore(e){let t=this.childBefore(e),i=this;for(;t;){let r=t.lastChild;if(!r||r.to!=t.to)break;r.type.isError&&r.from==r.to?(i=t,t=r.prevSibling):t=r}return i}get node(){return this}get next(){return this.parent}}class M extends Oe{constructor(e,t,i,r){super(),this._tree=e,this.from=t,this.index=i,this._parent=r}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,t,i,r,n=0){for(let s=this;;){for(let{children:o,positions:f}=s._tree,c=t>0?o.length:-1;e!=c;e+=t){let m=o[e],g=f[e]+s.from;if(Me(r,i,g,g+m.length)){if(m instanceof Q){if(n&z.ExcludeBuffers)continue;let d=m.findChild(0,m.buffer.length,t,i-g,r);if(d>-1)return new q(new Le(s,m,e,g),null,d)}else if(n&z.IncludeAnonymous||!m.type.isAnonymous||we(m)){let d;if(!(n&z.IgnoreMounts)&&(d=ce.get(m))&&!d.overlay)return new M(d.tree,g,e,s);let k=new M(m,g,e,s);return n&z.IncludeAnonymous||!k.type.isAnonymous?k:k.nextChild(t<0?m.children.length-1:0,t,i,r)}}}if(n&z.IncludeAnonymous||!s.type.isAnonymous||(s.index>=0?e=s.index+t:e=t<0?-1:s._parent._tree.children.length,s=s._parent,!s))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}prop(e){return this._tree.prop(e)}enter(e,t,i=0){let r;if(!(i&z.IgnoreOverlays)&&(r=ce.get(this._tree))&&r.overlay){let n=e-this.from;for(let{from:s,to:o}of r.overlay)if((t>0?s<=n:s<n)&&(t<0?o>=n:o>n))return new M(r.tree,r.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,t,i)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get tree(){return this._tree}toTree(){return this._tree}toString(){return this._tree.toString()}}function Ae(l,e,t,i){let r=l.cursor(),n=[];if(!r.firstChild())return n;if(t!=null){for(let s=!1;!s;)if(s=r.type.is(t),!r.nextSibling())return n}for(;;){if(i!=null&&r.type.is(i))return n;if(r.type.is(e)&&n.push(r.node),!r.nextSibling())return i==null?n:[]}}function me(l,e,t=e.length-1){for(let i=l;t>=0;i=i.parent){if(!i)return!1;if(!i.type.isAnonymous){if(e[t]&&e[t]!=i.name)return!1;t--}}return!0}class Le{constructor(e,t,i,r){this.parent=e,this.buffer=t,this.index=i,this.start=r}}class q extends Oe{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(e,t,i){super(),this.context=e,this._parent=t,this.index=i,this.type=e.buffer.set.types[e.buffer.buffer[i]]}child(e,t,i){let{buffer:r}=this.context,n=r.findChild(this.index+4,r.buffer[this.index+3],e,t-this.context.start,i);return n<0?null:new q(this.context,this,n)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}prop(e){return this.type.prop(e)}enter(e,t,i=0){if(i&z.ExcludeBuffers)return null;let{buffer:r}=this.context,n=r.findChild(this.index+4,r.buffer[this.index+3],t>0?1:-1,e-this.context.start,t);return n<0?null:new q(this.context,this,n)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,t=e.buffer[this.index+3];return t<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new q(this.context,this._parent,t):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,t=this._parent?this._parent.index+4:0;return this.index==t?this.externalSibling(-1):new q(this.context,this._parent,e.findChild(t,this.index,-1,0,4))}get tree(){return null}toTree(){let e=[],t=[],{buffer:i}=this.context,r=this.index+4,n=i.buffer[this.index+3];if(n>r){let s=i.buffer[this.index+1];e.push(i.slice(r,n,s)),t.push(0)}return new F(this.type,e,t,this.to-this.from)}toString(){return this.context.buffer.childString(this.index)}}function Pe(l){if(!l.length)return null;let e=0,t=l[0];for(let n=1;n<l.length;n++){let s=l[n];(s.from>t.from||s.to<t.to)&&(t=s,e=n)}let i=t instanceof M&&t.index<0?null:t.parent,r=l.slice();return i?r[e]=i:r.splice(e,1),new We(r,t)}class We{constructor(e,t){this.heads=e,this.node=t}get next(){return Pe(this.heads)}}function Ue(l,e,t){let i=l.resolveInner(e,t),r=null;for(let n=i instanceof M?i:i.context.parent;n;n=n.parent)if(n.index<0){let s=n.parent;(r||(r=[i])).push(s.resolve(e,t)),n=s}else{let s=ce.get(n.tree);if(s&&s.overlay&&s.overlay[0].from<=e&&s.overlay[s.overlay.length-1].to>=e){let o=new M(s.tree,s.overlay[0].from+n.from,-1,n);(r||(r=[i])).push(re(o,e,t,!1))}}return r?Pe(r):i}class xe{get name(){return this.type.name}constructor(e,t=0){if(this.mode=t,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof M)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let i=e._parent;i;i=i._parent)this.stack.unshift(i.index);this.bufferNode=e,this.yieldBuf(e.index)}}yieldNode(e){return e?(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0):!1}yieldBuf(e,t){this.index=e;let{start:i,buffer:r}=this.buffer;return this.type=t||r.set.types[r.buffer[e]],this.from=i+r.buffer[e+1],this.to=i+r.buffer[e+2],!0}yield(e){return e?e instanceof M?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,t,i){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,t,i,this.mode));let{buffer:r}=this.buffer,n=r.findChild(this.index+4,r.buffer[this.index+3],e,t-this.buffer.start,i);return n<0?!1:(this.stack.push(this.index),this.yieldBuf(n))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,t,i=this.mode){return this.buffer?i&z.ExcludeBuffers?!1:this.enterChild(1,e,t):this.yield(this._tree.enter(e,t,i))}parent(){if(!this.buffer)return this.yieldNode(this.mode&z.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&z.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode)):!1;let{buffer:t}=this.buffer,i=this.stack.length-1;if(e<0){let r=i<0?0:this.stack[i]+4;if(this.index!=r)return this.yieldBuf(t.findChild(r,this.index,-1,0,4))}else{let r=t.buffer[this.index+3];if(r<(i<0?t.buffer.length:t.buffer[this.stack[i]+3]))return this.yieldBuf(r)}return i<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let t,i,{buffer:r}=this;if(r){if(e>0){if(this.index<r.buffer.buffer.length)return!1}else for(let n=0;n<this.index;n++)if(r.buffer.buffer[n+3]<this.index)return!1;({index:t,parent:i}=r)}else({index:t,_parent:i}=this._tree);for(;i;{index:t,_parent:i}=i)if(t>-1)for(let n=t+e,s=e<0?-1:i._tree.children.length;n!=s;n+=e){let o=i._tree.children[n];if(this.mode&z.IncludeAnonymous||o instanceof Q||!o.type.isAnonymous||we(o))return!1}return!0}move(e,t){if(t&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,t=0){for(;(this.from==this.to||(t<1?this.from>=e:this.from>e)||(t>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,t););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,t=null,i=0;if(e&&e.context==this.buffer)e:for(let r=this.index,n=this.stack.length;n>=0;){for(let s=e;s;s=s._parent)if(s.index==r){if(r==this.index)return s;t=s,i=n+1;break e}r=this.stack[--n]}for(let r=i;r<this.stack.length;r++)t=new q(this.buffer,t,this.stack[r]);return this.bufferNode=new q(this.buffer,t,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,t){for(let i=0;;){let r=!1;if(this.type.isAnonymous||e(this)!==!1){if(this.firstChild()){i++;continue}this.type.isAnonymous||(r=!0)}for(;;){if(r&&t&&t(this),r=this.type.isAnonymous,!i)return;if(this.nextSibling())break;this.parent(),i--,r=!0}}}matchContext(e){if(!this.buffer)return me(this.node.parent,e);let{buffer:t}=this.buffer,{types:i}=t.set;for(let r=e.length-1,n=this.stack.length-1;r>=0;n--){if(n<0)return me(this._tree,e,r);let s=i[t.buffer[this.stack[n]]];if(!s.isAnonymous){if(e[r]&&e[r]!=s.name)return!1;r--}}return!0}}function we(l){return l.children.some(e=>e instanceof Q||!e.type.isAnonymous||we(e))}function qe(l){var e;let{buffer:t,nodeSet:i,maxBufferLength:r=1024,reused:n=[],minRepeatType:s=i.types.length}=l,o=Array.isArray(t)?new ke(t,t.length):t,f=i.types,c=0,m=0;function g(y,v,a,C,b,A){let{id:x,start:u,end:w,size:S}=o,I=m,V=c;if(S<0)if(o.next(),S==-1){let J=n[x];a.push(J),C.push(u-y);return}else if(S==-3){c=x;return}else if(S==-4){m=x;return}else throw new RangeError(`Unrecognized record size: ${S}`);let te=f[x],se,X,Se=u-y;if(w-u<=r&&(X=T(o.pos-v,b))){let J=new Uint16Array(X.size-X.skip),E=o.pos-X.size,H=J.length;for(;o.pos>E;)H=j(X.start,J,H);se=new Q(J,w-X.start,i),Se=X.start-y}else{let J=o.pos-S;o.next();let E=[],H=[],Y=x>=s?x:-1,ee=0,le=w;for(;o.pos>J;)Y>=0&&o.id==Y&&o.size>=0?(o.end<=le-r&&(_(E,H,u,ee,o.end,le,Y,I,V),ee=E.length,le=o.end),o.next()):A>2500?d(u,J,E,H):g(u,J,E,H,Y,A+1);if(Y>=0&&ee>0&&ee<E.length&&_(E,H,u,ee,u,le,Y,I,V),E.reverse(),H.reverse(),Y>-1&&ee>0){let Ne=k(te,V);se=ve(te,E,H,0,E.length,0,w-u,Ne,Ne)}else se=R(te,E,H,w-u,I-w,V)}a.push(se),C.push(Se)}function d(y,v,a,C){let b=[],A=0,x=-1;for(;o.pos>v;){let{id:u,start:w,end:S,size:I}=o;if(I>4)o.next();else{if(x>-1&&w<x)break;x<0&&(x=S-r),b.push(u,w,S),A++,o.next()}}if(A){let u=new Uint16Array(A*4),w=b[b.length-2];for(let S=b.length-3,I=0;S>=0;S-=3)u[I++]=b[S],u[I++]=b[S+1]-w,u[I++]=b[S+2]-w,u[I++]=I;a.push(new Q(u,b[2]-w,i)),C.push(w-y)}}function k(y,v){return(a,C,b)=>{let A=0,x=a.length-1,u,w;if(x>=0&&(u=a[x])instanceof F){if(!x&&u.type==y&&u.length==b)return u;(w=u.prop(N.lookAhead))&&(A=C[x]+u.length+w)}return R(y,a,C,b,A,v)}}function _(y,v,a,C,b,A,x,u,w){let S=[],I=[];for(;y.length>C;)S.push(y.pop()),I.push(v.pop()+a-b);y.push(R(i.types[x],S,I,A-b,u-A,w)),v.push(b-a)}function R(y,v,a,C,b,A,x){if(A){let u=[N.contextHash,A];x=x?[u].concat(x):[u]}if(b>25){let u=[N.lookAhead,b];x=x?[u].concat(x):[u]}return new F(y,v,a,C,x)}function T(y,v){let a=o.fork(),C=0,b=0,A=0,x=a.end-r,u={size:0,start:0,skip:0};e:for(let w=a.pos-y;a.pos>w;){let S=a.size;if(a.id==v&&S>=0){u.size=C,u.start=b,u.skip=A,A+=4,C+=4,a.next();continue}let I=a.pos-S;if(S<0||I<w||a.start<x)break;let V=a.id>=s?4:0,te=a.start;for(a.next();a.pos>I;){if(a.size<0)if(a.size==-3||a.size==-4)V+=4;else break e;else a.id>=s&&(V+=4);a.next()}b=te,C+=S,A+=V}return(v<0||C==y)&&(u.size=C,u.start=b,u.skip=A),u.size>4?u:void 0}function j(y,v,a){let{id:C,start:b,end:A,size:x}=o;if(o.next(),x>=0&&C<s){let u=a;if(x>4){let w=o.pos-(x-4);for(;o.pos>w;)a=j(y,v,a)}v[--a]=u,v[--a]=A-y,v[--a]=b-y,v[--a]=C}else x==-3?c=C:x==-4&&(m=C);return a}let O=[],B=[];for(;o.pos>0;)g(l.start||0,l.bufferStart||0,O,B,-1,0);let D=(e=l.length)!==null&&e!==void 0?e:O.length?B[0]+O[0].length:0;return new F(f[l.topID],O.reverse(),B.reverse(),D)}const _e=new WeakMap;function ue(l,e){if(!l.isAnonymous||e instanceof Q||e.type!=l)return 1;let t=_e.get(e);if(t==null){t=1;for(let i of e.children){if(i.type!=l||!(i instanceof F)){t=1;break}t+=ue(l,i)}_e.set(e,t)}return t}function ve(l,e,t,i,r,n,s,o,f){let c=0;for(let _=i;_<r;_++)c+=ue(l,e[_]);let m=Math.ceil(c*1.5/8),g=[],d=[];function k(_,R,T,j,O){for(let B=T;B<j;){let D=B,y=R[B],v=ue(l,_[B]);for(B++;B<j;B++){let a=ue(l,_[B]);if(v+a>=m)break;v+=a}if(B==D+1){if(v>m){let a=_[D];k(a.children,a.positions,0,a.children.length,R[D]+O);continue}g.push(_[D])}else{let a=R[B-1]+_[B-1].length-y;g.push(ve(l,_,R,D,B,y,a,null,f))}d.push(y+O-n)}}return k(e,t,i,r,0),(o||f)(g,d,s)}class tt{constructor(){this.map=new WeakMap}setBuffer(e,t,i){let r=this.map.get(e);r||this.map.set(e,r=new Map),r.set(t,i)}getBuffer(e,t){let i=this.map.get(e);return i&&i.get(t)}set(e,t){e instanceof q?this.setBuffer(e.context.buffer,e.index,t):e instanceof M&&this.map.set(e.tree,t)}get(e){return e instanceof q?this.getBuffer(e.context.buffer,e.index):e instanceof M?this.map.get(e.tree):void 0}cursorSet(e,t){e.buffer?this.setBuffer(e.buffer.buffer,e.index,t):this.map.set(e.tree,t)}cursorGet(e){return e.buffer?this.getBuffer(e.buffer.buffer,e.index):this.map.get(e.tree)}}class ye{constructor(e,t,i,r,n=!1,s=!1){this.from=e,this.to=t,this.tree=i,this.offset=r,this.open=(n?1:0)|(s?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(e,t=[],i=!1){let r=[new ye(0,e.length,e,0,!1,i)];for(let n of t)n.to>e.length&&r.push(n);return r}static applyChanges(e,t,i=128){if(!t.length)return e;let r=[],n=1,s=e.length?e[0]:null;for(let o=0,f=0,c=0;;o++){let m=o<t.length?t[o]:null,g=m?m.fromA:1e9;if(g-f>=i)for(;s&&s.from<g;){let d=s;if(f>=d.from||g<=d.to||c){let k=Math.max(d.from,f)-c,_=Math.min(d.to,g)-c;d=k>=_?null:new ye(k,_,d.tree,d.offset+c,o>0,!!m)}if(d&&r.push(d),s.to>g)break;s=n<e.length?e[n++]:null}if(!m)break;f=m.toA,c=m.toA-m.toB}return r}}class it{startParse(e,t,i){return typeof e=="string"&&(e=new Fe(e)),i=i?i.length?i.map(r=>new pe(r.from,r.to)):[new pe(0,0)]:[new pe(0,e.length)],this.createParse(e,t||[],i)}parse(e,t,i){let r=this.startParse(e,t,i);for(;;){let n=r.advance();if(n)return n}}}class Fe{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,t){return this.string.slice(e,t)}}new N({perNode:!0});let Ke=0;class P{constructor(e,t,i,r){this.name=e,this.set=t,this.base=i,this.modified=r,this.id=Ke++}toString(){let{name:e}=this;for(let t of this.modified)t.name&&(e=`${t.name}(${e})`);return e}static define(e,t){let i=typeof e=="string"?e:"?";if(e instanceof P&&(t=e),t?.base)throw new Error("Can not derive from a modified tag");let r=new P(i,[],null,[]);if(r.set.push(r),t)for(let n of t.set)r.set.push(n);return r}static defineModifier(e){let t=new de(e);return i=>i.modified.indexOf(t)>-1?i:de.get(i.base||i,i.modified.concat(t).sort((r,n)=>r.id-n.id))}}let Je=0;class de{constructor(e){this.name=e,this.instances=[],this.id=Je++}static get(e,t){if(!t.length)return e;let i=t[0].instances.find(o=>o.base==e&&Ve(t,o.modified));if(i)return i;let r=[],n=new P(e.name,r,e,t);for(let o of t)o.instances.push(n);let s=$e(t);for(let o of e.set)if(!o.modified.length)for(let f of s)r.push(de.get(o,f));return n}}function Ve(l,e){return l.length==e.length&&l.every((t,i)=>t==e[i])}function $e(l){let e=[[]];for(let t=0;t<l.length;t++)for(let i=0,r=e.length;i<r;i++)e.push(e[i].concat(l[t]));return e.sort((t,i)=>i.length-t.length)}function Ge(l){let e=Object.create(null);for(let t in l){let i=l[t];Array.isArray(i)||(i=[i]);for(let r of t.split(" "))if(r){let n=[],s=2,o=r;for(let g=0;;){if(o=="..."&&g>0&&g+3==r.length){s=1;break}let d=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(o);if(!d)throw new RangeError("Invalid path: "+r);if(n.push(d[0]=="*"?"":d[0][0]=='"'?JSON.parse(d[0]):d[0]),g+=d[0].length,g==r.length)break;let k=r[g++];if(g==r.length&&k=="!"){s=0;break}if(k!="/")throw new RangeError("Invalid path: "+r);o=r.slice(g)}let f=n.length-1,c=n[f];if(!c)throw new RangeError("Invalid path: "+r);let m=new ne(i,s,f>0?n.slice(0,f):null);e[c]=m.sort(e[c])}}return Ee.add(e)}const Ee=new N({combine(l,e){let t,i,r;for(;l||e;){if(!l||e&&l.depth>=e.depth?(r=e,e=e.next):(r=l,l=l.next),t&&t.mode==r.mode&&!r.context&&!t.context)continue;let n=new ne(r.tags,r.mode,r.context);t?t.next=n:i=n,t=n}return i}});class ne{constructor(e,t,i,r){this.tags=e,this.mode=t,this.context=i,this.next=r}get opaque(){return this.mode==0}get inherit(){return this.mode==1}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}}ne.empty=new ne([],2,null);function Re(l,e){let t=Object.create(null);for(let n of l)if(!Array.isArray(n.tag))t[n.tag.id]=n.class;else for(let s of n.tag)t[s.id]=n.class;let{scope:i,all:r=null}=e||{};return{style:n=>{let s=r;for(let o of n)for(let f of o.set){let c=t[f.id];if(c){s=s?s+" "+c:c;break}}return s},scope:i}}function Qe(l,e){let t=null;for(let i of l){let r=i.style(e);r&&(t=t?t+" "+r:r)}return t}function je(l,e,t,i=0,r=l.length){let n=new Ye(i,Array.isArray(e)?e:[e],t);n.highlightRange(l.cursor(),i,r,"",n.highlighters),n.flush(r)}function Xe(l,e,t,i,r,n=0,s=l.length){let o=n;function f(c,m){if(!(c<=o)){for(let g=l.slice(o,c),d=0;;){let k=g.indexOf(`
`,d),_=k<0?g.length:k;if(_>d&&i(g.slice(d,_),m),k<0)break;r(),d=k+1}o=c}}je(e,t,(c,m,g)=>{f(c,""),f(m,g)},n,s),f(s,"")}class Ye{constructor(e,t,i){this.at=e,this.highlighters=t,this.span=i,this.class=""}startSpan(e,t){t!=this.class&&(this.flush(e),e>this.at&&(this.at=e),this.class=t)}flush(e){e>this.at&&this.class&&this.span(this.at,e,this.class)}highlightRange(e,t,i,r,n){let{type:s,from:o,to:f}=e;if(o>=i||f<=t)return;s.isTop&&(n=this.highlighters.filter(k=>!k.scope||k.scope(s)));let c=r,m=Te(e)||ne.empty,g=Qe(n,m.tags);if(g&&(c&&(c+=" "),c+=g,m.mode==1&&(r+=(r?" ":"")+g)),this.startSpan(Math.max(t,o),c),m.opaque)return;let d=e.tree&&e.tree.prop(N.mounted);if(d&&d.overlay){let k=e.node.enter(d.overlay[0].from+o,1),_=this.highlighters.filter(T=>!T.scope||T.scope(d.tree.type)),R=e.firstChild();for(let T=0,j=o;;T++){let O=T<d.overlay.length?d.overlay[T]:null,B=O?O.from+o:f,D=Math.max(t,j),y=Math.min(i,B);if(D<y&&R)for(;e.from<y&&(this.highlightRange(e,D,y,r,n),this.startSpan(Math.min(y,e.to),c),!(e.to>=B||!e.nextSibling())););if(!O||B>i)break;j=O.to+o,j>t&&(this.highlightRange(k.cursor(),Math.max(t,O.from+o),Math.min(i,j),"",_),this.startSpan(Math.min(i,j),c))}R&&e.parent()}else if(e.firstChild()){d&&(r="");do if(!(e.to<=t)){if(e.from>=i)break;this.highlightRange(e,t,i,r,n),this.startSpan(Math.min(i,e.to),c)}while(e.nextSibling());e.parent()}}}function Te(l){let e=l.type.prop(Ee);for(;e&&e.context&&!l.matchContext(e.context);)e=e.next;return e||null}const h=P.define,he=h(),$=h(),Be=h($),Ie=h($),G=h(),fe=h(G),ge=h(G),U=h(),Z=h(U),L=h(),W=h(),be=h(),ie=h(be),ae=h(),p={comment:he,lineComment:h(he),blockComment:h(he),docComment:h(he),name:$,variableName:h($),typeName:Be,tagName:h(Be),propertyName:Ie,attributeName:h(Ie),className:h($),labelName:h($),namespace:h($),macroName:h($),literal:G,string:fe,docString:h(fe),character:h(fe),attributeValue:h(fe),number:ge,integer:h(ge),float:h(ge),bool:h(G),regexp:h(G),escape:h(G),color:h(G),url:h(G),keyword:L,self:h(L),null:h(L),atom:h(L),unit:h(L),modifier:h(L),operatorKeyword:h(L),controlKeyword:h(L),definitionKeyword:h(L),moduleKeyword:h(L),operator:W,derefOperator:h(W),arithmeticOperator:h(W),logicOperator:h(W),bitwiseOperator:h(W),compareOperator:h(W),updateOperator:h(W),definitionOperator:h(W),typeOperator:h(W),controlOperator:h(W),punctuation:be,separator:h(be),bracket:ie,angleBracket:h(ie),squareBracket:h(ie),paren:h(ie),brace:h(ie),content:U,heading:Z,heading1:h(Z),heading2:h(Z),heading3:h(Z),heading4:h(Z),heading5:h(Z),heading6:h(Z),contentSeparator:h(U),list:h(U),quote:h(U),emphasis:h(U),strong:h(U),link:h(U),monospace:h(U),strikethrough:h(U),inserted:h(),deleted:h(),changed:h(),invalid:h(),meta:ae,documentMeta:h(ae),annotation:h(ae),processingInstruction:h(ae),definition:P.defineModifier("definition"),constant:P.defineModifier("constant"),function:P.defineModifier("function"),standard:P.defineModifier("standard"),local:P.defineModifier("local"),special:P.defineModifier("special")};for(let l in p){let e=p[l];e instanceof P&&(e.name=l)}const Ze=Re([{tag:p.link,class:"tok-link"},{tag:p.heading,class:"tok-heading"},{tag:p.emphasis,class:"tok-emphasis"},{tag:p.strong,class:"tok-strong"},{tag:p.keyword,class:"tok-keyword"},{tag:p.atom,class:"tok-atom"},{tag:p.bool,class:"tok-bool"},{tag:p.url,class:"tok-url"},{tag:p.labelName,class:"tok-labelName"},{tag:p.inserted,class:"tok-inserted"},{tag:p.deleted,class:"tok-deleted"},{tag:p.literal,class:"tok-literal"},{tag:p.string,class:"tok-string"},{tag:p.number,class:"tok-number"},{tag:[p.regexp,p.escape,p.special(p.string)],class:"tok-string2"},{tag:p.variableName,class:"tok-variableName"},{tag:p.local(p.variableName),class:"tok-variableName tok-local"},{tag:p.definition(p.variableName),class:"tok-variableName tok-definition"},{tag:p.special(p.variableName),class:"tok-variableName2"},{tag:p.definition(p.propertyName),class:"tok-propertyName tok-definition"},{tag:p.typeName,class:"tok-typeName"},{tag:p.namespace,class:"tok-namespace"},{tag:p.className,class:"tok-className"},{tag:p.macroName,class:"tok-macroName"},{tag:p.propertyName,class:"tok-propertyName"},{tag:p.operator,class:"tok-operator"},{tag:p.comment,class:"tok-comment"},{tag:p.meta,class:"tok-meta"},{tag:p.invalid,class:"tok-invalid"},{tag:p.punctuation,class:"tok-punctuation"}]),rt=Object.freeze(Object.defineProperty({__proto__:null,Tag:P,classHighlighter:Ze,getStyleTags:Te,highlightCode:Xe,highlightTree:je,styleTags:Ge,tagHighlighter:Re,tags:p},Symbol.toStringTag,{value:"Module"}));export{et as D,z as I,N,it as P,F as T,Re as a,ye as b,K as c,ze as d,tt as e,je as h,rt as i,Ge as s,p as t};
